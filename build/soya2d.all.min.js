/*
 * Soya2D is a web interactive animation(game) engine for modern web browsers 
 *
 *
 * Copyright 2015-2017 MrSoya and other contributors
 * Released under the MIT license
 *
 * website: http://soya2d.com
 * last build: 2017-01-06
 */
!function(e){"use strict";function t(e,t,n){Object.defineProperties(this,{x:{set:function(e){this.__view.x=e,this.__checkBounds()},get:function(){return this.__view.x}},y:{set:function(e){this.__view.y=e,this.__checkBounds()},get:function(){return this.__view.y}},w:{get:function(){return this.__view.w}},h:{get:function(){return this.__view.h}}}),this.freezone=null,this.__view=new soya2d.Rectangle(0,0,e,t),this.__game=n}function n(e,t){if(e.__renderable){if(e.__fixedToCamera)return;if(!t.intersectWith(e.getBoundingBox()))return e.__renderable=!1,void 0;if(e.children)for(var i=e.children.length;i--;){var o=e.children[i];o.__renderable&&n(o,t)}}}function i(e,t,n){if(e.__renderable){var o=null,s=null;if(e.__fixedToCamera){var o=e.cameraOffset.x+e.anchorPosition.x,s=e.cameraOffset.y+e.anchorPosition.y;n=!0}else n?(o=e.parent.__screenPosition.x-e.parent.anchorPosition.x+e.x+e.anchorPosition.x,s=e.parent.__screenPosition.y-e.parent.anchorPosition.y+e.y+e.anchorPosition.y):(o=e.worldPosition.x,s=e.worldPosition.y,o-=t.x,s-=t.y);if(e.__screenPosition.set(o,s),e.children)for(var r=e.children.length;r--;){var a=e.children[r];a.__renderable&&i(a,t,n)}}}function o(){this.__assets={image:{},sound:{},imageFont:{},atlas:{},text:{},xml:{},json:{}}}function s(){}function r(){this.map={}}function a(e,t,n,i,o){var s=new XMLHttpRequest;s.open("get",e,!0),s.timeout=t,s.ontimeout=n,s.onerror=i,null===s.onload?s.onload=function(){(0===s.status||s.status>=200&&s.status<300||304===s.status)&&o(s)}:s.onreadystatechange=function(){(0===s.status||(s.status>=200&&s.status<300||304===s.status)&&4===s.readyState)&&o(s)},s.send(null)}function l(e,t,n,i,o,s,r,a){setTimeout(function(){if((new Date).getTime()-e>t)return s(a),void 0;for(var c in n){n[c].style.left="-1000px";var u=n[c].offsetWidth,h=n[c].offsetHeight;if(u!==i[c]||h!==o[c])return r(a),void 0}l(e,t,n,i,o,s,r,a)},20)}function c(e,t){soya2d.ext(this,e),this.map={},this.game=t}function u(e,t,n,i){for(var o=0;o<t.childNodes.length;o++){var s=t.childNodes[o];if(3!=s.nodeType){for(var r=s.tagName,a=s.attributes.id?s.attributes.id.value:null,l={},c=s.attributes,f=0;f<c.length;f++){var p=c[f].name;l[p]=c[f].value}i.objects.map[r].prototype.onBuild&&i.objects.map[r].prototype.onBuild(l,s,i);var _=d(r,l,i);h(l,_,e),a&&(e.map[a]=_),n.add(_),s.childNodes.length>0&&u(e,s,_,i)}}}function h(e,t,n){for(var i=Object.keys(e),o=i.length;o--;){var s=i[o],r=e[s];if(0===s.indexOf("on-")){var a=s.substr(3),l=n[r];l instanceof Function?t.on(a,l):soya2d.console.warn('invalid callback "'+r+'" of '+s)}}}function d(e,t,n){var i=new n.objects.map[e](t);return i}function f(e){this.map={},this.game=e}function p(e){this.exp=e,this.times=0,this.priority=0,this.milliseconds=0,this._lastTriggerMilliseconds=-1e3,this._t=[],this._reset=function(){this.times=0,this.milliseconds=0,this._lastTriggerMilliseconds=-1e3,this._t=[],delete this._frameInfo,delete this._timeInfo},this._canUnload=function(){var e=this._timeInfo.hour;if(1===e[2]){if(this._t[2]>e[0])return!0}else if(e[2]>1&&this._t[2]>e[3][e[3].length-1])return!0},this.canTrigger=function(){return y(this)},/^(\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+)) (\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+)) (\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+))$/.test(e)||soya2d.console.error("invalid timer expression -- "+e);var t=_(RegExp.$1),n=_(RegExp.$2),i=_(RegExp.$3);this._timeInfo={sec:t,min:n,hour:i}}function _(e){var t,n,i,o,s;if("*"==e)t=-1,n=0,i=-1;else if((n=parseInt(e))==e)i=1,t=0;else if(2===(s=e.split("/")).length){t=parseInt(s[1]);var r;if(2===(r=s[0].split("-")).length){o=[];for(var a=r[0]>>0,l=r[1]>>0;l>=a;a++)o.push(a);o.sort(function(e,t){return e-t}),i=o.length}else(n=parseInt(s[0]))||(n=0),i=-1}else if((s=e.split(",")).length>1){o=[];for(var t=s.length;t--;)o.push(s[t]>>0);o.sort(function(e,t){return e-t}),i=s.length}else if(2===(s=e.split("-")).length){o=[];for(var a=s[0]>>0,l=s[1]>>0;l>=a;a++)o.push(a);o.sort(function(e,t){return e-t}),i=o.length}return[t,n,i,o]}function y(e){var t=e.milliseconds/1e3,n=e._t[0]=t%60>>0,i=e._t[1]=t/60%60>>0,o=e._t[2]=t/60/60>>0;return m(e._timeInfo.hour,o)?m(e._timeInfo.min,i)?m(e._timeInfo.sec,n)?!0:!1:!1:!1}function m(e,t){if(1===e[2]){if(e[1]!==t)return!1}else if(-1===e[2]&&-1===e[0]);else if(e[3]&&!e[0]){if(e[3].indexOf(t)<0)return!1}else if(-1===e[2]&&e[0]>0||e[0]>0&&e[3]){if(e[3]&&e[3].indexOf(t)<0)return!1;var n=t-e[1];if(0>=n&&0!=e[1])return!1;if(n%e[0])return!1}return!0}function g(e){this.map={},this.game=e}function v(e){this.game=e,this.__newInstanceAndAppend=function(e,t){t.game=this.game;var n=new this.game.objects.map[e](t);return this.game.world.add(n),n}}function x(e,t){if(/^(-?\d+)%$/.test(e)){var n=parseFloat(RegExp.$1)/100;return S(t,n)}return e}function b(e,t){if(/^(-?\d+)%$/.test(e)){var n=parseFloat(RegExp.$1)/100;return A(t,n)}return e}function w(e,t){if(!isNaN(e))return parseFloat(e);var n=t,i=0;return/^(-?\d+)%$/.test(e)&&(i=parseFloat(RegExp.$1)/100),n*i}function S(e,t){var n=e.w;return 0===n&&e.parent?S(e.parent,t):n*t}function A(e,t){var n=e.h;return 0===n&&e.parent?A(e.parent,t):n*t}function T(e,t,n){for(var i=e.children.length;i--;){var o=e.children[i];t(o)&&n.push(o),o.children&&o.children.length>0&&T(o,t,n)}}function M(e){if(e.transform(),e.__renderable=!0,e.children)for(var t=e.children.length;t--;){var n=e.children[t];n.visible&&M(n)}}function C(e,t,n){for(var i=e.length;i--;){var o=e[i];o._onUpdate&&o._onUpdate(t,n),o.onUpdate&&o.onUpdate(t,n),o.children&&o.children.length>0&&C(o.children,t,n)}}function E(e,t,n){for(var i=e.length;i--;){var o=e[i];o._onPostUpdate&&o._onPostUpdate(t,n),o.onPostUpdate&&o.onPostUpdate(t,n),o.children&&o.children.length>0&&E(o.children,t,n)}}function k(e,t,n,i,o){var s;switch(t){case soya2d.ROTATEMODE_90:s="rotate(90deg)";break;case soya2d.ROTATEMODE_180:s="rotate(180deg)";break;case soya2d.ROTATEMODE_270:s="rotate(270deg)";break;case soya2d.ROTATEMODE_0:default:s="rotate(0deg)",o.__rotat=soya2d.ROTATEMODE_0}if(n.style.transform=n.style.webkitTransform=n.style.mozTransform=n.style.msTransform=n.style.oTransform=s,n.style.left=n.style.top=0,t===soya2d.ROTATEMODE_90||t===soya2d.ROTATEMODE_270){var r=n.offsetWidth,a=n.offsetHeight;if(e===soya2d.SCALEMODE_NOBORDER){var l=this.game.w,c=this.game.h;r=r>c?c:r,a=a>l?l:a}if(i.resize(a,r),e===soya2d.SCALEMODE_EXACTFIT){var u=(r-a)/2;u=a%2===0?u:Math.floor(u);var h=(a-r)/2;h=r%2===0?h:Math.floor(h),n.style.left=u+"px",n.style.top=h+"px"}}}function I(){var e,t=window.innerWidth,n=window.innerHeight;return e=t>n?"landscape":"portrait"}function P(e,t,n,i,o,s,r,a){n=r&&n>r?r:n,i=a&&i>a?a:i;var l=Math.max(n/e,i/t),c=e*l,u=t*l;return[c,u]}function O(e,t,n,i,o,s,r,a){n=r&&n>r?r:n,i=a&&i>a?a:i;var l=1;(e>n||t>i)&&(l=Math.min(n/e,i/t));var c=e*l,u=t*l;return[c,u]}function B(e,t,n,i,o,s,r,a){var l,c;return l=o&&o>n?o:r&&n>r?r:n,c=s&&s>i?s:a&&i>a?a:i,[l,c]}function R(e,t,n){this.frames=e,this.index=0,this.lastUpdateTime=0,this.frameRate=t||10,this.loop=n===!1?!1:n||!0}function L(e){this.map={},this.game=e}function D(e,t){var n,i,o=e.w,s=e.h,r=(t.w,t.h),a=t.body.rigid.speed,l=1,c=e.x-e.w/2,u=e.y-e.h/2,h=t.x-t.w/2,d=t.y-t.h/2;h>=c?(n="center",h+a+l>=c+o&&(n="right")):n="left",d>=u?(i="middle",d>u+s&&(i="bottom")):i="top";var f;switch(i){case"top":if(d+r>u)switch(n){case"left":f="left";break;case"right":f="right";break;case"center":f="top"}else f="top";break;case"bottom":f="bottom";break;case"middle":switch(n){case"left":f="left";break;case"right":f="right"}}this.tilemap.emit("tileCollision",t,{direction:f,x:this.x,y:this.y})}e.soya2d=new function(){function e(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype._super=t.prototype}this.__roIndex=0,this.version={v:[2,0,0],state:"beta3",toString:function(){return soya2d.version.v.join(".")+" "+soya2d.version.state}},this.website="http://soya2d.com",this.ext=function(e,t,n){for(var i=Object.keys(t),o=i.length;o--;){var s=i[o];(!e.hasOwnProperty(s)||n)&&(e[s]=t[s])}},this.class=function(t,n){var i=n.constructor,o=n.extends,s=function(){o&&o.apply(this,arguments),i&&i.apply(this,arguments)};o&&e(s,o);for(var r in n)"extends"!==r&&"constructor"!==r&&(s.prototype[r]=n[r]);if(t){var a=t.split("."),l=a[a.length-1],c=self;if(a.length>1)for(var u=0;u<a.length;u++)a[u]!==l&&(c=c[a[u]],c||(c={}));c[l]=s,s.prototype.class=t}return s},this.module=new function(){var e={};this.install=function(t,n){e[t]=n},this._getAll=function(){return e}},this.render=function(e,t,n,i){var o=new soya2d.Game({w:t,h:n,container:e});return o.start(),o.scene.start(i),o}},e.soya=soya2d,self.Int8Array=self.Int8Array||Array,self.Uint8Array=self.Uint8Array||Array,self.Int16Array=self.Int16Array||Array,self.Uint16Array=self.Uint16Array||Array,self.Int32Array=self.Int32Array||Array,self.Uint32Array=self.Uint32Array||Array,self.Float32Array=self.Float32Array||Array,self.console=self.console||new function(){this.log=function(){},this.info=function(){},this.debug=function(){},this.error=function(){},this.warn=function(){}},soya2d.console=new function(){var e=1;this.level=function(t){e=0==t?0:t||1},this.debug=function(t,n){1==e&&(soya2d.Device.ie?console.debug(t):console.debug("%c"+t,n||"padding:1px 50px;font-size:14px;color:#fff;background:#0069D6;"))},this.info=function(t,n){1>e||e>2||(soya2d.Device.ie?console.log(t):console.log("%c"+t,n||"padding:1px 50px;font-size:14px;color:#fff;background:#2DB008;"))},this.warn=function(t,n){1>e||e>3||(soya2d.Device.ie?console.warn(t):console.warn("%c"+t,n||"padding:1px 50px;font-size:14px;color:#fff;background:#FFB502;"))},this.error=function(t,n){1>e||(soya2d.Device.ie?console.error(t):console.error("%c"+t,n||"padding:1px 50px;font-size:14px;color:#fff;background:#ff0000;"))}},self.cancelAFrame=function(e){return e.cancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.clearTimeout}(self),self.requestAFrame=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||function(t){return e.setTimeout(function(){t(Date.now())},16.7)}}(self),soya2d.BLEND_NORMAL="source-over",soya2d.BLEND_LIGHTER="lighter",soya2d.BLEND_MASK="destination-in",soya2d.BLEND_CLEAR="destination-out",soya2d.LINECAP_BUTT="butt",soya2d.LINECAP_ROUND="round",soya2d.LINECAP_SQUARE="square",soya2d.LINEJOIN_BEVEL="bevel",soya2d.LINEJOIN_ROUND="round",soya2d.LINEJOIN_MITER="miter",soya2d.TEXTALIGN_LEFT="left",soya2d.TEXTALIGN_CENTER="center",soya2d.TEXTALIGN_RIGHT="right",soya2d.TEXTVALIGN_TOP="hanging",soya2d.TEXTVALIGN_MIDDLE="middle",soya2d.TEXTVALIGN_BOTTOM="alphabetic",soya2d.TEXTDIR_LTR="ltr",soya2d.TEXTDIR_RTL="rtl",soya2d.GRADIENT_LINEAR=1,soya2d.GRADIENT_RADIAL=2,t.prototype={follow:function(e){var t=this.__game.world.find(function(t){return e.roid===t.roid?!0:void 0},!0);t.length<0&&soya2d.console.error("camera: "+e.toString()+" must be a child node of game.world"),this.target=e},unfollow:function(){this.target=null},moveTo:function(e,t){this.target||(this.__view.x=e,this.__view.y=t,this.__checkBounds())},moveBy:function(e,t){this.target||(this.__view.x+=e,this.__view.y+=t,this.__checkBounds())},reset:function(){this.__view.x=this.__view.y=0},__checkBounds:function(){var e=this.__game.world.bounds,t=e.x,n=e.y,i=e.w,o=e.h,s=this.__view.x;t>s&&(this.__view.x=t),i>0&&s+this.__view.w>i&&(this.__view.x=i-this.__view.w);var r=this.__view.y;n>r&&(this.__view.y=n),o>0&&r+this.__view.h>o&&(this.__view.y=o-this.__view.h)},setFreezone:function(e){e&&(this.freezone=e)},__onUpdate:function(){if(this.target&&this.target.game){var e,t,n=this.target.worldPosition;e=n.x,t=n.y;{var i=this.target.w,o=this.target.h;e-this.__view.x,t-this.__view.y}if(this.freezone){var s=this.freezone.x,r=this.freezone.y,a=this.freezone.w,l=this.freezone.h,c=this.__view.x+s,u=this.__view.y+r,h=this.__view.x+s+a,d=this.__view.y+r+l,f=i/2,p=o/2;c>e-f?this.__view.x=e-s-f:e+f>h&&(this.__view.x=e-a-s+f),u>t-p?this.__view.y=t-r-p:t+p>d&&(this.__view.y=t-l-r+p)}else this.__view.x=e-this.__view.w/2,this.__view.y=t-this.__view.h/2;this.__checkBounds()}},__cull:function(e){for(var t=e.children,i=t.length;i--;)n(t[i],this.__view)},__viewport:function(e){for(var t=e.children,n=t.length;n--;)i(t[n],this.__view)}},soya2d.Math={PI:3.141592654,PIM2:6.283185307,PID2:1.570796327,PID4:.785398163,ONERAD:.017453292,ONEANG:57.295779513,toRadian:function(e){return e*this.ONERAD},toAngle:function(e){return e*this.ONEANG},randomf:function(e,t){return e+Math.random()*(t-e)},randomi:function(e,t){return e+Math.random()*(t-e)>>0},round:function(e){return.5+e>>0},floor:function(e){return 0|e},len2D:function(e,t,n,i){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))},len2Df:function(e,t){e=Math.abs(e),t=Math.abs(t);var n=Math.min(e,t);return e+t-(n>>1)-(n>>2)+(n>>4)},SINTABLE:function(){for(var e=new Float32Array(361),t=.017453292,n=0;360>=n;n++){var i=n*t,o=Math.sin(i);e[n]=o}return e}(),COSTABLE:function(){for(var e=new Float32Array(361),t=.017453292,n=0;360>=n;n++){var i=n*t,o=Math.cos(i);e[n]=o}return e}()},o.prototype={image:function(e){return this.__assets.image[e]},sound:function(e){return this.__assets.sound[e]},imageFont:function(e){return this.__assets.imageFont[e]},atlas:function(e){return this.__assets.atlas[e]},text:function(e){return this.__assets.text[e]},xml:function(e){return this.__assets.xml[e]},json:function(e){return this.__assets.json[e]}},soya2d.Atlas=function(e,t){this.texs={},t.forEach(function(t){var n=document.createElement("canvas");n.width=t.w,n.height=t.h;var i=n.getContext("2d");i.translate(t.w/2,t.h/2),i.rotate((t.r||0)*Math.PI/180);var o=t.w>>0,s=t.h>>0;return 0===o||0===s?(soya2d.console.error("soya2d.Atlas: invalid ssheet unit，w/h must be a positive;[w:"+o+",h:"+s+"] "),void 0):(i.drawImage(e,t.x>>0,t.y>>0,o,s,-o/2>>0,-s/2>>0,o,s),this.texs[t.n]=n,void 0)},this)},soya2d.Atlas.prototype={getAll:function(e){var t=[];for(var n in this.texs)(!e||"*"===e||e&&0===n.indexOf(e))&&t.push(this.texs[n]);return t},getByIndex:function(e,t){for(var n=[],i=Object.keys(this.texs),o=e;t>=o;o++){var s=this.texs[i[o]];n.push(s)}return n},get:function(e){return this.texs[e]},destroy:function(){this.texs=null}},s.prototype={on:function(e,t,n){if(this instanceof soya2d.DisplayObject)switch(e){case"pointdown":e=soya2d.Device.mobile?"touchstart":"mousedown";break;case"pointmove":e=soya2d.Device.mobile?"touchmove":"mousemove";break;case"pointup":e=soya2d.Device.mobile?"touchend":"mouseup"}return this.__signalHandler.on(e,t,n,this),this},once:function(e,t,n){return this.__signalHandler.once(e,t,n,this),this},off:function(e,t){return this.__signalHandler.off(e,t,this),this},emit:function(){for(var e=[arguments[0],this],t=1;t<arguments.length;t++)e.push(arguments[t]);return this.__signalHandler.emit.apply(this.__signalHandler,e),this}},r.prototype={on:function(e,t,n,i){for(var o=e.replace(/\s+/gm," ").split(" "),s=o.length;s--;){var r=this.map[o[s]];r||(r=this.map[o[s]]=[]),r.push([t,i,n])}},once:function(e,t,n,i){for(var o=e.replace(/\s+/gm," ").split(" "),s=o.length;s--;){var r=this.map[o[s]];r||(r=this.map[o[s]]=[]),r.push([t,i,n,!0])}},off:function(e,t,n){var i=null;i=e?e.replace(/\s+/gm," ").split(" "):Object.keys(this.map);for(var o=i.length;o--;){var s=this.map[i[o]];if(s){for(var r=[],a=s.length;a--;)n!==s[a][1]||(t?s[a][0]!==t:0)||r.push(s[a]);r.forEach(function(e){var t=s.indexOf(e);s.splice(t,1)})}}},emit:function(){var e=this.map[arguments[0]];if(e){for(var t=arguments[1],n=[t],i=2;i<arguments.length;i++)n.push(arguments[i]);e.sort(function(e,t){return t[2]-e[2]}),e.filter(function(e){e[1]===t&&e[0].apply(e[1],n)});var o=e.filter(function(e){return e[3]?void 0:!0});this.map[arguments[0]]=o}}};var F=soya2d.class("",{"extends":s,timeout:5e3,constructor:function(e){this.__signalHandler=new r,this.__assetsQueue=[],this.game=e,this.__assets=e.assets.__assets,this.baseUrl="";var t=!0;Object.defineProperties(this,{show:{set:function(e){t=e},get:function(){return t}},fillStyle:{set:function(e){this.__tip.fillStyle=e},get:function(){return this.__tip.fillStyle}}}),this.__logo=new soya2d.Shape({game:e,opacity:0,x:e.w/2-11,y:e.h/2-30-20,z:9999});var n=new soya2d.Shape({w:23,h:20,skewY:-30,game:e,fillStyle:"#69CA14",onRender:function(e){e.beginPath(),e.fillStyle(this.fillStyle),e.rect(0,0,this.w,this.h),e.fill(),e.closePath()}}),i=new soya2d.Shape({game:e,w:23,h:20,skewY:30,y:13,opacity:.9,fillStyle:"#2A5909",onRender:function(e){e.beginPath(),e.fillStyle(this.fillStyle),e.rect(0,0,this.w,this.h),e.fill(),e.closePath()}}),o=new soya2d.Shape({game:e,w:23,h:20,skewY:-30,y:28,blendMode:soya2d.BLEND_LIGHTER,fillStyle:"#69CA14",onRender:function(e){e.beginPath(),e.fillStyle(this.fillStyle),e.rect(0,0,this.w,this.h),e.fill(),e.closePath()}}),s=new soya2d.Font("normal 400 23px/normal Arial,Helvetica,sans-serif");this.__tip=new soya2d.Text({game:e,x:-70,y:70,font:s,text:"Loading... 0/0",w:200,fillStyle:"#000"}),this.__logo.add(n,i,o,this.__tip),e.world.add(this.__logo)},__addToAssets:function(e,t){for(var n in t)this.__assetsQueue.push({type:e,k:n,data:t[n],baseUrl:this.baseUrl})},image:function(e){var t=e;e instanceof Array&&(t={},e.forEach(function(e){var n=e.lastIndexOf("/")+1,i=e.lastIndexOf("."),o=e.substring(n,i);t[o]=e})),this.__addToAssets("image",t)},sound:function(e){this.__addToAssets("sound",e)},font:function(e){this.__addToAssets("font",e)},imageFont:function(e){this.__addToAssets("imageFont",e)},atlas:function(e){var t=e;if(4===arguments.length){t={};var n=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3];t[n]=[i,o,s]}this.__addToAssets("atlas",t)},text:function(e){this.__addToAssets("text",e)},xml:function(e){this.__addToAssets("xml",e)},json:function(e){this.__addToAssets("json",e)},__loadImage:function(e,t,n){var i=new Image;void 0!==this.crossOrigin&&(i.crossOrigin=this.crossOrigin),i.path=t;i.onload=function(){n("load",this),this.onerror=null,this.onload=null},i.onerror=function(){n("error",this.path),this.onerror=null,this.onload=null},i.src=e+t,i.complete&&(n("load",i),i.onerror=null,i.onload=null)},__loadSound:function(e,t,n){for(var i=t instanceof Array?t:[t],o=i.length;o--;)i[o]=e+i[o];new Howl({src:i,onload:function(){var e=new soya2d.Sound;e.__handler=this,n("load",e)},onloaderror:function(e){var t=soya2d.MEDIA_ERR_DECODE;e&&(t=e.type),n("error",this._src,t)}})},__loadFont:function(e,t,n,i){for(var o=["serif","sans-serif"],s="border:none;position:absolute;top:-999px;left:-999px;font-size:100px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:",r={},a={},c={},u=o.length;u--;){var h=document.createElement("div");h.style.cssText=s+"'"+o[u]+"'",h.innerHTML=t,document.body.appendChild(h),c[o[u]]=h,r[o[u]]=h.offsetWidth,a[o[u]]=h.offsetHeight}var d=document.createElement("style");d.id="FontLoader_"+(new Date).getTime(),d.innerHTML="@font-face {font-family: '"+t+"';src: url("+e+n+")}",document.head.appendChild(d);for(var u in c)c[u].style.fontFamily=t+","+c[u].style.fontFamily;var f=(new Date).getTime(),p=this;setTimeout(function(){l(f,p.timeout,c,r,a,function(e){i("timeout",e)},function(e){i("load",e)},t)},100)},__loadAtlas:function(e,t,n,i){var o=this;this.__loadImage(e,n[0],function(s,r){if("load"===s)if("string"==typeof n[1]&&2===n.length)o.__getXhr(e,n[1],function(e,t){var n=t;if("load"===e){var o;try{o=new Function("return "+t.responseText)()}catch(s){o=s}n=new soya2d.Atlas(r,o)}i(e,n)});else{var a=n[1];if(n.length>2){a=[];for(var l=r.width,c=r.height,u=n[1],h=n[2],d=1,f=h;c>=f;f+=h)for(var p=u;l>=p;p+=u)a.push({n:t+"_"+d,x:p-u,y:f-h,w:u,h:h}),d++}var _=new soya2d.Atlas(r,a);i(s,_)}else i(s,r)})},__getXhr:function(e,t,n){a(e+t,this.timeout,function(){n("timeout",t)},function(){n("error",t)},function(e){n("load",e)})},__loadAssets:function(){var e=this;return this.__assetsQueue.length<1?(this.emit("end"),void 0):(this.__assetsQueue.forEach(function(t){switch(t.type){case"image":e.__loadImage(t.baseUrl,t.data,function(n,i){"load"===n&&(e.__assets.image[t.k]=i),e.__onLoad(n,i)});break;case"sound":if(!soya2d.Sound)return soya2d.console.warn("can't load sounds, module [sound] needs to be loaded"),void 0;e.__loadSound(t.baseUrl,t.data,function(n,i){"load"===n&&(e.__assets.sound[t.k]=i),e.__onLoad(n,i,arguments[2])});break;case"atlas":e.__loadAtlas(t.baseUrl,t.k,t.data,function(n,i){"load"===n&&(e.__assets.atlas[t.k]=i),e.__onLoad(n,i)});break;case"font":e.__loadFont(t.baseUrl,t.k,t.data,function(n,i){var o=i;"load"===n&&(o=(new soya2d.Font).family(i),e.__assets.imageFont[t.k]=o),e.__onLoad(n,o)});break;case"imageFont":e.__loadAtlas(t.baseUrl,t.k,t.data,function(n,i){var o=i;"load"===n&&(o=new soya2d.ImageFont(i),e.__assets.imageFont[t.k]=o),e.__onLoad(n,o)});break;case"text":e.__getXhr(t.baseUrl,t.data,function(n,i){var o=i;"load"===n&&(e.__assets.text[t.k]=i.responseText,o=i.responseText),e.__onLoad(n,o)});break;case"xml":e.__getXhr(t.baseUrl,t.data,function(n,i){var o=i;"load"===n&&(o=e.__assets.xml[t.k]=i.responseXML),e.__onLoad(n,o)});break;case"json":e.__getXhr(t.baseUrl,t.data,function(n,i){var o=i;if("load"===n){try{o=new Function("return "+i.responseText)()}catch(s){o=s}e.__assets.json[t.k]=o}e.__onLoad(n,o)})}}),void 0)},__onLoad:function(e,t){this.__tip.setText("Loading... "+ ++this.__index+"/"+this.__assetsQueue.length),"load"===e?this.emit(e,t,this.__index,this.__assetsQueue.length):this.emit(e,t,arguments[2]),this.__index==this.__assetsQueue.length&&(this.__assetsQueue=[],this.emit("end"),this.__logo.parent.remove(this.__logo),this.__logo.opacity=0)},start:function(){this.__index=0,this.show&&(this.__logo.parent||this.game.world.add(this.__logo),this.__logo.opacity=1),this.__loadAssets()}});soya2d.MEDIA_ERR_UNCERTAIN=-1,soya2d.MEDIA_ERR_ABORTED=1,soya2d.MEDIA_ERR_NETWORK=2,soya2d.MEDIA_ERR_DECODE=3,soya2d.MEDIA_ERR_SRC_NOT_SUPPORTED=4,soya2d.MEDIA_ERR_SRC_NOT_FORTHCOMING=101,c.prototype={setView:function(e){var t=e.childNodes[0];u(this,t,this.game.world,this.game)},findView:function(e){return this.map[e]}},f.prototype={start:function(e,t){var n=this.game;e="string"==typeof e?this.map[e]:new c(e,n),n.currentScene=e,t&&(n.world.clear(!0),n.world.off(),n.camera.reset()),e.onPreload?(e.onPreload(n),n.load.once("end",function(){n.currentScene.onInit&&setTimeout(function(){n.currentScene.onInit(n)},0)}),n.load.start()):e.onInit&&e.onInit(n);var i=soya2d.module._getAll();for(var o in i)i[o].onSceneChange&&i[o].onSceneChange(n,e);return this},add:function(e,t){return this.map[e]=new c(t,game),this.map[e]}};var N=soya2d.class("",{"extends":s,constructor:function(){this.__signalHandler=new r,this.triggerList=[],this.expMap={},this.threshold=1e3},on:function(e,t,n){var i=this;return e=e.replace(/\[(.*?)\]/gm,function(e,t){if(!i.expMap[t]){var n=new p(t);i.triggerList.push(n),i.expMap[t]=n}return t.replace(/\s+/gm,"_")}),this._super.on.call(this,e,t,n)},once:function(e,t,n){var i=this;return e=e.replace(/\[(.*?)\]/gm,function(e,t){if(!i.expMap[t]){var n=new p(t);i.triggerList.push(n),i.expMap[t]=n}return t.replace(/\s+/gm,"_")}),this._super.once.call(this,e,t,n)},off:function(e,t){var n=[];e=e.replace(/\[(.*?)\]/gm,function(e,t){return n.push(t),t.replace(/\s+/gm,"_")}),this._super.off.call(this,e,t),n.forEach(function(e){var t=this.__signalHandler.map[e.replace(/\s+/gm,"_")];Object.keys(t).length<1&&(this.expMap[e]=null,this.__removeTrigger(e))},this)},__scan:function(e){for(var t=[],n=[],i=this.triggerList.length;i--;){var o=this.triggerList[i],s=this.__signalHandler.map[o.exp.replace(/\s+/gm,"_")],r=!1;o.milliseconds+=e;var a=o.milliseconds-o._lastTriggerMilliseconds;o.canTrigger()&&a>=this.threshold&&(r=!0,o._lastTriggerMilliseconds=o.milliseconds),o._canUnload()&&t.push(o.exp),r&&(o.times++,s.forEach(function(e){e[3]&&n.push([o.exp,e[0]]),e[0].call(this,o.milliseconds,o.times,o._t)},this))}for(var i=t.length;i--;)this.__removeTrigger(t[i]);for(var i=n.length;i--;)this.off(n[i][0],n[i][1])},__removeTrigger:function(e){for(var t=this.triggerList.length;t--;){var n=this.triggerList[t];if(n.exp===e)break}this.triggerList.splice(t,1)}});soya2d.Circle=function(e,t,n){this.x=e||0,this.y=t||0,this.r=n||0},soya2d.Circle.prototype={toString:function(){return"{x:"+this.x+",y:"+this.y+",r:"+this.r+"}"},clone:function(){return new soya2d.Circle(this.x,this.y,this.r)},intersectWith:function(e){if(e instanceof soya2d.Circle&&e.r>0){if(soya2d.Math.len2Df(e.x-this.x,e.y-this.y)<=this.r+e.r)return!1}else if(e instanceof soya2d.Rectangle&&e.w>0&&e.h>0){var t=e.w/2,n=e.h/2,i=this.x-(e.x+t),o=this.y-(e.y+n);if(i>t+this.r||o>n+this.r)return!1;var s=Math.min(i,t),r=Math.max(s,-t),a=Math.min(o,n),l=Math.max(a,-n);return(r-i)*(r-i)+(l-o)*(l-o)<=this.r*this.r}return!0}},soya2d.Polygon=function(e){this.vtx=e},soya2d.Polygon.prototype={toString:function(){return this.vtx},clone:function(){return new soya2d.Polygon(this.vtx.concat())}},soya2d.Rectangle=function(e,t,n,i){this.x=e||0,this.y=t||0,this.w=n||0,this.h=i||0},soya2d.Rectangle.prototype={toString:function(){return"{x:"+this.x+",y:"+this.y+",w:"+this.w+",h:"+this.h+"}"},clone:function(){return new soya2d.Rectangle(this.x,this.y,this.w,this.h)},getRight:function(){return this.x+this.w},getBottom:function(){return this.y+this.h},contains:function(e,t){return e<this.x||e>this.x+this.w?!1:t<this.y||t>this.y+this.h?!1:!0},intersectWith:function(e){if(e instanceof soya2d.Rectangle&&e.w>0&&e.h>0){if(this.x>e.x+e.w||this.y>e.y+e.h)return!1;if(this.x+this.w<e.x||this.y+this.h<e.y)return!1}else if(e instanceof soya2d.Circle&&e.r>0)return e.intersectWith(this);return!0}},soya2d.Point=function(e,t){this.x=e||0,this.y=t||0},soya2d.Point.prototype={toString:function(){return"{x:"+this.x+",y:"+this.y+"}"},clone:function(){return new soya2d.Point(this.x,this.y)},set:function(e,t){return this.x=e,this.y=t,this}},soya2d.Matrix2x2=function(){this.e=new Float32Array(4),this.identity()},soya2d.Matrix2x2.prototype={toString:function(){return"["+this.e[0]+","+this.e[1]+","+this.e[2]+","+this.e[3]+"]"},set:function(e,t,n,i){var o=this.e;return o[0]=0==e?0:e||1,o[1]=t||0,o[2]=n||0,o[3]=0==i?0:i||1,this},clone:function(){return(new soya2d.Matrix2x2).set(this.e[0],this.e[1],this.e[2],this.e[3])},identity:function(){return this.set(1,0,0,1),this},mul:function(e){var t=this.e[0],n=this.e[1],i=this.e[2],o=this.e[3],s=e.e;return this.e[0]=s[0]*t+s[2]*n,this.e[1]=s[1]*t+s[3]*n,this.e[2]=s[0]*i+s[2]*o,this.e[3]=s[1]*i+s[3]*o,this},scale:function(e,t){return this.e[0]*=e,this.e[1]*=t,this.e[2]*=e,this.e[3]*=t,this},rotate:function(e){if(!e)return this;var t=soya2d.Math;e=0>e?360+e%360:e,e>360&&(e%=360);var n=this.e[0],i=this.e[1],o=this.e[2],s=this.e[3],r=t.SINTABLE[e],a=t.COSTABLE[e];return void 0===r&&(r=Math.sin(e*t.ONERAD),a=Math.cos(e*t.ONERAD)),this.e[0]=n*a+i*-r,this.e[1]=n*r+i*a,this.e[2]=o*a+s*-r,this.e[3]=o*r+s*a,this},skew:function(e,t){var n=this.e[0],i=this.e[1],o=this.e[2],s=this.e[3];if(e){var r;this.skewX===e&&this.sx?r=this.sx:(r=Math.tan(.017453292*e),this.sx=r),this.e[0]+=i*r,this.e[2]+=s*r}if(t){var a;this.skewY===e&&this.sy?a=this.sy:(a=Math.tan(.017453292*t),this.sy=a),this.e[1]+=n*a,this.e[3]+=o*a}return this}},soya2d.Vector=function(e,t){this.e=new Float32Array(2),this.e[0]=e||0,this.e[1]=t||0},soya2d.Vector.prototype={toString:function(){return"{x:"+this.e[0]+",y:"+this.e[1]+"}"},clone:function(){return new soya2d.Vector(this.e[0],this.e[1])},set:function(e,t){return this.e[0]=e||0,this.e[1]=t||0,this},dot:function(e){return this.e[0]*e.e[0]+this.e[1]*e.e[1]},negate:function(){return this.e[0]*=-1,this.e[1]*=-1,this},add:function(e){return this.e[0]+=e.e[0],this.e[1]+=e.e[1],this},sub:function(e){return this.e[0]-=e.e[0],this.e[1]-=e.e[1],this},mul:function(e){return this.e[0]*=e,this.e[1]*=e,this},div:function(e){return e?(this.e[0]/=e,this.e[1]/=e):(this.e[0]=0,this.e[1]=0),this},getAngle:function(){return Math.atan2(this.e[1],this.e[0])},getAngleBetween:function(e){var t=this.dot(e),n=t/(this.length()*e.length());return Math.acos(n)},rotate:function(e){var t=soya2d.Math,n=t.SINTABLE[e],i=t.COSTABLE[e];void 0===n&&(n=Math.sin(e*t.ONERAD),i=Math.cos(e*t.ONERAD));var o=this.e[0],s=this.e[1];return this.e[0]=o*i-s*n,this.e[1]=o*n+s*i,this},lengthSq:function(){return this.e[0]*this.e[0]+this.e[1]*this.e[1]},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.div(this.length())}};var V=soya2d.class("",{"extends":s,constructor:function(e){this.__signalHandler=new r,this.sprite=e,this.rigid=null},sensor:function(e){return this.__cbk&&this.__cbk.sensor(this.rigid,e),this},moveTo:function(e,t){return this.__cbk&&this.__cbk.moveTo(this.rigid,e,t),this},moveBy:function(e,t){return this.__cbk&&this.__cbk.moveBy(this.rigid,e,t),this},"static":function(e){return this.__cbk&&this.__cbk.static(this.rigid,e),this},mass:function(e){return this.__cbk&&this.__cbk.mass(this.rigid,e),this},rotateBy:function(e){return this.__cbk&&this.__cbk.rotateBy(this.rigid,e),this},rotateTo:function(e){return this.__cbk&&this.__cbk.rotateTo(this.rigid,e),this},friction:function(e){return this.__cbk&&this.__cbk.friction(this.rigid,e),this},restitution:function(e){return this.__cbk&&this.__cbk.restitution(this.rigid,e),this},velocity:function(e,t){return this.__cbk&&this.__cbk.velocity(this.rigid,e||0,t||0),this},inertia:function(e){return this.__cbk&&this.__cbk.inertia(this.rigid,e||0),this}}),G=soya2d.class("",{"extends":s,constructor:function(){this.__signalHandler=new r,this.running=!1},setup:function(e){this.__cbk=e||{}},start:function(e){e=e||{},e.gravity=e.gravity||[0,1],e.gravity[0]=e.gravity[0]||0,e.gravity[1]=e.gravity[1]||1,e.enableSleeping=e.enableSleeping||!1,this.__cbk.onStart&&this.__cbk.onStart(e),this.running=!0},stop:function(){this.__cbk.onStop&&this.__cbk.onStop(),this.running=!1},update:function(){this.__cbk.onUpdate&&this.__cbk.onUpdate()},bind:function(e){var t;this.__cbk.onBind&&(t=this.__cbk.onBind(e)),e.body.rigid=t,e.body.__cbk=this.__cbk.body,t.__sprite=e},unbind:function(e){var t=e.body.rigid;t&&(e.body.__cbk=null,this.__cbk.onUnbind&&(t.__sprite=null,this.__cbk.onUnbind(t)),e.body={})},enable:function(e){var t=e;if(e instanceof Array||arguments.length>1){arguments.length>1&&(t=arguments);for(var n=t.length;n--;)this.bind(t[n])}else this.bind(t)},unable:function(e){var t=e;if(e instanceof Array||arguments.length>1){arguments.length>1&&(t=arguments);for(var n=t.length;n--;)this.unbind(t[n])}else this.unbind(t)}});soya2d.EVENT_COLLISIONSTART="collisionStart",soya2d.EVENT_COLLISIONEND="collisionEnd",g.prototype={register:function(e,t){this.map[e]=t,t.prototype instanceof soya2d.DisplayObject&&(this.game.add[e]=function(t){return this.__newInstanceAndAppend(e,t)})}},soya2d.class("soya2d.DisplayObject",{"extends":s,__signalHandler:new r,constructor:function(e){if(e=e||{},this.__seq=soya2d.__roIndex++,this.roid="roid_"+this.__seq,this.name=e.name||this.roid,this.visible=e.visible===!1?!1:e.visible||!0,this.layout=e.layout,this.__opacity=0===e.opacity?0:e.opacity||1,this.__x=e.x||0,this.__y=e.y||0,this.__w=e.w||0,this.__h=e.h||0,this.__anchorX=0===e.anchorX?0:e.anchorX||"50%",this.__anchorY=0===e.anchorY?0:e.anchorY||"50%",this.__angle=e.angle||0,this.__scaleX=0==e.scaleX?0:e.scaleX||1,this.__scaleY=0==e.scaleY?0:e.scaleY||1,this.__skewX=e.skewX||0,this.__skewY=e.skewY||0,Object.defineProperties(this,{opacity:{set:function(e){e=0==e?0:parseFloat(e)||1,this.__opacity=0>e?0:e>1?1:e},get:function(){return this.__opacity},enumerable:!0},x:{set:function(e){this.__x=e||0,this.__localChange=!0,this.game.physics.running&&this.body.moveTo(this.__x,this.__y)},get:function(){return this.__x},enumerable:!0},y:{set:function(e){this.__y=e||0,this.__localChange=!0,this.game.physics.running&&this.body.moveTo(this.__x,this.__y)},get:function(){return this.__y},enumerable:!0},w:{set:function(e){this.__w=e,this.__anchorChange=!0
},get:function(){return this.__w},enumerable:!0},h:{set:function(e){this.__h=e,this.__anchorChange=!0},get:function(){return this.__h},enumerable:!0},anchorX:{set:function(e){this.__anchorX=e,this.__anchorChange=!0},get:function(){return this.__anchorX},enumerable:!0},anchorY:{set:function(e){this.__anchorY=e,this.__anchorChange=!0},get:function(){return this.__anchorY},enumerable:!0},angle:{set:function(e){this.__angle=e,this.__localChange=!0,this.game.physics.running&&this.body.rotateTo(this.__angle)},get:function(){return this.__angle},enumerable:!0},scaleX:{set:function(e){this.__scaleX=e,this.__localChange=!0},get:function(){return this.__scaleX},enumerable:!0},scaleY:{set:function(e){this.__scaleY=e,this.__localChange=!0},get:function(){return this.__scaleY},enumerable:!0},skewX:{set:function(e){this.__skewX=e,this.__localChange=!0},get:function(){return this.__skewX},enumerable:!0},skewY:{set:function(e){this.__skewY=e,this.__localChange=!0},get:function(){return this.__skewY},enumerable:!0}}),this.z=e.z||0,this.__localChange=!0,this.__anchorChange=!0,this.__localTransform=new soya2d.Matrix2x2,this.__worldTransform=new soya2d.Matrix2x2,this.worldPosition=new soya2d.Point,this.anchorPosition=new soya2d.Point,this.__screenPosition=new soya2d.Point(1/0,1/0),this.blendMode=e.blendMode||"source-over",this.__mask=e.mask||null,this.__fixedToCamera=e.fixedToCamera||!1,Object.defineProperties(this,{mask:{set:function(e){e&&(e.__masker&&(e.__masker.__mask=null),this.__mask=e,e.__masker=this)},get:function(){return this.__mask},enumerable:!0},fixedToCamera:{set:function(e){this.__fixedToCamera=e,e&&this.cameraOffset.set(this.x,this.y)},get:function(){return this.__fixedToCamera},enumerable:!0}}),this.__masker=null,this.bounds=e.bounds||new soya2d.Rectangle(0,0,this.__w,this.__h),this.__boundRect=new soya2d.Rectangle(0,0,1,1),this.body=new V(this),this.game=e.game||soya2d.games[0],this.imageCache=null,this.__updateCache=!1,this.cameraOffset=new soya2d.Point,!this.game)throw new Error("soya2d.DisplayObject: invalid param [game]; "+this.game);soya2d.ext(this,e),this.fixedToCamera=this.__fixedToCamera},onBuild:function(e){for(var t in e){var n=t,i=e[t];switch(n){case"x":case"w":case"y":case"h":case"z":case"angle":case"scaleX":case"scaleY":case"skewX":case"skewY":i=parseFloat(i);break;case"fixedToCamera":case"visible":i=new Function("return "+i)()}0===n.indexOf("layout-")?(e.layout||(e.layout={}),e.layout[n.split("-")[1]]=i):e[n]=i}return e},_onAdded:function(){this.centerX=this.w/2,this.centerY=this.h/2,this.setLayout(this.layout),this.fixedToCamera&&this.layout&&this.cameraOffset.set(this.x,this.y),this.onAdded&&this.onAdded()},setLayout:function(e){if(!e)return this;var t=e.left||0,n=e.top||0,i=e.width,o=e.height,s=e.offsetLeft,r=e.offsetTop;i&&(this.__w=x(i,this.parent)||0),o&&(this.__h=b(o,this.parent)||0);var a=0,l=0;return s&&(a=w(s,this.__w)),r&&(l=w(r,this.__h)),(t||s)&&(this.__x=x(t,this.parent)+a),(n||r)&&(this.__y=b(n,this.parent)+l),this},refreshLayout:function(){return this.setLayout(this.layout),this},toString:function(){return'{roid:"'+this.roid+'";name:"'+this.name+'"}'},transform:function(){var e=this.__x,t=this.__y;this.__localChange&&(this.__localTransform.identity(),this.__localTransform.scale(this.__scaleX,this.__scaleY).rotate(this.__angle).skew(this.__skewX,this.__skewY));var n=this.__localTransform,i=this.__worldTransform,o=this.anchorPosition,s=n.e,r=o.x,a=o.y;if(this.__anchorChange&&(r=this.__anchorX,a=this.__anchorY,r="number"==typeof r?r:parseFloat(r)/100*this.__w,a="number"==typeof a?a:parseFloat(a)/100*this.__h,o.set(r,a)),e+=r,t+=a,i.set(s[0],s[1],s[2],s[3]),this.parent){var l=this.parent.__worldTransform,c=l.e,u=this.parent.worldPosition,h=this.parent.anchorPosition,d=h.x*c[0]+h.y*c[2],f=h.x*c[1]+h.y*c[3],p=e*c[0]+t*c[2],_=e*c[1]+t*c[3];e=p+u.x-d,t=_+u.y-f,i.mul(l)}this.body.rigid&&(e-=o.x,t-=o.y),this.worldPosition.set(e,t),this.__localChange=this.__anchorChange=!1},isRendered:function(){if(!this.visible||0===this.opacity)return!1;for(var e=this.parent;e;){if(!e.visible||0===e.opacity)return!1;if(!(e.parent||e instanceof W))return!1;e=e.parent}return!0},clone:function(e,t){t=t||new this.constructor;for(var n=Object.keys(this),i=n.length;i--;){var o=n[i];if("parent"!==o&&"__seq"!==o&&"roid"!==o&&"__localTransform"!==o&&"__worldTransform"!==o&&"worldPosition"!==o&&"anchorPosition"!==o&&"__screenPosition"!==o&&(e||"children"!==o))if(e&&"children"===o&&this[o]&&this[o].length>0){t[o]=[];for(var s=0;s<this[o].length;s++){var r=this[o][s],a=r.clone(e);a.parent=t,t[o].push(a)}}else t[o]=this[o]instanceof Array?this[o].slice(0):this[o]}return t},moveBy:function(){var e=arguments[0]||0,t=0===arguments[1]?0:arguments[1]||e;return this.x+=e,this.y+=t,this},moveTo:function(){var e=arguments[0]||0,t=0===arguments[1]?0:arguments[1]||e;return this.x=e,this.y=t,this},opacifyTo:function(e){return this.opacity=e>1?1:0>e?0:e,this},opacifyBy:function(e){return this.opacity+=e,this.opacity>1&&(this.opacity=1),this.opacity<0&&(this.opacity=0),this},resizeTo:function(){var e=arguments[0]||0,t=0===arguments[1]?0:arguments[1]||e;return this.w=e,this.h=t,this},scaleBy:function(){var e=arguments[0]||0,t=0===arguments[1]?0:arguments[1]||e;return this.scaleX+=e,this.scaleY+=t,this},scaleTo:function(){var e=arguments[0]||0,t=0===arguments[1]?0:arguments[1]||e;return this.scaleX=e,this.scaleY=t,this},skewBy:function(){var e=arguments[0]||0,t=0===arguments[1]?0:arguments[1]||e;return this.skewX+=e,this.skewY+=t,this},skewTo:function(){var e=arguments[0]||0,t=0===arguments[1]?0:arguments[1]||e;return this.skewX=e,this.skewY=t,this},rotateBy:function(e){return this.angle+=e,this},rotateTo:function(e){return this.angle=e,this},anchorBy:function(){var e=arguments[0]||0,t=0===arguments[1]?0:arguments[1]||e;return this.anchorX+=e,this.anchorY+=t,this},anchorTo:function(){var e=arguments[0]||0,t=0===arguments[1]?0:arguments[1]||e;return this.anchorX=e,this.anchorY=t,this},getBoundingPoints:function(){var e=this.__worldTransform.e,t=this.worldPosition,n=this.anchorPosition,i=t.x,o=t.y,s=e[0],r=e[1],a=e[2],l=e[3],c=n.x,u=n.y,h=-c,d=-u,f=this.w-c,p=-u,_=-c,y=this.h-u,m=this.w-c,g=this.h-u;return[h*s+d*a+i,h*r+d*l+o,f*s+p*a+i,f*r+p*l+o,m*s+g*a+i,m*r+g*l+o,_*s+y*a+i,_*r+y*l+o]},getBoundingBox:function(){var e,t,n,i,o=this.getBoundingPoints();n=o[0],e=o[0],i=o[1],t=o[1];for(var s=o.length;s--;)s%2===0?(o[s]>n&&(n=o[s]),o[s]<e&&(e=o[s])):(o[s]>i&&(i=o[s]),o[s]<t&&(t=o[s]));var r=e,a=t,l=n-e,c=i-t;return this.__boundRect.x=r,this.__boundRect.y=a,this.__boundRect.w=l,this.__boundRect.h=c,this.__boundRect},hitTest:function(e,t){var n=this.worldPosition;if(this.bounds instanceof soya2d.Circle){var i=Math.abs(soya2d.Math.len2D(n.x,n.y,e,t));if(i<=this.bounds.r)return!0}else if(this.bounds instanceof soya2d.Rectangle||this.bounds instanceof soya2d.Polygon){var o;if(this.bounds.vtx){var s=this.__worldTransform.e,r=this.anchorPosition,a=n.x,l=n.y,c=s[0],u=s[1],h=s[2],d=s[3],f=r.x,p=r.y,_=-f,y=-p;o=[];for(var m=0;m<this.bounds.vtx.length;m+=2){var g=this.bounds.vtx[m]+_,v=this.bounds.vtx[m+1]+y;o.push(g*c+v*h+a,g*u+v*d+l)}}else o=this.getBoundingPoints();for(var x=!1,m=0;m<o.length;m+=2){var g=o[m],v=o[m+1],b=o[m+2]||o[0],w=o[m+3]||o[1];if(g===e&&v===t||b===e&&w===t)return!0;if(t>v&&w>=t||v>=t&&t>w){var S=(t-v)/(w-v)*(b-g)+g;if(S===e)return!0;S>e&&(x=!x)}}return x}return!1},intersectWith:function(e){var t=this.getBoundingBox(),n=e.getBoundingBox();return t.intersectWith(n)},getAnchorPosition:function(){var e=this.__worldTransform.e,t=this.worldPosition,n=this.anchorPosition,i=t.x,o=t.y,s=e[0],r=e[1],a=e[2],l=e[3],c=n.x,u=n.y,h=-c,d=-u,f=this.w*parseInt(this.anchorX)/100,p=this.h*parseInt(this.anchorY)/100,_=Math.sqrt(p*p+f*f),y=Math.atan2(p,f);return f=Math.cos(y)*_+h,p=Math.sin(y)*_+d,new soya2d.Point(f*s+p*a+i,f*r+p*l+o)},cache:function(){if(!(this.__w>1024||this.__h>1024)){this.imageCache||(this.imageCache=document.createElement("canvas")),this.imageCache.width=this.__w,this.imageCache.height=this.__h,this.transform(),this.__updateCache=!0,this.__renderable=!0;var e=this.imageCache.getContext("2d"),t=new soya2d.CanvasGraphics(e);this.game.renderer.renderDO(this.game.camera.__view,e,this,t,!0),this.__updateCache=!1}},destroy:function(){if(this.game.physics.unbind(this),this.off(),this.__seq){this.children.length>0&&this.children.forEach(function(e){e.destroy()});for(var e=Object.keys(this),t=e.length;t--;)e[t].indexOf("__")<0||(this[e[t]]=null);this.parent&&this.parent.remove(this),this.onRender=this.onUpdate=this.parent=this.children=this.imageCache=this.fillStyle=this.game=this.body=null}}}),soya2d.class("soya2d.DisplayObjectContainer",{"extends":soya2d.DisplayObject,constructor:function(){this.children=[],this.parent=null},add:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t.parent&&t.parent.remove(t),this.children.push(t),t.parent=this,t._onAdded()}return this},remove:function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],n=this.children.indexOf(t);0>n||(this.children.splice(n,1),t.parent=null)}return this},clear:function(e){for(var t=this.children.length;t--;)this.children[t].parent=null;var n=this.children;if(this.children=[],e)for(var t=n.length;t--;)n[t].destroy();return n},find:function(e,t){if(this.children.length<1)return[];var n;return t?(n=[],T(this,e,n)):n=this.children.filter(e),n}});var W=soya2d.class("",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){this.game=e.game,this.__anchorX=this.__anchorY=0,this.minWidth=0,this.minHeight=0,this.maxWidth=0,this.maxHeight=0,this.autoScale=!0,this.orientation=I();var t,n=this;window.addEventListener("orientationchange",function(){clearTimeout(t),t=setTimeout(function(){n.orientation=I()},500),n.autoScale&&n.__scan()},!1),window.addEventListener("resize",function(){n.orientation=I(),n.autoScale&&n.__scan()},!1),this.__bg=null,this.__rotat=soya2d.ROTATEMODE_0;var i=soya2d.ALIGNMODE_CENTER,o=soya2d.SCALEMODE_SHOWALL;Object.defineProperties(this,{scaleMode:{set:function(e){o=e,this.__scan()},get:function(){return o}},alignMode:{set:function(e){if(e&&this.scaleMode===soya2d.SCALEMODE_SHOWALL){var t=this.game.renderer.getCanvas();switch(i=e,e){case soya2d.ALIGNMODE_LEFT:t.style.left=0,t.style.right="auto";break;case soya2d.ALIGNMODE_RIGHT:t.style.left="auto",t.style.right=0;break;case soya2d.ALIGNMODE_CENTER:default:t.style.left=0,t.style.right=0,i=soya2d.ALIGNMODE_CENTER}t.style.margin="auto"}},get:function(){return i}},rotateMode:{set:function(e){this.__rotat=e,this.__scan()},get:function(){return this.__rotat}}})},__updateMatrix:function(){M(this)},__preUpdate:function(e,t){this.children&&C(this.children,e,t)},__postUpdate:function(e,t){this.children&&E(this.children,e,t)},onRender:function(e){this.__bg&&(e.fillStyle(this.__bg),e.fillRect(0,0,this.w,this.h))},background:function(e){if("string"==typeof e)this.__bg=e;else if(e instanceof self.Image)this.__bg=this.game.renderer.createPattern(e,arguments[1]);else if(!isNaN(e)){var t={};arguments[4]&&soya2d.ext(t,arguments[4]),t.type=e;var n=this.game.renderer.createGradient(arguments[1],arguments[2],arguments[3]||1,t);this.__bg=n}},__scan:function(){var e,t=this.game.w,n=this.game.h;switch(this.scaleMode){case soya2d.SCALEMODE_NOSCALE:break;case soya2d.SCALEMODE_NOBORDER:e=P;break;case soya2d.SCALEMODE_EXACTFIT:e=B;break;case soya2d.SCALEMODE_SHOWALL:default:e=O}if(e){var i=this.game.renderer,o=i.getCanvas().parentNode,s=o.clientWidth,r=o.clientHeight;"BODY"===o.tagName&&(r=window.innerHeight);var a=e(t,n,s,r,this.minWidth,this.minHeight,this.maxWidth,this.maxHeight);i.resize(a[0],a[1]),k(this.scaleMode,this.__rotat,i.getCanvas(),i,this)}}});soya2d.SCALEMODE_NOSCALE=0,soya2d.SCALEMODE_SHOWALL=1,soya2d.SCALEMODE_NOBORDER=2,soya2d.SCALEMODE_EXACTFIT=3,soya2d.ALIGNMODE_LEFT=1,soya2d.ALIGNMODE_CENTER=2,soya2d.ALIGNMODE_RIGHT=3,soya2d.ROTATEMODE_0=1,soya2d.ROTATEMODE_90=2,soya2d.ROTATEMODE_180=3,soya2d.ROTATEMODE_270=4,soya2d.BG_REPEAT="repeat",soya2d.BG_NOREPEAT="no-repeat",soya2d.BG_REPEAT_X="repeat-x",soya2d.BG_REPEAT_Y="repeat-y";var j=soya2d.class("",{"extends":soya2d.DisplayObjectContainer,constructor:function(){this.__soya_type="world"},setBounds:function(e,t){this.bounds.w=e,this.bounds.h=t,this.w=e,this.h=t}});soya2d.class("soya2d.Shape",{"extends":soya2d.DisplayObjectContainer}),R.prototype.reset=function(){this.index=0,this.lastUpdateTime=0};var U=soya2d.class("",{"extends":s,__signalHandler:new r,constructor:function(e,t){this.map={};for(var n=[],i=0;t>i;i++)n.push(i);this.defaultAnimation=new R(n),this.animation=null,this.playingK=null},destroy:function(){this.defaultAnimation=null,this.animation=null,this.playingK=null,this.__signalHandler=null},add:function(e,t,n,i){return this.map[e]=new R(t,n,i),this},play:function(e){return this.playingK===e?this:(this.animation=e?this.map[e]:this.defaultAnimation,this.playingK=e||!0,this)},stop:function(){return this.playingK=null,this.animation&&this.animation.reset(),this.animation=null,this}});soya2d.class("soya2d.Sprite",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){var t=e.images;t&&(this.animations=null,this.setImages(t),this.w=e.w||this.images[0].width,this.h=e.h||this.images[0].height,this.__frameIndex=e.frameIndex||0,this.__scale9grid=e.scale9grid,Object.defineProperties(this,{frameIndex:{set:function(e){this.__frameIndex=e,this.__cacheGrid=!0},get:function(){return this.__frameIndex},enumerable:!0},scale9grid:{set:function(e){e instanceof soya2d.Rectangle&&(this.__scale9grid=e,this.__cacheGrid=!0,this.__parseScale9())},get:function(){return this.__scale9grid},enumerable:!0}}))},clone:function(e){var t=new this.constructor({images:this.images.concat()});return soya2d.DisplayObject.prototype.clone.call(this,e,t)},onBuild:function(e){soya2d.DisplayObject.prototype.onBuild(e);for(var t in e){var n=t,i=e[t];switch(n){case"images":e[n]=i.split(",");break;case"frameIndex":e[n]=parseFloat(i);break;case"atlas":var o=e["atlas-prefix"];e.images=game.assets.atlas(i).getAll(o);break;case"scale9grid":var s=i.split(",");e[n]=new soya2d.Rectangle(parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]))}}},_onAdded:function(){soya2d.DisplayObject.prototype._onAdded.call(this),!this.__scale9grid||this.__w==this.images[0].width&&this.__h==this.images[0].height||(this.__cacheGrid=!0,this.__parseScale9())},_onUpdate:function(){this.__cacheGrid&&this.__scale9grid instanceof soya2d.Rectangle&&(this.cache(),this.__cacheW=this.__w,this.__cacheH=this.__h,this.__cacheGrid=!1)},__parseScale9:function(){var e=this.images[0].width,t=this.images[0].height,n=this.__scale9grid.y+this.__scale9grid.h,i=t-n,o=this.__scale9grid.x+this.__scale9grid.w,s=e-o,r=this.__w-this.__scale9grid.x-s,a=this.__h-this.__scale9grid.y-i,l=r+this.__scale9grid.x,c=a+this.__scale9grid.y,u=this.__scale9grid.x,h=this.__scale9grid.y,d=this.__scale9grid.w,f=this.__scale9grid.h;this.__scale9Data={t1:{x:0,y:0,w:u,h:h},t2:{x:u,y:0,w:d,h:h,dw:r},t3:{x:o,y:0,w:s,h:h,dx:l},m1:{x:0,y:h,w:u,h:f,dh:a},m2:{x:u,y:h,w:d,h:f,dw:r,dh:a},m3:{x:o,y:h,w:s,h:f,dx:l,dh:a},b1:{x:0,y:n,w:u,h:i,dy:c},b2:{x:u,y:n,w:d,h:i,dw:r,dy:c},b3:{x:o,y:n,w:s,h:i,dx:l,dy:c}}},onRender:function(e){if(this.animations.playingK){var t=this.animations.animation;t.lastUpdateTime||(t.lastUpdateTime=(new Date).getTime());var n=(new Date).getTime(),i=n-t.lastUpdateTime,o=i/(16.7*t.frameRate)>>0;if(o>0){if(t.index+=o,t.index>=t.frames.length){if(!t.loop){var s=this.animations.playingK;return this.animations.stop(),this.animations.emit("stop",s),void 0}t.index=0}t.lastUpdateTime=n}var r=t.frames[t.index];e.map(this.images[r],0,0,this.w,this.h)}else if(this.__scale9grid&&this.__updateCache){var a=this.images[this.__frameIndex],l=this.__scale9Data,c=l.t1,u=l.t2,h=l.t3,d=l.m1,f=l.m2,p=l.m3,_=l.b1,y=l.b2,m=l.b3;e.map(a,c.x,c.y,c.w,c.h,c.x,c.y,c.w,c.h),e.map(a,u.x,u.y,u.dw,u.h,u.x,u.y,u.w,u.h),e.map(a,h.dx,h.y,h.w,h.h,h.x,h.y,h.w,h.h),e.map(a,d.x,d.y,d.w,d.dh,d.x,d.y,d.w,d.h),e.map(a,f.x,f.y,f.dw,f.dh,f.x,f.y,f.w,f.h),e.map(a,p.dx,p.y,p.w,p.dh,p.x,p.y,p.w,p.h),e.map(a,_.x,_.dy,_.w,_.h,_.x,_.y,_.w,_.h),e.map(a,y.x,y.dy,y.dw,y.h,y.x,y.y,y.w,y.h),e.map(a,m.dx,m.dy,m.w,m.h,m.x,m.y,m.w,m.h)}else e.map(this.images[this.frameIndex],0,0,this.w,this.h)},nextFrame:function(e){this.frameIndex++,this.frameIndex>=this.images.length&&(this.frameIndex=e?0:this.images.length-1)},prevFrame:function(e){this.frameIndex--,this.frameIndex<0&&(e?frameIndex=this.images.length-1:this.frameIndex=0)},setImages:function(e,t){if("string"==typeof e)this.images=[this.game.assets.image(e)];else if(e instanceof self.Image||e.getContext&&1==e.nodeType)this.images=[e];else if(e instanceof Array){var n=[];e.forEach(function(e){"string"==typeof e?n.push(this.game.assets.image(e)):n.push(e)},this),this.images=n}else this.images=[];return this.images[0]||soya2d.console.error("soya2d.Sprite: invalid param [images]; "+this.images[0]),this.frameIndex=0,t&&(this.w=this.images[0].width,this.h=this.images[0].height),this.animations&&this.animations.destroy(),this.animations=new U(this,this.images.length),this}}),soya2d.class("soya2d.TileSprite",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){this.sprite=null,this.sprite=e.sprite instanceof soya2d.Sprite?e.sprite:new soya2d.Sprite({images:e.sprite}),this.w=e.w||this.sprite.w,this.h=e.h||this.sprite.h,this.autoScroll=e.autoScroll||!1,this.speed=e.speed||1,this.scrollAngle=e.scrollAngle||0,this.__tileOffx=0,this.__tileOffy=0},scroll:function(e,t){if(e||t)this.__tileOffx+=e||0,this.__tileOffy+=t||0;else{var n=(this.scrollAngle>>0)%360;this.__tileOffx+=soya2d.Math.COSTABLE[n]*this.speed,this.__tileOffy+=soya2d.Math.SINTABLE[n]*this.speed}},clone:function(e){var t=new this.constructor({sprite:this.sprite});return soya2d.DisplayObject.prototype.clone.call(this,e,t),t},_onUpdate:function(){if(this.autoScroll){var e=(this.scrollAngle>>0)%360;this.__tileOffx+=soya2d.Math.COSTABLE[e]*this.speed,this.__tileOffy+=soya2d.Math.SINTABLE[e]*this.speed}},onRender:function(e){e.beginPath(),e.push(),e.rect(0,0,this.w,this.h),e.clip();var t=this.sprite,n=t.w,i=t.h,o=n*t.scaleX,s=i*t.scaleY;o=0>o?-1*o:o,s=0>s?-1*s:s;var r=(this.w/o>>0)+2,a=(this.h/s>>0)+2,l=this.__tileOffx%o,c=this.__tileOffy%s;this.__tileOffx>0&&(l-=o),this.__tileOffy>0&&(c-=s);for(var u=this.sprite.images[0],h=a;h--;)for(var d=r;d--;){var f=d*o,p=h*s;e.map(u,f+l,p+c,o,s,0,0,n,i)}e.pop()}}),soya2d.CanvasGraphics=function(e){this.ctx=e,this.opacity=function(e){return 0===e||e?(this.ctx.globalAlpha=e,this):this.ctx.globalAlpha},this.closePath=function(){return this.ctx.closePath(),this},this.moveTo=function(e,t){return this.ctx.moveTo(e,t),this},this.lineTo=function(e,t){return this.ctx.lineTo(e,t),this},this.quadraticCurveTo=function(e,t,n,i){return this.ctx.quadraticCurveTo(e,t,n,i),this},this.bezierCurveTo=function(e,t,n,i,o,s){return this.ctx.bezierCurveTo(e,t,n,i,o,s),this},this.arcTo=function(e,t,n,i,o){return this.ctx.arcTo(e,t,n,i,o),this},this.arc=function(e,t,n,i,o){return this.ctx.arc(e,t,n,i||0,o||soya2d.Math.PIM2),this},this.eArc=function(t,n,i,o,s,r){s=(s||0)>>0,r=(r||360)>>0;var a=soya2d.Math,l=t+i*a.COSTABLE[s],c=n+o*a.SINTABLE[s];e.moveTo(l,c);var u=0;u=s>r?360-s+r:r-s;for(var h=1;u>=h;h++){var d=(s+h)%360;l=t+i*a.COSTABLE[d],c=n+o*a.SINTABLE[d],e.lineTo(l,c)}return this},this.rect=function(e,t,n,i){return this.ctx.rect(e,t,n,i),this},this.polygon=function(e){var t=this.ctx,n=e.length-1;t.moveTo(e[0],e[1]);for(var i=2;n>i;i+=2)t.lineTo(e[i],e[i+1]);return this},this.ellipse=function(e,t,n,i){var o=.5522848,s=n/2*o,r=i/2*o,a=e+n,l=t+i,c=e+n/2,u=t+i/2,h=this.ctx;return h.moveTo(e,u),h.bezierCurveTo(e,u-r,c-s,t,c,t),h.bezierCurveTo(c+s,t,a,u-r,a,u),h.bezierCurveTo(a,u+r,c+s,l,c,l),h.bezierCurveTo(c-s,l,e,u+r,e,u),this},this.roundRect=function(e,t,n,i,o){var s=this.ctx;return s.moveTo(e+o,t),s.lineTo(e+(n-(o<<1)),t),s.arc(e+n-o,t+o,o,3*Math.PI/2,0),s.lineTo(e+n,t+i-o),s.arc(e+n-o,t+i-o,o,0,soya2d.Math.PID2),s.lineTo(e+o,t+i),s.arc(e+o,t+i-o,o,soya2d.Math.PID2,Math.PI),s.lineTo(e,t+o),s.arc(e+o,t+o,o,Math.PI,3*Math.PI/2),this},this.regularPolygon=function(e,t,n,i,o){e=e||0,t=t||0,n=3>n?3:n;for(var s=soya2d.Math,r=[],a=360/n,l=0,c=0;360>l;l+=a,c++){var u=i;o&&(u=c%2!==0?i:o),s.COSTABLE[l]?r.push(e+u*s.COSTABLE[l],t+u*s.SINTABLE[l]):r.push(e+u*s.COSTABLE[Math.round(l)],t+u*s.SINTABLE[Math.round(l)])}return this.polygon(r),this},this.blendMode=function(e){return e?(this.ctx.globalCompositeOperation=e,this):this.ctx.globalCompositeOperation},this.strokeStyle=function(e){return e?(this.ctx.strokeStyle=e,this):this.ctx.strokeStyle},this.fillStyle=function(e){return e?(this.ctx.fillStyle=e,this):this.ctx.fillStyle},this.shadow=function(e,t,n,i){return this.ctx.shadowBlur=e,this.ctx.shadowColor=t,this.ctx.shadowOffsetX=n,this.ctx.shadowOffsetY=i,this},this.lineStyle=function(e,t,n,i){var o=this.ctx;return o.lineWidth=e,o.lineCap=t||o.lineCap,o.lineJoin=n||o.lineJoin,o.miterLimit=i||o.miterLimit,this},this.font=function(e){var t=this.ctx;return t.font=e.getDesc(),this},this.clip=function(){return this.ctx.clip(),this},this.push=function(){return this.ctx.save(),this},this.pop=function(){return this.ctx.restore(),this},this.beginPath=function(){return this.ctx.beginPath(),this},this.closePath=function(){return this.ctx.closePath(),this},this.fill=function(){return this.ctx.fill(),this},this.stroke=function(){return this.ctx.stroke(),this},this.path=function(e){e._insQ.forEach(function(e){var t=e[0].toLowerCase();switch(t){case"m":this.ctx.moveTo(e[1][0],e[1][1]);break;case"l":var n=e[1];if(n.length>2)for(var i=0;i<n.length;i+=2)this.ctx.lineTo(n[i],n[i+1]);else this.ctx.lineTo(n[0],n[1]);break;case"c":var n=e[1];if(n.length>6)for(var i=0;i<n.length;i+=6)this.ctx.bezierCurveTo(n[i],n[i+1],n[i+2],n[i+3],n[i+4],n[i+5]);else this.ctx.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]);break;case"q":var n=e[1];if(n.length>4)for(var i=0;i<n.length;i+=4)this.ctx.quadraticCurveTo(n[i],n[i+1],n[i+2],n[i+3]);else this.ctx.quadraticCurveTo(n[0],n[1],n[2],n[3]);break;case"z":this.ctx.closePath()}},this)},this.fillRect=function(e,t,n,i){return this.ctx.fillRect(e,t,n,i),this},this.strokeRect=function(e,t,n,i){return this.ctx.strokeRect(e,t,n,i),this},this.clearRect=function(e,t,n,i){return this.ctx.clearRect(e,t,n,i),this},this.map=function(e,t,n,i,o,s,r,a,l){return s=s||0,r=r||0,a=a||e.width,l=l||e.height,0!==a&&0!==l&&0!==i&&0!==o?(this.ctx.drawImage(e,s>>0,r>>0,a>>0,l>>0,t>>0,n>>0,i>>0,o>>0),this):void 0},this.fillText=function(e,t,n,i){return i?this.ctx.fillText(e,t||0,n||0,i):this.ctx.fillText(e,t||0,n||0),this},this.strokeText=function(e,t,n,i){return i?this.ctx.strokeText(e,t||0,n||0,i):this.ctx.strokeText(e,t||0,n||0),this}},soya2d.CanvasRenderer=function(e){function t(e){e.stroke=function(){},e.fill=function(){},e.fillRect=function(t,n,i,o){e.rect(t,n,i,o)},e.strokeRect=function(t,n,i,o){e.rect(t,n,i,o)},e.drawImage=function(t,n,i,o,s,r,a,l,c){3===arguments.length?e.rect(n,i,t.width,t.height):5===arguments.length?e.rect(n,i,o,s):9===arguments.length&&e.rect(r,a,l,c)},e.fillText=function(){},e.strokeText=function(){},e.beginPath=function(){},e.closePath=function(){}}function n(e){e.stroke=p.stroke,e.fill=p.fill,e.fillRect=p.fillRect,e.strokeRect=p.strokeRect,e.drawImage=p.drawImage,e.fillText=p.fillText,e.strokeText=p.strokeText,e.beginPath=p.beginPath,e.closePath=p.closePath}function i(e,t){if(t.onRender){var n=t.__worldTransform.e,o=t.worldPosition;e.setTransform(n[0],n[1],n[2],n[3],o.x,o.y);var s=t.anchorPosition;e.translate(-s.x,-s.y),t.onRender(h)}if(t.children&&t.children.length>0)for(var r=t.children,a=0;a<r.length;a++)i(e,r[a])}function o(e,s,r,a,l,c){if(0!==r.opacity&&r.visible&&!r.__masker){var u=r.__screenPosition;if(r.__renderable||1/0==u.x||1/0==u.y){if(f++,r.mask instanceof soya2d.DisplayObject&&(s.save(),s.beginPath(),t(s),i(s,r.mask),s.clip(),n(s),s.closePath()),r.onRender){var h=r.__worldTransform.e,d=r.anchorPosition,p=r.worldPosition;if(r.__updateCache){var _=d.x,y=d.y;s.setTransform(1,0,0,1,_,y)}else{var _=u.x,y=u.y;1/0==_&&1/0==y&&(_=p.x,y=p.y),s.setTransform(h[0],h[1],h[2],h[3],_,y)}c&&r.opacity<=1&&r.opacity!==c.opacity&&(c.opacity=r.opacity,s.globalAlpha=r.opacity),c&&c.blendMode!==r.blendMode&&(c.blendMode=r.blendMode,s.globalCompositeOperation=r.blendMode),s.translate(-d.x,-d.y),r.imageCache&&!r.__updateCache?s.drawImage(r.imageCache,0,0):r.onRender(a)}if(r.__renderable=!1,r.children&&r.children.length>0&&!r.__updateCache){var m=r.children;l&&m.sort(function(e,t){return e.z===t.z?e.__seq-t.__seq:e.z-t.z});for(var g=0;g<m.length;g++)o(e,s,m[g],a,l,c)}r.mask instanceof soya2d.DisplayObject&&s.restore()}}}e=e||{};var s=e.container;this.w=e.w||(s?s.clientWidth:0),this.h=e.h||(s?s.clientHeight:0),this.autoClear=void 0===e.autoClear?!0:e.autoClear,this.sortEnable=e.sortEnable||!1;var r=e.smoothEnable===!1?!1:e.smoothEnable||!0,a=e.crispEnable||!1,l=document.createElement("canvas");l.style.position="absolute";var c=window.getComputedStyle(e.container,null).position;"absolute"!==c&&"relative"!==c&&(s.style.position="relative"),c=null,s.appendChild(l),s=null;var u=l.getContext("2d"),h=new soya2d.CanvasGraphics(u);l.width=this.w,l.height=this.h,this.ctx=u,u.textBaseline=soya2d.TEXTVALIGN_TOP;var d={opacity:1,blendMode:"source-over"};this.getCanvas=function(){return l};var f=0;this.render=function(e,t){if(!(!e instanceof W)){u.setTransform(1,0,0,1,0,0),this.autoClear&&u.clearRect(0,0,this.w,this.h);var n=t.__view;return f=0,o(n,u,e,h,this.sortEnable,d),f}};var p={stroke:u.stroke,fill:u.fill,fillRect:u.fillRect,strokeRect:u.strokeRect,drawImage:u.drawImage,fillText:u.fillText,strokeText:u.strokeText,beginPath:u.beginPath,closePath:u.closePath};this.renderDO=o,this.destroy=function(){l.parentNode&&l.parentNode.removeChild(l),p=h=this.ctx=null},this.resize=function(e,t){var n=l.width,i=l.height;this.hr=e/n,this.vr=t/i,l.style.width=e+"px",l.style.height=t+"px"},this.hr=1,this.vr=1,this.smooth=function(e){return void 0!==e?(u.imageSmoothingEnabled=u.mozImageSmoothingEnabled=u.oImageSmoothingEnabled=u.msImageSmoothingEnabled=e,r=e,this):r},this.smooth(r),this.crisp=function(e){e?(l.style["image-rendering"]="optimizeSpeed",l.style["image-rendering"]="crisp-edges",l.style["image-rendering"]="-moz-crisp-edges",l.style["image-rendering"]="-webkit-optimize-contrast",l.style["image-rendering"]="optimize-contrast",l.style["image-rendering"]="pixelated",l.style.msInterpolationMode="nearest-neighbor"):(l.style["image-rendering"]="auto",l.style.msInterpolationMode="bicubic")},this.crisp(a),this.getImageData=function(e,t,n,i){return e=e||0,t=t||0,n=n||this.w,i=i||this.h,u.getImageData(e,t,n,i)},this.toDataURL=function(e){return l.toDataURL(e||"image/png")},this.createPattern=function(e,t){return u.createPattern(e,t||"repeat")},this.createGradient=function(e,t,n,i){var o=0,s=0,r=0,a=soya2d.GRADIENT_LINEAR,l=0,c=0;i&&(o=i.angle||0,s=i.x||0,r=i.y||0,a=i.type||soya2d.GRADIENT_LINEAR,l=i.focalRatio||0,c=i.focalRadius||0);var h,d=soya2d.Math;switch(o=Math.abs((o||0)>>0),a){case soya2d.GRADIENT_LINEAR:h=u.createLinearGradient(s,r,s+n*d.COSTABLE[o],r+n*d.SINTABLE[o]);for(var f=0,p=e.length;p>f;f++)h.addColorStop(e[f],t[f]||"RGBA(0,0,0,0)");break;case soya2d.GRADIENT_RADIAL:var _=n*l;h=u.createRadialGradient(s,r,c,s+_*d.COSTABLE[o],r+_*d.SINTABLE[o],n);for(var f=0,p=e.length;p>f;f++)h.addColorStop(e[f],t[f]||"RGBA(0,0,0,0)")}return h}},soya2d.CanvasRenderer.prototype.getImageFrom=function(e,t,n){var i=document.createElement("canvas");i.width=t||e.w,i.height=n||e.h;var o=i.getContext("2d"),s=new soya2d.CanvasGraphics(o),r=new Image;return r.src=i.toDataURL("image/png"),s=null,i=null,r},soya2d.Path=function(e){this.d=e||"",this.cmd=["m","l","c","q","z"],this._insQ=[],this.__parse()},soya2d.ext(soya2d.Path.prototype,{__parse:function(){var e=new RegExp("["+this.cmd.join("")+"]([^"+this.cmd.join("")+"]+|$)","img"),t=this.d.replace(/^\s+|\s+$/,"").match(e);t.forEach(function(e){e=e.replace(/^\s+|\s+$/,"");var t=e[0].toLowerCase();if(this.cmd.indexOf(t)>-1){var n=e.substr(1).replace(/^\s/gm,"").split(/\n|,|\s/gm);this._insQ.push([t,n])}},this)},setPath:function(e){this.d=e,this.__parse()}}),soya2d.Device=new function(){var e=this.userAgent=self.navigator.userAgent.toLowerCase(),t=e.indexOf("windows")>0?!0:!1,n=e.indexOf("linux")>0?!0:!1,i=e.indexOf("mac os")>0?!0:!1,o=e.indexOf("android")>0?!0:!1,s=e.indexOf("iphone")>0?!0:!1,r=e.indexOf("ipad")>0?!0:!1,a=e.indexOf("windows phone")>0?!0:!1;this.iphone=s,this.ipad=r,this.ios=s||r,this.android=o,this.wp=a,this.mobile=this.ios||o||a,this.windows=t,this.linux=n,this.mac=i;var l={Firefox:e.indexOf("firefox")+1,Opera:e.indexOf("opera")+1,Chrome:e.indexOf("chrome")+1,Safari:e.indexOf("safari")>-1&&e.indexOf("chrome")<0};this.ie=/msie|trident.*rv:/.test(e.toLowerCase()),this.ff=l.Firefox?!0:!1,this.opera=l.Opera?!0:!1,this.chrome=l.Chrome?!0:!1,this.safari=l.Safari?!0:!1},soya2d.Font=function(e){var t=document.createElement("span"),n=["padding:0 !important;","margin:0 !important;","top:-9999px !important;","left:-9999px !important;","white-space:nowrap !important;","position:absolute !important;"];t.style.cssText=n.join("")+"font:"+(e||"normal 400 13px/normal sans-serif"),document.body.appendChild(t),this.fontString=t.style.font,this.__textRenderer=function(e){if(e.font(this.font),this.__lines){e.fillStyle(this.fillStyle);for(var t=0,n=this.__lines.length;n>t;t++){var i=this.__lines[t];if(this.letterSpacing>0)for(var o=0,s=0,r=i.length;r>s;s++)e.fillText(i[s],o,(this.__lh+this.lineSpacing)*t),o+=this.letterSpacing+this.__uw;else e.fillText(i,0,(this.__lh+this.lineSpacing)*t)}}},this.clone=function(){return new soya2d.Font(this.getDesc())},this.getDesc=function(){return t.style.font},this.style=function(e){return arguments.length>0?(t.style.fontStyle=e,this.fontString=t.style.font,this):t.style.fontStyle},this.weight=function(e){return arguments.length>0?(t.style.fontWeight=e,this.fontString=t.style.font,this):t.style.fontWeight},this.size=function(e){return arguments.length>0?(t.style.fontSize=e+"px",this.fontString=t.style.font,this):t.style.fontSize},this.family=function(e){return arguments.length>0?(e&&(t.style.fontFamily=e,this.fontString=t.style.font),this):t.style.fontFamily},this.getBounds=function(e){t.innerText=e;var n=t.offsetHeight,i=t.offsetWidth;return{w:i,h:n}}},soya2d.ImageFont=function(e,t){this.__fontMap=e;var n=e.texs[Object.keys(e.texs)[0]].height;this.fontSize=t||n,this.fontWidth=e.texs[Object.keys(e.texs)[0]].width;var i=1;this.__textRenderer=function(e){if(this.__lines)for(var t=0,n=0,o=0,s=this.__lines.length;s>o;o++){for(var r=this.__lines[o],a=0,l=0,c=r.length;c>l;l++){var u=r[l],h=this.font.__fontMap.get(u);if(h){var d=h.width*i,f=h.height*i;n=d,e.map(h,a,t,d,f,0,0,h.width,h.height)}a+=n+this.letterSpacing}t+=this.font.fontSize+this.lineSpacing}},this.clone=function(){return new soya2d.ImageFont(this.__fontMap)},this.size=function(e){return arguments.length>0?(this.fontSize=parseInt(e)||n,i=this.fontSize/n,this):this.fontSize},this.getBounds=function(e){var t=e.length;return{w:t*this.fontWidth*i,h:this.fontSize}},t&&this.size(t)},soya2d.class("soya2d.Text",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){this.text=e.text||"",this.letterSpacing=e.letterSpacing||0,this.lineSpacing=e.lineSpacing||0,this.font=e.font||new soya2d.Font,"string"==typeof this.font?this.font=new soya2d.Font(this.font):this.font instanceof soya2d.Atlas&&(this.font=new soya2d.ImageFont(this.font,e.size)),this.__changed=!0,this.__lines,this.__renderer=this.font.__textRenderer,this.fillStyle=e.fillStyle||"#000";var t=this.font.getBounds(this.text);this.w||(this.w=t.w),this.h||(this.h=t.h)},onBuild:function(e,t,n){soya2d.DisplayObject.prototype.onBuild(e);for(var i="",o=0;o<t.childNodes.length;o++)3===t.childNodes[o].nodeType&&(i+=t.childNodes[o].nodeValue);e.text=i.replace(/(^\s+)|(\s+$)/gm,"");var s=e.atlas;s&&(e.size=parseInt(e.size),e.font=n.assets.atlas(s));for(var o in e){var r=o,a=e[o];
switch(r){case"letterSpacing":case"lineSpacing":e[r]=parseFloat(a)}}},onRender:function(e){this.__renderer(e)},refresh:function(){return this.__changed=!0,this},setFont:function(e){return e?(this.font=e,this.__renderer=this.font.__textRenderer,this):this},setText:function(e,t){return this.text=e+"",this.refresh(),t&&(this.w=this.font.getBounds(this.text).w),this},_onUpdate:function(){if(!this.__lh){var e=this.font.getBounds("s"),t=this.font.getBounds("豆");this.__lh=(e.h+t.h)/2>>0,this.__uw=(e.w+t.w)/2>>0}this.__changed&&(this.__lines=this.__calc(),this.__changed=!1)},__calc:function(){var e=this.letterSpacing>>0,t=this.w/(this.__uw+e)>>0;1>t&&(this.w=1.5*this.__uw,t=1);for(var n=this.font,i=this.text.split("\n"),o=[],s=0,r=i.length;r>s;s++){var a=i[s];if(a)for(var l=a.length,c=0;l>c;){var u=a.substr(c,t+1),h=n.getBounds(u).w+u.length*e;if(h>this.w){for(var d=t+1;d--;)if(u=u.substr(0,u.length-1),h=n.getBounds(u).w+u.length*e,h<=this.w){if(0===h)return;o.push(u),c+=u.length;break}}else{for(var f=c,d=1;l-c>d;d++){if(u=a.substr(c,t+1+d),h=n.getBounds(u).w+u.length*e,h>this.w){o.push(u.substr(0,u.length-1)),c+=u.length-1;break}if(u===a){t=a.length-1;break}}if(c===f){u=a.substr(c,t+1),o.push(u);break}}}else o.push("")}return o}}),soya2d.Game=function(e){function n(e){d.running&&(h=requestAFrame(function(t){0===p&&(p=t);var i=t-p;if(p=t,m>u){var o=Date.now();e&&e(o,i),m%=u}m+=i,n(e)}))}e=e||{};var i=e.container||document.body;"string"==typeof i&&(i=document.querySelector(i));var a=(e.rendererType||soya2d.RENDERER_TYPE_CANVAS,i.offsetWidth||100),l=i.offsetHeight||100,c=null;c=new soya2d.CanvasRenderer({smoothEnable:e.smoothEnable,autoClear:e.autoClear,container:i,sortEnable:!0,w:e.w||a,h:e.h||l}),soya2d.ext(this,e),this.renderer=c,this.objects=new g(this),this.add=new v(this),this.events=new s,this.events.__signalHandler=new r,this.scene=new f(this),this.stage=new W({game:this,w:c.w,h:c.h}),this.world=new j({game:this,w:c.w,h:c.h}),this.stage.add(this.world),this.camera=new t(c.w,c.h,this),this.assets=new o,this.load=new F(this),this.timer=new N,this.physics=new G,this.w=c.w,this.h=c.h,this.running=!1,this.start=function(){if(!this.running){this.running=!0,this.stage.__scan(this.w,this.h,i,c);var e=soya2d.module._getAll(),t=[],o=[],s=[],r=[];for(var a in e)e[a].onStart&&e[a].onStart(this),e[a].onBeforeUpdate&&t.push([e[a],e[a].onBeforeUpdate]),e[a].onPostUpdate&&o.push([e[a],e[a].onPostUpdate]),e[a].onBeforeRender&&s.push([e[a],e[a].onBeforeRender]),e[a].onPostRender&&r.push([e[a],e[a].onPostRender]);return u=1e3/y,n(function(e,n){t.forEach(function(t){t[1].call(t[0],d,e,n)}),d.physics.running&&d.physics.update(),d.camera.__onUpdate(),d.timer.__scan(n),d.currentScene.onUpdate&&d.currentScene.onUpdate(d,n),d.stage.__preUpdate(d,n),d.stage.__updateMatrix(),d.stage.__postUpdate(d,n),o.length>0&&(e=Date.now(),o.forEach(function(t){t[1].call(t[0],d,e,n)})),d.camera.__cull(d.stage),d.camera.__viewport(d.world),s.length>0&&(e=Date.now(),s.forEach(function(t){t[1].call(t[0],d,e,n)}));var i=c.render(d.stage,d.camera);r.length>0&&(e=Date.now(),r.forEach(function(t){t[1].call(t[0],d,e,n,i)}))}),this}};var u,h,d=this,p=0,_=60,y=60,m=0;this.setFPS=function(e){return y=parseInt(e)||_,y=y>_?_:y,u=1e3/y,this},this.stop=function(){cancelAFrame(h),this.running=!1;var e=soya2d.module._getAll();for(var t in e)e[t].onStop&&e[t].onStop(this);return this},this.destroy=function(){this.running&&this.stop();var e=soya2d.module._getAll();for(var t in e)e[t].onDestroy&&e[t].onDestroy(this);this.renderer.destroy(),this.stage.destroy();var n=soya2d.games.indexOf(this);n>-1&&soya2d.games.splice(n,1)};var x=soya2d.module._getAll(),b=0;for(var w in x)x[w].onInit&&x[w].onInit(this),b++;this.objects.register("shape",soya2d.Shape),this.objects.register("sprite",soya2d.Sprite),this.objects.register("tileSprite",soya2d.TileSprite),this.objects.register("group",soya2d.DisplayObjectContainer),this.objects.register("text",soya2d.Text);var S="soya2d Game instance created...",A=b+" plugins loaded...";soya2d.console.info(S),soya2d.console.info(A),soya2d.games.push(this)},soya2d.games=[];var H="soya2d "+soya2d.version.toString()+" is working...",q="==== thank you for using soya2d, you'll love it! ====";soya2d.console.info(H),soya2d.console.info(q),soya2d.RENDERER_TYPE_AUTO=1,soya2d.RENDERER_TYPE_CANVAS=2,soya2d.RENDERER_TYPE_WEBGL=3,!function(){function e(e,t,n,i){this.duration=1e3*n,i=i||{},this.easing=i.easing||soya2d.Tween.Linear,this.repeat=i.repeat||0,this.yoyo=i.yoyo||!1,this.cacheable=i.cacheable||!1,this.delay=1e3*(i.delay||0),this.__attr=e[0],this.__attriNames=Object.keys(e[0]),this.__ratio=e[1],this.__initState=t,this.__loops=0}soya2d.class("soya2d.Tween",{"extends":s,constructor:function(e){this.__signalHandler=new r,this.target=e,this.__tds={},this.__startTimes=[],this.__long=0,this.position=0,this.__reversed=!1,this.__paused=!1,this.__infinite=!1,this.__state={},this.__status="paused",this.__runningTD,this.__changeTimes=0,this.__lastChangeTD},__calc:function(e,t,n){for(var i=Object.keys(e),o={},s={},r=i.length;r--;){var a=i[r],l=this.__state[a];if(void 0===l&&(l=this.target[a]),void 0!==l){var c=parseFloat(l||0),u=e[a];("string"==typeof u||u instanceof String)&&(u=0===u.indexOf("-")?c-parseFloat(u.substring(1,u.length)):0===u.indexOf("+")?c+parseFloat(u.substring(1,u.length)):parseFloat(u));var h=u-c;if(o[a]={initVal:c,varVal:h,endVal:u},this.__state[a]=u,this.cacheable)for(var d=o[a].dVal={},f=0;(f+=10)<t;){var p=n(f,0,1,t);s["p_"+f]=p,d["p_"+f]=c+h*p}}}return[o,s]},to:function(t,n,i){if(this.__infinite)return this;n=n||1,i=i||{};var o=i.easing||soya2d.Tween.Linear,s=this.__calc(t,n,o),r=i.yoyo||!1,a=i.repeat||0,l=a%2;if(r&&l)for(var c in s[0])this.__state[c]=s[0][c].initVal;var u={};soya2d.ext(u,this.__state);var h=new e(s,u,n,i);this.__long+=h.delay;for(var d in this.__tds){var f=this.__tds[d];for(var c in s[0])void 0===f.__initState[c]&&(f.__initState[c]=s[0][c].initVal)}return this.__tds[this.__long]=h,this.__startTimes.push(this.__long),h.__startPos=this.__long,-1===h.repeat&&(this.__infinite=!0,soya2d.console.warn("infinite loop instance")),this.__long+=h.duration*(h.repeat+1),this},play:function(e){return this.__reversed=!1,this.__status="running",this.keepAlive=e,this},reverse:function(){return this.__infinite?void 0:(this.__status="running",this.__reversed=!0,this)},pause:function(){return this.__status="paused",this.emit("pause"),this},restart:function(e){return this.position=0,this.play(e),this},__getTD:function(){for(var e=this.__startTimes.length;e--;)if(this.position>=this.__startTimes[e])return this.__tds[this.__startTimes[e]]},__onUpdate:function(e,t){this.emit("process",e,this.position/this.__long),(e>=1&&!this.__reversed||0===e&&this.__reversed)&&this.__lastChangeTD!=t&&(this.__onChange(++this.__changeTimes),this.__lastChangeTD=t)},__onChange:function(e){this.emit("change",e)},__onEnd:function(){this.emit("stop"),this.keepAlive||this.destroy()},__update:function(e,t){if("running"===this.__status){if(this.position>this.__long&&!this.__reversed&&!this.__infinite)return this.position=this.__long,this.pause(),this.__onEnd(),void 0;if(this.position<0&&this.__reversed&&!this.__infinite)return this.position=0,this.pause(),this.__onEnd(),void 0;t=this.__reversed?-t:t,this.position+=t;var n=this.__getTD();n&&(this.__runningTD!==n&&(this.__runningTD=n,this.__runningTD.__inited=!1),n.update(this,this.position))}},destroy:function(){this.__manager.__remove(this);for(var e in this.__tds)this.__tds[e].destroy();this.__tds=null,this.target=null,this.__currentTD=null}}),e.prototype={update:function(e,t){var n=t-this.__startPos;if(0!==this.repeat){if(this.__loops=Math.ceil(n/this.duration)-1,this.repeat>0&&this.__loops>this.repeat)return;n%=this.duration}else n=n>this.duration?this.duration:n;var i=e.target;if(!this.__inited){for(var o in this.__initState)i[o]=this.__initState[o];this.__inited=!0}var s;if(0===this.repeat)s=this.goTo(i,n);else{var r=this.__loops%2;s=r&&this.__loops>0&&this.yoyo?this.goTo(i,n,!0):this.goTo(i,n)}e.__onUpdate(s,this)},goTo:function(e,t,n){var i,o=this.__attriNames,s=this.__attr,r=e;if(this.cacheable){var a="p_"+10*(t/10>>0);i=this.__ratio[a],"p_0"===a&&(i=0),void 0===i&&(i=1);for(var l=o.length;l--;){var c=o[l];if(s[c]){var u=s[c].dVal[a];void 0===u&&(u=s[c].endVal),r[c]=u}}}else{0>t&&(t=0),i=this.easing(t,0,1,this.duration),t>this.duration&&(i=1);for(var l=o.length;l--;){var c=o[l];s[c]&&(r[c]=s[c].initVal+s[c].varVal*(n?1-i:i))}}return i},destroy:function(){this.__attr=null,this.__ratio=null,this.easing=null,this.target=null,this.onUpdate=null,this.onEnd=null}}}(),!function(){function e(e,t,n){this.duration=1e3*t,n=n||{},this.easing=n.easing||soya2d.Tween.Linear,this.repeat=n.repeat||0,this.yoyo=n.yoyo||!1,this.cacheable=n.cacheable||!1,this.delay=1e3*(n.delay||0),this.__pps=e,this.__radian=0,this.__loops=0}soya2d.class("soya2d.PathTween",{"extends":s,constructor:function(e){this.__signalHandler=new r,this.target=e,this.__tds={},this.__startTimes=[],this.__long=0,this.position=0,this.__reversed=!1,this.__paused=!1,this.__infinite=!1,this.__status="paused",this.__runningTD,this.__changeTimes=0,this.__lastChangeTD},__calc:function(e){var t=0,n=0,i=0,o=0,s=[];return"string"==typeof e&&(e=new soya2d.Path(e)),e._insQ.forEach(function(e){var r=e[0].toLowerCase();switch(r){case"m":i=t=parseFloat(e[1][0]),o=n=parseFloat(e[1][1]);break;case"l":for(var a=e[1],l=0;l<a.length;l+=2){for(var c=Math.atan2(a[l+1]-n,a[l]-t),u=soya2d.Math.len2D(t,n,a[l],a[l+1]),h=0;u>h;h++){var d=h*Math.cos(c)+t,f=h*Math.sin(c)+n;s.push(d,f)}t=parseFloat(a[l]),n=parseFloat(a[l+1])}break;case"c":for(var p=[],a=e[1],l=0;l<a.length;l+=6){for(var _=0;1>_;_+=.01){var y=_*_,m=y*_,d=t*(1-3*_+3*y-m)+3*a[l]*_*(1-2*_+y)+3*a[l+2]*y*(1-_)+a[l+4]*m,f=n*(1-3*_+3*y-m)+3*a[l+1]*_*(1-2*_+y)+3*a[l+3]*y*(1-_)+a[l+5]*m;p.push(d,f)}t=parseFloat(a[l+4]),n=parseFloat(a[l+5])}(p[p.length-2]!=a[a.length-2]||p[p.length-1]!=a[a.length-1])&&p.push(a[a.length-2],a[a.length-1]);for(var g=0,v={},l=0;l<p.length-2;l+=2){var u=soya2d.Math.len2D(p[l],p[l+1],p[l+2],p[l+3]),c=Math.atan2(p[l+3]-p[l+1],p[l+2]-p[l]);v[g]=[c,p[l],p[l+1],u],g+=u}for(var x=[p[0],p[1]],l=1;g>l;l++){for(var b,w,S,c=0,A=Object.keys(v),T=A.length;T--;)if(S=parseFloat(A[T]),l>=S){c=v[S][0],b=v[S][1],w=v[S][2];break}if(0!==c){var d=(l-S)*Math.cos(c)+b,f=(l-S)*Math.sin(c)+w;x.push(d,f)}}s=s.concat(x);break;case"q":for(var p=[],a=e[1],l=0;l<a.length;l+=4){for(var _=0;1>_;_+=.01){var y=_*_,m=y*_,d=t*(1-2*_+y)+2*a[l]*_*(1-_)+a[l+2]*y,f=n*(1-2*_+y)+2*a[l+1]*_*(1-_)+a[l+3]*y;p.push(d,f)}t=parseFloat(a[l+2]),n=parseFloat(a[l+3])}(p[p.length-2]!=a[a.length-2]||p[p.length-1]!=a[a.length-1])&&p.push(a[a.length-2],a[a.length-1]);for(var g=0,v={},l=0;l<p.length-2;l+=2){var u=soya2d.Math.len2D(p[l],p[l+1],p[l+2],p[l+3]),c=Math.atan2(p[l+3]-p[l+1],p[l+2]-p[l]);v[g]=[c,p[l],p[l+1],u],g+=u}for(var x=[p[0],p[1]],l=1;g>l;l++){for(var b,w,S,c=0,A=Object.keys(v),T=A.length;T--;)if(S=parseFloat(A[T]),l>=S){c=v[S][0],b=v[S][1],w=v[S][2];break}if(0!==c){var d=(l-S)*Math.cos(c)+b,f=(l-S)*Math.sin(c)+w;x.push(d,f)}}s=s.concat(x);break;case"z":for(var c=Math.atan2(o-n,i-t),u=soya2d.Math.len2D(t,n,i,o),h=0;u>h;h++){var d=h*Math.cos(c)+t,f=h*Math.sin(c)+n;s.push(d,f)}}},this),s},to:function(t,n,i){if(this.__infinite)return this;i=i||{};var o=i.easing||soya2d.Tween.Linear,s=this.__calc(t,n,o),r=new e(s,n,i);return this.__long+=r.delay,this.__tds[this.__long]=r,this.__startTimes.push(this.__long),r.__startPos=this.__long,-1===r.repeat&&(this.__infinite=!0,soya2d.console.warn("infinite loop instance")),this.__long+=r.duration*(r.repeat+1),this},play:function(e){return this.__reversed=!1,this.__status="running",this.keepAlive=e,this},reverse:function(){return this.__infinite?void 0:(this.__status="running",this.__reversed=!0,this)},pause:function(){return this.__status="paused",this.emit("pause"),this},restart:function(){return this.position=0,this.play(),this},__getTD:function(){for(var e=this.__startTimes.length;e--;)if(this.position>=this.__startTimes[e])return this.__tds[this.__startTimes[e]]},__onUpdate:function(e,t,n){this.emit("process",e,this.position/this.__long,t),(1===e&&!this.__reversed||0===e&&this.__reversed)&&this.__lastChangeTD!=n&&(this.__onChange(++this.__changeTimes),this.__lastChangeTD=n)},__onChange:function(e){this.emit("change",e)},__onEnd:function(){this.emit("stop"),this.keepAlive||this.destroy()},__update:function(e,t){if("running"===this.__status){if(this.position>this.__long&&!this.__reversed)return this.position=this.__long,this.pause(),this.__onEnd(),void 0;if(this.position<0&&this.__reversed)return this.position=0,this.pause(),this.__onEnd(),void 0;t=this.__reversed?-t:t,this.position+=t;var n=this.__getTD();n&&(this.__runningTD!==n&&(this.__runningTD=n,this.__runningTD.__inited=!1),n.update(this,this.position))}},destroy:function(){this.__manager.__remove(this);for(var e in this.__tds)this.__tds[e].destroy();this.__tds=null,this.target=null,this.__currentTD=null}}),e.prototype={update:function(e,t){var n=t-this.__startPos;if(0!==this.repeat){if(this.__loops=Math.ceil(n/this.duration)-1,this.repeat>0&&this.__loops>this.repeat)return;n%=this.duration}else n=n>this.duration?this.duration:n;var i=e.target;this.__inited||(i.x=this.__pps[0],i.y=this.__pps[1],this.__inited=!0);var o;if(0===this.repeat)o=this.goTo(i,n);else{var s=this.__loops%2;o=s&&this.__loops>0&&this.yoyo?this.goTo(i,n,!0):this.goTo(i,n)}e.__onUpdate(o,this.__radian*soya2d.Math.ONEANG,this)},goTo:function(e,t,n){var i,o=this.__pps,s=e;0>t&&(t=0),i=this.easing(t,0,1,this.duration);var r=(o.length-2)*(n?1-i:i)>>0;r>o.length-2&&(r=o.length-2),0>r&&(r*=-1),r%2!=0&&r++;var a=s.anchorPosition;s.x=o[r]-a.x,s.y=o[r+1]-a.y;var l,c,u=o[r],h=o[r+1];return 1>r?(l=o[r+2],c=o[r+3],this.__radian=Math.atan2(c-h,l-u)):(l=o[r-2],c=o[r-1],this.__radian=Math.atan2(h-c,u-l)),i},destroy:function(){this.__pps=null,this.easing=null,this.target=null,this.onUpdate=null,this.onEnd=null}}}(),soya2d.TweenManager=new function(){this.list=[],this.tweenMap={},this.add=function(e,t){var n=null;n=t===soya2d.TWEEN_TYPE_PATH?new soya2d.PathTween(e):new soya2d.Tween(e),this.list.push(n),n.__manager=this;var i=this.tweenMap[e.roid];return i||(i=this.tweenMap[e.roid]=[]),i.push(n),n},this.__remove=function(e){var t=this.list.indexOf(e);t>-1&&(this.list.splice(t,1),e.__manager=null,delete e.__manager);var n=this.tweenMap[e.target.roid];return n&&(t=n.indexOf(e),t>-1&&n.splice(t,1)),e},this.clearAll=function(e){var t=null;if(e){if(!this.tweenMap[e.roid])return;t=this.tweenMap[e.roid].concat()}else t=this.list.concat();for(var n=t.length;n--;)this.__remove(t[n])},this.pauseAll=function(e){var t=null;if(e){if(!this.tweenMap[e.roid])return;t=this.tweenMap[e.roid].concat()}else t=this.list.concat();for(var n=t.length;n--;)t[n].pause()},this.playAll=function(e){var t=null;if(e){if(!this.tweenMap[e.roid])return;t=this.tweenMap[e.roid].concat()}else t=this.list.concat();for(var n=t.length;n--;)t[n].play()},this.reverseAll=function(e){var t=null;if(e){if(!this.tweenMap[e.roid])return;t=this.tweenMap[e.roid].concat()}else t=this.list.concat();for(var n=t.length;n--;)t[n].reverse()},this.__refresh=function(){for(;;){for(var e=!0,t=this.list.length;t--;)this.list[t].target||(this.__remove(this.list[t]),e=!1);if(e)break}},this.__update=function(e,t){for(var n=!1,i=this.list.length;i--;)this.list[i].target?this.list[i].__update(e,t):n=!0;n&&this.__refresh()}},soya2d.TWEEN_TYPE_PATH=2,soya2d.Tween.Linear=function(e,t,n,i){return n*e/i+t},soya2d.Tween.Quad={In:function(e,t,n,i){return n*(e/=i)*e+t},Out:function(e,t,n,i){return-n*(e/=i)*(e-2)+t},InOut:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}},soya2d.Tween.Cubic={In:function(e,t,n,i){return n*(e/=i)*e*e+t},Out:function(e,t,n,i){return n*((e=e/i-1)*e*e+1)+t},InOut:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t}},soya2d.Tween.Quart={In:function(e,t,n,i){return n*(e/=i)*e*e*e+t},Out:function(e,t,n,i){return-n*((e=e/i-1)*e*e*e-1)+t},InOut:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t}},soya2d.Tween.Quint={In:function(e,t,n,i){return n*(e/=i)*e*e*e*e+t},Out:function(e,t,n,i){return n*((e=e/i-1)*e*e*e*e+1)+t},InOut:function(e,t,n,i){return(e/=i/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t}},soya2d.Tween.Sine={In:function(e,t,n,i){return-n*Math.cos(e/i*(Math.PI/2))+n+t},Out:function(e,t,n,i){return n*Math.sin(e/i*(Math.PI/2))+t},InOut:function(e,t,n,i){return-n/2*(Math.cos(Math.PI*e/i)-1)+t}},soya2d.Tween.Expo={In:function(e,t,n,i){return 0===e?t:n*Math.pow(2,10*(e/i-1))+t},Out:function(e,t,n,i){return e===i?t+n:n*(-Math.pow(2,-10*e/i)+1)+t},InOut:function(e,t,n,i){return 0===e?t:e===i?t+n:(e/=i/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(-Math.pow(2,-10*--e)+2)+t}},soya2d.Tween.Circ={In:function(e,t,n,i){return-n*(Math.sqrt(1-(e/=i)*e)-1)+t},Out:function(e,t,n,i){return n*Math.sqrt(1-(e=e/i-1)*e)+t},InOut:function(e,t,n,i){return(e/=i/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t}},soya2d.Tween.Elastic={In:function(e,t,n,i,o,s){if(0===e)return t;if(1===(e/=i))return t+n;if(s||(s=.3*i),!o||o<Math.abs(n)){o=n;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(n/o);return-(o*Math.pow(2,10*(e-=1))*Math.sin(2*(e*i-r)*Math.PI/s))+t},Out:function(e,t,n,i,o,s){if(0===e)return t;if(1===(e/=i))return t+n;if(s||(s=.3*i),!o||o<Math.abs(n)){o=n;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(n/o);return o*Math.pow(2,-10*e)*Math.sin(2*(e*i-r)*Math.PI/s)+n+t},InOut:function(e,t,n,i,o,s){if(0===e)return t;if(2===(e/=i/2))return t+n;if(s||(s=.3*i*1.5),!o||o<Math.abs(n)){o=n;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(n/o);return 1>e?-.5*o*Math.pow(2,10*(e-=1))*Math.sin(2*(e*i-r)*Math.PI/s)+t:o*Math.pow(2,-10*(e-=1))*Math.sin(2*(e*i-r)*Math.PI/s)*.5+n+t}},soya2d.Tween.Back={In:function(e,t,n,i,o){return void 0===o&&(o=1.70158),n*(e/=i)*e*((o+1)*e-o)+t},Out:function(e,t,n,i,o){return void 0===o&&(o=.70158),n*((e=e/i-1)*e*((o+1)*e+o)+1)+t},InOut:function(e,t,n,i,o){return void 0===o&&(o=1.70158),(e/=i/2)<1?n/2*e*e*(((o*=1.525)+1)*e-o)+t:n/2*((e-=2)*e*(((o*=1.525)+1)*e+o)+2)+t}},soya2d.Tween.Bounce={In:function(e,t,n,i){return n-soya2d.Tween.Bounce.Out(i-e,0,n,i)+t},Out:function(e,t,n,i){return(e/=i)<1/2.75?7.5625*n*e*e+t:2/2.75>e?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:2.5/2.75>e?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t},InOut:function(e,t,n,i){return i/2>e?.5*soya2d.Tween.Bounce.In(2*e,0,n,i)+t:.5*soya2d.Tween.Bounce.Out(2*e-i,0,n,i)+.5*n+t}},soya2d.module.install("tween",{onInit:function(e){e.tween=soya2d.TweenManager},onBeforeUpdate:function(e,t,n){soya2d.TweenManager.__update(t,n)},onStop:function(){soya2d.TweenManager.pauseAll()}}),soya2d.class("soya2d.Arc",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){this.bounds=new soya2d.Circle(0,0,this.w/2),this.fillStyle=e.fillStyle||"transparent"},onRender:function(e){e.beginPath();var t=this.w/2,n=this.h/2;e.fillStyle(this.fillStyle);var i=(this.startAngle||0)*soya2d.Math.ONERAD,o=(this.endAngle||0)*soya2d.Math.ONERAD;e.arc(t,n,this.w/2,i,o),o-i!=0&&360!=Math.abs(this.startAngle||0-this.endAngle||0)&&e.lineTo(t,n),e.fill(),e.closePath(),this.lineWidth>0&&(e.lineStyle(this.lineWidth),e.strokeStyle(this.strokeStyle),e.stroke()),e.moveTo(t,n)}}),soya2d.class("soya2d.Ellipse",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){this.fillStyle=e.fillStyle||"transparent"},onRender:function(e){e.beginPath(),e.fillStyle(this.fillStyle),e.ellipse(0,0,this.w,this.h),e.closePath(),e.fill(),this.lineWidth>0&&(e.lineStyle(this.lineWidth),e.strokeStyle(this.strokeStyle),e.stroke())}}),soya2d.class("soya2d.Poly",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){this.bounds=new soya2d.Polygon(e.vtx),this.fillStyle=e.fillStyle||"transparent"},onRender:function(e){e.beginPath(),e.fillStyle(this.fillStyle),e.polygon(this.vtx),e.fill(),e.closePath(),this.lineWidth>0&&(e.lineStyle(this.lineWidth),e.strokeStyle(this.strokeStyle),e.stroke())}}),soya2d.class("soya2d.Rect",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){this.fillStyle=e.fillStyle||"transparent"},onRender:function(e){e.beginPath(),e.fillStyle(this.fillStyle),e.rect(0,0,this.w,this.h),e.fill(),e.closePath(),this.lineWidth>0&&(e.lineStyle(this.lineWidth),e.strokeStyle(this.strokeStyle),e.stroke())}}),soya2d.class("soya2d.RPoly",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){this.fillStyle=e.fillStyle||"transparent"},onRender:function(e){e.beginPath(),e.fillStyle(this.fillStyle),e.regularPolygon(this.w/2,this.h/2,this.edgeCount,this.r||this.w/2,this.w/2),e.closePath(),e.fill(),this.lineWidth>0&&(e.lineStyle(this.lineWidth),e.strokeStyle(this.strokeStyle),e.stroke())}}),soya2d.class("soya2d.RRect",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){this.fillStyle=e.fillStyle||"transparent",this.r=e.r||0},onRender:function(e){e.beginPath(),e.moveTo(0,0),e.fillStyle(this.fillStyle),e.roundRect(0,0,this.w,this.h,this.r<0?0:this.r),e.fill(),this.lineWidth>0&&(e.lineStyle(this.lineWidth),e.strokeStyle(this.strokeStyle),e.stroke()),e.closePath()}}),soya2d.class("soya2d.EArc",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){this.fillStyle=e.fillStyle||"transparent"},onRender:function(e){e.beginPath(),e.fillStyle(this.fillStyle);var t=this.startAngle||0,n=this.endAngle||0;e.eArc(this.w/2,this.h/2,this.w/2,this.h/2,t,n),n-t!=0&&360!=Math.abs(t-n)&&e.lineTo(this.w/2,this.h/2),e.fill(),e.closePath(),this.lineWidth>0&&(e.lineStyle(this.lineWidth),e.strokeStyle(this.strokeStyle),e.stroke())}}),soya2d.module.install("shapes",{onInit:function(e){e.objects.register("rect",soya2d.Rect),e.objects.register("rrect",soya2d.RRect),e.objects.register("poly",soya2d.Poly),e.objects.register("rpoly",soya2d.RPoly),e.objects.register("arc",soya2d.Arc),e.objects.register("earc",soya2d.EArc),e.objects.register("ellipse",soya2d.Ellipse)}}),soya2d.Events=function(){var e=[];this.register=function(t,n){e.push([t,n])},this.scan=function(){for(var t=e.length;t--;)e[t][1].scan()},this.startListen=function(t){for(var n=e.length;n--;)e[n][1].startListen(t);return this},this.stopListen=function(t){for(var n=e.length;n--;)e[n][1].stopListen(t);return this},this.addListener=function(t,n,i,o){for(var s=t.split(" "),r=s.length;r--;)for(var a=s[r],l=e.length;l--;)if(e[l][0].indexOf(a)>-1){e[l][1].addListener(a,n,i,o);break}},this.removeListener=function(t,n,i){for(var o=t.split(" "),s=o.length;s--;)for(var r=o[s],a=e.length;a--;)if(e[a][0].indexOf(r)>-1){e[a][1].removeListener(r,n,i);break}},this.clearListener=function(t,n){if(t){for(var i=e.length;i--;)if(e[i][1]instanceof t)return e[i][1].clearListener(n),void 0}else for(var i=e.length;i--;)e[i][1].clearListener()}},soya2d.Keyboard=function(){function e(e,t){e.keyCode=t.keyCode||t.which,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.altKey=t.altKey,e.metaKey=t.metaKey,e.keyCodes=r,e.e=t,e.containsAll=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];if(this.keyCodes.length>0){if(this.keyCodes.indexOf(t)<0)return!1}else if(this.keyCode!=t)return!1}return!0},e.contains=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];if(this.keyCodes.length>0){if(this.keyCodes.indexOf(t)>-1)return!0}else if(this.keyCode===t)return!0}return!1}}function t(t){var n=t.keyCode||t.which;r.indexOf(n)<0&&r.push(n),c=!0,e(a,t),h=!0,o(t,n)}function n(t){var n=t.keyCode||t.which,i=r.indexOf(n);i>-1&&r.splice(i,1),u=!0,e(l,t),r.length<1&&(h=!1),o(t,n)}function i(){c=u=h=!1,r=[]}function o(e,t){var n=soya2d.Keyboard.preventKeys;n.indexOf(t)>-1&&(e.preventDefault?e.preventDefault():e.returnValue=!1);var i=soya2d.Keyboard.stopKeys;i.indexOf(t)>-1&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)}function s(e,t,n){if(e){e.sort(function(e,t){return t[2]-e[2]});for(var i=[],o=e.length;o--;)e[o][0].call(e[o][1],t),e[o][3]&&i.push(e[o]);for(var o=i.length;o--;)i[o][1].off(n,i[o][0])}}var r=[],a={},l={},c=!1,u=!1,h=!1,d=soya2d.DisplayObject.prototype.__signalHandler.map;this.scan=function(){var e,t;c&&(e=d.keydown,t=a,s(e,t,"keydown"),c=!1),h&&(e=d.keypress,t=a,s(e,t,"keypress")),u&&(e=d.keyup,t=l,s(e,t,"keyup"),u=!1)},this.startListen=function(){return self.addEventListener("keydown",t,!1),self.addEventListener("keyup",n,!1),self.addEventListener("blur",i,!1),this},this.stopListen=function(){return self.removeEventListener("keydown",t,!1),self.removeEventListener("keyup",n,!1),self.removeEventListener("blur",i,!1),this}},soya2d.Keyboard.preventKeys=[],soya2d.Keyboard.stopKeys=[],soya2d.KeyCode={DELETE:46,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"[":219,"]":221,"\\":220,"=":187,"-":189,",":188,".":190,"/":191,";":186,"'":222},soya2d.Mobile=function(){function e(e,t){t.orientation&&(c.orientation=l[e].orientation=t.orientation),t.alpha&&(c.tilt=l[e].tilt={z:t.alpha,x:t.beta,y:t.gamma,absolute:t.absolute}),t.acceleration&&(c.motion=l[e].motion={x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.z,interval:t.interval}),l[e].e=t,l[e].type=e,l[e].fire=!0}function t(t){e("tilt",t)}function n(t){e("motion",t)}function i(t){clearTimeout(a),a=setTimeout(function(){t.orientation=o(),e("hov",t)},510)}function o(){var e,t=window.innerWidth,n=window.innerHeight;return e=t>n?"landscape":"portrait"}function s(){for(var e in l){var t=l[e];t&&(t.fire=!1)}}function r(e,t){if(e){e.sort(function(e,t){return t[2]-e[2]});for(var n=[],i=e.length;i--;){var o=e[i][1];e[i][0].call(o,t),e[i][3]&&n.push(e[i])}for(var i=n.length;i--;)n[i][1].off(t.type,n[i][0])}}var a,l={tilt:{},motion:{},hov:{}},c=this,u=soya2d.DisplayObject.prototype.__signalHandler.map;this.scan=function(){for(var e in l){var t=l[e];if(t&&t.fire){var n=u[e];r(n,t)}}s()},this.startListen=function(){return self.addEventListener("orientationchange",i,!1),self.addEventListener("deviceorientation",t,!1),self.addEventListener("devicemotion",n,!1),this},this.stopListen=function(){return self.removeEventListener("orientationchange",i,!1),self.removeEventListener("deviceorientation",t,!1),self.removeEventListener("devicemotion",n,!1),this}},soya2d.Mouse=function(){function e(e,n,i){var o=h.renderer;f.x=d[e].x=(n.offsetX||n.layerX)/o.hr,f.y=d[e].y=(n.offsetY||n.layerY)/o.vr,f.lButton=d[e].lButton=0==n.button||1==n.button,f.rButton=d[e].rButton=2==n.button,f.wButton=d[e].wButton=4==n.button||2==n.which,d[e].e=n,d[e].__propagate=!0,d[e].stopPropagation=t,d[e].type=e,d[e].fire=!0,d[e].__fireList&&d[e].__fireList.push(i)}function t(){this.__propagate=!1}function n(t){e("click",t)}function i(t){e("dblclick",t)}function o(t){e("mousedown",t)}function s(t){e("mousewheel",t)}function r(t){e("mousemove",t);var n=[],i=p.mouseover,o=p.mouseout;if(i&&i.forEach(function(e){n.push(e)}),o&&o.forEach(function(e){for(var t=n.length;t--;)if(n[t][1]==e[1])return;n.push(e)}),n.length>0){var s=[];n.forEach(function(n){{var i=n[1];n[0]}i.hitTest&&i.hitTest(f.x,f.y)&&(s.push(i),_.indexOf(i)>-1||(_.push(i),e("mouseover",t,i)))});var r=[];if(_.forEach(function(e){s.indexOf(e)<0&&r.push(e)}),r.length<1)return;for(var a=r.length;a--;){var l=_.indexOf(r[a]);_.splice(l,1);var c=r[a];e("mouseout",t,c)}}}function a(t){e("mouseup",t)}function l(){for(var e in d){var t=d[e];t&&(t.fire=!1,t.__fireList&&(t.__fireList=[]))}}function c(e,t){if(e){for(var n=[],i=e.length;i--;){var o=e[i][1];("mouseover"==t.type||"mouseout"==t.type)&&t.__fireList.indexOf(o)>=0&&o.isRendered()&&n.push(o),n.indexOf(o)<0&&o.hitTest(f.x,f.y)&&o.isRendered()&&n.push(o)}if(n.sort(function(e,t){return t.z-e.z}),!(n.length<1)){var o=n[0],t=u(o,e,t);if(t.__propagate){for(var s=o.parent;s;){if(t=u(s,e,t),!t.__propagate)return;s=s.parent}o!=h&&u(h,e,t)}}}}function u(e,t,n){var i=[];t.forEach(function(t){t[1]==e&&i.push(t)}),i.sort(function(e,t){return t[2]-e[2]});for(var o=i.length;o--;)i[o][0].call(e,n),i[o][3]&&i[o][1].off(n.type,i[o][0]);return n}var h,d={click:{},dblclick:{},mousedown:{},mouseup:{},mousemove:{},mousewheel:{},mouseover:{__fireList:[]},mouseout:{__fireList:[]}},f=this,p=soya2d.DisplayObject.prototype.__signalHandler.map,_=[];this.scan=function(){for(var e in d){var t=d[e];if(t&&t.fire){var n=p[e];c(n,t)}}l()},this.startListen=function(e){h=e;var t=e.renderer.getCanvas();return t.addEventListener("click",n,!1),t.addEventListener("dblclick",i,!1),t.addEventListener("mousedown",o,!1),t.addEventListener("mousewheel",s,!1),t.addEventListener("mousemove",r,!1),self.addEventListener("mouseup",a,!1),this},this.stopListen=function(e){var t=e.renderer.getCanvas();return t.removeEventListener("click",n,!1),t.removeEventListener("dblclick",i,!1),t.removeEventListener("mousedown",o,!1),t.removeEventListener("mousewheel",s,!1),t.removeEventListener("mousemove",r,!1),self.removeEventListener("mouseup",a,!1),this}},soya2d.EVENT_CLICK="click",soya2d.EVENT_DBLCLICK="dblclick",soya2d.EVENT_MOUSEDOWN="mousedown",soya2d.EVENT_MOUSEWHEEL="mousewheel",soya2d.EVENT_MOUSEMOVE="mousemove",soya2d.EVENT_MOUSEUP="mouseup",soya2d.EVENT_MOUSEOVER="mouseover",soya2d.EVENT_MOUSEOUT="mouseout",soya2d.Touch=function(){function e(e,n,i){var o;if(i){var s=n.pointerId;if("touchstart"===e)h[s]={clientX:n.clientX,clientY:n.clientY};else if("touchmove"===e){if(!h[s]||h[s].clientX==n.clientX&&h[s].clientY==n.clientY)return;h[s]={clientX:n.clientX,clientY:n.clientY}}else"touchend"===e?delete h[s]:"touchcancel"===e&&delete h[s];o=[];for(var r in h){var u=h[r];o.push(u)}}else o=n.changedTouches;if(o&&o.length>0){for(var d=n.target||n.srcElement,f=d.offsetLeft,p=d.offsetTop;(d=d.offsetParent)&&"BODY"!=d.tagName;)f+=d.offsetLeft-d.scrollLeft,p+=d.offsetTop-d.scrollTop;for(var _=document.body.scrollTop||document.documentElement.scrollTop,y=document.body.scrollLeft||document.documentElement.scrollLeft,r=0;r<o.length;r++){var m=o[r];c.touchList[r]=m.clientX-f+y,c.touchList[r+1]=m.clientY-p+_}}var g=c.touchList,v=a.renderer,x=v.getCanvas(),b=window.getComputedStyle(x,null).marginLeft;b=parseFloat(b)||0;var w=window.getComputedStyle(x,null).marginTop;w=parseFloat(w)||0;for(var r=0;r<g.length;r+=2){var S=g[r],A=g[r+1];switch(a.stage.rotateMode){case soya2d.ROTATEMODE_90:S=S+x.offsetLeft-w,A=A+x.offsetTop-b;var T=S;S=A,A=a.stage.w-Math.abs(T);break;case soya2d.ROTATEMODE_270:S=S+x.offsetLeft-w,A=A+x.offsetTop-b;var T=A;A=S,S=a.stage.h-Math.abs(T);break;case soya2d.ROTATEMODE_180:S=a.stage.w-Math.abs(S),A=a.stage.h-Math.abs(A)}S/=v.hr,A/=v.vr,g[r]=S,g[r+1]=A}l[e].touchList=g,l[e].e=n,l[e].__propagate=!0,l[e].stopPropagation=t,l[e].type=e,l[e].fire=!0}function t(){this.__propagate=!1}function n(t){if(!t.pointerType||t.pointerType===t.MSPOINTER_TYPE_TOUCH){var n=t.type;switch(n){case"MSPointerDown":case"pointerdown":e("touchstart",t,!0);break;case"touchstart":e("touchstart",t);break;case"MSPointerMove":case"pointermove":e("touchmove",t,!0);break;case"touchmove":e("touchmove",t);break;case"MSPointerUp":case"pointerup":e("touchend",t,!0);break;case"touchend":e("touchend",t);break;case"MSPointerCancel":case"pointercancel":e("touchcancel",t,!0);break;case"touchcancel":e("touchcancel",t)}}}function i(e){e.preventManipulation?e.preventManipulation():e.preventDefault(),n(e)}function o(){for(var e in l){var t=l[e];t&&(t.fire=!1)}}function s(e,t){if(e){for(var n,i,o=[],s=c.touchList,a=e.length;a--;)for(var l=e[a][1],u=0;u<s.length;u+=2)if(n=s[u],i=s[u+1],l.hitTest(n,i)&&l.isRendered()){o.indexOf(l)<0&&o.push(l);break}if(o.sort(function(e,t){return t.z-e.z}),!(o.length<1)){var l=o[0],t=r(l,e,t);if(t.__propagate)for(var h=l.parent;h;){if(t=r(h,e,t),!t.__propagate)return;h=h.parent}}}}function r(e,t,n){var i=[];
t.forEach(function(t){t[1]==e&&i.push(t)}),i.sort(function(e,t){return t[2]-e[2]});for(var o=i.length;o--;)i[o][0].call(e,n),i[o][3]&&i[o][1].off(n.type,i[o][0]);return n}var a,l={touchstart:{},touchmove:{},touchend:{},touchcancel:{}},c=this,u=soya2d.DisplayObject.prototype.__signalHandler.map;this.touchList=[];var h={};this.scan=function(){for(var e in l){var t=l[e];if(t&&t.fire){var n=u[e];s(n,t)}}o()},this.startListen=function(e){a=e;var t=e.renderer.getCanvas();return window.PointerEvent?(t.addEventListener("pointerdown",i,!1),t.addEventListener("pointermove",i,!1),self.addEventListener("pointerup",n,!1),self.addEventListener("pointercancel",n,!1)):window.MSPointerEvent?(t.addEventListener("MSPointerDown",i,!1),t.addEventListener("MSPointerMove",i,!1),self.addEventListener("MSPointerUp",n,!1),self.addEventListener("MSPointerCancel",n,!1)):(t.addEventListener("touchstart",i,!1),t.addEventListener("touchmove",i,!1),self.addEventListener("touchend",n,!1),self.addEventListener("touchcancel",n,!1)),this},this.stopListen=function(e){var t=e.renderer.getCanvas();return window.PointerEvent?(t.removeEventListener("pointerdown",n,!1),t.removeEventListener("pointermove",n,!1),self.removeEventListener("pointerup",n,!1),self.removeEventListener("pointercancel",n,!1)):window.MSPointerEvent?(t.removeEventListener("MSPointerDown",n,!1),t.removeEventListener("MSPointerMove",n,!1),self.removeEventListener("MSPointerUp",n,!1),self.removeEventListener("MSPointerCancel",n,!1)):(t.removeEventListener("touchstart",n,!1),t.removeEventListener("touchmove",n,!1),self.removeEventListener("touchend",n,!1),self.removeEventListener("touchcancel",n,!1)),this}},soya2d.EVENT_TOUCHSTART="touchstart",soya2d.EVENT_TOUCHMOVE="touchmove",soya2d.EVENT_TOUCHEND="touchend",soya2d.EVENT_TOUCHCANCEL="touchcancel",soya2d.module.install("event",{onInit:function(){this.events=new soya2d.Events;var e=["keyup","keydown","keypress"],t=["click","dblclick","mousedown","mousewheel","mousemove","mouseup","mouseover","mouseout"],n=["touchstart","touchmove","touchend","touchcancel"],i=["hov","tilt","motion"];soya2d.Mouse&&this.events.register(t,new soya2d.Mouse),soya2d.Keyboard&&this.events.register(e,new soya2d.Keyboard),soya2d.Touch&&this.events.register(n,new soya2d.Touch),soya2d.Mobile&&this.events.register(i,new soya2d.Mobile)},onStart:function(e){this.events.startListen(e)},onStop:function(e){this.events.stopListen(e)},onBeforeUpdate:function(){this.events.scan()}}),soya2d.EVENT_POINTDOWN="pointdown",soya2d.EVENT_POINTMOVE="pointmove",soya2d.EVENT_POINTUP="pointup",!function(){var t=function(){this.init()};t.prototype={init:function(){var e=this||n;return e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var t=this||n;if(e=parseFloat(e),t.ctx||u(),"undefined"!=typeof e&&e>=0&&1>=e){if(t._volume=e,t._muted)return t;t.usingWebAudio&&(t.masterGain.gain.value=e);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var o=t._howls[i]._getSoundIds(),s=0;s<o.length;s++){var r=t._howls[i]._soundById(o[s]);r&&r._node&&(r._node.volume=r._volume*e)}return t}return t._volume},mute:function(e){var t=this||n;t.ctx||u(),t._muted=e,t.usingWebAudio&&(t.masterGain.gain.value=e?0:t._volume);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var o=t._howls[i]._getSoundIds(),s=0;s<o.length;s++){var r=t._howls[i]._soundById(o[s]);r&&r._node&&(r._node.muted=!!e||r._muted)}return t},unload:function(){for(var e=this||n,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&"undefined"!=typeof e.ctx.close&&(e.ctx.close(),e.ctx=null,u()),e},codecs:function(e){return(this||n)._codecs[e]},_setup:function(){var e=this||n;return e.state=e.ctx?e.ctx.state||"running":"running",e._autoSuspend(),e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||n,t="undefined"!=typeof Audio?new Audio:null;if(!t||"function"!=typeof t.canPlayType)return e;var i=t.canPlayType("audio/mpeg;").replace(/^no$/,""),o=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),s=o&&parseInt(o[0].split("/")[1],10)<33;return e._codecs={mp3:!(s||!i&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||n,t=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),i=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(t||i)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var o=function(){var t=e.ctx.createBufferSource();t.buffer=e._scratchBuffer,t.connect(e.ctx.destination),"undefined"==typeof t.start?t.noteOn(0):t.start(0),t.onended=function(){t.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchend",o,!0)}};return document.addEventListener("touchend",o,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&"undefined"!=typeof e.ctx.suspend&&n.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var i=0;i<e._howls[t]._sounds.length;i++)if(!e._howls[t]._sounds[i]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume:function(){var e=this;return e.ctx&&"undefined"!=typeof e.ctx.resume&&n.usingWebAudio?("running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.state="resuming",e.ctx.resume().then(function(){e.state="running"}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e):void 0}};var n=new t,i=function(e){var t=this;return e.src&&0!==e.src.length?void t.init(e):void console.error("An array of source files must be passed with any new Howl.")};i.prototype={init:function(e){var t=this;return n.ctx||u(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._webAudio=n.usingWebAudio&&!t._html5,"undefined"!=typeof n.ctx&&n.ctx&&n.mobileAutoEnable&&n._enableMobileAudio(),n._howls.push(t),t._preload&&t.load(),t},load:function(){var e=this,t=null;if(n.noAudio)return void e._emit("loaderror",null,"No audio support.");"string"==typeof e._src&&(e._src=[e._src]);for(var i=0;i<e._src.length;i++){var s,a;if(e._format&&e._format[i])s=e._format[i];else{if(a=e._src[i],"string"!=typeof a){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}s=/^data:audio\/([^;,]+);/i.exec(a),s||(s=/\.([^.]+)$/.exec(a.split("?",1)[0])),s&&(s=s[1].toLowerCase())}if(n.codecs(s)){t=e._src[i];break}}return t?(e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new o(e),e._webAudio&&r(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(e,t){var i=this,o=null;if("number"==typeof e)o=e,e=null;else{if("string"==typeof e&&"loaded"===i._state&&!i._sprite[e])return null;if("undefined"==typeof e){e="__default";for(var s=0,r=0;r<i._sounds.length;r++)i._sounds[r]._paused&&!i._sounds[r]._ended&&(s++,o=i._sounds[r]._id);1===s?e=null:o=null}}var a=o?i._soundById(o):i._inactiveSound();if(!a)return null;if(o&&!e&&(e=a._sprite||"__default"),"loaded"!==i._state&&!i._sprite[e])return i._queue.push({event:"play",action:function(){i.play(i._soundById(a._id)?a._id:void 0)}}),a._id;if(o&&!a._paused)return t||setTimeout(function(){i._emit("play",a._id)},0),a._id;i._webAudio&&n._autoResume();var l=a._seek>0?a._seek:i._sprite[e][0]/1e3,c=(i._sprite[e][0]+i._sprite[e][1])/1e3-l,u=1e3*c/Math.abs(a._rate);a._paused=!1,a._ended=!1,a._sprite=e,a._seek=l,a._start=i._sprite[e][0]/1e3,a._stop=(i._sprite[e][0]+i._sprite[e][1])/1e3,a._loop=!(!a._loop&&!i._sprite[e][2]);var h=a._node;if(i._webAudio){var d=function(){i._refreshBuffer(a);var e=a._muted||i._muted?0:a._volume;h.gain.setValueAtTime(e,n.ctx.currentTime),a._playStart=n.ctx.currentTime,"undefined"==typeof h.bufferSource.start?a._loop?h.bufferSource.noteGrainOn(0,l,86400):h.bufferSource.noteGrainOn(0,l,c):a._loop?h.bufferSource.start(0,l,86400):h.bufferSource.start(0,l,c),u!==1/0&&(i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),u)),t||setTimeout(function(){i._emit("play",a._id)},0)};"loaded"===i._state?d():(i.once("load",d,a._id),i._clearTimer(a._id))}else{var f=function(){h.currentTime=l,h.muted=a._muted||i._muted||n._muted||h.muted,h.volume=a._volume*n.volume(),h.playbackRate=a._rate,setTimeout(function(){h.play(),u!==1/0&&(i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),u)),t||i._emit("play",a._id)},0)},p="loaded"===i._state&&(window&&window.ejecta||!h.readyState&&n._navigator.isCocoonJS);if(4===h.readyState||p)f();else{var _=function(){f(),h.removeEventListener(n._canPlayEvent,_,!1)};h.addEventListener(n._canPlayEvent,_,!1),i._clearTimer(a._id)}}return a._id},pause:function(e){var t=this;if("loaded"!==t._state)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),i=0;i<n.length;i++){t._clearTimer(n[i]);var o=t._soundById(n[i]);if(o&&!o._paused){if(o._seek=t.seek(n[i]),o._rateSeek=0,o._paused=!0,t._stopFade(n[i]),o._node)if(t._webAudio){if(!o._node.bufferSource)return t;"undefined"==typeof o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),t._cleanBuffer(o._node)}else isNaN(o._node.duration)&&o._node.duration!==1/0||o._node.pause();arguments[1]||t._emit("pause",o._id)}}return t},stop:function(e,t){var n=this;if("loaded"!==n._state)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var i=n._getSoundIds(e),o=0;o<i.length;o++){n._clearTimer(i[o]);var s=n._soundById(i[o]);if(s&&!s._paused&&(s._seek=s._start||0,s._rateSeek=0,s._paused=!0,s._ended=!0,n._stopFade(i[o]),s._node))if(n._webAudio){if(!s._node.bufferSource)return n;"undefined"==typeof s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),n._cleanBuffer(s._node)}else isNaN(s._node.duration)&&s._node.duration!==1/0||(s._node.currentTime=s._start||0,s._node.pause());s&&!t&&n._emit("stop",s._id)}return n},mute:function(e,t){var i=this;if("loaded"!==i._state)return i._queue.push({event:"mute",action:function(){i.mute(e,t)}}),i;if("undefined"==typeof t){if("boolean"!=typeof e)return i._muted;i._muted=e}for(var o=i._getSoundIds(t),s=0;s<o.length;s++){var r=i._soundById(o[s]);r&&(r._muted=e,i._webAudio&&r._node?r._node.gain.setValueAtTime(e?0:r._volume,n.ctx.currentTime):r._node&&(r._node.muted=!!n._muted||e),i._emit("mute",r._id))}return i},volume:function(){var e,t,i=this,o=arguments;if(0===o.length)return i._volume;if(1===o.length){var s=i._getSoundIds(),r=s.indexOf(o[0]);r>=0?t=parseInt(o[0],10):e=parseFloat(o[0])}else o.length>=2&&(e=parseFloat(o[0]),t=parseInt(o[1],10));var a;if(!("undefined"!=typeof e&&e>=0&&1>=e))return a=t?i._soundById(t):i._sounds[0],a?a._volume:0;if("loaded"!==i._state)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,o)}}),i;"undefined"==typeof t&&(i._volume=e),t=i._getSoundIds(t);for(var l=0;l<t.length;l++)a=i._soundById(t[l]),a&&(a._volume=e,o[2]||i._stopFade(t[l]),i._webAudio&&a._node&&!a._muted?a._node.gain.setValueAtTime(e,n.ctx.currentTime):a._node&&!a._muted&&(a._node.volume=e*n.volume()),i._emit("volume",a._id));return i},fade:function(e,t,i,o){var s=this,r=Math.abs(e-t),a=e>t?"out":"in",l=r/.01,c=i/l;if("loaded"!==s._state)return s._queue.push({event:"fade",action:function(){s.fade(e,t,i,o)}}),s;s.volume(e,o);for(var u=s._getSoundIds(o),h=0;h<u.length;h++){var d=s._soundById(u[h]);if(d){if(o||s._stopFade(u[h]),s._webAudio&&!d._muted){var f=n.ctx.currentTime,p=f+i/1e3;d._volume=e,d._node.gain.setValueAtTime(e,f),d._node.gain.linearRampToValueAtTime(t,p)}var _=e;d._interval=setInterval(function(e,n){_+="in"===a?.01:-.01,_=Math.max(0,_),_=Math.min(1,_),_=Math.round(100*_)/100,s._webAudio?("undefined"==typeof o&&(s._volume=_),n._volume=_):s.volume(_,e,!0),_===t&&(clearInterval(n._interval),n._interval=null,s.volume(_,e),s._emit("fade",e))}.bind(s,u[h],d),c)}}return s},_stopFade:function(e){var t=this,i=t._soundById(e);return i&&i._interval&&(t._webAudio&&i._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(i._interval),i._interval=null,t._emit("fade",e)),t},loop:function(){var e,t,n,i=this,o=arguments;if(0===o.length)return i._loop;if(1===o.length){if("boolean"!=typeof o[0])return n=i._soundById(parseInt(o[0],10)),!!n&&n._loop;e=o[0],i._loop=e}else 2===o.length&&(e=o[0],t=parseInt(o[1],10));for(var s=i._getSoundIds(t),r=0;r<s.length;r++)n=i._soundById(s[r]),n&&(n._loop=e,i._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e));return i},rate:function(){var e,t,i=this,o=arguments;if(0===o.length)t=i._sounds[0]._id;else if(1===o.length){var s=i._getSoundIds(),r=s.indexOf(o[0]);r>=0?t=parseInt(o[0],10):e=parseFloat(o[0])}else 2===o.length&&(e=parseFloat(o[0]),t=parseInt(o[1],10));var a;if("number"!=typeof e)return a=i._soundById(t),a?a._rate:i._rate;if("loaded"!==i._state)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,o)}}),i;"undefined"==typeof t&&(i._rate=e),t=i._getSoundIds(t);for(var l=0;l<t.length;l++)if(a=i._soundById(t[l])){a._rateSeek=i.seek(t[l]),a._playStart=i._webAudio?n.ctx.currentTime:a._playStart,a._rate=e,i._webAudio&&a._node&&a._node.bufferSource?a._node.bufferSource.playbackRate.value=e:a._node&&(a._node.playbackRate=e);var c=i.seek(t[l]),u=(i._sprite[a._sprite][0]+i._sprite[a._sprite][1])/1e3-c,h=1e3*u/Math.abs(a._rate);!i._endTimers[t[l]]&&a._paused||(i._clearTimer(t[l]),i._endTimers[t[l]]=setTimeout(i._ended.bind(i,a),h)),i._emit("rate",a._id)}return i},seek:function(){var e,t,i=this,o=arguments;if(0===o.length)t=i._sounds[0]._id;else if(1===o.length){var s=i._getSoundIds(),r=s.indexOf(o[0]);r>=0?t=parseInt(o[0],10):(t=i._sounds[0]._id,e=parseFloat(o[0]))}else 2===o.length&&(e=parseFloat(o[0]),t=parseInt(o[1],10));if("undefined"==typeof t)return i;if("loaded"!==i._state)return i._queue.push({event:"seek",action:function(){i.seek.apply(i,o)}}),i;var a=i._soundById(t);if(a){if(!("number"==typeof e&&e>=0)){if(i._webAudio){var l=i.playing(t)?n.ctx.currentTime-a._playStart:0,c=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(c+l*Math.abs(a._rate))}return a._node.currentTime}var u=i.playing(t);u&&i.pause(t,!0),a._seek=e,a._ended=!1,i._clearTimer(t),u&&i.play(t,!0),!i._webAudio&&a._node&&(a._node.currentTime=e),i._emit("seek",t)}return i},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var i=0;i<t._sounds.length;i++)if(!t._sounds[i]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,i=t._soundById(e);return i&&(n=t._sprite[i._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,i=0;i<t.length;i++){t[i]._paused||(e.stop(t[i]._id),e._emit("end",t[i]._id)),e._webAudio||(t[i]._node.src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",t[i]._node.removeEventListener("error",t[i]._errorFn,!1),t[i]._node.removeEventListener(n._canPlayEvent,t[i]._loadFn,!1)),delete t[i]._node,e._clearTimer(t[i]._id);var o=n._howls.indexOf(e);o>=0&&n._howls.splice(o,1)}var r=!0;for(i=0;i<n._howls.length;i++)if(n._howls[i]._src===e._src){r=!1;break}return s&&r&&delete s[e._src],e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,i){var o=this,s=o["_on"+e];return"function"==typeof t&&s.push(i?{id:n,fn:t,once:i}:{id:n,fn:t}),o},off:function(e,t,n){var i=this,o=i["_on"+e],s=0;if(t){for(s=0;s<o.length;s++)if(t===o[s].fn&&n===o[s].id){o.splice(s,1);break}}else if(e)i["_on"+e]=[];else{var r=Object.keys(i);for(s=0;s<r.length;s++)0===r[s].indexOf("_on")&&Array.isArray(i[r[s]])&&(i[r[s]]=[])}return i},once:function(e,t,n){var i=this;return i.on(e,t,n,1),i},_emit:function(e,t,n){for(var i=this,o=i["_on"+e],s=o.length-1;s>=0;s--)o[s].id&&o[s].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(i,o[s].fn),0),o[s].once&&i.off(e,o[s].fn,o[s].id));return i},_loadQueue:function(){var e=this;if(e._queue.length>0){var t=e._queue[0];e.once(t.event,function(){e._queue.shift(),e._loadQueue()}),t.action()}return e},_ended:function(e){var t=this,i=e._sprite,o=!(!e._loop&&!t._sprite[i][2]);if(t._emit("end",e._id),!t._webAudio&&o&&t.stop(e._id,!0).play(e._id),t._webAudio&&o){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=n.ctx.currentTime;var s=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),s)}return t._webAudio&&!o&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),n._autoSuspend()),t._webAudio||o||t.stop(e._id),t},_clearTimer:function(e){var t=this;return t._endTimers[e]&&(clearTimeout(t._endTimers[e]),delete t._endTimers[e]),t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new o(e)},_drain:function(){var e=this,t=e._pool,n=0,i=0;if(!(e._sounds.length<t)){for(i=0;i<e._sounds.length;i++)e._sounds[i]._ended&&n++;for(i=e._sounds.length-1;i>=0;i--){if(t>=n)return;e._sounds[i]._ended&&(e._webAudio&&e._sounds[i]._node&&e._sounds[i]._node.disconnect(0),e._sounds.splice(i,1),n--)}}},_getSoundIds:function(e){var t=this;if("undefined"==typeof e){for(var n=[],i=0;i<t._sounds.length;i++)n.push(t._sounds[i]._id);return n}return[e]},_refreshBuffer:function(e){var t=this;return e._node.bufferSource=n.ctx.createBufferSource(),e._node.bufferSource.buffer=s[t._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.value=e._rate,t},_cleanBuffer:function(e){var t=this;if(t._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}}return e.bufferSource=null,t}};var o=function(e){this._parent=e,this.init()};o.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._muted=t._muted,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=Math.round(Date.now()*Math.random()),t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,i=n._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node="undefined"==typeof n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),e._node.gain.setValueAtTime(i,n.ctx.currentTime),e._node.paused=!0,e._node.connect(n.masterGain)):(e._node=new Audio,e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(n._canPlayEvent,e._loadFn,!1),e._node.src=t._src,e._node.preload="auto",e._node.volume=i*n.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._muted=t._muted,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=Math.round(Date.now()*Math.random()),e},_errorListener:function(){var e=this;e._node.error&&4===e._node.error.code&&(n.noAudio=!0),e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorListener,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),t._autoplay&&t.play(),e._node.removeEventListener(n._canPlayEvent,e._loadFn,!1)}};var s={},r=function(e){var t=e._src;if(s[t])return e._duration=s[t].duration,void c(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),i=new Uint8Array(n.length),o=0;o<n.length;++o)i[o]=n.charCodeAt(o);l(i.buffer,e)}else{var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){var t=(r.status+"")[0];return"0"!==t&&"2"!==t&&"3"!==t?void e._emit("loaderror",null,"Failed loading audio file with status: "+r.status+"."):void l(r.response,e)},r.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete s[t],e.load())},a(r)}},a=function(e){try{e.send()}catch(t){e.onerror()}},l=function(e,t){n.ctx.decodeAudioData(e,function(e){e&&t._sounds.length>0&&(s[t._src]=e,c(t,e))},function(){t._emit("loaderror",null,"Decoding audio data failed.")})},c=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),e._autoplay&&e.play()},u=function(){n.noAudio=!1;try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(e){n.usingWebAudio=!1}if(!n.usingWebAudio)if("undefined"!=typeof Audio)try{var e=new Audio;"undefined"==typeof e.oncanplaythrough&&(n._canPlayEvent="canplay")}catch(e){n.noAudio=!0}else n.noAudio=!0;try{var e=new Audio;e.muted&&(n.noAudio=!0)}catch(e){}var t=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),i=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),o=i?parseInt(i[1],10):null;if(t&&o&&9>o){var s=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());(n._navigator&&n._navigator.standalone&&!s||n._navigator&&!n._navigator.standalone&&!s)&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain="undefined"==typeof n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.value=1,n.masterGain.connect(n.ctx.destination)),n._setup()};"function"==typeof define&&define.amd&&define([],function(){return{Howler:n,Howl:i}}),"undefined"!=typeof exports&&(exports.Howler=n,exports.Howl=i),"undefined"!=typeof window?(window.HowlerGlobal=t,window.Howler=n,window.Howl=i,window.Sound=o):"undefined"!=typeof e&&(e.HowlerGlobal=t,e.Howler=n,e.Howl=i,e.Sound=o)}(),!function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var i=this;return i.ctx&&i.ctx.listener?(t="number"!=typeof t?i._pos[1]:t,n="number"!=typeof n?i._pos[2]:n,"number"!=typeof e?i._pos:(i._pos=[e,t,n],i.ctx.listener.setPosition(i._pos[0],i._pos[1],i._pos[2]),i)):i},HowlerGlobal.prototype.orientation=function(e,t,n,i,o,s){var r=this;if(!r.ctx||!r.ctx.listener)return r;var a=r._orientation;return t="number"!=typeof t?a[1]:t,n="number"!=typeof n?a[2]:n,i="number"!=typeof i?a[3]:i,o="number"!=typeof o?a[4]:o,s="number"!=typeof s?a[5]:s,"number"!=typeof e?a:(r._orientation=[e,t,n,i,o,s],r.ctx.listener.setOrientation(e,t,n,i,o,s),r)},Howl.prototype.init=function(e){return function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:"undefined"!=typeof t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:"undefined"!=typeof t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:"undefined"!=typeof t.coneOuterGain?t.coneOuterGain:0,distanceModel:"undefined"!=typeof t.distanceModel?t.distanceModel:"inverse",maxDistance:"undefined"!=typeof t.maxDistance?t.maxDistance:1e4,panningModel:"undefined"!=typeof t.panningModel?t.panningModel:"HRTF",refDistance:"undefined"!=typeof t.refDistance?t.refDistance:1,rolloffFactor:"undefined"!=typeof t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,n){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"stereo",action:function(){i.stereo(t,n)}}),i;var o="undefined"==typeof Howler.ctx.createStereoPanner?"spatial":"stereo";if("undefined"==typeof n){if("number"!=typeof t)return i._stereo;i._stereo=t,i._pos=[t,0,0]}for(var s=i._getSoundIds(n),r=0;r<s.length;r++){var a=i._soundById(s[r]);if(a){if("number"!=typeof t)return a._stereo;a._stereo=t,a._pos=[t,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||e(a,o),"spatial"===o?a._panner.setPosition(t,0,0):a._panner.pan.value=t),i._emit("stereo",a._id)}}return i},Howl.prototype.pos=function(t,n,i,o){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"pos",action:function(){s.pos(t,n,i,o)}}),s;if(n="number"!=typeof n?0:n,i="number"!=typeof i?-.5:i,"undefined"==typeof o){if("number"!=typeof t)return s._pos;s._pos=[t,n,i]}for(var r=s._getSoundIds(o),a=0;a<r.length;a++){var l=s._soundById(r[a]);if(l){if("number"!=typeof t)return l._pos;l._pos=[t,n,i],l._node&&(l._panner&&!l._panner.pan||e(l,"spatial"),l._panner.setPosition(t,n,i)),s._emit("pos",l._id)}}return s},Howl.prototype.orientation=function(t,n,i,o){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"orientation",action:function(){s.orientation(t,n,i,o)}}),s;if(n="number"!=typeof n?s._orientation[1]:n,i="number"!=typeof i?s._orientation[2]:i,"undefined"==typeof o){if("number"!=typeof t)return s._orientation;s._orientation=[t,n,i]}for(var r=s._getSoundIds(o),a=0;a<r.length;a++){var l=s._soundById(r[a]);if(l){if("number"!=typeof t)return l._orientation;l._orientation=[t,n,i],l._node&&(l._panner||(l._pos||(l._pos=s._pos||[0,0,-.5]),e(l,"spatial")),l._panner.setOrientation(t,n,i)),s._emit("orientation",l._id)}}return s},Howl.prototype.pannerAttr=function(){var t,n,i,o=this,s=arguments;if(!o._webAudio)return o;if(0===s.length)return o._pannerAttr;if(1===s.length){if("object"!=typeof s[0])return i=o._soundById(parseInt(s[0],10)),i?i._pannerAttr:o._pannerAttr;t=s[0],"undefined"==typeof n&&(o._pannerAttr={coneInnerAngle:"undefined"!=typeof t.coneInnerAngle?t.coneInnerAngle:o._coneInnerAngle,coneOuterAngle:"undefined"!=typeof t.coneOuterAngle?t.coneOuterAngle:o._coneOuterAngle,coneOuterGain:"undefined"!=typeof t.coneOuterGain?t.coneOuterGain:o._coneOuterGain,distanceModel:"undefined"!=typeof t.distanceModel?t.distanceModel:o._distanceModel,maxDistance:"undefined"!=typeof t.maxDistance?t.maxDistance:o._maxDistance,panningModel:"undefined"!=typeof t.panningModel?t.panningModel:o._panningModel,refDistance:"undefined"!=typeof t.refDistance?t.refDistance:o._refDistance,rolloffFactor:"undefined"!=typeof t.rolloffFactor?t.rolloffFactor:o._rolloffFactor})}else 2===s.length&&(t=s[0],n=parseInt(s[1],10));for(var r=o._getSoundIds(n),a=0;a<r.length;a++)if(i=o._soundById(r[a])){var l=i._pannerAttr;l={coneInnerAngle:"undefined"!=typeof t.coneInnerAngle?t.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:"undefined"!=typeof t.coneOuterAngle?t.coneOuterAngle:l.coneOuterAngle,coneOuterGain:"undefined"!=typeof t.coneOuterGain?t.coneOuterGain:l.coneOuterGain,distanceModel:"undefined"!=typeof t.distanceModel?t.distanceModel:l.distanceModel,maxDistance:"undefined"!=typeof t.maxDistance?t.maxDistance:l.maxDistance,panningModel:"undefined"!=typeof t.panningModel?t.panningModel:l.panningModel,refDistance:"undefined"!=typeof t.refDistance?t.refDistance:l.refDistance,rolloffFactor:"undefined"!=typeof t.rolloffFactor?t.rolloffFactor:l.rolloffFactor};var c=i._panner;c?(c.coneInnerAngle=l.coneInnerAngle,c.coneOuterAngle=l.coneOuterAngle,c.coneOuterGain=l.coneOuterGain,c.distanceModel=l.distanceModel,c.maxDistance=l.maxDistance,c.panningModel=l.panningModel,c.refDistance=l.refDistance,c.rolloffFactor=l.rolloffFactor):(i._pos||(i._pos=o._pos||[0,0,-.5]),e(i,"spatial"))}return o},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this)}}(Sound.prototype.reset);var e=function(e,t){t=t||"spatial","spatial"===t?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.value=e._stereo),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id)}}(),soya2d.Sound=function(e){e=e||{},this.__handler,this.src,this.__loop=e.loop||!1,this.__volume=e.volume||1,this.__muted=!1,this.__pos=0},soya2d.Sound.prototype={play:function(){return this.__handler.play(),this},pause:function(){return this.__handler.pause(),this},stop:function(){return this.pause(),this.loop(!1),this.__handler.stop(),this},mute:function(e){return void 0!=e?(this.__muted=e,e?this.__handler.mute(!0):this.__handler.mute(!1),this):this.__muted},loop:function(e){return void 0!=e?(this.__loop=e,this.__handler._loop=e,this):this.__loop},volume:function(e){return e?(this.__volume=e,this.__handler.volume(e),this):this.__volume},pos:function(e){return e?(this.__pos=e,this.__handler.pos(e),this):this.__pos},fade:function(e,t,n){return this.__handler.fade(e,t,n),this
},on:function(e,t){return this.__handler.on(e,t),this},once:function(e,t){return this.__handler.once(e,t),this},off:function(e,t){return this.__handler.off(e,t),this}},soya2d.SoundManager=function(e){this.game=e,this.__sounds=e.assets.__assets.sound,this.muteAll=function(e){for(var t in this.__sounds)this.__sounds[t].mute(e)},this.stopAll=function(){for(var e in this.__sounds)this.__sounds[e].stop()}},soya2d.module.install("sound",{onInit:function(e){e.sound=new soya2d.SoundManager(e)},onStop:function(e){e.sound.stopAll()}}),!function(){function e(e){return"string"==typeof e||e instanceof Image||e instanceof Array?new soya2d.Sprite({images:e}):e instanceof soya2d.DisplayObject?e:(soya2d.console.error("soya2d.Emitter: invalid param [particles]; "+e),void 0)}function t(e,t){var n=(soya2d.Math,t/1e3);return e.lifeSpan-=n,e.lifeSpan<=0?(e.visible=!1,e.deadRate=0,void 0):(e.deadRate=e.lifeSpan/e.__maxLifeSpan,e.__speed.add(e.__deltaSpeed).add(e.__radialAcc),0!==e.__tanAcc&&(e.__tanDir.set(e.__speed.e[0],e.__speed.e[1]).rotate(e.__tans),e.__tans+=e.__tanAcc,e.__tans%=360,e.__speed.set(e.__tanDir.e[0],e.__tanDir.e[1])),e.x=e.__sx+e.__speed.e[0],e.y=e.__sy+e.__speed.e[1],void 0)}function n(e,t){var n=soya2d.Math,i=e.lifeSpan=t.lifeSpan;e.__maxLifeSpan=i,e.__sx=n.randomi(0,t.w-e.w),e.__sy=n.randomi(0,t.h-e.h);var o=t.maxAngle?t.maxAngle-t.minAngle:0,s=t.minAngle+o*Math.random();s=n.floor(s%=360);var r=t.maxSpeed?t.maxSpeed-t.minSpeed:0,a=t.minSpeed+r*Math.random(),l=new soya2d.Vector(n.COSTABLE[s],n.SINTABLE[s]);e.__speed=l.clone().mul(a),e.__deltaSpeed=new soya2d.Vector(e.__speed.e[0]/i,e.__speed.e[1]/i);var c=t.maxRadAcc?t.maxRadAcc-t.minRadAcc:0;e.__radialAcc=l.mul(t.minRadAcc+c*Math.random());var u=t.maxTanAcc?t.maxTanAcc-t.minTanAcc:0;e.__tanAcc=t.minTanAcc+u*Math.random(),0!==e.__tanAcc&&(e.__tans=e.__tanAcc,e.__tanDir=new soya2d.Vector(0,0))}soya2d.class("soya2d.Emitter",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){var n=t||{};this.__particles=[],this.frequency=1e3*n.frequency||100,this.size=n.size,this.quantity=n.quantity||1,this.__template=e(n.particles),this.lifeSpan=n.lifeSpan||1,this.minSpeed=n.minSpeed||0,this.maxSpeed=n.maxSpeed||0,this.minRadAcc=n.minRadAcc||0,this.maxRadAcc=n.maxRadAcc||0,this.minTanAcc=n.minTanAcc||0,this.maxTanAcc=n.maxTanAcc||0,this.minAngle=n.minAngle||0,this.maxAngle=n.maxAngle||0;for(var i=this.size;i--;){var o=this.__template.clone();o.visible=!1,o.lifeSpan=0,o.deadRate=0,o.blendMode=n.blendMode,this.__particles.push(o)}this.__deltaSum=0,this.running=!1},tween:{__ts:[],add:function(){var e={__tds:[],to:function(e,t,n){return this.__tds.push([e,t,n]),this}};return this.__ts.push(e),e}},emit:function(){return this.running?void 0:(this.__particles.forEach(function(e){this.add(e)},this),this.running=!0,this.stopping&&clearTimeout(this.stopping),this)},stop:function(e){if(this.running){if(e>0){var t=this;return this.stopping=setTimeout(function(){t.running=!1,t.stopping=null,t.__particles.forEach(function(e){t.add(e)})},e),void 0}return this.running=!1,this}},_onUpdate:function(e,i){if(this.running){this.__deltaSum+=i;var o=0,s=this.__particles;if(this.__deltaSum>=this.frequency&&this.running&&(o=this.__deltaSum/this.frequency>>0,this.__deltaSum=0),o>0&&this.running){o=this.quantity;for(var r=this.size;r--&&o;){var a=s[r];a.lifeSpan<=0&&(this.onActive&&this.onActive(a),n(a,this),this.tween.__ts.length>0&&this.tween.__ts.forEach(function(t){var n=e.tween.add(a);t.__tds.forEach(function(e){n.to(e[0],e[1],e[2])}),n.play()}),o>0&&o--)}}for(var r=s.length;r--;){var a=s[r];a.lifeSpan>0&&(t(a,i),a.visible||(a.visible=!0))}this.onRunning&&this.onRunning(s)}}})}(),soya2d.module.install("particles",{onInit:function(e){e.objects.register("emitter",soya2d.Emitter)}}),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:this,n.Matter=t()}}(function(){return function e(t,n,i){function o(r,a){if(!n[r]){if(!t[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(s)return s(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){var n=t[r][1][e];return o(n?n:e)},u,u.exports,e,t,n,i)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(e,t){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../geometry/Vector"),s=e("../core/Sleeping"),r=(e("../render/Render"),e("../core/Common")),a=e("../geometry/Bounds"),l=e("../geometry/Axes");!function(){n._inertiaScale=4,n._nextCollidingGroupId=1,n._nextNonCollidingGroupId=-1,n._nextCategory=1,n.create=function(t){var n={id:r.nextId(),type:"body",label:"Body",parts:[],angle:0,vertices:i.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:1.5}},o=r.extend(n,t);return e(o,t),o},n.nextGroup=function(e){return e?n._nextNonCollidingGroupId--:n._nextCollidingGroupId++},n.nextCategory=function(){return n._nextCategory=n._nextCategory<<1,n._nextCategory};var e=function(e,t){n.set(e,{bounds:e.bounds||a.create(e.vertices),positionPrev:e.positionPrev||o.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),i.rotate(e.vertices,e.angle,e.position),l.rotate(e.axes,e.angle),a.update(e.bounds,e.vertices,e.velocity),n.set(e,{axes:t.axes||e.axes,area:t.area||e.area,mass:t.mass||e.mass,inertia:t.inertia||e.inertia});var s=e.isStatic?"#eeeeee":r.choose(["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"]),c=r.shadeColor(s,-20);e.render.fillStyle=e.render.fillStyle||s,e.render.strokeStyle=e.render.strokeStyle||c,e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};n.set=function(e,t,i){var o;"string"==typeof t&&(o=t,t={},t[o]=i);for(o in t)if(i=t[o],t.hasOwnProperty(o))switch(o){case"isStatic":n.setStatic(e,i);break;case"isSleeping":s.set(e,i);break;case"mass":n.setMass(e,i);break;case"density":n.setDensity(e,i);break;case"inertia":n.setInertia(e,i);break;case"vertices":n.setVertices(e,i);break;case"position":n.setPosition(e,i);break;case"angle":n.setAngle(e,i);break;case"velocity":n.setVelocity(e,i);break;case"angularVelocity":n.setAngularVelocity(e,i);break;case"parts":n.setParts(e,i);break;default:e[o]=i}},n.setStatic=function(e,t){for(var n=0;n<e.parts.length;n++){var i=e.parts[n];i.isStatic=t,t&&(i.restitution=0,i.friction=1,i.mass=i.inertia=i.density=1/0,i.inverseMass=i.inverseInertia=0,i.positionPrev.x=i.position.x,i.positionPrev.y=i.position.y,i.anglePrev=i.angle,i.angularVelocity=0,i.speed=0,i.angularSpeed=0,i.motion=0)}},n.setMass=function(e,t){e.mass=t,e.inverseMass=1/e.mass,e.density=e.mass/e.area},n.setDensity=function(e,t){n.setMass(e,t*e.area),e.density=t},n.setInertia=function(e,t){e.inertia=t,e.inverseInertia=1/e.inertia},n.setVertices=function(e,t){e.vertices=t[0].body===e?t:i.create(t,e),e.axes=l.fromVertices(e.vertices),e.area=i.area(e.vertices),n.setMass(e,e.density*e.area);var o=i.centre(e.vertices);i.translate(e.vertices,o,-1),n.setInertia(e,n._inertiaScale*i.inertia(e.vertices,e.mass)),i.translate(e.vertices,e.position),a.update(e.bounds,e.vertices,e.velocity)},n.setParts=function(e,o,s){var r;for(o=o.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,r=0;r<o.length;r++){var a=o[r];a!==e&&(a.parent=e,e.parts.push(a))}if(1!==e.parts.length){if(s="undefined"!=typeof s?s:!0){var l=[];for(r=0;r<o.length;r++)l=l.concat(o[r].vertices);i.clockwiseSort(l);var c=i.hull(l),u=i.centre(c);n.setVertices(e,c),i.translate(e.vertices,u)}var h=t(e);e.area=h.area,e.parent=e,e.position.x=h.centre.x,e.position.y=h.centre.y,e.positionPrev.x=h.centre.x,e.positionPrev.y=h.centre.y,n.setMass(e,h.mass),n.setInertia(e,h.inertia),n.setPosition(e,h.centre)}},n.setPosition=function(e,t){var n=o.sub(t,e.position);e.positionPrev.x+=n.x,e.positionPrev.y+=n.y;for(var s=0;s<e.parts.length;s++){var r=e.parts[s];r.position.x+=n.x,r.position.y+=n.y,i.translate(r.vertices,n),a.update(r.bounds,r.vertices,e.velocity)}},n.setAngle=function(e,t){var n=t-e.angle;e.anglePrev+=n;for(var s=0;s<e.parts.length;s++){var r=e.parts[s];r.angle+=n,i.rotate(r.vertices,n,e.position),l.rotate(r.axes,n),a.update(r.bounds,r.vertices,e.velocity),s>0&&o.rotateAbout(r.position,n,e.position,r.position)}},n.setVelocity=function(e,t){e.positionPrev.x=e.position.x-t.x,e.positionPrev.y=e.position.y-t.y,e.velocity.x=t.x,e.velocity.y=t.y,e.speed=o.magnitude(e.velocity)},n.setAngularVelocity=function(e,t){e.anglePrev=e.angle-t,e.angularVelocity=t,e.angularSpeed=Math.abs(e.angularVelocity)},n.translate=function(e,t){n.setPosition(e,o.add(e.position,t))},n.rotate=function(e,t){n.setAngle(e,e.angle+t)},n.scale=function(e,o,s){for(var r=0;r<e.parts.length;r++){var c=e.parts[r];i.scale(c.vertices,o,s,e.position),c.axes=l.fromVertices(c.vertices),e.isStatic||(c.area=i.area(c.vertices),n.setMass(c,e.density*c.area),i.translate(c.vertices,{x:-c.position.x,y:-c.position.y}),n.setInertia(c,i.inertia(c.vertices,c.mass)),i.translate(c.vertices,{x:c.position.x,y:c.position.y})),a.update(c.bounds,c.vertices,e.velocity)}if(e.circleRadius&&(o===s?e.circleRadius*=o:e.circleRadius=null),!e.isStatic){var u=t(e);e.area=u.area,n.setMass(e,u.mass),n.setInertia(e,u.inertia)}},n.update=function(e,t,n,s){var r=Math.pow(t*n*e.timeScale,2),c=1-e.frictionAir*n*e.timeScale,u=e.position.x-e.positionPrev.x,h=e.position.y-e.positionPrev.y;e.velocity.x=u*c*s+e.force.x/e.mass*r,e.velocity.y=h*c*s+e.force.y/e.mass*r,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*c*s+e.torque/e.inertia*r,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=o.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var d=0;d<e.parts.length;d++){var f=e.parts[d];i.translate(f.vertices,e.velocity),d>0&&(f.position.x+=e.velocity.x,f.position.y+=e.velocity.y),0!==e.angularVelocity&&(i.rotate(f.vertices,e.angularVelocity,e.position),l.rotate(f.axes,e.angularVelocity),d>0&&o.rotateAbout(f.position,e.angularVelocity,e.position,f.position)),a.update(f.bounds,f.vertices,e.velocity)}},n.applyForce=function(e,t,n){e.force.x+=n.x,e.force.y+=n.y;var i={x:t.x-e.position.x,y:t.y-e.position.y};e.torque+=i.x*n.y-i.y*n.x};var t=function(e){for(var t={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===e.parts.length?0:1;n<e.parts.length;n++){var i=e.parts[n];t.mass+=i.mass,t.area+=i.area,t.inertia+=i.inertia,t.centre=o.add(t.centre,o.mult(i.position,i.mass!==1/0?i.mass:1))}return t.centre=o.div(t.centre,t.mass!==1/0?t.mass:e.parts.length),t}}()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29}],2:[function(e,t){var n={};t.exports=n;var i=e("../core/Events"),o=e("../core/Common"),s=e("./Body");!function(){n.create=function(e){return o.extend({id:o.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite"},e)},n.setModified=function(e,t,i,o){if(e.isModified=t,i&&e.parent&&n.setModified(e.parent,t,i,o),o)for(var s=0;s<e.composites.length;s++){var r=e.composites[s];n.setModified(r,t,i,o)}},n.add=function(e,t){var s=[].concat(t);i.trigger(e,"beforeAdd",{object:t});for(var r=0;r<s.length;r++){var a=s[r];switch(a.type){case"body":if(a.parent!==a){o.log("Composite.add: skipped adding a compound body part (you must add its parent instead)","warn");break}n.addBody(e,a);break;case"constraint":n.addConstraint(e,a);break;case"composite":n.addComposite(e,a);break;case"mouseConstraint":n.addConstraint(e,a.constraint)}}return i.trigger(e,"afterAdd",{object:t}),e},n.remove=function(e,t,o){var s=[].concat(t);i.trigger(e,"beforeRemove",{object:t});for(var r=0;r<s.length;r++){var a=s[r];switch(a.type){case"body":n.removeBody(e,a,o);break;case"constraint":n.removeConstraint(e,a,o);break;case"composite":n.removeComposite(e,a,o);break;case"mouseConstraint":n.removeConstraint(e,a.constraint)}}return i.trigger(e,"afterRemove",{object:t}),e},n.addComposite=function(e,t){return e.composites.push(t),t.parent=e,n.setModified(e,!0,!0,!1),e},n.removeComposite=function(e,t,i){var s=o.indexOf(e.composites,t);if(-1!==s&&(n.removeCompositeAt(e,s),n.setModified(e,!0,!0,!1)),i)for(var r=0;r<e.composites.length;r++)n.removeComposite(e.composites[r],t,!0);return e},n.removeCompositeAt=function(e,t){return e.composites.splice(t,1),n.setModified(e,!0,!0,!1),e},n.addBody=function(e,t){return e.bodies.push(t),n.setModified(e,!0,!0,!1),e},n.removeBody=function(e,t,i){var s=o.indexOf(e.bodies,t);if(-1!==s&&(n.removeBodyAt(e,s),n.setModified(e,!0,!0,!1)),i)for(var r=0;r<e.composites.length;r++)n.removeBody(e.composites[r],t,!0);return e},n.removeBodyAt=function(e,t){return e.bodies.splice(t,1),n.setModified(e,!0,!0,!1),e},n.addConstraint=function(e,t){return e.constraints.push(t),n.setModified(e,!0,!0,!1),e},n.removeConstraint=function(e,t,i){var s=o.indexOf(e.constraints,t);if(-1!==s&&n.removeConstraintAt(e,s),i)for(var r=0;r<e.composites.length;r++)n.removeConstraint(e.composites[r],t,!0);return e},n.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),n.setModified(e,!0,!0,!1),e},n.clear=function(e,t,i){if(i)for(var o=0;o<e.composites.length;o++)n.clear(e.composites[o],t,!0);return t?e.bodies=e.bodies.filter(function(e){return e.isStatic}):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,n.setModified(e,!0,!0,!1),e},n.allBodies=function(e){for(var t=[].concat(e.bodies),i=0;i<e.composites.length;i++)t=t.concat(n.allBodies(e.composites[i]));return t},n.allConstraints=function(e){for(var t=[].concat(e.constraints),i=0;i<e.composites.length;i++)t=t.concat(n.allConstraints(e.composites[i]));return t},n.allComposites=function(e){for(var t=[].concat(e.composites),i=0;i<e.composites.length;i++)t=t.concat(n.allComposites(e.composites[i]));return t},n.get=function(e,t,i){var o,s;switch(i){case"body":o=n.allBodies(e);break;case"constraint":o=n.allConstraints(e);break;case"composite":o=n.allComposites(e).concat(e)}return o?(s=o.filter(function(e){return e.id.toString()===t.toString()}),0===s.length?null:s[0]):null},n.move=function(e,t,i){return n.remove(e,t),n.add(i,t),e},n.rebase=function(e){for(var t=n.allBodies(e).concat(n.allConstraints(e)).concat(n.allComposites(e)),i=0;i<t.length;i++)t[i].id=o.nextId();return n.setModified(e,!0,!0,!1),e},n.translate=function(e,t,i){for(var o=i?n.allBodies(e):e.bodies,r=0;r<o.length;r++)s.translate(o[r],t);return n.setModified(e,!0,!0,!1),e},n.rotate=function(e,t,i,o){for(var r=Math.cos(t),a=Math.sin(t),l=o?n.allBodies(e):e.bodies,c=0;c<l.length;c++){var u=l[c],h=u.position.x-i.x,d=u.position.y-i.y;s.setPosition(u,{x:i.x+(h*r-d*a),y:i.y+(h*a+d*r)}),s.rotate(u,t)}return n.setModified(e,!0,!0,!1),e},n.scale=function(e,t,i,o,r){for(var a=r?n.allBodies(e):e.bodies,l=0;l<a.length;l++){var c=a[l],u=c.position.x-o.x,h=c.position.y-o.y;s.setPosition(c,{x:o.x+u*t,y:o.y+h*i}),s.scale(c,t,i)}return n.setModified(e,!0,!0,!1),e}}()},{"../core/Common":14,"../core/Events":16,"./Body":1}],3:[function(e,t){var n={};t.exports=n;var i=e("./Composite"),o=(e("../constraint/Constraint"),e("../core/Common"));!function(){n.create=function(e){var t=i.create(),n={label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-(1/0),y:-(1/0)},max:{x:1/0,y:1/0}}};return o.extend(t,n,e)}}()},{"../constraint/Constraint":12,"../core/Common":14,"./Composite":2}],4:[function(e,t){var n={};t.exports=n,function(){n.create=function(e){return{id:n.id(e),vertex:e,normalImpulse:0,tangentImpulse:0}},n.id=function(e){return e.body.id+"_"+e.index}}()},{}],5:[function(e,t){var n={};t.exports=n;var i=e("./SAT"),o=e("./Pair"),s=e("../geometry/Bounds");!function(){n.collisions=function(e,t){for(var r=[],a=t.pairs.table,l=0;l<e.length;l++){var c=e[l][0],u=e[l][1];if((!c.isStatic&&!c.isSleeping||!u.isStatic&&!u.isSleeping)&&n.canCollide(c.collisionFilter,u.collisionFilter)&&s.overlaps(c.bounds,u.bounds))for(var h=c.parts.length>1?1:0;h<c.parts.length;h++)for(var d=c.parts[h],f=u.parts.length>1?1:0;f<u.parts.length;f++){var p=u.parts[f];if(d===c&&p===u||s.overlaps(d.bounds,p.bounds)){var _,y=o.id(d,p),m=a[y];_=m&&m.isActive?m.collision:null;var g=i.collides(d,p,_);g.collided&&r.push(g)}}}return r},n.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!==(e.mask&t.category)&&0!==(t.mask&e.category)}}()},{"../geometry/Bounds":24,"./Pair":7,"./SAT":11}],6:[function(e,t){var n={};t.exports=n;var i=e("./Pair"),o=e("./Detector"),s=e("../core/Common");!function(){n.create=function(e){var t={controller:n,detector:o.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return s.extend(t,e)},n.update=function(n,i,o,s){var r,d,f,p,_,y=o.world,m=n.buckets,g=!1;for(r=0;r<i.length;r++){var v=i[r];if((!v.isSleeping||s)&&!(v.bounds.max.x<y.bounds.min.x||v.bounds.min.x>y.bounds.max.x||v.bounds.max.y<y.bounds.min.y||v.bounds.min.y>y.bounds.max.y)){var x=t(n,v);if(!v.region||x.id!==v.region.id||s){v.region&&!s||(v.region=x);var b=e(x,v.region);for(d=b.startCol;d<=b.endCol;d++)for(f=b.startRow;f<=b.endRow;f++){_=a(d,f),p=m[_];var w=d>=x.startCol&&d<=x.endCol&&f>=x.startRow&&f<=x.endRow,S=d>=v.region.startCol&&d<=v.region.endCol&&f>=v.region.startRow&&f<=v.region.endRow;!w&&S&&S&&p&&u(n,p,v),(v.region===x||w&&!S||s)&&(p||(p=l(m,_)),c(n,p,v))}v.region=x,g=!0}}}g&&(n.pairsList=h(n))},n.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]};var e=function(e,t){var n=Math.min(e.startCol,t.startCol),i=Math.max(e.endCol,t.endCol),o=Math.min(e.startRow,t.startRow),s=Math.max(e.endRow,t.endRow);return r(n,i,o,s)},t=function(e,t){var n=t.bounds,i=Math.floor(n.min.x/e.bucketWidth),o=Math.floor(n.max.x/e.bucketWidth),s=Math.floor(n.min.y/e.bucketHeight),a=Math.floor(n.max.y/e.bucketHeight);return r(i,o,s,a)},r=function(e,t,n,i){return{id:e+","+t+","+n+","+i,startCol:e,endCol:t,startRow:n,endRow:i}},a=function(e,t){return e+","+t},l=function(e,t){var n=e[t]=[];return n},c=function(e,t,n){for(var o=0;o<t.length;o++){var s=t[o];if(!(n.id===s.id||n.isStatic&&s.isStatic)){var r=i.id(n,s),a=e.pairs[r];a?a[2]+=1:e.pairs[r]=[n,s,1]}}t.push(n)},u=function(e,t,n){t.splice(s.indexOf(t,n),1);for(var o=0;o<t.length;o++){var r=t[o],a=i.id(n,r),l=e.pairs[a];l&&(l[2]-=1)}},h=function(e){var t,n,i=[];t=s.keys(e.pairs);for(var o=0;o<t.length;o++)n=e.pairs[t[o]],n[2]>0?i.push(n):delete e.pairs[t[o]];return i}}()},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(e,t){var n={};t.exports=n;var i=e("./Contact");!function(){n.create=function(e,t){var i=e.bodyA,o=e.bodyB,s=e.parentA,r=e.parentB,a={id:n.id(i,o),bodyA:i,bodyB:o,contacts:{},activeContacts:[],separation:0,isActive:!0,isSensor:i.isSensor||o.isSensor,timeCreated:t,timeUpdated:t,inverseMass:s.inverseMass+r.inverseMass,friction:Math.min(s.friction,r.friction),frictionStatic:Math.max(s.frictionStatic,r.frictionStatic),restitution:Math.max(s.restitution,r.restitution),slop:Math.max(s.slop,r.slop)};return n.update(a,e,t),a},n.update=function(e,t,o){var s=e.contacts,r=t.supports,a=e.activeContacts,l=t.parentA,c=t.parentB;if(e.collision=t,e.inverseMass=l.inverseMass+c.inverseMass,e.friction=Math.min(l.friction,c.friction),e.frictionStatic=Math.max(l.frictionStatic,c.frictionStatic),e.restitution=Math.max(l.restitution,c.restitution),e.slop=Math.max(l.slop,c.slop),a.length=0,t.collided){for(var u=0;u<r.length;u++){var h=r[u],d=i.id(h),f=s[d];f?a.push(f):a.push(s[d]=i.create(h))}e.separation=t.depth,n.setActive(e,!0,o)}else e.isActive===!0&&n.setActive(e,!1,o)},n.setActive=function(e,t,n){t?(e.isActive=!0,e.timeUpdated=n):(e.isActive=!1,e.activeContacts.length=0)},n.id=function(e,t){return e.id<t.id?e.id+"_"+t.id:t.id+"_"+e.id}}()},{"./Contact":4}],8:[function(e,t){var n={};t.exports=n;var i=e("./Pair"),o=e("../core/Common");!function(){var e=1e3;n.create=function(e){return o.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},n.update=function(e,t,n){var s,r,a,l,c=e.list,u=e.table,h=e.collisionStart,d=e.collisionEnd,f=e.collisionActive,p=[];for(h.length=0,d.length=0,f.length=0,l=0;l<t.length;l++)s=t[l],s.collided&&(r=i.id(s.bodyA,s.bodyB),p.push(r),a=u[r],a?(a.isActive?f.push(a):h.push(a),i.update(a,s,n)):(a=i.create(s,n),u[r]=a,h.push(a),c.push(a)));for(l=0;l<c.length;l++)a=c[l],a.isActive&&-1===o.indexOf(p,a.id)&&(i.setActive(a,!1,n),d.push(a))},n.removeOld=function(t,n){var i,o,s,r,a=t.list,l=t.table,c=[];for(r=0;r<a.length;r++)i=a[r],o=i.collision,o.bodyA.isSleeping||o.bodyB.isSleeping?i.timeUpdated=n:n-i.timeUpdated>e&&c.push(r);for(r=0;r<c.length;r++)s=c[r]-r,i=a[s],delete l[i.id],a.splice(s,1)},n.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}}()},{"../core/Common":14,"./Pair":7}],9:[function(e,t){var n={};t.exports=n;var i=e("../geometry/Vector"),o=e("./SAT"),s=e("../geometry/Bounds"),r=e("../factory/Bodies"),a=e("../geometry/Vertices");!function(){n.ray=function(e,t,n,a){a=a||1e-100;for(var l=i.angle(t,n),c=i.magnitude(i.sub(t,n)),u=.5*(n.x+t.x),h=.5*(n.y+t.y),d=r.rectangle(u,h,c,a,{angle:l}),f=[],p=0;p<e.length;p++){var _=e[p];if(s.overlaps(_.bounds,d.bounds))for(var y=1===_.parts.length?0:1;y<_.parts.length;y++){var m=_.parts[y];if(s.overlaps(m.bounds,d.bounds)){var g=o.collides(m,d);if(g.collided){g.body=g.bodyA=g.bodyB=_,f.push(g);break}}}}return f},n.region=function(e,t,n){for(var i=[],o=0;o<e.length;o++){var r=e[o],a=s.overlaps(r.bounds,t);(a&&!n||!a&&n)&&i.push(r)}return i},n.point=function(e,t){for(var n=[],i=0;i<e.length;i++){var o=e[i];if(s.contains(o.bounds,t))for(var r=1===o.parts.length?0:1;r<o.parts.length;r++){var l=o.parts[r];if(s.contains(l.bounds,t)&&a.contains(l.vertices,t)){n.push(o);break}}}return n}}()},{"../factory/Bodies":21,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,"./SAT":11}],10:[function(e,t){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../geometry/Vector"),s=e("../core/Common"),r=e("../geometry/Bounds");!function(){n._restingThresh=4,n._restingThreshTangent=6,n._positionDampen=.9,n._positionWarming=.8,n._frictionNormalMultiplier=5,n.preSolvePosition=function(e){var t,n,i;for(t=0;t<e.length;t++)n=e[t],n.isActive&&(i=n.activeContacts.length,n.collision.parentA.totalContacts+=i,n.collision.parentB.totalContacts+=i)},n.solvePosition=function(e,t){var i,s,r,a,l,c,u,h,d,f=o._temp[0],p=o._temp[1],_=o._temp[2],y=o._temp[3];for(i=0;i<e.length;i++)s=e[i],s.isActive&&!s.isSensor&&(r=s.collision,a=r.parentA,l=r.parentB,c=r.normal,u=o.sub(o.add(l.positionImpulse,l.position,f),o.add(a.positionImpulse,o.sub(l.position,r.penetration,p),_),y),s.separation=o.dot(c,u));for(i=0;i<e.length;i++)s=e[i],!s.isActive||s.isSensor||s.separation<0||(r=s.collision,a=r.parentA,l=r.parentB,c=r.normal,d=(s.separation-s.slop)*t,(a.isStatic||l.isStatic)&&(d*=2),a.isStatic||a.isSleeping||(h=n._positionDampen/a.totalContacts,a.positionImpulse.x+=c.x*d*h,a.positionImpulse.y+=c.y*d*h),l.isStatic||l.isSleeping||(h=n._positionDampen/l.totalContacts,l.positionImpulse.x-=c.x*d*h,l.positionImpulse.y-=c.y*d*h))},n.postSolvePosition=function(e){for(var t=0;t<e.length;t++){var s=e[t];if(s.totalContacts=0,0!==s.positionImpulse.x||0!==s.positionImpulse.y){for(var a=0;a<s.parts.length;a++){var l=s.parts[a];i.translate(l.vertices,s.positionImpulse),r.update(l.bounds,l.vertices,s.velocity),l.position.x+=s.positionImpulse.x,l.position.y+=s.positionImpulse.y}s.positionPrev.x+=s.positionImpulse.x,s.positionPrev.y+=s.positionImpulse.y,o.dot(s.positionImpulse,s.velocity)<0?(s.positionImpulse.x=0,s.positionImpulse.y=0):(s.positionImpulse.x*=n._positionWarming,s.positionImpulse.y*=n._positionWarming)}}},n.preSolveVelocity=function(e){var t,n,i,s,r,a,l,c,u,h,d,f,p,_,y=o._temp[0],m=o._temp[1];for(t=0;t<e.length;t++)if(i=e[t],i.isActive&&!i.isSensor)for(s=i.activeContacts,r=i.collision,a=r.parentA,l=r.parentB,c=r.normal,u=r.tangent,n=0;n<s.length;n++)h=s[n],d=h.vertex,f=h.normalImpulse,p=h.tangentImpulse,0===f&&0===p||(y.x=c.x*f+u.x*p,y.y=c.y*f+u.y*p,a.isStatic||a.isSleeping||(_=o.sub(d,a.position,m),a.positionPrev.x+=y.x*a.inverseMass,a.positionPrev.y+=y.y*a.inverseMass,a.anglePrev+=o.cross(_,y)*a.inverseInertia),l.isStatic||l.isSleeping||(_=o.sub(d,l.position,m),l.positionPrev.x-=y.x*l.inverseMass,l.positionPrev.y-=y.y*l.inverseMass,l.anglePrev-=o.cross(_,y)*l.inverseInertia))},n.solveVelocity=function(e,t){for(var i=t*t,r=o._temp[0],a=o._temp[1],l=o._temp[2],c=o._temp[3],u=o._temp[4],h=o._temp[5],d=0;d<e.length;d++){var f=e[d];if(f.isActive&&!f.isSensor){var p=f.collision,_=p.parentA,y=p.parentB,m=p.normal,g=p.tangent,v=f.activeContacts,x=1/v.length;_.velocity.x=_.position.x-_.positionPrev.x,_.velocity.y=_.position.y-_.positionPrev.y,y.velocity.x=y.position.x-y.positionPrev.x,y.velocity.y=y.position.y-y.positionPrev.y,_.angularVelocity=_.angle-_.anglePrev,y.angularVelocity=y.angle-y.anglePrev;for(var b=0;b<v.length;b++){var w=v[b],S=w.vertex,A=o.sub(S,_.position,a),T=o.sub(S,y.position,l),M=o.add(_.velocity,o.mult(o.perp(A),_.angularVelocity),c),C=o.add(y.velocity,o.mult(o.perp(T),y.angularVelocity),u),E=o.sub(M,C,h),k=o.dot(m,E),I=o.dot(g,E),P=Math.abs(I),O=s.sign(I),B=(1+f.restitution)*k,R=s.clamp(f.separation+k,0,1)*n._frictionNormalMultiplier,L=I,D=1/0;P>f.friction*f.frictionStatic*R*i&&(D=P,L=s.clamp(f.friction*O*i,-D,D));var F=o.cross(A,m),N=o.cross(T,m),V=x/(_.inverseMass+y.inverseMass+_.inverseInertia*F*F+y.inverseInertia*N*N);if(B*=V,L*=V,0>k&&k*k>n._restingThresh*i)w.normalImpulse=0;else{var G=w.normalImpulse;w.normalImpulse=Math.min(w.normalImpulse+B,0),B=w.normalImpulse-G}if(I*I>n._restingThreshTangent*i)w.tangentImpulse=0;else{var W=w.tangentImpulse;w.tangentImpulse=s.clamp(w.tangentImpulse+L,-D,D),L=w.tangentImpulse-W}r.x=m.x*B+g.x*L,r.y=m.y*B+g.y*L,_.isStatic||_.isSleeping||(_.positionPrev.x+=r.x*_.inverseMass,_.positionPrev.y+=r.y*_.inverseMass,_.anglePrev+=o.cross(A,r)*_.inverseInertia),y.isStatic||y.isSleeping||(y.positionPrev.x-=r.x*y.inverseMass,y.positionPrev.y-=r.y*y.inverseMass,y.anglePrev-=o.cross(T,r)*y.inverseInertia)}}}}}()},{"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],11:[function(e,t){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../geometry/Vector");!function(){n.collides=function(t,n,r){var a,l,c,u,h=r,d=!1;if(h){var f=t.parent,p=n.parent,_=f.speed*f.speed+f.angularSpeed*f.angularSpeed+p.speed*p.speed+p.angularSpeed*p.angularSpeed;d=h&&h.collided&&.2>_,u=h}else u={collided:!1,bodyA:t,bodyB:n};if(h&&d){var y=u.axisBody,m=y===t?n:t,g=[y.axes[h.axisNumber]];if(c=e(y.vertices,m.vertices,g),u.reused=!0,c.overlap<=0)return u.collided=!1,u}else{if(a=e(t.vertices,n.vertices,t.axes),a.overlap<=0)return u.collided=!1,u;if(l=e(n.vertices,t.vertices,n.axes),l.overlap<=0)return u.collided=!1,u;a.overlap<l.overlap?(c=a,u.axisBody=t):(c=l,u.axisBody=n),u.axisNumber=c.axisNumber}u.bodyA=t.id<n.id?t:n,u.bodyB=t.id<n.id?n:t,u.collided=!0,u.normal=c.axis,u.depth=c.overlap,u.parentA=u.bodyA.parent,u.parentB=u.bodyB.parent,t=u.bodyA,n=u.bodyB,o.dot(u.normal,o.sub(n.position,t.position))>0&&(u.normal=o.neg(u.normal)),u.tangent=o.perp(u.normal),u.penetration={x:u.normal.x*u.depth,y:u.normal.y*u.depth};var v=s(t,n,u.normal),x=u.supports||[];if(x.length=0,i.contains(t.vertices,v[0])&&x.push(v[0]),i.contains(t.vertices,v[1])&&x.push(v[1]),x.length<2){var b=s(n,t,o.neg(u.normal));i.contains(n.vertices,b[0])&&x.push(b[0]),x.length<2&&i.contains(n.vertices,b[1])&&x.push(b[1])}return x.length<1&&(x=[v[0]]),u.supports=x,u};var e=function(e,n,i){for(var s,r,a=o._temp[0],l=o._temp[1],c={overlap:Number.MAX_VALUE},u=0;u<i.length;u++){if(r=i[u],t(a,e,r),t(l,n,r),s=Math.min(a.max-l.min,l.max-a.min),0>=s)return c.overlap=s,c;s<c.overlap&&(c.overlap=s,c.axis=r,c.axisNumber=u)}return c},t=function(e,t,n){for(var i=o.dot(t[0],n),s=i,r=1;r<t.length;r+=1){var a=o.dot(t[r],n);a>s?s=a:i>a&&(i=a)}e.min=i,e.max=s},s=function(e,t,n){for(var i,s,r,a,l=Number.MAX_VALUE,c=o._temp[0],u=t.vertices,h=e.position,d=0;d<u.length;d++)s=u[d],c.x=s.x-h.x,c.y=s.y-h.y,i=-o.dot(n,c),l>i&&(l=i,r=s);var f=r.index-1>=0?r.index-1:u.length-1;s=u[f],c.x=s.x-h.x,c.y=s.y-h.y,l=-o.dot(n,c),a=s;var p=(r.index+1)%u.length;return s=u[p],c.x=s.x-h.x,c.y=s.y-h.y,i=-o.dot(n,c),l>i&&(a=s),[r,a]}}()},{"../geometry/Vector":26,"../geometry/Vertices":27}],12:[function(e,t){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../geometry/Vector"),s=e("../core/Sleeping"),r=e("../geometry/Bounds"),a=e("../geometry/Axes"),l=e("../core/Common");!function(){var e=1e-6,t=.001;n.create=function(t){var n=t;n.bodyA&&!n.pointA&&(n.pointA={x:0,y:0}),n.bodyB&&!n.pointB&&(n.pointB={x:0,y:0});var i=n.bodyA?o.add(n.bodyA.position,n.pointA):n.pointA,s=n.bodyB?o.add(n.bodyB.position,n.pointB):n.pointB,r=o.magnitude(o.sub(i,s));n.length=n.length||r||e;var a={visible:!0,lineWidth:2,strokeStyle:"#666"};return n.render=l.extend(a,n.render),n.id=n.id||l.nextId(),n.label=n.label||"Constraint",n.type="constraint",n.stiffness=n.stiffness||1,n.angularStiffness=n.angularStiffness||0,n.angleA=n.bodyA?n.bodyA.angle:n.angleA,n.angleB=n.bodyB?n.bodyB.angle:n.angleB,n},n.solveAll=function(e,t){for(var i=0;i<e.length;i++)n.solve(e[i],t)},n.solve=function(n,i){var s=n.bodyA,r=n.bodyB,a=n.pointA,l=n.pointB;s&&!s.isStatic&&(n.pointA=o.rotate(a,s.angle-n.angleA),n.angleA=s.angle),r&&!r.isStatic&&(n.pointB=o.rotate(l,r.angle-n.angleB),n.angleB=r.angle);var c=a,u=l;if(s&&(c=o.add(s.position,a)),r&&(u=o.add(r.position,l)),c&&u){var h=o.sub(c,u),d=o.magnitude(h);0===d&&(d=e);var f=(d-n.length)/d,p=o.div(h,d),_=o.mult(h,.5*f*n.stiffness*i*i);if(!(Math.abs(1-d/n.length)<t*i)){var y,m,g,v,x,b,w,S;s&&!s.isStatic?(g={x:c.x-s.position.x+_.x,y:c.y-s.position.y+_.y},s.velocity.x=s.position.x-s.positionPrev.x,s.velocity.y=s.position.y-s.positionPrev.y,s.angularVelocity=s.angle-s.anglePrev,y=o.add(s.velocity,o.mult(o.perp(g),s.angularVelocity)),x=o.dot(g,p),w=s.inverseMass+s.inverseInertia*x*x):(y={x:0,y:0},w=s?s.inverseMass:0),r&&!r.isStatic?(v={x:u.x-r.position.x-_.x,y:u.y-r.position.y-_.y},r.velocity.x=r.position.x-r.positionPrev.x,r.velocity.y=r.position.y-r.positionPrev.y,r.angularVelocity=r.angle-r.anglePrev,m=o.add(r.velocity,o.mult(o.perp(v),r.angularVelocity)),b=o.dot(v,p),S=r.inverseMass+r.inverseInertia*b*b):(m={x:0,y:0},S=r?r.inverseMass:0);var A=o.sub(m,y),T=o.dot(p,A)/(w+S);T>0&&(T=0);var M,C={x:p.x*T,y:p.y*T};s&&!s.isStatic&&(M=o.cross(g,C)*s.inverseInertia*(1-n.angularStiffness),s.constraintImpulse.x-=_.x,s.constraintImpulse.y-=_.y,s.constraintImpulse.angle+=M,s.position.x-=_.x,s.position.y-=_.y,s.angle+=M),r&&!r.isStatic&&(M=o.cross(v,C)*r.inverseInertia*(1-n.angularStiffness),r.constraintImpulse.x+=_.x,r.constraintImpulse.y+=_.y,r.constraintImpulse.angle-=M,r.position.x+=_.x,r.position.y+=_.y,r.angle-=M)}}},n.postSolveAll=function(e){for(var t=0;t<e.length;t++){var n=e[t],l=n.constraintImpulse;if(0!==l.x||0!==l.y||0!==l.angle){s.set(n,!1);for(var c=0;c<n.parts.length;c++){var u=n.parts[c];i.translate(u.vertices,l),c>0&&(u.position.x+=l.x,u.position.y+=l.y),0!==l.angle&&(i.rotate(u.vertices,l.angle,n.position),a.rotate(u.axes,l.angle),c>0&&o.rotateAbout(u.position,l.angle,n.position,u.position)),r.update(u.bounds,u.vertices,n.velocity)
}l.angle=0,l.x=0,l.y=0}}}}()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],13:[function(e,t){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../core/Sleeping"),s=e("../core/Mouse"),r=e("../core/Events"),a=e("../collision/Detector"),l=e("./Constraint"),c=e("../body/Composite"),u=e("../core/Common"),h=e("../geometry/Bounds");!function(){n.create=function(t,i){var o=(t?t.mouse:null)||(i?i.mouse:null);o||(t&&t.render&&t.render.canvas?o=s.create(t.render.canvas):i&&i.element?o=s.create(i.element):(o=s.create(),u.log("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected","warn")));var a=l.create({label:"Mouse Constraint",pointA:o.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),h={type:"mouseConstraint",mouse:o,element:null,body:null,constraint:a,collisionFilter:{category:1,mask:4294967295,group:0}},d=u.extend(h,i);return r.on(t,"tick",function(){var i=c.allBodies(t.world);n.update(d,i),e(d)}),d},n.update=function(e,t){var n=e.mouse,s=e.constraint,l=e.body;if(0===n.button){if(s.bodyB)o.set(s.bodyB,!1),s.pointA=n.position;else for(var c=0;c<t.length;c++)if(l=t[c],h.contains(l.bounds,n.position)&&a.canCollide(l.collisionFilter,e.collisionFilter))for(var u=l.parts.length>1?1:0;u<l.parts.length;u++){var d=l.parts[u];if(i.contains(d.vertices,n.position)){s.pointA=n.position,s.bodyB=e.body=l,s.pointB={x:n.position.x-l.position.x,y:n.position.y-l.position.y},s.angleB=l.angle,o.set(l,!1),r.trigger(e,"startdrag",{mouse:n,body:l});break}}}else s.bodyB=e.body=null,s.pointB=null,l&&r.trigger(e,"enddrag",{mouse:n,body:l})};var e=function(e){var t=e.mouse,n=t.sourceEvents;n.mousemove&&r.trigger(e,"mousemove",{mouse:t}),n.mousedown&&r.trigger(e,"mousedown",{mouse:t}),n.mouseup&&r.trigger(e,"mouseup",{mouse:t}),s.clearSourceEvents(t)}}()},{"../body/Composite":2,"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":18,"../core/Sleeping":20,"../geometry/Bounds":24,"../geometry/Vertices":27,"./Constraint":12}],14:[function(e,t){var n={};t.exports=n,function(){n._nextId=0,n._seed=0,n.extend=function(e,t){var i,o,s;"boolean"==typeof t?(i=2,s=t):(i=1,s=!0),o=Array.prototype.slice.call(arguments,i);for(var r=0;r<o.length;r++){var a=o[r];if(a)for(var l in a)s&&a[l]&&a[l].constructor===Object?e[l]&&e[l].constructor!==Object?e[l]=a[l]:(e[l]=e[l]||{},n.extend(e[l],s,a[l])):e[l]=a[l]}return e},n.clone=function(e,t){return n.extend({},t,e)},n.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)t.push(n);return t},n.values=function(e){var t=[];if(Object.keys){for(var n=Object.keys(e),i=0;i<n.length;i++)t.push(e[n[i]]);return t}for(var o in e)t.push(e[o]);return t},n.shadeColor=function(e,t){var n=parseInt(e.slice(1),16),i=Math.round(2.55*t),o=(n>>16)+i,s=(n>>8&255)+i,r=(255&n)+i;return"#"+(16777216+65536*(255>o?1>o?0:o:255)+256*(255>s?1>s?0:s:255)+(255>r?1>r?0:r:255)).toString(16).slice(1)},n.shuffle=function(e){for(var t=e.length-1;t>0;t--){var i=Math.floor(n.random()*(t+1)),o=e[t];e[t]=e[i],e[i]=o}return e},n.choose=function(e){return e[Math.floor(n.random()*e.length)]},n.isElement=function(e){try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},n.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.clamp=function(e,t,n){return t>e?t:e>n?n:e},n.sign=function(e){return 0>e?-1:1},n.now=function(){var e=window.performance||{};return e.now=function(){return e.now||e.webkitNow||e.msNow||e.oNow||e.mozNow||function(){return+new Date}}(),e.now()},n.random=function(t,n){return t="undefined"!=typeof t?t:0,n="undefined"!=typeof n?n:1,t+e()*(n-t)},n.colorToNumber=function(e){return e=e.replace("#",""),3==e.length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},n.log=function(e,t){if(console&&console.log&&console.warn)switch(t){case"warn":console.warn("Matter.js:",e);break;case"error":console.log("Matter.js:",e)}},n.nextId=function(){return n._nextId++},n.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1};var e=function(){return n._seed=(9301*n._seed+49297)%233280,n._seed/233280}}()},{}],15:[function(e,t){var n={};t.exports=n;var i=e("../body/World"),o=e("./Sleeping"),s=e("../collision/Resolver"),r=e("../render/Render"),a=e("../collision/Pairs"),l=(e("./Metrics"),e("../collision/Grid")),c=e("./Events"),u=e("../body/Composite"),h=e("../constraint/Constraint"),d=e("./Common"),f=e("../body/Body");!function(){n.create=function(e,t){t=d.isElement(e)?t:e,e=d.isElement(e)?e:null,t=t||{},(e||t.render)&&d.log("Engine.create: engine.render is deprecated (see docs)","warn");var n={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],timing:{timestamp:0,timeScale:1},broadphase:{controller:l}},o=d.extend(n,t);if(e||o.render){var s={element:e,controller:r};o.render=d.extend(s,o.render)}return o.render&&o.render.controller&&(o.render=o.render.controller.create(o.render)),o.render&&(o.render.engine=o),o.world=t.world||i.create(o.world),o.pairs=a.create(),o.broadphase=o.broadphase.controller.create(o.broadphase),o.metrics=o.metrics||{extended:!1},o},n.update=function(n,i,r){i=i||1e3/60,r=r||1;var l,d=n.world,f=n.timing,_=n.broadphase,y=[];f.timestamp+=i*f.timeScale;var m={timestamp:f.timestamp};c.trigger(n,"beforeUpdate",m);var g=u.allBodies(d),v=u.allConstraints(d);for(n.enableSleeping&&o.update(g,f.timeScale),t(g,d.gravity),p(g,i,f.timeScale,r,d.bounds),l=0;l<n.constraintIterations;l++)h.solveAll(v,f.timeScale);h.postSolveAll(g),_.controller?(d.isModified&&_.controller.clear(_),_.controller.update(_,g,n,d.isModified),y=_.pairsList):y=g,d.isModified&&u.setModified(d,!1,!1,!0);var x=_.detector(y,n),b=n.pairs,w=f.timestamp;for(a.update(b,x,w),a.removeOld(b,w),n.enableSleeping&&o.afterCollisions(b.list,f.timeScale),b.collisionStart.length>0&&c.trigger(n,"collisionStart",{pairs:b.collisionStart}),s.preSolvePosition(b.list),l=0;l<n.positionIterations;l++)s.solvePosition(b.list,f.timeScale);for(s.postSolvePosition(g),s.preSolveVelocity(b.list),l=0;l<n.velocityIterations;l++)s.solveVelocity(b.list,f.timeScale);return b.collisionActive.length>0&&c.trigger(n,"collisionActive",{pairs:b.collisionActive}),b.collisionEnd.length>0&&c.trigger(n,"collisionEnd",{pairs:b.collisionEnd}),e(g),c.trigger(n,"afterUpdate",m),n},n.merge=function(e,t){if(d.extend(e,t),t.world){e.world=t.world,n.clear(e);for(var i=u.allBodies(e.world),s=0;s<i.length;s++){var r=i[s];o.set(r,!1),r.id=d.nextId()}}},n.clear=function(e){var t=e.world;a.clear(e.pairs);var n=e.broadphase;if(n.controller){var i=u.allBodies(t);n.controller.clear(n),n.controller.update(n,i,e,!0)}};var e=function(e){for(var t=0;t<e.length;t++){var n=e[t];n.force.x=0,n.force.y=0,n.torque=0}},t=function(e,t){var n="undefined"!=typeof t.scale?t.scale:.001;if((0!==t.x||0!==t.y)&&0!==n)for(var i=0;i<e.length;i++){var o=e[i];o.isStatic||o.isSleeping||(o.force.y+=o.mass*t.y*n,o.force.x+=o.mass*t.x*n)}},p=function(e,t,n,i){for(var o=0;o<e.length;o++){var s=e[o];s.isStatic||s.isSleeping||f.update(s,t,n,i)}}}()},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":29,"./Common":14,"./Events":16,"./Metrics":17,"./Sleeping":20}],16:[function(e,t){var n={};t.exports=n;var i=e("./Common");!function(){n.on=function(e,t,n){for(var i,o=t.split(" "),s=0;s<o.length;s++)i=o[s],e.events=e.events||{},e.events[i]=e.events[i]||[],e.events[i].push(n);return n},n.off=function(e,t,n){if(!t)return void(e.events={});"function"==typeof t&&(n=t,t=i.keys(e.events).join(" "));for(var o=t.split(" "),s=0;s<o.length;s++){var r=e.events[o[s]],a=[];if(n&&r)for(var l=0;l<r.length;l++)r[l]!==n&&a.push(r[l]);e.events[o[s]]=a}},n.trigger=function(e,t,n){var o,s,r,a;if(e.events){n||(n={}),o=t.split(" ");for(var l=0;l<o.length;l++)if(s=o[l],r=e.events[s]){a=i.clone(n,!1),a.name=s,a.source=e;for(var c=0;c<r.length;c++)r[c].apply(e,[a])}}}}()},{"./Common":14}],17:[function(){},{"../body/Composite":2,"./Common":14}],18:[function(e,t){var n={};t.exports=n;var i=e("../core/Common");!function(){n.create=function(t){var o={};return t||i.log("Mouse.create: element was undefined, defaulting to document.body","warn"),o.element=t||document.body,o.absolute={x:0,y:0},o.position={x:0,y:0},o.mousedownPosition={x:0,y:0},o.mouseupPosition={x:0,y:0},o.offset={x:0,y:0},o.scale={x:1,y:1},o.wheelDelta=0,o.button=-1,o.pixelRatio=o.element.getAttribute("data-pixel-ratio")||1,o.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},o.mousemove=function(t){var n=e(t,o.element,o.pixelRatio),i=t.changedTouches;i&&(o.button=0,t.preventDefault()),o.absolute.x=n.x,o.absolute.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.sourceEvents.mousemove=t},o.mousedown=function(t){var n=e(t,o.element,o.pixelRatio),i=t.changedTouches;i?(o.button=0,t.preventDefault()):o.button=t.button,o.absolute.x=n.x,o.absolute.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mousedownPosition.x=o.position.x,o.mousedownPosition.y=o.position.y,o.sourceEvents.mousedown=t},o.mouseup=function(t){var n=e(t,o.element,o.pixelRatio),i=t.changedTouches;i&&t.preventDefault(),o.button=-1,o.absolute.x=n.x,o.absolute.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mouseupPosition.x=o.position.x,o.mouseupPosition.y=o.position.y,o.sourceEvents.mouseup=t},o.mousewheel=function(e){o.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault()},n.setElement(o,o.element),o},n.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove),t.addEventListener("mousedown",e.mousedown),t.addEventListener("mouseup",e.mouseup),t.addEventListener("mousewheel",e.mousewheel),t.addEventListener("DOMMouseScroll",e.mousewheel),t.addEventListener("touchmove",e.mousemove),t.addEventListener("touchstart",e.mousedown),t.addEventListener("touchend",e.mouseup)},n.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},n.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},n.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y};var e=function(e,t,n){var i,o,s=t.getBoundingClientRect(),r=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:r.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:r.scrollTop,c=e.changedTouches;return c?(i=c[0].pageX-s.left-a,o=c[0].pageY-s.top-l):(i=e.pageX-s.left-a,o=e.pageY-s.top-l),{x:i/(t.clientWidth/t.width*n),y:o/(t.clientHeight/t.height*n)}}}()},{"../core/Common":14}],19:[function(e,t){var n={};t.exports=n;var i=e("./Events"),o=e("./Engine"),s=e("./Common");!function(){var e,t;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(s.now())},1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n.create=function(e){var t={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},n=s.extend(t,e);return n.delta=n.delta||1e3/n.fps,n.deltaMin=n.deltaMin||1e3/n.fps,n.deltaMax=n.deltaMax||1e3/(.5*n.fps),n.fps=1e3/n.delta,n},n.run=function(t,i){return"undefined"!=typeof t.positionIterations&&(i=t,t=n.create()),function o(s){t.frameRequestId=e(o),s&&t.enabled&&n.tick(t,i,s)}(),t},n.tick=function(e,t,n){var s,r=t.timing,a=1,l={timestamp:r.timestamp};i.trigger(e,"beforeTick",l),i.trigger(t,"beforeTick",l),e.isFixed?s=e.delta:(s=n-e.timePrev||e.delta,e.timePrev=n,e.deltaHistory.push(s),e.deltaHistory=e.deltaHistory.slice(-e.deltaSampleSize),s=Math.min.apply(null,e.deltaHistory),s=s<e.deltaMin?e.deltaMin:s,s=s>e.deltaMax?e.deltaMax:s,a=s/e.delta,e.delta=s),0!==e.timeScalePrev&&(a*=r.timeScale/e.timeScalePrev),0===r.timeScale&&(a=0),e.timeScalePrev=r.timeScale,e.correction=a,e.frameCounter+=1,n-e.counterTimestamp>=1e3&&(e.fps=e.frameCounter*((n-e.counterTimestamp)/1e3),e.counterTimestamp=n,e.frameCounter=0),i.trigger(e,"tick",l),i.trigger(t,"tick",l),t.world.isModified&&t.render&&t.render.controller&&t.render.controller.clear&&t.render.controller.clear(t.render),i.trigger(e,"beforeUpdate",l),o.update(t,s,a),i.trigger(e,"afterUpdate",l),t.render&&t.render.controller&&(i.trigger(e,"beforeRender",l),i.trigger(t,"beforeRender",l),t.render.controller.world(t.render),i.trigger(e,"afterRender",l),i.trigger(t,"afterRender",l)),i.trigger(e,"afterTick",l),i.trigger(t,"afterTick",l)},n.stop=function(e){t(e.frameRequestId)},n.start=function(e,t){n.run(e,t)}}()},{"./Common":14,"./Engine":15,"./Events":16}],20:[function(e,t){var n={};t.exports=n;var i=e("./Events");!function(){n._motionWakeThreshold=.18,n._motionSleepThreshold=.08,n._minBias=.9,n.update=function(e,t){for(var i=t*t*t,o=0;o<e.length;o++){var s=e[o],r=s.speed*s.speed+s.angularSpeed*s.angularSpeed;if(0===s.force.x&&0===s.force.y){var a=Math.min(s.motion,r),l=Math.max(s.motion,r);s.motion=n._minBias*a+(1-n._minBias)*l,s.sleepThreshold>0&&s.motion<n._motionSleepThreshold*i?(s.sleepCounter+=1,s.sleepCounter>=s.sleepThreshold&&n.set(s,!0)):s.sleepCounter>0&&(s.sleepCounter-=1)}else n.set(s,!1)}},n.afterCollisions=function(e,t){for(var i=t*t*t,o=0;o<e.length;o++){var s=e[o];if(s.isActive){var r=s.collision,a=r.bodyA.parent,l=r.bodyB.parent;if(!(a.isSleeping&&l.isSleeping||a.isStatic||l.isStatic)&&(a.isSleeping||l.isSleeping)){var c=a.isSleeping&&!a.isStatic?a:l,u=c===a?l:a;!c.isStatic&&u.motion>n._motionWakeThreshold*i&&n.set(c,!1)}}}},n.set=function(e,t){var n=e.isSleeping;t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0,n||i.trigger(e,"sleepStart")):(e.isSleeping=!1,e.sleepCounter=0,n&&i.trigger(e,"sleepEnd"))}}()},{"./Events":16}],21:[function(e,t){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../core/Common"),s=e("../body/Body"),r=e("../geometry/Bounds"),a=e("../geometry/Vector");!function(){n.rectangle=function(e,t,n,r,a){a=a||{};var l={label:"Rectangle Body",position:{x:e,y:t},vertices:i.fromPath("L 0 0 L "+n+" 0 L "+n+" "+r+" L 0 "+r)};if(a.chamfer){var c=a.chamfer;l.vertices=i.chamfer(l.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete a.chamfer}return s.create(o.extend({},l,a))},n.trapezoid=function(e,t,n,r,a,l){l=l||{},a*=.5;var c,u=(1-2*a)*n,h=n*a,d=h+u,f=d+h;c=.5>a?"L 0 0 L "+h+" "+-r+" L "+d+" "+-r+" L "+f+" 0":"L 0 0 L "+d+" "+-r+" L "+f+" 0";var p={label:"Trapezoid Body",position:{x:e,y:t},vertices:i.fromPath(c)};if(l.chamfer){var _=l.chamfer;p.vertices=i.chamfer(p.vertices,_.radius,_.quality,_.qualityMin,_.qualityMax),delete l.chamfer}return s.create(o.extend({},p,l))},n.circle=function(e,t,i,s,r){s=s||{};var a={label:"Circle Body",circleRadius:i};r=r||25;var l=Math.ceil(Math.max(10,Math.min(r,i)));return l%2===1&&(l+=1),n.polygon(e,t,l,i,o.extend({},a,s))},n.polygon=function(e,t,r,a,l){if(l=l||{},3>r)return n.circle(e,t,a,l);for(var c=2*Math.PI/r,u="",h=.5*c,d=0;r>d;d+=1){var f=h+d*c,p=Math.cos(f)*a,_=Math.sin(f)*a;u+="L "+p.toFixed(3)+" "+_.toFixed(3)+" "}var y={label:"Polygon Body",position:{x:e,y:t},vertices:i.fromPath(u)};if(l.chamfer){var m=l.chamfer;y.vertices=i.chamfer(y.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete l.chamfer}return s.create(o.extend({},y,l))},n.fromVertices=function(e,t,n,l,c,u,h){var d,f,p,_,y,m,g,v,x;for(l=l||{},f=[],c="undefined"!=typeof c?c:!1,u="undefined"!=typeof u?u:.01,h="undefined"!=typeof h?h:10,window.decomp||o.log("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull.","warn"),o.isArray(n[0])||(n=[n]),v=0;v<n.length;v+=1)if(_=n[v],p=i.isConvex(_),p||!window.decomp)_=p?i.clockwiseSort(_):i.hull(_),f.push({position:{x:e,y:t},vertices:_});else{var b=new decomp.Polygon;for(y=0;y<_.length;y++)b.vertices.push([_[y].x,_[y].y]);b.makeCCW(),u!==!1&&b.removeCollinearPoints(u);var w=b.quickDecomp();for(y=0;y<w.length;y++){var S=w[y],A=[];for(m=0;m<S.vertices.length;m++)A.push({x:S.vertices[m][0],y:S.vertices[m][1]});h>0&&i.area(A)<h||f.push({position:i.centre(A),vertices:A})}}for(y=0;y<f.length;y++)f[y]=s.create(o.extend(f[y],l));if(c){var T=5;for(y=0;y<f.length;y++){var M=f[y];for(m=y+1;m<f.length;m++){var C=f[m];if(r.overlaps(M.bounds,C.bounds)){var E=M.vertices,k=C.vertices;for(g=0;g<M.vertices.length;g++)for(x=0;x<C.vertices.length;x++){var I=a.magnitudeSquared(a.sub(E[(g+1)%E.length],k[x])),P=a.magnitudeSquared(a.sub(E[g],k[(x+1)%k.length]));T>I&&T>P&&(E[g].isInternal=!0,k[x].isInternal=!0)}}}}}return f.length>1?(d=s.create(o.extend({parts:f.slice(0)},l)),s.setPosition(d,{x:e,y:t}),d):f[0]}}()},{"../body/Body":1,"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],22:[function(e,t){var n={};t.exports=n;var i=e("../body/Composite"),o=e("../constraint/Constraint"),s=e("../core/Common"),r=e("../body/Body"),a=e("./Bodies");!function(){n.stack=function(e,t,n,o,s,a,l){for(var c,u=i.create({label:"Stack"}),h=e,d=t,f=0,p=0;o>p;p++){for(var _=0,y=0;n>y;y++){var m=l(h,d,y,p,c,f);if(m){var g=m.bounds.max.y-m.bounds.min.y,v=m.bounds.max.x-m.bounds.min.x;g>_&&(_=g),r.translate(m,{x:.5*v,y:.5*g}),h=m.bounds.max.x+s,i.addBody(u,m),c=m,f+=1}else h+=s}d+=_+a,h=e}return u},n.chain=function(e,t,n,r,a,l){for(var c=e.bodies,u=1;u<c.length;u++){var h=c[u-1],d=c[u],f=h.bounds.max.y-h.bounds.min.y,p=h.bounds.max.x-h.bounds.min.x,_=d.bounds.max.y-d.bounds.min.y,y=d.bounds.max.x-d.bounds.min.x,m={bodyA:h,pointA:{x:p*t,y:f*n},bodyB:d,pointB:{x:y*r,y:_*a}},g=s.extend(m,l);i.addConstraint(e,o.create(g))}return e.label+=" Chain",e},n.mesh=function(e,t,n,r,a){var l,c,u,h,d,f=e.bodies;for(l=0;n>l;l++){for(c=1;t>c;c++)u=f[c-1+l*t],h=f[c+l*t],i.addConstraint(e,o.create(s.extend({bodyA:u,bodyB:h},a)));if(l>0)for(c=0;t>c;c++)u=f[c+(l-1)*t],h=f[c+l*t],i.addConstraint(e,o.create(s.extend({bodyA:u,bodyB:h},a))),r&&c>0&&(d=f[c-1+(l-1)*t],i.addConstraint(e,o.create(s.extend({bodyA:d,bodyB:h},a)))),r&&t-1>c&&(d=f[c+1+(l-1)*t],i.addConstraint(e,o.create(s.extend({bodyA:d,bodyB:h},a))))}return e.label+=" Mesh",e},n.pyramid=function(e,t,i,o,s,a,l){return n.stack(e,t,i,o,s,a,function(t,n,a,c,u,h){var d=Math.min(o,Math.ceil(i/2)),f=u?u.bounds.max.x-u.bounds.min.x:0;if(!(c>d)){c=d-c;var p=c,_=i-1-c;if(!(p>a||a>_)){1===h&&r.translate(u,{x:(a+(i%2===1?1:-1))*f,y:0});var y=u?a*f:0;return l(e+y+a*s,n,a,c,u,h)}}})},n.newtonsCradle=function(e,t,n,s,r){for(var l=i.create({label:"Newtons Cradle"}),c=0;n>c;c++){var u=1.9,h=a.circle(e+c*s*u,t+r,s,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),d=o.create({pointA:{x:e+c*s*u,y:t},bodyB:h});i.addBody(l,h),i.addConstraint(l,d)}return l},n.car=function(e,t,n,s,l){var c=r.nextGroup(!0),u=-20,h=.5*-n+u,d=.5*n-u,f=0,p=i.create({label:"Car"}),_=a.trapezoid(e,t,n,s,.3,{collisionFilter:{group:c},friction:.01,chamfer:{radius:10}}),y=a.circle(e+h,t+f,l,{collisionFilter:{group:c},friction:.8,density:.01}),m=a.circle(e+d,t+f,l,{collisionFilter:{group:c},friction:.8,density:.01}),g=o.create({bodyA:_,pointA:{x:h,y:f},bodyB:y,stiffness:.2}),v=o.create({bodyA:_,pointA:{x:d,y:f},bodyB:m,stiffness:.2});return i.addBody(p,_),i.addBody(p,y),i.addBody(p,m),i.addConstraint(p,g),i.addConstraint(p,v),p},n.softBody=function(e,t,i,o,r,l,c,u,h,d){h=s.extend({inertia:1/0},h),d=s.extend({stiffness:.4},d);var f=n.stack(e,t,i,o,r,l,function(e,t){return a.circle(e,t,u,h)});return n.mesh(f,i,o,c,d),f.label="Soft Body",f}}()},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":21}],23:[function(e,t){var n={};t.exports=n;var i=e("../geometry/Vector"),o=e("../core/Common");!function(){n.fromVertices=function(e){for(var t={},n=0;n<e.length;n++){var s=(n+1)%e.length,r=i.normalise({x:e[s].y-e[n].y,y:e[n].x-e[s].x}),a=0===r.y?1/0:r.x/r.y;a=a.toFixed(3).toString(),t[a]=r}return o.values(t)},n.rotate=function(e,t){if(0!==t)for(var n=Math.cos(t),i=Math.sin(t),o=0;o<e.length;o++){var s,r=e[o];s=r.x*n-r.y*i,r.y=r.x*i+r.y*n,r.x=s}}}()},{"../core/Common":14,"../geometry/Vector":26}],24:[function(e,t){var n={};t.exports=n,function(){n.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&n.update(t,e),t},n.update=function(e,t,n){e.min.x=1/0,e.max.x=-(1/0),e.min.y=1/0,e.max.y=-(1/0);for(var i=0;i<t.length;i++){var o=t[i];o.x>e.max.x&&(e.max.x=o.x),o.x<e.min.x&&(e.min.x=o.x),o.y>e.max.y&&(e.max.y=o.y),o.y<e.min.y&&(e.min.y=o.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},n.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},n.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},n.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},n.shift=function(e,t){var n=e.max.x-e.min.x,i=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+n,e.min.y=t.y,e.max.y=t.y+i}}()},{}],25:[function(e,t){var n={};t.exports=n,e("../geometry/Bounds"),!function(){n.pathToVertices=function(t,n){var i,o,s,r,a,l,c,u,h,d,f,p,_=[],y=0,m=0,g=0;n=n||15;var v=function(e,t,n){var i=n%2===1&&n>1;if(!h||e!=h.x||t!=h.y){h&&i?(f=h.x,p=h.y):(f=0,p=0);var o={x:f+e,y:p+t};!i&&h||(h=o),_.push(o),m=f+e,g=p+t}},x=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":m=e.x,g=e.y;break;case"H":m=e.x;break;case"V":g=e.y}v(m,g,e.pathSegType)}};for(e(t),s=t.getTotalLength(),l=[],i=0;i<t.pathSegList.numberOfItems;i+=1)l.push(t.pathSegList.getItem(i));for(c=l.concat();s>y;){if(d=t.getPathSegAtLength(y),a=l[d],a!=u){for(;c.length&&c[0]!=a;)x(c.shift());u=a}switch(a.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":r=t.getPointAtLength(y),v(r.x,r.y,0)}y+=n}for(i=0,o=c.length;o>i;++i)x(c[i]);return _};var e=function(e){for(var t,n,i,o,s,r,a=e.pathSegList,l=0,c=0,u=a.numberOfItems,h=0;u>h;++h){var d=a.getItem(h),f=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(f))"x"in d&&(l=d.x),"y"in d&&(c=d.y);else switch("x1"in d&&(i=l+d.x1),"x2"in d&&(s=l+d.x2),"y1"in d&&(o=c+d.y1),"y2"in d&&(r=c+d.y2),"x"in d&&(l+=d.x),"y"in d&&(c+=d.y),f){case"m":a.replaceItem(e.createSVGPathSegMovetoAbs(l,c),h);break;case"l":a.replaceItem(e.createSVGPathSegLinetoAbs(l,c),h);break;case"h":a.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(l),h);break;case"v":a.replaceItem(e.createSVGPathSegLinetoVerticalAbs(c),h);break;case"c":a.replaceItem(e.createSVGPathSegCurvetoCubicAbs(l,c,i,o,s,r),h);break;case"s":a.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(l,c,s,r),h);break;case"q":a.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(l,c,i,o),h);break;case"t":a.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(l,c),h);break;case"a":a.replaceItem(e.createSVGPathSegArcAbs(l,c,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),h);break;case"z":case"Z":l=t,c=n}"M"!=f&&"m"!=f||(t=l,n=c)}}}()},{"../geometry/Bounds":24}],26:[function(e,t){var n={};t.exports=n,function(){n.create=function(e,t){return{x:e||0,y:t||0}},n.clone=function(e){return{x:e.x,y:e.y}},n.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},n.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},n.rotate=function(e,t){var n=Math.cos(t),i=Math.sin(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}},n.rotateAbout=function(e,t,n,i){var o=Math.cos(t),s=Math.sin(t);i||(i={});var r=n.x+((e.x-n.x)*o-(e.y-n.y)*s);return i.y=n.y+((e.x-n.x)*s+(e.y-n.y)*o),i.x=r,i},n.normalise=function(e){var t=n.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},n.dot=function(e,t){return e.x*t.x+e.y*t.y},n.cross=function(e,t){return e.x*t.y-e.y*t.x},n.cross3=function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)},n.add=function(e,t,n){return n||(n={}),n.x=e.x+t.x,n.y=e.y+t.y,n},n.sub=function(e,t,n){return n||(n={}),n.x=e.x-t.x,n.y=e.y-t.y,n},n.mult=function(e,t){return{x:e.x*t,y:e.y*t}},n.div=function(e,t){return{x:e.x/t,y:e.y/t}},n.perp=function(e,t){return t=t===!0?-1:1,{x:t*-e.y,y:t*e.x}},n.neg=function(e){return{x:-e.x,y:-e.y}},n.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]}()},{}],27:[function(e,t){var n={};t.exports=n;var i=e("../geometry/Vector"),o=e("../core/Common");!function(){n.create=function(e,t){for(var n=[],i=0;i<e.length;i++){var o=e[i],s={x:o.x,y:o.y,index:i,body:t,isInternal:!1};n.push(s)}return n},n.fromPath=function(e,t){var i=/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,o=[];return e.replace(i,function(e,t,n){o.push({x:parseFloat(t),y:parseFloat(n)})}),n.create(o,t)},n.centre=function(e){for(var t,o,s,r=n.area(e,!0),a={x:0,y:0},l=0;l<e.length;l++)s=(l+1)%e.length,t=i.cross(e[l],e[s]),o=i.mult(i.add(e[l],e[s]),t),a=i.add(a,o);return i.div(a,6*r)},n.mean=function(e){for(var t={x:0,y:0},n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y;return i.div(t,e.length)},n.area=function(e,t){for(var n=0,i=e.length-1,o=0;o<e.length;o++)n+=(e[i].x-e[o].x)*(e[i].y+e[o].y),i=o;return t?n/2:Math.abs(n)/2},n.inertia=function(e,t){for(var n,o,s=0,r=0,a=e,l=0;l<a.length;l++)o=(l+1)%a.length,n=Math.abs(i.cross(a[o],a[l])),s+=n*(i.dot(a[o],a[o])+i.dot(a[o],a[l])+i.dot(a[l],a[l])),r+=n;return t/6*(s/r)},n.translate=function(e,t,n){var i;if(n)for(i=0;i<e.length;i++)e[i].x+=t.x*n,e[i].y+=t.y*n;else for(i=0;i<e.length;i++)e[i].x+=t.x,e[i].y+=t.y;return e},n.rotate=function(e,t,n){if(0!==t){for(var i=Math.cos(t),o=Math.sin(t),s=0;s<e.length;s++){var r=e[s],a=r.x-n.x,l=r.y-n.y;r.x=n.x+(a*i-l*o),r.y=n.y+(a*o+l*i)}return e}},n.contains=function(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=e[(n+1)%e.length];if((t.x-i.x)*(o.y-i.y)+(t.y-i.y)*(i.x-o.x)>0)return!1}return!0},n.scale=function(e,t,o,s){if(1===t&&1===o)return e;s=s||n.centre(e);for(var r,a,l=0;l<e.length;l++)r=e[l],a=i.sub(r,s),e[l].x=s.x+a.x*t,e[l].y=s.y+a.y*o;return e},n.chamfer=function(e,t,n,s,r){t=t||[8],t.length||(t=[t]),n="undefined"!=typeof n?n:-1,s=s||2,r=r||14;for(var a=[],l=0;l<e.length;l++){var c=e[l-1>=0?l-1:e.length-1],u=e[l],h=e[(l+1)%e.length],d=t[l<t.length?l:t.length-1];if(0!==d){var f=i.normalise({x:u.y-c.y,y:c.x-u.x}),p=i.normalise({x:h.y-u.y,y:u.x-h.x}),_=Math.sqrt(2*Math.pow(d,2)),y=i.mult(o.clone(f),d),m=i.normalise(i.mult(i.add(f,p),.5)),g=i.sub(u,i.mult(m,_)),v=n;-1===n&&(v=1.75*Math.pow(d,.32)),v=o.clamp(v,s,r),v%2===1&&(v+=1);for(var x=Math.acos(i.dot(f,p)),b=x/v,w=0;v>w;w++)a.push(i.add(i.rotate(y,b*w),g))}else a.push(u)}return a},n.clockwiseSort=function(e){var t=n.mean(e);return e.sort(function(e,n){return i.angle(t,e)-i.angle(t,n)}),e},n.isConvex=function(e){var t,n,i,o,s=0,r=e.length;if(3>r)return null;for(t=0;r>t;t++)if(n=(t+1)%r,i=(t+2)%r,o=(e[n].x-e[t].x)*(e[i].y-e[n].y),o-=(e[n].y-e[t].y)*(e[i].x-e[n].x),0>o?s|=1:o>0&&(s|=2),3===s)return!1;return 0!==s?!0:null},n.hull=function(e){var t,n,o=[],s=[];for(e=e.slice(0),e.sort(function(e,t){var n=e.x-t.x;return 0!==n?n:e.y-t.y}),n=0;n<e.length;n++){for(t=e[n];s.length>=2&&i.cross3(s[s.length-2],s[s.length-1],t)<=0;)s.pop();s.push(t)}for(n=e.length-1;n>=0;n--){for(t=e[n];o.length>=2&&i.cross3(o[o.length-2],o[o.length-1],t)<=0;)o.pop();o.push(t)}return o.pop(),s.pop(),o.concat(s)}}()},{"../core/Common":14,"../geometry/Vector":26}],28:[function(e,t){var n=t.exports={};n.version="master",n.Body=e("../body/Body"),n.Composite=e("../body/Composite"),n.World=e("../body/World"),n.Contact=e("../collision/Contact"),n.Detector=e("../collision/Detector"),n.Grid=e("../collision/Grid"),n.Pairs=e("../collision/Pairs"),n.Pair=e("../collision/Pair"),n.Query=e("../collision/Query"),n.Resolver=e("../collision/Resolver"),n.SAT=e("../collision/SAT"),n.Constraint=e("../constraint/Constraint"),n.MouseConstraint=e("../constraint/MouseConstraint"),n.Common=e("../core/Common"),n.Engine=e("../core/Engine"),n.Events=e("../core/Events"),n.Mouse=e("../core/Mouse"),n.Runner=e("../core/Runner"),n.Sleeping=e("../core/Sleeping"),n.Bodies=e("../factory/Bodies"),n.Composites=e("../factory/Composites"),n.Axes=e("../geometry/Axes"),n.Bounds=e("../geometry/Bounds"),n.Svg=e("../geometry/Svg"),n.Vector=e("../geometry/Vector"),n.Vertices=e("../geometry/Vertices"),n.Render=e("../render/Render"),n.RenderPixi=e("../render/RenderPixi"),n.World.add=n.Composite.add,n.World.remove=n.Composite.remove,n.World.addComposite=n.Composite.addComposite,n.World.addBody=n.Composite.addBody,n.World.addConstraint=n.Composite.addConstraint,n.World.clear=n.Composite.clear,n.Engine.run=n.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Metrics":17,"../core/Mouse":18,"../core/Runner":19,"../core/Sleeping":20,"../factory/Bodies":21,"../factory/Composites":22,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Svg":25,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29,"../render/RenderPixi":30}],29:[function(e,t){var n={};t.exports=n;var i=e("../core/Common"),o=e("../body/Composite"),s=e("../geometry/Bounds"),r=e("../core/Events"),a=e("../collision/Grid"),l=e("../geometry/Vector");!function(){var e,t;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(i.now())},1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n.create=function(e){var t={controller:n,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222",hasBounds:!!e.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},o=i.extend(t,e);return o.canvas&&(o.canvas.width=o.options.width||o.canvas.width,o.canvas.height=o.options.height||o.canvas.height),o.mouse=e.mouse,o.engine=e.engine,o.canvas=o.canvas||c(o.options.width,o.options.height),o.context=o.canvas.getContext("2d"),o.textures={},o.bounds=o.bounds||{min:{x:0,y:0},max:{x:o.canvas.width,y:o.canvas.height}},1!==o.options.pixelRatio&&n.setPixelRatio(o,o.options.pixelRatio),i.isElement(o.element)?o.element.appendChild(o.canvas):i.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),o},n.run=function(t){!function i(){t.frameRequestId=e(i),n.world(t)}()},n.stop=function(e){t(e.frameRequestId)},n.setPixelRatio=function(e,t){var n=e.options,i=e.canvas;"auto"===t&&(t=u(i)),n.pixelRatio=t,i.setAttribute("data-pixel-ratio",t),i.width=n.width*t,i.height=n.height*t,i.style.width=n.width+"px",i.style.height=n.height+"px",e.context.scale(t,t)},n.world=function(e){var t,i=e.engine,c=i.world,u=e.canvas,h=e.context,f=e.options,p=o.allBodies(c),_=o.allConstraints(c),y=f.wireframes?f.wireframeBackground:f.background,m=[],g=[],v={timestamp:i.timing.timestamp};
if(r.trigger(e,"beforeRender",v),e.currentBackground!==y&&d(e,y),h.globalCompositeOperation="source-in",h.fillStyle="transparent",h.fillRect(0,0,u.width,u.height),h.globalCompositeOperation="source-over",f.hasBounds){var x=e.bounds.max.x-e.bounds.min.x,b=e.bounds.max.y-e.bounds.min.y,w=x/f.width,S=b/f.height;for(t=0;t<p.length;t++){var A=p[t];s.overlaps(A.bounds,e.bounds)&&m.push(A)}for(t=0;t<_.length;t++){var T=_[t],M=T.bodyA,C=T.bodyB,E=T.pointA,k=T.pointB;M&&(E=l.add(M.position,T.pointA)),C&&(k=l.add(C.position,T.pointB)),E&&k&&(s.contains(e.bounds,E)||s.contains(e.bounds,k))&&g.push(T)}h.scale(1/w,1/S),h.translate(-e.bounds.min.x,-e.bounds.min.y)}else g=_,m=p;!f.wireframes||i.enableSleeping&&f.showSleeping?n.bodies(e,m,h):(f.showConvexHulls&&n.bodyConvexHulls(e,m,h),n.bodyWireframes(e,m,h)),f.showBounds&&n.bodyBounds(e,m,h),(f.showAxes||f.showAngleIndicator)&&n.bodyAxes(e,m,h),f.showPositions&&n.bodyPositions(e,m,h),f.showVelocity&&n.bodyVelocity(e,m,h),f.showIds&&n.bodyIds(e,m,h),f.showSeparations&&n.separations(e,i.pairs.list,h),f.showCollisions&&n.collisions(e,i.pairs.list,h),f.showVertexNumbers&&n.vertexNumbers(e,m,h),f.showMousePosition&&n.mousePosition(e,e.mouse,h),n.constraints(g,h),f.showBroadphase&&i.broadphase.controller===a&&n.grid(e,i.broadphase,h),f.showDebug&&n.debug(e,h),f.hasBounds&&h.setTransform(f.pixelRatio,0,0,f.pixelRatio,0,0),r.trigger(e,"afterRender",v)},n.debug=function(e,t){var n=t,i=e.engine,s=i.world,r=i.metrics,a=e.options,l=(o.allBodies(s),"    ");if(i.timing.timestamp-(e.debugTimestamp||0)>=500){var c="";r.timing&&(c+="fps: "+Math.round(r.timing.fps)+l),e.debugString=c,e.debugTimestamp=i.timing.timestamp}if(e.debugString){n.font="12px Arial",n.fillStyle=a.wireframes?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)";for(var u=e.debugString.split("\n"),h=0;h<u.length;h++)n.fillText(u[h],50,50+18*h)}},n.constraints=function(e,t){for(var n=t,i=0;i<e.length;i++){var o=e[i];if(o.render.visible&&o.pointA&&o.pointB){var s=o.bodyA,r=o.bodyB;s?(n.beginPath(),n.moveTo(s.position.x+o.pointA.x,s.position.y+o.pointA.y)):(n.beginPath(),n.moveTo(o.pointA.x,o.pointA.y)),r?n.lineTo(r.position.x+o.pointB.x,r.position.y+o.pointB.y):n.lineTo(o.pointB.x,o.pointB.y),n.lineWidth=o.render.lineWidth,n.strokeStyle=o.render.strokeStyle,n.stroke()}}},n.bodyShadows=function(e,t,n){for(var i=n,o=(e.engine,0);o<t.length;o++){var s=t[o];if(s.render.visible){if(s.circleRadius)i.beginPath(),i.arc(s.position.x,s.position.y,s.circleRadius,0,2*Math.PI),i.closePath();else{i.beginPath(),i.moveTo(s.vertices[0].x,s.vertices[0].y);for(var r=1;r<s.vertices.length;r++)i.lineTo(s.vertices[r].x,s.vertices[r].y);i.closePath()}var a=s.position.x-.5*e.options.width,l=s.position.y-.2*e.options.height,c=Math.abs(a)+Math.abs(l);i.shadowColor="rgba(0,0,0,0.15)",i.shadowOffsetX=.05*a,i.shadowOffsetY=.05*l,i.shadowBlur=1+12*Math.min(1,c/1e3),i.fill(),i.shadowColor=null,i.shadowOffsetX=null,i.shadowOffsetY=null,i.shadowBlur=null}}},n.bodies=function(e,t,n){var i,o,s,r,a=n,l=(e.engine,e.options),c=l.showInternalEdges||!l.wireframes;for(s=0;s<t.length;s++)if(i=t[s],i.render.visible)for(r=i.parts.length>1?1:0;r<i.parts.length;r++)if(o=i.parts[r],o.render.visible){if(l.showSleeping&&i.isSleeping?a.globalAlpha=.5*o.render.opacity:1!==o.render.opacity&&(a.globalAlpha=o.render.opacity),o.render.sprite&&o.render.sprite.texture&&!l.wireframes){var u=o.render.sprite,d=h(e,u.texture);a.translate(o.position.x,o.position.y),a.rotate(o.angle),a.drawImage(d,d.width*-u.xOffset*u.xScale,d.height*-u.yOffset*u.yScale,d.width*u.xScale,d.height*u.yScale),a.rotate(-o.angle),a.translate(-o.position.x,-o.position.y)}else{if(o.circleRadius)a.beginPath(),a.arc(o.position.x,o.position.y,o.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(o.vertices[0].x,o.vertices[0].y);for(var f=1;f<o.vertices.length;f++)!o.vertices[f-1].isInternal||c?a.lineTo(o.vertices[f].x,o.vertices[f].y):a.moveTo(o.vertices[f].x,o.vertices[f].y),o.vertices[f].isInternal&&!c&&a.moveTo(o.vertices[(f+1)%o.vertices.length].x,o.vertices[(f+1)%o.vertices.length].y);a.lineTo(o.vertices[0].x,o.vertices[0].y),a.closePath()}l.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb"):(a.fillStyle=o.render.fillStyle,a.lineWidth=o.render.lineWidth,a.strokeStyle=o.render.strokeStyle,a.fill()),a.stroke()}a.globalAlpha=1}},n.bodyWireframes=function(e,t,n){var i,o,s,r,a,l=n,c=e.options.showInternalEdges;for(l.beginPath(),s=0;s<t.length;s++)if(i=t[s],i.render.visible)for(a=i.parts.length>1?1:0;a<i.parts.length;a++){for(o=i.parts[a],l.moveTo(o.vertices[0].x,o.vertices[0].y),r=1;r<o.vertices.length;r++)!o.vertices[r-1].isInternal||c?l.lineTo(o.vertices[r].x,o.vertices[r].y):l.moveTo(o.vertices[r].x,o.vertices[r].y),o.vertices[r].isInternal&&!c&&l.moveTo(o.vertices[(r+1)%o.vertices.length].x,o.vertices[(r+1)%o.vertices.length].y);l.lineTo(o.vertices[0].x,o.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},n.bodyConvexHulls=function(e,t,n){var i,o,s,r=n;for(r.beginPath(),o=0;o<t.length;o++)if(i=t[o],i.render.visible&&1!==i.parts.length){for(r.moveTo(i.vertices[0].x,i.vertices[0].y),s=1;s<i.vertices.length;s++)r.lineTo(i.vertices[s].x,i.vertices[s].y);r.lineTo(i.vertices[0].x,i.vertices[0].y)}r.lineWidth=1,r.strokeStyle="rgba(255,255,255,0.2)",r.stroke()},n.vertexNumbers=function(e,t,n){var i,o,s,r=n;for(i=0;i<t.length;i++){var a=t[i].parts;for(s=a.length>1?1:0;s<a.length;s++){var l=a[s];for(o=0;o<l.vertices.length;o++)r.fillStyle="rgba(255,255,255,0.2)",r.fillText(i+"_"+o,l.position.x+.8*(l.vertices[o].x-l.position.x),l.position.y+.8*(l.vertices[o].y-l.position.y))}}},n.mousePosition=function(e,t,n){var i=n;i.fillStyle="rgba(255,255,255,0.8)",i.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)},n.bodyBounds=function(e,t,n){var i=n,o=(e.engine,e.options);i.beginPath();for(var s=0;s<t.length;s++){var r=t[s];if(r.render.visible)for(var a=t[s].parts,l=a.length>1?1:0;l<a.length;l++){var c=a[l];i.rect(c.bounds.min.x,c.bounds.min.y,c.bounds.max.x-c.bounds.min.x,c.bounds.max.y-c.bounds.min.y)}}i.strokeStyle=o.wireframes?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.1)",i.lineWidth=1,i.stroke()},n.bodyAxes=function(e,t,n){var i,o,s,r,a=n,l=(e.engine,e.options);for(a.beginPath(),o=0;o<t.length;o++){var c=t[o],u=c.parts;if(c.render.visible)if(l.showAxes)for(s=u.length>1?1:0;s<u.length;s++)for(i=u[s],r=0;r<i.axes.length;r++){var h=i.axes[r];a.moveTo(i.position.x,i.position.y),a.lineTo(i.position.x+20*h.x,i.position.y+20*h.y)}else for(s=u.length>1?1:0;s<u.length;s++)for(i=u[s],r=0;r<i.axes.length;r++)a.moveTo(i.position.x,i.position.y),a.lineTo((i.vertices[0].x+i.vertices[i.vertices.length-1].x)/2,(i.vertices[0].y+i.vertices[i.vertices.length-1].y)/2)}l.wireframes?a.strokeStyle="indianred":(a.strokeStyle="rgba(0,0,0,0.8)",a.globalCompositeOperation="overlay"),a.lineWidth=1,a.stroke(),a.globalCompositeOperation="source-over"},n.bodyPositions=function(e,t,n){var i,o,s,r,a=n,l=(e.engine,e.options);for(a.beginPath(),s=0;s<t.length;s++)if(i=t[s],i.render.visible)for(r=0;r<i.parts.length;r++)o=i.parts[r],a.arc(o.position.x,o.position.y,3,0,2*Math.PI,!1),a.closePath();for(a.fillStyle=l.wireframes?"indianred":"rgba(0,0,0,0.5)",a.fill(),a.beginPath(),s=0;s<t.length;s++)i=t[s],i.render.visible&&(a.arc(i.positionPrev.x,i.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},n.bodyVelocity=function(e,t,n){var i=n;i.beginPath();for(var o=0;o<t.length;o++){var s=t[o];s.render.visible&&(i.moveTo(s.position.x,s.position.y),i.lineTo(s.position.x+2*(s.position.x-s.positionPrev.x),s.position.y+2*(s.position.y-s.positionPrev.y)))}i.lineWidth=3,i.strokeStyle="cornflowerblue",i.stroke()},n.bodyIds=function(e,t,n){var i,o,s=n;for(i=0;i<t.length;i++)if(t[i].render.visible){var r=t[i].parts;for(o=r.length>1?1:0;o<r.length;o++){var a=r[o];s.font="12px Arial",s.fillStyle="rgba(255,255,255,0.5)",s.fillText(a.id,a.position.x+10,a.position.y-10)}}},n.collisions=function(e,t,n){var i,o,s,r,a=n,l=e.options;for(a.beginPath(),s=0;s<t.length;s++)if(i=t[s],i.isActive)for(o=i.collision,r=0;r<i.activeContacts.length;r++){var c=i.activeContacts[r],u=c.vertex;a.rect(u.x-1.5,u.y-1.5,3.5,3.5)}for(a.fillStyle=l.wireframes?"rgba(255,255,255,0.7)":"orange",a.fill(),a.beginPath(),s=0;s<t.length;s++)if(i=t[s],i.isActive&&(o=i.collision,i.activeContacts.length>0)){var h=i.activeContacts[0].vertex.x,d=i.activeContacts[0].vertex.y;2===i.activeContacts.length&&(h=(i.activeContacts[0].vertex.x+i.activeContacts[1].vertex.x)/2,d=(i.activeContacts[0].vertex.y+i.activeContacts[1].vertex.y)/2),o.bodyB===o.supports[0].body||o.bodyA.isStatic===!0?a.moveTo(h-8*o.normal.x,d-8*o.normal.y):a.moveTo(h+8*o.normal.x,d+8*o.normal.y),a.lineTo(h,d)}a.strokeStyle=l.wireframes?"rgba(255,165,0,0.7)":"orange",a.lineWidth=1,a.stroke()},n.separations=function(e,t,n){var i,o,s,r,a,l=n,c=e.options;for(l.beginPath(),a=0;a<t.length;a++)if(i=t[a],i.isActive){o=i.collision,s=o.bodyA,r=o.bodyB;var u=1;r.isStatic||s.isStatic||(u=.5),r.isStatic&&(u=0),l.moveTo(r.position.x,r.position.y),l.lineTo(r.position.x-o.penetration.x*u,r.position.y-o.penetration.y*u),u=1,r.isStatic||s.isStatic||(u=.5),s.isStatic&&(u=0),l.moveTo(s.position.x,s.position.y),l.lineTo(s.position.x+o.penetration.x*u,s.position.y+o.penetration.y*u)}l.strokeStyle=c.wireframes?"rgba(255,165,0,0.5)":"orange",l.stroke()},n.grid=function(e,t,n){var o=n,s=e.options;o.strokeStyle=s.wireframes?"rgba(255,180,0,0.1)":"rgba(255,180,0,0.5)",o.beginPath();for(var r=i.keys(t.buckets),a=0;a<r.length;a++){var l=r[a];if(!(t.buckets[l].length<2)){var c=l.split(",");o.rect(.5+parseInt(c[0],10)*t.bucketWidth,.5+parseInt(c[1],10)*t.bucketHeight,t.bucketWidth,t.bucketHeight)}}o.lineWidth=1,o.stroke()},n.inspector=function(e,t){var n,i=(e.engine,e.selected),o=e.render,s=o.options;if(s.hasBounds){var r=o.bounds.max.x-o.bounds.min.x,a=o.bounds.max.y-o.bounds.min.y,l=r/o.options.width,c=a/o.options.height;t.scale(1/l,1/c),t.translate(-o.bounds.min.x,-o.bounds.min.y)}for(var u=0;u<i.length;u++){var h=i[u].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),h.type){case"body":n=h.bounds,t.beginPath(),t.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var d=h.pointA;h.bodyA&&(d=h.pointB),t.beginPath(),t.arc(d.x,d.y,10,0,2*Math.PI),t.closePath(),t.stroke()}t.setLineDash([]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",n=e.selectBounds,t.beginPath(),t.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),s.hasBounds&&t.setTransform(1,0,0,1,0,0)};var c=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},u=function(e){var t=e.getContext("2d"),n=window.devicePixelRatio||1,i=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return n/i},h=function(e,t){var n=e.textures[t];return n?n:(n=e.textures[t]=new Image,n.src=t,n)},d=function(e,t){var n=t;/(jpg|gif|png)$/.test(t)&&(n="url("+t+")"),e.canvas.style.background=n,e.canvas.style.backgroundSize="contain",e.currentBackground=t}}()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":24,"../geometry/Vector":26}],30:[function(e,t){var n={};t.exports=n;var i=e("../body/Composite"),o=e("../core/Common");!function(){var e,t;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(o.now())},1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n.create=function(e){o.log("RenderPixi.create: Matter.RenderPixi is deprecated (see docs)","warn");var t={controller:n,engine:null,element:null,frameRequestId:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},i=o.extend(t,e),s=!i.options.wireframes&&"transparent"===i.options.background;return i.pixiOptions=i.pixiOptions||{view:i.canvas,transparent:s,antialias:!0,backgroundColor:e.background},i.mouse=e.mouse,i.engine=e.engine,i.renderer=i.renderer||new PIXI.WebGLRenderer(i.options.width,i.options.height,i.pixiOptions),i.container=i.container||new PIXI.Container,i.spriteContainer=i.spriteContainer||new PIXI.Container,i.canvas=i.canvas||i.renderer.view,i.bounds=i.bounds||{min:{x:0,y:0},max:{x:i.options.width,y:i.options.height}},i.textures={},i.sprites={},i.primitives={},i.container.addChild(i.spriteContainer),o.isElement(i.element)?i.element.appendChild(i.canvas):o.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn"),i.canvas.oncontextmenu=function(){return!1},i.canvas.onselectstart=function(){return!1},i},n.run=function(t){!function i(){t.frameRequestId=e(i),n.world(t)}()},n.stop=function(e){t(e.frameRequestId)},n.clear=function(e){for(var t=e.container,n=e.spriteContainer;t.children[0];)t.removeChild(t.children[0]);for(;n.children[0];)n.removeChild(n.children[0]);var i=e.sprites["bg-0"];e.textures={},e.sprites={},e.primitives={},e.sprites["bg-0"]=i,i&&t.addChildAt(i,0),e.container.addChild(e.spriteContainer),e.currentBackground=null,t.scale.set(1,1),t.position.set(0,0)},n.setBackground=function(e,t){if(e.currentBackground!==t){var n=t.indexOf&&-1!==t.indexOf("#"),i=e.sprites["bg-0"];if(n){var s=o.colorToNumber(t);e.renderer.backgroundColor=s,i&&e.container.removeChild(i)}else if(!i){var r=a(e,t);i=e.sprites["bg-0"]=new PIXI.Sprite(r),i.position.x=0,i.position.y=0,e.container.addChildAt(i,0)}e.currentBackground=t}},n.world=function(e){var t,o=e.engine,s=o.world,r=e.renderer,a=e.container,l=e.options,c=i.allBodies(s),u=i.allConstraints(s),h=[];l.wireframes?n.setBackground(e,l.wireframeBackground):n.setBackground(e,l.background);var d=e.bounds.max.x-e.bounds.min.x,f=e.bounds.max.y-e.bounds.min.y,p=d/e.options.width,_=f/e.options.height;if(l.hasBounds){for(t=0;t<c.length;t++){var y=c[t];y.render.sprite.visible=Bounds.overlaps(y.bounds,e.bounds)}for(t=0;t<u.length;t++){var m=u[t],g=m.bodyA,v=m.bodyB,x=m.pointA,b=m.pointB;g&&(x=Vector.add(g.position,m.pointA)),v&&(b=Vector.add(v.position,m.pointB)),x&&b&&(Bounds.contains(e.bounds,x)||Bounds.contains(e.bounds,b))&&h.push(m)}a.scale.set(1/p,1/_),a.position.set(-e.bounds.min.x*(1/p),-e.bounds.min.y*(1/_))}else h=u;for(t=0;t<c.length;t++)n.body(e,c[t]);for(t=0;t<h.length;t++)n.constraint(e,h[t]);r.render(a)},n.constraint=function(e,t){var n=(e.engine,t.bodyA),i=t.bodyB,s=t.pointA,r=t.pointB,a=e.container,l=t.render,c="c-"+t.id,u=e.primitives[c];return u||(u=e.primitives[c]=new PIXI.Graphics),l.visible&&t.pointA&&t.pointB?(-1===o.indexOf(a.children,u)&&a.addChild(u),u.clear(),u.beginFill(0,0),u.lineStyle(l.lineWidth,o.colorToNumber(l.strokeStyle),1),n?u.moveTo(n.position.x+s.x,n.position.y+s.y):u.moveTo(s.x,s.y),i?u.lineTo(i.position.x+r.x,i.position.y+r.y):u.lineTo(r.x,r.y),void u.endFill()):void u.clear()},n.body=function(e,t){var n=(e.engine,t.render);if(n.visible)if(n.sprite&&n.sprite.texture){var i="b-"+t.id,a=e.sprites[i],l=e.spriteContainer;a||(a=e.sprites[i]=s(e,t)),-1===o.indexOf(l.children,a)&&l.addChild(a),a.position.x=t.position.x,a.position.y=t.position.y,a.rotation=t.angle,a.scale.x=n.sprite.xScale||1,a.scale.y=n.sprite.yScale||1}else{var c="b-"+t.id,u=e.primitives[c],h=e.container;u||(u=e.primitives[c]=r(e,t),u.initialAngle=t.angle),-1===o.indexOf(h.children,u)&&h.addChild(u),u.position.x=t.position.x,u.position.y=t.position.y,u.rotation=t.angle-u.initialAngle}};var s=function(e,t){var n=t.render,i=n.sprite.texture,o=a(e,i),s=new PIXI.Sprite(o);return s.anchor.x=t.render.sprite.xOffset,s.anchor.y=t.render.sprite.yOffset,s},r=function(e,t){var n,i=t.render,s=e.options,r=new PIXI.Graphics,a=o.colorToNumber(i.fillStyle),l=o.colorToNumber(i.strokeStyle),c=o.colorToNumber(i.strokeStyle),u=o.colorToNumber("#bbb"),h=o.colorToNumber("#CD5C5C");r.clear();for(var d=t.parts.length>1?1:0;d<t.parts.length;d++){n=t.parts[d],s.wireframes?(r.beginFill(0,0),r.lineStyle(1,u,1)):(r.beginFill(a,1),r.lineStyle(i.lineWidth,l,1)),r.moveTo(n.vertices[0].x-t.position.x,n.vertices[0].y-t.position.y);for(var f=1;f<n.vertices.length;f++)r.lineTo(n.vertices[f].x-t.position.x,n.vertices[f].y-t.position.y);r.lineTo(n.vertices[0].x-t.position.x,n.vertices[0].y-t.position.y),r.endFill(),(s.showAngleIndicator||s.showAxes)&&(r.beginFill(0,0),s.wireframes?r.lineStyle(1,h,1):r.lineStyle(1,c),r.moveTo(n.position.x-t.position.x,n.position.y-t.position.y),r.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2-t.position.x,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2-t.position.y),r.endFill())}return r},a=function(e,t){var n=e.textures[t];return n||(n=e.textures[t]=PIXI.Texture.fromImage(t)),n}}()},{"../body/Composite":2,"../core/Common":14}]},{},[28])(28)}),soya2d.module.install("physics",{onInit:function(e){var t;e.physics.setup({onStart:function(n){t=Matter.Engine.create(),t.world.gravity.x=n.gravity[0],t.world.gravity.y=n.gravity[1],t.enableSleeping=n.enableSleeping,Matter.Events.on(t,"collisionStart collisionEnd",function(t){for(var n=t.pairs,i=0;i<n.length;i++){var o=n[i];e.physics.emit(t.name,o.bodyA.__sprite,o.bodyB.__sprite),o.bodyA.__sprite.emit(t.name,o.bodyB.__sprite),o.bodyB.__sprite.emit(t.name,o.bodyA.__sprite)}})},onUpdate:function(){Matter.Engine.update(t,0,1);for(var e=t.world.bodies,n=e.length;n--;){var i=e[n],o=i.__sprite;i.isStatic||(o.__x=i.position.x,o.__y=i.position.y,o.angle=i.angle*soya2d.Math.ONEANG)}},onUnbind:function(e){Matter.World.remove(t.world,e)},onBind:function(e){var n,i={angle:e.angle*soya2d.Math.ONERAD,position:{x:e.x,y:e.y}};if(e.bounds instanceof soya2d.Rectangle)n=Matter.Bodies.rectangle(e.x,e.y,e.w,e.h,i);else if(e.bounds instanceof soya2d.Circle)n=Matter.Bodies.circle(0,0,e.bounds.r,i);else if(e.bounds instanceof soya2d.Polygon){var o=e.bounds.vtx,s=Matter.Vertices.fromPath(o.join(","));n=Matter.Bodies.fromVertices(0,0,s,i)}return Matter.World.add(t.world,n),Matter.Events.on(n,"sleepStart sleepEnd",function(t){e.emit(t.name,this.isSleeping)}),n},body:{sensor:function(e,t){e.isSensor=t},moveTo:function(e,t,n){Matter.Body.setPosition(e,{x:t,y:n})},moveBy:function(e,t,n){Matter.Body.translate(e,{x:t,y:n})},"static":function(e,t){Matter.Body.setStatic(e,t)},mass:function(e,t){Matter.Body.setMass(e,t)},rotateBy:function(e,t){Matter.Body.rotate(e,t)},rotateTo:function(e,t){Matter.Body.setAngle(e,soya2d.Math.toRadian(t))},friction:function(e,t){e.friction=t},restitution:function(e,t){e.restitution=t},velocity:function(e,t,n){Matter.Body.setVelocity(e,{x:t,y:n})},inertia:function(e,t){Matter.Body.setInertia(e,t)}}})}}),L.prototype={get:function(e){return this.map[e]},add:function(e,t){return t.game=this.game,this.map[e]=new X(t),this.map[e]}};var z=soya2d.class("",{"extends":soya2d.DisplayObjectContainer,constructor:function(e,t){this.tilemap=e,this.w=e.w,this.h=e.h,this.tw=e.tilewidth,this.th=e.tileheight,this.cols=e.columns,this.data=t,this.range={row:[0,e.rows],col:[0,e.columns]},this.tilesets=e.tilesets},onUpdate:function(){var e=this.worldPosition.x-this.anchorPosition.x,t=this.worldPosition.y-this.anchorPosition.y;if(!(0>e||0>t||this.lastcx==this.game.camera.x&&this.lastcy==this.game.camera.y)){this.lastcy=this.game.camera.y,this.lastcx=this.game.camera.x;var n=this.game.camera.x,i=this.game.camera.y,o=this.game.camera.w,s=this.game.camera.h,r=n-e,a=i-t,l=Math.floor(r/this.tw),c=Math.floor(a/this.th),u=Math.floor(o/this.tw)+1,h=Math.floor(s/this.th)+1;this.range.col[0]=l,this.range.col[1]=l+u,this.range.row[0]=c,this.range.row[1]=c+h}},onRender:function(e){for(var t=this.range.row[0],n=this.range.row[1],i=this.range.col[0],o=this.range.col[1],s=t;n>s;s++)for(var r=i;o>r;r++){var a=this.data[s*this.cols+r],l=this.tilesets.set[a];l&&(e.map(l,r*this.tw,s*this.th,this.tw,this.th),this.tilemap.__debug&&(e.fillText(s*this.cols+r,r*this.tw+this.tw/2,s*this.th+this.th/2-10),e.fillText(s+","+r,r*this.tw+this.tw/2,s*this.th+this.th/2+10)))}}}),X=soya2d.class("",{"extends":s,__signalHandler:new r,constructor:function(e){this.tilewidth=e.tilewidth,this.tileheight=e.tileheight,this.rows=e.rows,this.columns=e.columns,this.layersData=e.layers,this.tilesetsData=e.tilesets,this.tilesets={},this.layers={},this.tiles={};for(var t=0,n=0;n<this.rows;n++)for(var i=0;i<this.columns;i++){var o=i*this.tilewidth,s=n*this.tileheight;this.tiles[t++]={x:o,y:s}}this.tileMatrix={};for(var n=0;n<this.rows;n++)for(var i=0;i<this.columns;i++){var o=i*this.tilewidth,s=n*this.tileheight;this.tileMatrix[n+"_"+i]={x:o,y:s}}this.w=this.tilewidth*this.columns,this.h=this.tileheight*this.rows,this.game=e.game,this.__blocks=[],this.__debug=!1,Object.defineProperty(this,"debug",{get:function(){return this.__debug},set:function(e){this.__debug=e,e&&this.__blocks.forEach(function(e){e.fillStyle="red",e.opacity=.5})}})},bindTileset:function(e,t){var n=this.tilesetsData[e],i=null;"string"==typeof t&&(i=this.game.assets.image(t));var o=new Y(i,n.sid,this.tilewidth,this.tileheight);return soya2d.ext(this.tilesets,o),this},createLayer:function(e,t,n){var i=this.layersData[e],o=n;return i&&(o=i.data),this.layers[e]=new z(this,o),t=t||this.game.world,t.add(this.layers[e]),this.layers[e]},resizeWorld:function(){this.game.world.setBounds(this.w,this.h)},setCollisionBetween:function(e,t){var n=this.tiles[e],i=this.tiles[t];if(n&&i){var o=i.x-n.x+this.tilewidth,s=i.y-n.y+this.tileheight,r=game.add.rect({w:o,h:s,x:n.x+o/2,y:n.y+s/2});return this.game.physics.enable(r),r.tilemap=this,r.on("collisionStart",D),r.body.static(!0).friction(0),this.__blocks.push(r),this}},setCollision:function(e,t){var n=this.tileMatrix[e+"_"+t];if(n){var i=this.tilewidth,o=this.tileheight,s=game.add.rect({w:i,h:o,x:n.x+i/2,y:n.y+o/2});return this.game.physics.enable(s),s.tilemap=this,s.on("collisionStart",D),s.body.static(!0).friction(0),this.__blocks.push(s),this}},setCollisionZone:function(e,t,n,i){var o=this.tileMatrix[e+"_"+t],s=this.tileMatrix[n+"_"+i];if(o&&s){var r=s.x-o.x+this.tilewidth,a=s.y-o.y+this.tileheight,l=game.add.rect({w:r,h:a,x:o.x+r/2,y:o.y+a/2});return l.tilemap=this,l.on("collisionStart",D),this.game.physics.enable(l),l.body.static(!0).friction(0),this.__blocks.push(l),this}},getTile:function(e,t){return this.tileMatrix[e+"_"+t]}}),Y=soya2d.class("",{constructor:function(e,t,n,i){this.set={},this.index=t;for(var o=e.width/n,s=e.height/i,r=0;s>r;r++)for(var a=0;o>a;a++)this.__getTileImage(e,a*n,r*i,n,i)},__getTileImage:function(e,t,n,i,o){var s=document.createElement("canvas");s.width=i,s.height=o;var r=s.getContext("2d");r.translate(i/2,o/2),r.drawImage(e,t,n,i,o,-i/2>>0,-o/2>>0,i,o),this.set[this.index++]=s}});soya2d.module.install("tilemap",{onInit:function(e){e.tilemap=new L(e)}})}(window||this);