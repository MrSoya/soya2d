/*
 * Soya2D is a web interactive animation(game) engine for modern web browsers 
 *
 *
 * Copyright 2015-2017 MrSoya and other contributors
 * Released under the MIT license
 *
 * website: http://soya2d.com
 * last build: 2017-8-19
 */
!function(t){"use strict";function e(t,e,n){Object.defineProperties(this,{x:{set:function(t){this.__view.x=t,this.__checkBounds()},get:function(){return this.__view.x}},y:{set:function(t){this.__view.y=t,this.__checkBounds()},get:function(){return this.__view.y}},w:{get:function(){return this.__view.w}},h:{get:function(){return this.__view.h}}}),this.freezone=null,this.__view=new soya2d.Rectangle(0,0,t,e),this.__game=n}function n(t,e){if(t.__renderable){if(t.__fixedToCamera)return;if(!e.intersectWith(t.getBoundingBox()))return t.__renderable=!1,void 0;if(t.children)for(var i=t.children.length;i--;){var o=t.children[i];o.__renderable&&n(o,e)}}}function i(t,e,n){if(t.__renderable){var o=null,s=null;if(t.__fixedToCamera){var o=t.cameraOffset.x+t.anchorPosition.x,s=t.cameraOffset.y+t.anchorPosition.y;n=!0}else n?(o=t.parent.__screenPosition.x-t.parent.anchorPosition.x+t.x+t.anchorPosition.x,s=t.parent.__screenPosition.y-t.parent.anchorPosition.y+t.y+t.anchorPosition.y):(o=t.worldPosition.x,s=t.worldPosition.y,o-=e.x,s-=e.y);if(t.__screenPosition.set(o,s),t.children)for(var r=t.children.length;r--;){var a=t.children[r];a.__renderable&&i(a,e,n)}}}function o(){this.__assets={image:{},sound:{},imageFont:{},atlas:{},text:{},xml:{},json:{}}}function s(t,e,n,i,o){var s=new XMLHttpRequest;s.open("get",t,!0),s.timeout=e,s.ontimeout=n,s.onerror=i,null===s.onload?s.onload=function(){(0===s.status||s.status>=200&&s.status<300||304===s.status)&&o(s)}:s.onreadystatechange=function(){(0===s.status||(s.status>=200&&s.status<300||304===s.status)&&4===s.readyState)&&o(s)},s.send(null)}function r(t,e,n,i,o,s,a,l){setTimeout(function(){if((new Date).getTime()-t>e)return s(l),void 0;for(var c in n){n[c].style.left="-1000px";var h=n[c].offsetWidth,u=n[c].offsetHeight;if(h!==i[c]||u!==o[c])return a(l),void 0}r(t,e,n,i,o,s,a,l)},20)}function a(t,e){soya2d.ext(this,t),this.map={},this.game=e}function l(t,e,n,i){for(var o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];if(3!=s.nodeType){for(var r=s.tagName,a=s.attributes.id?s.attributes.id.value:null,u={},d=s.attributes,f=0;f<d.length;f++){var p=d[f].name;u[p]=d[f].value}i.objects.map[r].prototype.onBuild&&i.objects.map[r].prototype.onBuild(u,s,i);var _=h(r,u,i);c(u,_,t),a&&(t.map[a]=_),n.add(_),s.childNodes.length>0&&l(t,s,_,i)}}}function c(t,e,n){for(var i=Object.keys(t),o=i.length;o--;){var s=i[o],r=t[s];if(0===s.indexOf("on-")){var a=n[r];if(a instanceof Function){var l=s.replace(/-([\w])/gim,function(t,e){return e.toUpperCase()});e.events[l]&&e.events[l](a)}else soya2d.console.warn('invalid callback "'+r+'" of '+s)}}}function h(t,e,n){var i=new n.objects.map[t](e);return i}function u(t){this.map={},this.game=t}function d(t){this.exp=t,this.times=0,this.priority=0,this.milliseconds=0,this._lastTriggerMilliseconds=-1e3,this._t=[],this._reset=function(){this.times=0,this.milliseconds=0,this._lastTriggerMilliseconds=-1e3,this._t=[],delete this._frameInfo,delete this._timeInfo},this._canUnload=function(){var t=this._timeInfo.hour;if(1===t[2]){if(this._t[2]>t[0])return!0}else if(t[2]>1&&this._t[2]>t[3][t[3].length-1])return!0},this.canTrigger=function(){return p(this)},/^(\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+)) (\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+)) (\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+))$/.test(t)||soya2d.console.error("invalid timer expression -- "+t);var e=f(RegExp.$1),n=f(RegExp.$2),i=f(RegExp.$3);this._timeInfo={sec:e,min:n,hour:i}}function f(t){var e,n,i,o,s;if("*"==t)e=-1,n=0,i=-1;else if((n=parseInt(t))==t)i=1,e=0;else if(2===(s=t.split("/")).length){e=parseInt(s[1]);var r;if(2===(r=s[0].split("-")).length){o=[];for(var a=r[0]>>0,l=r[1]>>0;l>=a;a++)o.push(a);o.sort(function(t,e){return t-e}),i=o.length}else(n=parseInt(s[0]))||(n=0),i=-1}else if((s=t.split(",")).length>1){o=[];for(var e=s.length;e--;)o.push(s[e]>>0);o.sort(function(t,e){return t-e}),i=s.length}else if(2===(s=t.split("-")).length){o=[];for(var a=s[0]>>0,l=s[1]>>0;l>=a;a++)o.push(a);o.sort(function(t,e){return t-e}),i=o.length}return[e,n,i,o]}function p(t){var e=t.milliseconds/1e3,n=t._t[0]=e%60>>0,i=t._t[1]=e/60%60>>0,o=t._t[2]=e/60/60>>0;return _(t._timeInfo.hour,o)?_(t._timeInfo.min,i)?_(t._timeInfo.sec,n)?!0:!1:!1:!1}function _(t,e){if(1===t[2]){if(t[1]!==e)return!1}else if(-1===t[2]&&-1===t[0]);else if(t[3]&&!t[0]){if(t[3].indexOf(e)<0)return!1}else if(-1===t[2]&&t[0]>0||t[0]>0&&t[3]){if(t[3]&&t[3].indexOf(e)<0)return!1;var n=e-t[1];if(0>=n&&0!=t[1])return!1;if(n%t[0])return!1}return!0}function y(t){this.map={},this.game=t}function m(t){this.game=t,this.__newInstanceAndAppend=function(t,e){e.game=this.game;var n=new this.game.objects.map[t](e);return this.game.world.add(n),n}}function g(t,e){if(/^(-?\d+)%$/.test(t)){var n=parseFloat(RegExp.$1)/100;return b(e,n)}return t}function v(t,e){if(/^(-?\d+)%$/.test(t)){var n=parseFloat(RegExp.$1)/100;return w(e,n)}return t}function x(t,e){if(!isNaN(t))return parseFloat(t);var n=e,i=0;return/^(-?\d+)%$/.test(t)&&(i=parseFloat(RegExp.$1)/100),n*i}function b(t,e){var n=t.w;return 0===n&&t.parent?b(t.parent,e):n*e}function w(t,e){var n=t.h;return 0===n&&t.parent?w(t.parent,e):n*e}function S(t,e,n){for(var i=t.children.length;i--;){var o=t.children[i];e(o)&&n.push(o),o.children&&o.children.length>0&&S(o,e,n)}}function A(t){if(t.transform(),t.__renderable=!0,t.children)for(var e=t.children.length;e--;){var n=t.children[e];n.visible&&A(n)}}function T(t,e,n){for(var i=t.length;i--;){var o=t[i];o._onUpdate&&o._onUpdate(e,n),o.onUpdate&&o.onUpdate(e,n),o.children&&o.children.length>0&&T(o.children,e,n)}}function M(t,e,n){for(var i=t.length;i--;){var o=t[i];o._onPostUpdate&&o._onPostUpdate(e,n),o.onPostUpdate&&o.onPostUpdate(e,n),o.children&&o.children.length>0&&M(o.children,e,n)}}function C(t,e,n,i,o){var s;switch(e){case soya2d.ROTATEMODE_90:s="rotate(90deg)";break;case soya2d.ROTATEMODE_180:s="rotate(180deg)";break;case soya2d.ROTATEMODE_270:s="rotate(270deg)";break;case soya2d.ROTATEMODE_0:default:s="rotate(0deg)",o.__rotat=soya2d.ROTATEMODE_0}if(n.style.transform=n.style.webkitTransform=n.style.mozTransform=n.style.msTransform=n.style.oTransform=s,n.style.left=n.style.top=0,e===soya2d.ROTATEMODE_90||e===soya2d.ROTATEMODE_270){var r=n.offsetWidth,a=n.offsetHeight;if(t===soya2d.SCALEMODE_NOBORDER){var l=this.game.w,c=this.game.h;r=r>c?c:r,a=a>l?l:a}if(i.resize(a,r),t===soya2d.SCALEMODE_EXACTFIT){var h=(r-a)/2;h=a%2===0?h:Math.floor(h);var u=(a-r)/2;u=r%2===0?u:Math.floor(u),n.style.left=h+"px",n.style.top=u+"px"}}}function E(){var t,e=window.innerWidth,n=window.innerHeight;return t=e>n?"landscape":"portrait"}function k(t,e,n,i,o,s,r,a){n=r&&n>r?r:n,i=a&&i>a?a:i;var l=Math.max(n/t,i/e),c=t*l,h=e*l;return[c,h]}function I(t,e,n,i,o,s,r,a){n=r&&n>r?r:n,i=a&&i>a?a:i;var l=1;(t>n||e>i)&&(l=Math.min(n/t,i/e));var c=t*l,h=e*l;return[c,h]}function P(t,e,n,i,o,s,r,a){var l,c;return l=o&&o>n?o:r&&n>r?r:n,c=s&&s>i?s:a&&i>a?a:i,[l,c]}function O(t,e,n){this.frames=t,this.index=0,this.lastUpdateTime=0,this.frameRate=e||10,this.loop=n===!1?!1:n||!0}function B(t){this.obj=t,this.onPointerDown=function(t){X.on("pointerdown",t,this.obj)},this.onPointerTap=function(t){X.on("pointertap",t,this.obj)},this.onPointerDblTap=function(t){X.on("pointerdbltap",t,this.obj)},this.onPointerUp=function(t){X.on("pointerup",t,this.obj)},this.onPointerMove=function(t){X.on("pointermove",t,this.obj)},this.onPointerOver=function(t){X.on("pointerover",t,this.obj)},this.onPointerOut=function(t){X.on("pointerout",t,this.obj)},this.onPointerCancel=function(t){X.on("pointercancel",t,this.obj)},this.onKeyDown=function(t){X.on("keydown",t,this.obj)},this.onKeyPress=function(t){X.on("keypress",t,this.obj)},this.onKeyUp=function(t){X.on("keyup",t,this.obj)},this.onDeviceHov=function(t){X.on("hov",t,this.obj)},this.onDeviceTilt=function(t){X.on("tilt",t,this.obj)},this.onDeviceMotion=function(t){X.on("motion",t,this.obj)},this.onCollisionStart=function(t){X.on("collisionstart",t,this.obj)},this.onCollisionEnd=function(t){X.on("collisionend",t,this.obj)}}function R(t){this.eventMap={},soya2d.ext(this,t)}function D(t){this.map={},this.game=t}function L(t,e){var n,i,o=t.w,s=t.h,r=(e.w,e.h),a=e.body.rigid.speed,l=1,c=t.x-t.w/2,h=t.y-t.h/2,u=e.x-e.w/2,d=e.y-e.h/2;u>=c?(n="center",u+a+l>=c+o&&(n="right")):n="left",d>=h?(i="middle",d>h+s&&(i="bottom")):i="top";var f;switch(i){case"top":if(d+r>h)switch(n){case"left":f="left";break;case"right":f="right";break;case"center":f="top"}else f="top";break;case"bottom":f="bottom";break;case"middle":switch(n){case"left":f="left";break;case"right":f="right"}}this.tilemap.emit("tileCollision",e,{direction:f,x:this.x,y:this.y})}t.soya2d=new function(){function t(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype}this.__roIndex=0,this.version={v:[2,0,0],state:"beta3",toString:function(){return soya2d.version.v.join(".")+" "+soya2d.version.state}},this.website="http://soya2d.com",this.ext=function(t,e,n){for(var i=Object.keys(e),o=i.length;o--;){var s=i[o];(!t.hasOwnProperty(s)||n)&&(t[s]=e[s])}},this.class=function(e,n){var i=n.constructor,o=n.extends,s=function(){o&&o.apply(this,arguments),i&&i.apply(this,arguments)};o&&t(s,o);for(var r in n)"extends"!==r&&"constructor"!==r&&(s.prototype[r]=n[r]);if(e){var a=e.split("."),l=a[a.length-1],c=self;if(a.length>1)for(var h=0;h<a.length;h++)a[h]!==l&&(c=c[a[h]],c||(c={}));c[l]=s,s.prototype.class=e}return s},this.module=new function(){var t={};this.install=function(e,n){t[e]=n},this._getAll=function(){return t}},this.render=function(t,e,n,i){var o=new soya2d.Game({w:e,h:n,container:t});return o.start(),o.scene.start(i),o}},t.soya=soya2d,self.Int8Array=self.Int8Array||Array,self.Uint8Array=self.Uint8Array||Array,self.Int16Array=self.Int16Array||Array,self.Uint16Array=self.Uint16Array||Array,self.Int32Array=self.Int32Array||Array,self.Uint32Array=self.Uint32Array||Array,self.Float32Array=self.Float32Array||Array,self.console=self.console||new function(){this.log=function(){},this.info=function(){},this.debug=function(){},this.error=function(){},this.warn=function(){}},soya2d.console=new function(){var t=1;this.level=function(e){t=0==e?0:e||1},this.debug=function(e,n){1==t&&(soya2d.Device.ie?console.debug(e):console.debug("%c"+e,n||"padding:1px 50px;font-size:14px;color:#fff;background:#0069D6;"))},this.info=function(e,n){1>t||t>2||(soya2d.Device.ie?console.log(e):console.log("%c"+e,n||"padding:1px 50px;font-size:14px;color:#fff;background:#2DB008;"))},this.warn=function(e,n){1>t||t>3||(soya2d.Device.ie?console.warn(e):console.warn("%c"+e,n||"padding:1px 50px;font-size:14px;color:#fff;background:#FFB502;"))},this.error=function(e,n){1>t||(soya2d.Device.ie?console.error(e):console.error("%c"+e,n||"padding:1px 50px;font-size:14px;color:#fff;background:#ff0000;"))}},self.cancelAFrame=function(t){return t.cancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.clearTimeout}(self),self.requestAFrame=function(t){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||function(e){return t.setTimeout(function(){e(Date.now())},16.7)}}(self),soya2d.BLEND_NORMAL="source-over",soya2d.BLEND_LIGHTER="lighter",soya2d.BLEND_MASK="destination-in",soya2d.BLEND_CLEAR="destination-out",soya2d.LINECAP_BUTT="butt",soya2d.LINECAP_ROUND="round",soya2d.LINECAP_SQUARE="square",soya2d.LINEJOIN_BEVEL="bevel",soya2d.LINEJOIN_ROUND="round",soya2d.LINEJOIN_MITER="miter",soya2d.TEXTALIGN_LEFT="left",soya2d.TEXTALIGN_CENTER="center",soya2d.TEXTALIGN_RIGHT="right",soya2d.TEXTVALIGN_TOP="hanging",soya2d.TEXTVALIGN_MIDDLE="middle",soya2d.TEXTVALIGN_BOTTOM="alphabetic",soya2d.TEXTDIR_LTR="ltr",soya2d.TEXTDIR_RTL="rtl",soya2d.GRADIENT_LINEAR=1,soya2d.GRADIENT_RADIAL=2,e.prototype={follow:function(t){var e=this.__game.world.find(function(e){return t.roid===e.roid?!0:void 0},!0);e.length<0&&soya2d.console.error("camera: "+t.toString()+" must be a child node of game.world"),this.target=t},unfollow:function(){this.target=null},moveTo:function(t,e){this.target||(this.__view.x=t,this.__view.y=e,this.__checkBounds())},moveBy:function(t,e){this.target||(this.__view.x+=t,this.__view.y+=e,this.__checkBounds())},reset:function(){this.__view.x=this.__view.y=0},__checkBounds:function(){var t=this.__game.world.bounds,e=t.x,n=t.y,i=t.w,o=t.h,s=this.__view.x;e>s&&(this.__view.x=e),i>0&&s+this.__view.w>i&&(this.__view.x=i-this.__view.w);var r=this.__view.y;n>r&&(this.__view.y=n),o>0&&r+this.__view.h>o&&(this.__view.y=o-this.__view.h)},setFreezone:function(t){t&&(this.freezone=t)},__onUpdate:function(){if(this.target&&this.target.game){var t,e,n=this.target.worldPosition;t=n.x,e=n.y;{var i=this.target.w,o=this.target.h;t-this.__view.x,e-this.__view.y}if(this.freezone){var s=this.freezone.x,r=this.freezone.y,a=this.freezone.w,l=this.freezone.h,c=this.__view.x+s,h=this.__view.y+r,u=this.__view.x+s+a,d=this.__view.y+r+l,f=i/2,p=o/2;c>t-f?this.__view.x=t-s-f:t+f>u&&(this.__view.x=t-a-s+f),h>e-p?this.__view.y=e-r-p:e+p>d&&(this.__view.y=e-l-r+p)}else this.__view.x=t-this.__view.w/2,this.__view.y=e-this.__view.h/2;this.__checkBounds()}},__cull:function(t){for(var e=t.children,i=e.length;i--;)n(e[i],this.__view)},__viewport:function(t){for(var e=t.children,n=e.length;n--;)i(e[n],this.__view)}},soya2d.Math={PI:3.141592654,PIM2:6.283185307,PID2:1.570796327,PID4:.785398163,ONERAD:.017453292,ONEANG:57.295779513,toRadian:function(t){return t*this.ONERAD},toAngle:function(t){return t*this.ONEANG},randomf:function(t,e){return t+Math.random()*(e-t)},randomi:function(t,e){return t+Math.random()*(e-t)>>0},round:function(t){return.5+t>>0},floor:function(t){return 0|t},len2D:function(t,e,n,i){return Math.sqrt((i-e)*(i-e)+(n-t)*(n-t))},len2Df:function(t,e){t=Math.abs(t),e=Math.abs(e);var n=Math.min(t,e);return t+e-(n>>1)-(n>>2)+(n>>4)},SINTABLE:function(){for(var t=new Float32Array(361),e=.017453292,n=0;360>=n;n++){var i=n*e,o=Math.sin(i);t[n]=o}return t}(),COSTABLE:function(){for(var t=new Float32Array(361),e=.017453292,n=0;360>=n;n++){var i=n*e,o=Math.cos(i);t[n]=o}return t}()},o.prototype={image:function(t){return this.__assets.image[t]},sound:function(t){return this.__assets.sound[t]},imageFont:function(t){return this.__assets.imageFont[t]},atlas:function(t){return this.__assets.atlas[t]},text:function(t){return this.__assets.text[t]},xml:function(t){return this.__assets.xml[t]},json:function(t){return this.__assets.json[t]}},soya2d.Atlas=function(t,e){this.texs={},e.forEach(function(e){var n=document.createElement("canvas");n.width=e.w,n.height=e.h;var i=n.getContext("2d");i.translate(e.w/2,e.h/2),i.rotate((e.r||0)*Math.PI/180);var o=e.w>>0,s=e.h>>0;return 0===o||0===s?(soya2d.console.error("soya2d.Atlas: invalid ssheet unitï¼Œw/h must be a positive;[w:"+o+",h:"+s+"] "),void 0):(i.drawImage(t,e.x>>0,e.y>>0,o,s,-o/2>>0,-s/2>>0,o,s),this.texs[e.n]=n,void 0)},this)},soya2d.Atlas.prototype={getAll:function(t){var e=[];for(var n in this.texs)(!t||"*"===t||t&&0===n.indexOf(t))&&e.push(this.texs[n]);return e},getByIndex:function(t,e){for(var n=[],i=Object.keys(this.texs),o=t;e>=o;o++){var s=this.texs[i[o]];n.push(s)}return n},get:function(t){return this.texs[t]},destroy:function(){this.texs=null}};var F=soya2d.Signal=function(){this.__sigmap={}};soya2d.Signal.prototype={on:function(t,e,n){for(var i=t.replace(/\s+/gm," ").split(" "),o=i.length;o--;){var s=this.__sigmap[i[o]];s||(s=this.__sigmap[i[o]]=[]),s.push([e,n||this])}return this},once:function(t,e,n){for(var i=t.replace(/\s+/gm," ").split(" "),o=i.length;o--;){var s=this.__sigmap[i[o]];s||(s=this.__sigmap[i[o]]=[]),s.push([e,n||this,!0])}return this},off:function(t,e,n){var i=null;i=t?t.replace(/\s+/gm," ").split(" "):Object.keys(this.__sigmap);for(var o=i.length;o--;){var s=this.__sigmap[i[o]];if(s){for(var r=[],a=s.length;a--;)(n||this)!==s[a][1]||(e?s[a][0]!==e:0)||r.push(s[a]);r.forEach(function(t){var e=s.indexOf(t);s.splice(e,1)})}}return this},emit:function(){console.log(arguments[0]);var t=this.__sigmap[arguments[0]];if(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);t.filter(function(t){t[0].apply(t[1],e)});var i=t.filter(function(t){return t[2]?void 0:!0});return this.__sigmap[arguments[0]]=i,this}}};var N=soya2d.class("",{"extends":F,timeout:5e3,constructor:function(t){this.__assetsQueue=[],this.game=t,this.__assets=t.assets.__assets,this.baseUrl="";var e=!0;Object.defineProperties(this,{show:{set:function(t){e=t},get:function(){return e}},fillStyle:{set:function(t){this.__tip.fillStyle=t},get:function(){return this.__tip.fillStyle}}}),this.__logo=new soya2d.Shape({game:t,opacity:0,x:t.w/2-11,y:t.h/2-30-20,z:9999});var n=new soya2d.Shape({w:23,h:20,skewY:-30,game:t,fillStyle:"#69CA14",onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.rect(0,0,this.w,this.h),t.fill(),t.closePath()}}),i=new soya2d.Shape({game:t,w:23,h:20,skewY:30,y:13,opacity:.9,fillStyle:"#2A5909",onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.rect(0,0,this.w,this.h),t.fill(),t.closePath()}}),o=new soya2d.Shape({game:t,w:23,h:20,skewY:-30,y:28,blendMode:soya2d.BLEND_LIGHTER,fillStyle:"#69CA14",onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.rect(0,0,this.w,this.h),t.fill(),t.closePath()}}),s=new soya2d.Font("normal 400 23px/normal Arial,Helvetica,sans-serif");this.__tip=new soya2d.Text({game:t,x:-70,y:70,font:s,text:"Loading... 0/0",w:200,fillStyle:"#000"}),this.__logo.add(n,i,o,this.__tip),t.world.add(this.__logo)},__addToAssets:function(t,e){for(var n in e)this.__assetsQueue.push({type:t,k:n,data:e[n],baseUrl:this.baseUrl})},image:function(t){var e=t;t instanceof Array&&(e={},t.forEach(function(t){var n=t.lastIndexOf("/")+1,i=t.lastIndexOf("."),o=t.substring(n,i);e[o]=t})),this.__addToAssets("image",e)},sound:function(t){this.__addToAssets("sound",t)},font:function(t){this.__addToAssets("font",t)},imageFont:function(t){this.__addToAssets("imageFont",t)},atlas:function(t){var e=t;if(4===arguments.length){e={};var n=arguments[0],i=arguments[1],o=arguments[2],s=arguments[3];e[n]=[i,o,s]}this.__addToAssets("atlas",e)},text:function(t){this.__addToAssets("text",t)},xml:function(t){this.__addToAssets("xml",t)},json:function(t){this.__addToAssets("json",t)},__loadImage:function(t,e,n){var i=new Image;void 0!==this.crossOrigin&&(i.crossOrigin=this.crossOrigin),i.path=e;i.onload=function(){n("load",this),this.onerror=null,this.onload=null},i.onerror=function(){n("error",this.path),this.onerror=null,this.onload=null},i.src=t+e,i.complete&&(n("load",i),i.onerror=null,i.onload=null)},__loadSound:function(t,e,n){for(var i=e instanceof Array?e:[e],o=i.length;o--;)i[o]=t+i[o];new Howl({src:i,onload:function(){var t=new soya2d.Sound;t.__handler=this,n("load",t)},onloaderror:function(t){var e=soya2d.MEDIA_ERR_DECODE;t&&(e=t.type),n("error",this._src,e)}})},__loadFont:function(t,e,n,i){for(var o=["serif","sans-serif"],s="border:none;position:absolute;top:-999px;left:-999px;font-size:100px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:",a={},l={},c={},h=o.length;h--;){var u=document.createElement("div");u.style.cssText=s+"'"+o[h]+"'",u.innerHTML=e,document.body.appendChild(u),c[o[h]]=u,a[o[h]]=u.offsetWidth,l[o[h]]=u.offsetHeight}var d=document.createElement("style");d.id="FontLoader_"+(new Date).getTime(),d.innerHTML="@font-face {font-family: '"+e+"';src: url("+t+n+")}",document.head.appendChild(d);for(var h in c)c[h].style.fontFamily=e+","+c[h].style.fontFamily;var f=(new Date).getTime(),p=this;setTimeout(function(){r(f,p.timeout,c,a,l,function(t){i("timeout",t)},function(t){i("load",t)},e)},100)},__loadAtlas:function(t,e,n,i){var o=this;this.__loadImage(t,n[0],function(s,r){if("load"===s)if("string"==typeof n[1]&&2===n.length)o.__getXhr(t,n[1],function(t,e){var n=e;if("load"===t){var o;try{o=new Function("return "+e.responseText)()}catch(s){o=s}n=new soya2d.Atlas(r,o)}i(t,n)});else{var a=n[1];if(n.length>2){a=[];for(var l=r.width,c=r.height,h=n[1],u=n[2],d=1,f=u;c>=f;f+=u)for(var p=h;l>=p;p+=h)a.push({n:e+"_"+d,x:p-h,y:f-u,w:h,h:u}),d++}var _=new soya2d.Atlas(r,a);i(s,_)}else i(s,r)})},__getXhr:function(t,e,n){s(t+e,this.timeout,function(){n("timeout",e)},function(){n("error",e)},function(t){n("load",t)})},__loadAssets:function(){var t=this;return this.__assetsQueue.length<1?(this.emit("end"),void 0):(this.__assetsQueue.forEach(function(e){switch(e.type){case"image":t.__loadImage(e.baseUrl,e.data,function(n,i){"load"===n&&(t.__assets.image[e.k]=i),t.__onLoad(n,i)});break;case"sound":if(!soya2d.Sound)return soya2d.console.warn("can't load sounds, module [sound] needs to be loaded"),void 0;t.__loadSound(e.baseUrl,e.data,function(n,i){"load"===n&&(t.__assets.sound[e.k]=i),t.__onLoad(n,i,arguments[2])});break;case"atlas":t.__loadAtlas(e.baseUrl,e.k,e.data,function(n,i){"load"===n&&(t.__assets.atlas[e.k]=i),t.__onLoad(n,i)});break;case"font":t.__loadFont(e.baseUrl,e.k,e.data,function(n,i){var o=i;"load"===n&&(o=(new soya2d.Font).family(i),t.__assets.imageFont[e.k]=o),t.__onLoad(n,o)});break;case"imageFont":t.__loadAtlas(e.baseUrl,e.k,e.data,function(n,i){var o=i;"load"===n&&(o=new soya2d.ImageFont(i),t.__assets.imageFont[e.k]=o),t.__onLoad(n,o)});break;case"text":t.__getXhr(e.baseUrl,e.data,function(n,i){var o=i;"load"===n&&(t.__assets.text[e.k]=i.responseText,o=i.responseText),t.__onLoad(n,o)});break;case"xml":t.__getXhr(e.baseUrl,e.data,function(n,i){var o=i;"load"===n&&(o=t.__assets.xml[e.k]=i.responseXML),t.__onLoad(n,o)});break;case"json":t.__getXhr(e.baseUrl,e.data,function(n,i){var o=i;if("load"===n){try{o=new Function("return "+i.responseText)()}catch(s){o=s}t.__assets.json[e.k]=o}t.__onLoad(n,o)})}}),void 0)},__onLoad:function(t,e){this.__tip.setText("Loading... "+ ++this.__index+"/"+this.__assetsQueue.length),"load"===t?this.emit(t,e,this.__index,this.__assetsQueue.length):this.emit(t,e,arguments[2]),this.__index==this.__assetsQueue.length&&(this.__assetsQueue=[],this.emit("end"),this.__logo.parent.remove(this.__logo),this.__logo.opacity=0)},start:function(){this.__index=0,this.show&&(this.__logo.parent||this.game.world.add(this.__logo),this.__logo.opacity=1),this.__loadAssets()}});soya2d.MEDIA_ERR_UNCERTAIN=-1,soya2d.MEDIA_ERR_ABORTED=1,soya2d.MEDIA_ERR_NETWORK=2,soya2d.MEDIA_ERR_DECODE=3,soya2d.MEDIA_ERR_SRC_NOT_SUPPORTED=4,soya2d.MEDIA_ERR_SRC_NOT_FORTHCOMING=101,a.prototype={setView:function(t){var e=t.childNodes[0];l(this,e,this.game.world,this.game)},findView:function(t){return this.map[t]}},u.prototype={start:function(t,e){var n=this.game;t="string"==typeof t?this.map[t]:new a(t,n),n.currentScene=t,e&&(n.world.clear(!0),n.world.off(),n.camera.reset()),t.onPreload?(t.onPreload(n),n.load.once("end",function(){n.currentScene.onInit&&setTimeout(function(){n.currentScene.onInit(n)},0)}),n.load.start()):t.onInit&&t.onInit(n);var i=soya2d.module._getAll();for(var o in i)i[o].onSceneChange&&i[o].onSceneChange(n,t);return this},add:function(t,e){return this.map[t]=new a(e,game),this.map[t]}};var V=soya2d.class("",{"extends":F,constructor:function(){this.triggerList=[],this.expMap={},this.threshold=1e3},on:function(t,e,n){var i=this;return t=t.replace(/\[(.*?)\]/gm,function(t,e){if(!i.expMap[e]){var n=new d(e);i.triggerList.push(n),i.expMap[e]=n}return e.replace(/\s+/gm,"_")}),this._super.on.call(this,t,e,n)},once:function(t,e,n){var i=this;return t=t.replace(/\[(.*?)\]/gm,function(t,e){if(!i.expMap[e]){var n=new d(e);i.triggerList.push(n),i.expMap[e]=n}return e.replace(/\s+/gm,"_")}),this._super.once.call(this,t,e,n)},off:function(t,e){var n=[];t=t.replace(/\[(.*?)\]/gm,function(t,e){return n.push(e),e.replace(/\s+/gm,"_")}),this._super.off.call(this,t,e),n.forEach(function(t){var e=this.__sigmap[t.replace(/\s+/gm,"_")];Object.keys(e).length<1&&(this.expMap[t]=null,this.__removeTrigger(t))},this)},__scan:function(t){for(var e=[],n=[],i=this.triggerList.length;i--;){var o=this.triggerList[i],s=this.__sigmap[o.exp.replace(/\s+/gm,"_")],r=!1;o.milliseconds+=t;var a=o.milliseconds-o._lastTriggerMilliseconds;o.canTrigger()&&a>=this.threshold&&(r=!0,o._lastTriggerMilliseconds=o.milliseconds),o._canUnload()&&e.push(o.exp),r&&(o.times++,s.forEach(function(t){t[3]&&n.push([o.exp,t[0]]),t[0].call(this,o.milliseconds,o.times,o._t)},this))}for(var i=e.length;i--;)this.__removeTrigger(e[i]);for(var i=n.length;i--;)this.off(n[i][0],n[i][1])},__removeTrigger:function(t){for(var e=this.triggerList.length;e--;){var n=this.triggerList[e];if(n.exp===t)break}this.triggerList.splice(e,1)}});soya2d.Circle=function(t,e,n){this.x=t||0,this.y=e||0,this.r=n||0},soya2d.Circle.prototype={toString:function(){return"{x:"+this.x+",y:"+this.y+",r:"+this.r+"}"},clone:function(){return new soya2d.Circle(this.x,this.y,this.r)},intersectWith:function(t){if(t instanceof soya2d.Circle&&t.r>0){if(soya2d.Math.len2Df(t.x-this.x,t.y-this.y)<=this.r+t.r)return!1}else if(t instanceof soya2d.Rectangle&&t.w>0&&t.h>0){var e=t.w/2,n=t.h/2,i=this.x-(t.x+e),o=this.y-(t.y+n);if(i>e+this.r||o>n+this.r)return!1;var s=Math.min(i,e),r=Math.max(s,-e),a=Math.min(o,n),l=Math.max(a,-n);return(r-i)*(r-i)+(l-o)*(l-o)<=this.r*this.r}return!0}},soya2d.Polygon=function(t){this.vtx=t},soya2d.Polygon.prototype={toString:function(){return this.vtx},clone:function(){return new soya2d.Polygon(this.vtx.concat())}},soya2d.Rectangle=function(t,e,n,i){this.x=t||0,this.y=e||0,this.w=n||0,this.h=i||0},soya2d.Rectangle.prototype={toString:function(){return"{x:"+this.x+",y:"+this.y+",w:"+this.w+",h:"+this.h+"}"},clone:function(){return new soya2d.Rectangle(this.x,this.y,this.w,this.h)},getRight:function(){return this.x+this.w},getBottom:function(){return this.y+this.h},contains:function(t,e){return t<this.x||t>this.x+this.w?!1:e<this.y||e>this.y+this.h?!1:!0},intersectWith:function(t){if(t instanceof soya2d.Rectangle&&t.w>0&&t.h>0){if(this.x>t.x+t.w||this.y>t.y+t.h)return!1;if(this.x+this.w<t.x||this.y+this.h<t.y)return!1}else if(t instanceof soya2d.Circle&&t.r>0)return t.intersectWith(this);return!0}},soya2d.Point=function(t,e){this.x=t||0,this.y=e||0},soya2d.Point.prototype={toString:function(){return"{x:"+this.x+",y:"+this.y+"}"},clone:function(){return new soya2d.Point(this.x,this.y)},set:function(t,e){return this.x=t,this.y=e,this}},soya2d.Matrix2x2=function(){this.e=new Float32Array(4),this.identity()},soya2d.Matrix2x2.prototype={toString:function(){return"["+this.e[0]+","+this.e[1]+","+this.e[2]+","+this.e[3]+"]"},set:function(t,e,n,i){var o=this.e;return o[0]=0==t?0:t||1,o[1]=e||0,o[2]=n||0,o[3]=0==i?0:i||1,this},clone:function(){return(new soya2d.Matrix2x2).set(this.e[0],this.e[1],this.e[2],this.e[3])},identity:function(){return this.set(1,0,0,1),this},mul:function(t){var e=this.e[0],n=this.e[1],i=this.e[2],o=this.e[3],s=t.e;return this.e[0]=s[0]*e+s[2]*n,this.e[1]=s[1]*e+s[3]*n,this.e[2]=s[0]*i+s[2]*o,this.e[3]=s[1]*i+s[3]*o,this},scale:function(t,e){return this.e[0]*=t,this.e[1]*=e,this.e[2]*=t,this.e[3]*=e,this},rotate:function(t){if(!t)return this;var e=soya2d.Math;t=0>t?360+t%360:t,t>360&&(t%=360);var n=this.e[0],i=this.e[1],o=this.e[2],s=this.e[3],r=e.SINTABLE[t],a=e.COSTABLE[t];return void 0===r&&(r=Math.sin(t*e.ONERAD),a=Math.cos(t*e.ONERAD)),this.e[0]=n*a+i*-r,this.e[1]=n*r+i*a,this.e[2]=o*a+s*-r,this.e[3]=o*r+s*a,this},skew:function(t,e){var n=this.e[0],i=this.e[1],o=this.e[2],s=this.e[3];if(t){var r;this.skewX===t&&this.sx?r=this.sx:(r=Math.tan(.017453292*t),this.sx=r),this.e[0]+=i*r,this.e[2]+=s*r}if(e){var a;this.skewY===t&&this.sy?a=this.sy:(a=Math.tan(.017453292*e),this.sy=a),this.e[1]+=n*a,this.e[3]+=o*a}return this}},soya2d.Vector=function(t,e){this.e=new Float32Array(2),this.e[0]=t||0,this.e[1]=e||0},soya2d.Vector.prototype={toString:function(){return"{x:"+this.e[0]+",y:"+this.e[1]+"}"},clone:function(){return new soya2d.Vector(this.e[0],this.e[1])},set:function(t,e){return this.e[0]=t||0,this.e[1]=e||0,this},dot:function(t){return this.e[0]*t.e[0]+this.e[1]*t.e[1]},negate:function(){return this.e[0]*=-1,this.e[1]*=-1,this},add:function(t){return this.e[0]+=t.e[0],this.e[1]+=t.e[1],this},sub:function(t){return this.e[0]-=t.e[0],this.e[1]-=t.e[1],this},mul:function(t){return this.e[0]*=t,this.e[1]*=t,this},div:function(t){return t?(this.e[0]/=t,this.e[1]/=t):(this.e[0]=0,this.e[1]=0),this},getAngle:function(){return Math.atan2(this.e[1],this.e[0])},getAngleBetween:function(t){var e=this.dot(t),n=e/(this.length()*t.length());return Math.acos(n)},rotate:function(t){var e=soya2d.Math,n=e.SINTABLE[t],i=e.COSTABLE[t];void 0===n&&(n=Math.sin(t*e.ONERAD),i=Math.cos(t*e.ONERAD));var o=this.e[0],s=this.e[1];return this.e[0]=o*i-s*n,this.e[1]=o*n+s*i,this},lengthSq:function(){return this.e[0]*this.e[0]+this.e[1]*this.e[1]},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.div(this.length())}};var j=soya2d.class("",{"extends":F,constructor:function(t){this.sprite=t,this.rigid=null},sensor:function(t){return this.__cbk&&this.__cbk.sensor(this.rigid,t),this},moveTo:function(t,e){return this.__cbk&&this.__cbk.moveTo(this.rigid,t,e),this},moveBy:function(t,e){return this.__cbk&&this.__cbk.moveBy(this.rigid,t,e),this},"static":function(t){return this.__cbk&&this.__cbk.static(this.rigid,t),this},mass:function(t){return this.__cbk&&this.__cbk.mass(this.rigid,t),this},rotateBy:function(t){return this.__cbk&&this.__cbk.rotateBy(this.rigid,t),this},rotateTo:function(t){return this.__cbk&&this.__cbk.rotateTo(this.rigid,t),this},friction:function(t){return this.__cbk&&this.__cbk.friction(this.rigid,t),this},restitution:function(t){return this.__cbk&&this.__cbk.restitution(this.rigid,t),this},velocity:function(t,e){return this.__cbk&&this.__cbk.velocity(this.rigid,t||0,e||0),this},inertia:function(t){return this.__cbk&&this.__cbk.inertia(this.rigid,t||0),this}}),G=soya2d.class("",{"extends":F,constructor:function(){this.running=!1},setup:function(t){this.__cbk=t||{}},start:function(t){t=t||{},t.gravity=t.gravity||[0,1],t.gravity[0]=t.gravity[0]||0,t.gravity[1]=t.gravity[1]||1,t.enableSleeping=t.enableSleeping||!1,this.__cbk.onStart&&this.__cbk.onStart(t),this.running=!0},stop:function(){this.__cbk.onStop&&this.__cbk.onStop(),this.running=!1},update:function(){this.__cbk.onUpdate&&this.__cbk.onUpdate()},bind:function(t){var e;this.__cbk.onBind&&(e=this.__cbk.onBind(t)),t.body.rigid=e,t.body.__cbk=this.__cbk.body,e.__sprite=t},unbind:function(t){var e=t.body.rigid;e&&(t.body.__cbk=null,this.__cbk.onUnbind&&(e.__sprite=null,this.__cbk.onUnbind(e)),t.body={})},enable:function(t){var e=t;if(t instanceof Array||arguments.length>1){arguments.length>1&&(e=arguments);for(var n=e.length;n--;)this.bind(e[n])}else this.bind(e)},unable:function(t){var e=t;if(t instanceof Array||arguments.length>1){arguments.length>1&&(e=arguments);for(var n=e.length;n--;)this.unbind(e[n])}else this.unbind(e)}});soya2d.EVENT_COLLISIONSTART="collisionStart",soya2d.EVENT_COLLISIONEND="collisionEnd",y.prototype={register:function(t,e){this.map[t]=e,e.prototype instanceof soya2d.DisplayObject&&(this.game.add[t]=function(e){return this.__newInstanceAndAppend(t,e)})}},soya2d.DisplayObject=function(t){if(t=t||{},this.__seq=soya2d.__roIndex++,this.roid="roid_"+this.__seq,this.name=t.name||this.roid,this.visible=t.visible===!1?!1:t.visible||!0,this.layout=t.layout,this.__opacity=0===t.opacity?0:t.opacity||1,this.__x=t.x||0,this.__y=t.y||0,this.__w=t.w||0,this.__h=t.h||0,this.__anchorX=0===t.anchorX?0:t.anchorX||"50%",this.__anchorY=0===t.anchorY?0:t.anchorY||"50%",this.__angle=t.angle||0,this.__scaleX=0==t.scaleX?0:t.scaleX||1,this.__scaleY=0==t.scaleY?0:t.scaleY||1,this.__skewX=t.skewX||0,this.__skewY=t.skewY||0,Object.defineProperties(this,{opacity:{set:function(t){t=0==t?0:parseFloat(t)||1,this.__opacity=0>t?0:t>1?1:t},get:function(){return this.__opacity
},enumerable:!0},x:{set:function(t){this.__x=t||0,this.__localChange=!0,this.game.physics.running&&this.body.moveTo(this.__x,this.__y)},get:function(){return this.__x},enumerable:!0},y:{set:function(t){this.__y=t||0,this.__localChange=!0,this.game.physics.running&&this.body.moveTo(this.__x,this.__y)},get:function(){return this.__y},enumerable:!0},w:{set:function(t){this.__w=t,this.__anchorChange=!0},get:function(){return this.__w},enumerable:!0},h:{set:function(t){this.__h=t,this.__anchorChange=!0},get:function(){return this.__h},enumerable:!0},anchorX:{set:function(t){this.__anchorX=t,this.__anchorChange=!0},get:function(){return this.__anchorX},enumerable:!0},anchorY:{set:function(t){this.__anchorY=t,this.__anchorChange=!0},get:function(){return this.__anchorY},enumerable:!0},angle:{set:function(t){this.__angle=t,this.__localChange=!0,this.game.physics.running&&this.body.rotateTo(this.__angle)},get:function(){return this.__angle},enumerable:!0},scaleX:{set:function(t){this.__scaleX=t,this.__localChange=!0},get:function(){return this.__scaleX},enumerable:!0},scaleY:{set:function(t){this.__scaleY=t,this.__localChange=!0},get:function(){return this.__scaleY},enumerable:!0},skewX:{set:function(t){this.__skewX=t,this.__localChange=!0},get:function(){return this.__skewX},enumerable:!0},skewY:{set:function(t){this.__skewY=t,this.__localChange=!0},get:function(){return this.__skewY},enumerable:!0}}),this.z=t.z||0,this.__localChange=!0,this.__anchorChange=!0,this.__localTransform=new soya2d.Matrix2x2,this.__worldTransform=new soya2d.Matrix2x2,this.worldPosition=new soya2d.Point,this.anchorPosition=new soya2d.Point,this.__screenPosition=new soya2d.Point(1/0,1/0),this.blendMode=t.blendMode||"source-over",this.__mask=t.mask||null,this.__fixedToCamera=t.fixedToCamera||!1,Object.defineProperties(this,{mask:{set:function(t){t&&(t.__masker&&(t.__masker.__mask=null),this.__mask=t,t.__masker=this)},get:function(){return this.__mask},enumerable:!0},fixedToCamera:{set:function(t){this.__fixedToCamera=t,t&&this.cameraOffset.set(this.x,this.y)},get:function(){return this.__fixedToCamera},enumerable:!0}}),this.__masker=null,this.bounds=t.bounds||new soya2d.Rectangle(0,0,this.__w,this.__h),this.__boundRect=new soya2d.Rectangle(0,0,1,1),this.body=new j(this),this.game=t.game||soya2d.games[0],this.imageCache=null,this.__updateCache=!1,this.cameraOffset=new soya2d.Point,!this.game)throw new Error("soya2d.DisplayObject: invalid param [game]; "+this.game);soya2d.ext(this,t),this.fixedToCamera=this.__fixedToCamera,this.events=new B(this)},soya2d.DisplayObject.prototype={onBuild:function(t){for(var e in t){var n=e,i=t[e];switch(n){case"x":case"w":case"y":case"h":case"z":case"angle":case"scaleX":case"scaleY":case"skewX":case"skewY":i=parseFloat(i);break;case"fixedToCamera":case"visible":i=new Function("return "+i)()}0===n.indexOf("layout-")?(t.layout||(t.layout={}),t.layout[n.split("-")[1]]=i):t[n]=i}return t},_onAdded:function(){this.centerX=this.w/2,this.centerY=this.h/2,this.setLayout(this.layout),this.fixedToCamera&&this.layout&&this.cameraOffset.set(this.x,this.y),this.onAdded&&this.onAdded()},setLayout:function(t){if(!t)return this;var e=t.left||0,n=t.top||0,i=t.width,o=t.height,s=t.offsetLeft,r=t.offsetTop;i&&(this.__w=g(i,this.parent)||0),o&&(this.__h=v(o,this.parent)||0);var a=0,l=0;return s&&(a=x(s,this.__w)),r&&(l=x(r,this.__h)),(e||s)&&(this.__x=g(e,this.parent)+a),(n||r)&&(this.__y=v(n,this.parent)+l),this},refreshLayout:function(){return this.setLayout(this.layout),this},toString:function(){return'{roid:"'+this.roid+'";name:"'+this.name+'"}'},transform:function(){var t=this.__x,e=this.__y;this.__localChange&&(this.__localTransform.identity(),this.__localTransform.scale(this.__scaleX,this.__scaleY).rotate(this.__angle).skew(this.__skewX,this.__skewY));var n=this.__localTransform,i=this.__worldTransform,o=this.anchorPosition,s=n.e,r=o.x,a=o.y;if(this.__anchorChange&&(r=this.__anchorX,a=this.__anchorY,r="number"==typeof r?r:parseFloat(r)/100*this.__w,a="number"==typeof a?a:parseFloat(a)/100*this.__h,o.set(r,a)),t+=r,e+=a,i.set(s[0],s[1],s[2],s[3]),this.parent){var l=this.parent.__worldTransform,c=l.e,h=this.parent.worldPosition,u=this.parent.anchorPosition,d=u.x*c[0]+u.y*c[2],f=u.x*c[1]+u.y*c[3],p=t*c[0]+e*c[2],_=t*c[1]+e*c[3];t=p+h.x-d,e=_+h.y-f,i.mul(l)}this.body.rigid&&(t-=o.x,e-=o.y),this.worldPosition.set(t,e),this.__localChange=this.__anchorChange=!1},isRendered:function(){if(!this.visible||0===this.opacity)return!1;for(var t=this.parent;t;){if(!t.visible||0===t.opacity)return!1;if(!(t.parent||t instanceof W))return!1;t=t.parent}return!0},clone:function(t,e){e=e||new this.constructor;for(var n=Object.keys(this),i=n.length;i--;){var o=n[i];if("parent"!==o&&"__seq"!==o&&"roid"!==o&&"__localTransform"!==o&&"__worldTransform"!==o&&"worldPosition"!==o&&"anchorPosition"!==o&&"__screenPosition"!==o&&(t||"children"!==o))if(t&&"children"===o&&this[o]&&this[o].length>0){e[o]=[];for(var s=0;s<this[o].length;s++){var r=this[o][s],a=r.clone(t);a.parent=e,e[o].push(a)}}else e[o]=this[o]instanceof Array?this[o].slice(0):this[o]}return e},moveBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.x+=t,this.y+=e,this},moveTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.x=t,this.y=e,this},opacifyTo:function(t){return this.opacity=t>1?1:0>t?0:t,this},opacifyBy:function(t){return this.opacity+=t,this.opacity>1&&(this.opacity=1),this.opacity<0&&(this.opacity=0),this},resizeTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.w=t,this.h=e,this},scaleBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.scaleX+=t,this.scaleY+=e,this},scaleTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.scaleX=t,this.scaleY=e,this},skewBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.skewX+=t,this.skewY+=e,this},skewTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.skewX=t,this.skewY=e,this},rotateBy:function(t){return this.angle+=t,this},rotateTo:function(t){return this.angle=t,this},anchorBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.anchorX+=t,this.anchorY+=e,this},anchorTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.anchorX=t,this.anchorY=e,this},getBoundingPoints:function(){var t=this.__worldTransform.e,e=this.worldPosition,n=this.anchorPosition,i=e.x,o=e.y,s=t[0],r=t[1],a=t[2],l=t[3],c=n.x,h=n.y,u=-c,d=-h,f=this.w-c,p=-h,_=-c,y=this.h-h,m=this.w-c,g=this.h-h;return[u*s+d*a+i,u*r+d*l+o,f*s+p*a+i,f*r+p*l+o,m*s+g*a+i,m*r+g*l+o,_*s+y*a+i,_*r+y*l+o]},getBoundingBox:function(){var t,e,n,i,o=this.getBoundingPoints();n=o[0],t=o[0],i=o[1],e=o[1];for(var s=o.length;s--;)s%2===0?(o[s]>n&&(n=o[s]),o[s]<t&&(t=o[s])):(o[s]>i&&(i=o[s]),o[s]<e&&(e=o[s]));var r=t,a=e,l=n-t,c=i-e;return this.__boundRect.x=r,this.__boundRect.y=a,this.__boundRect.w=l,this.__boundRect.h=c,this.__boundRect},hitTest:function(t,e){if(t instanceof soya2d.Point){var n=t;t=n.x,e=n.y}var i=this.worldPosition;if(this.bounds instanceof soya2d.Circle){var o=Math.abs(soya2d.Math.len2D(i.x,i.y,t,e));if(o<=this.bounds.r)return!0}else if(this.bounds instanceof soya2d.Rectangle||this.bounds instanceof soya2d.Polygon){var s;if(this.bounds.vtx){var r=this.__worldTransform.e,a=this.anchorPosition,l=i.x,c=i.y,h=r[0],u=r[1],d=r[2],f=r[3],p=a.x,_=a.y,y=-p,m=-_;s=[];for(var g=0;g<this.bounds.vtx.length;g+=2){var v=this.bounds.vtx[g]+y,x=this.bounds.vtx[g+1]+m;s.push(v*h+x*d+l,v*u+x*f+c)}}else s=this.getBoundingPoints();for(var b=!1,g=0;g<s.length;g+=2){var v=s[g],x=s[g+1],w=s[g+2]||s[0],S=s[g+3]||s[1];if(v===t&&x===e||w===t&&S===e)return!0;if(e>x&&S>=e||x>=e&&e>S){var A=(e-x)/(S-x)*(w-v)+v;if(A===t)return!0;A>t&&(b=!b)}}return b}return!1},intersectWith:function(t){var e=this.getBoundingBox(),n=t.getBoundingBox();return e.intersectWith(n)},getAnchorPosition:function(){var t=this.__worldTransform.e,e=this.worldPosition,n=this.anchorPosition,i=e.x,o=e.y,s=t[0],r=t[1],a=t[2],l=t[3],c=n.x,h=n.y,u=-c,d=-h,f=this.w*parseInt(this.anchorX)/100,p=this.h*parseInt(this.anchorY)/100,_=Math.sqrt(p*p+f*f),y=Math.atan2(p,f);return f=Math.cos(y)*_+u,p=Math.sin(y)*_+d,new soya2d.Point(f*s+p*a+i,f*r+p*l+o)},cache:function(){if(!(this.__w>1024||this.__h>1024)){this.imageCache||(this.imageCache=document.createElement("canvas")),this.imageCache.width=this.__w,this.imageCache.height=this.__h,this.transform(),this.__updateCache=!0,this.__renderable=!0;var t=this.imageCache.getContext("2d"),e=new soya2d.CanvasGraphics(t);this.game.renderer.renderDO(this.game.camera.__view,t,this,e,!0),this.__updateCache=!1}},destroy:function(){if(this.game.physics.unbind(this),this.off(),this.__seq){this.children.length>0&&this.children.forEach(function(t){t.destroy()});for(var t=Object.keys(this),e=t.length;e--;)t[e].indexOf("__")<0||(this[t[e]]=null);this.parent&&this.parent.remove(this),this.onRender=this.onUpdate=this.parent=this.children=this.imageCache=this.fillStyle=this.game=this.body=null}}},soya2d.class("soya2d.DisplayObjectContainer",{"extends":soya2d.DisplayObject,constructor:function(){this.children=[],this.parent=null},add:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];e.parent&&e.parent.remove(e),this.children.push(e),e.parent=this,e._onAdded()}return this},remove:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t],n=this.children.indexOf(e);0>n||(this.children.splice(n,1),e.parent=null)}return this},clear:function(t){for(var e=this.children.length;e--;)this.children[e].parent=null;var n=this.children;if(this.children=[],t)for(var e=n.length;e--;)n[e].destroy();return n},find:function(t,e){if(this.children.length<1)return[];var n;return e?(n=[],S(this,t,n)):n=this.children.filter(t),n}});var W=soya2d.class("",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){this.game=t.game,this.__anchorX=this.__anchorY=0,this.minWidth=0,this.minHeight=0,this.maxWidth=0,this.maxHeight=0,this.autoScale=!0,this.orientation=E();var e,n=this;window.addEventListener("orientationchange",function(){clearTimeout(e),e=setTimeout(function(){n.orientation=E()},500),n.autoScale&&n.__scan()},!1),window.addEventListener("resize",function(){n.orientation=E(),n.autoScale&&n.__scan()},!1),this.__bg=null,this.__rotat=soya2d.ROTATEMODE_0;var i=soya2d.ALIGNMODE_CENTER,o=soya2d.SCALEMODE_SHOWALL;Object.defineProperties(this,{scaleMode:{set:function(t){o=t,this.__scan()},get:function(){return o}},alignMode:{set:function(t){if(t&&this.scaleMode===soya2d.SCALEMODE_SHOWALL){var e=this.game.renderer.getCanvas();switch(i=t,t){case soya2d.ALIGNMODE_LEFT:e.style.left=0,e.style.right="auto";break;case soya2d.ALIGNMODE_RIGHT:e.style.left="auto",e.style.right=0;break;case soya2d.ALIGNMODE_CENTER:default:e.style.left=0,e.style.right=0,i=soya2d.ALIGNMODE_CENTER}e.style.margin="auto"}},get:function(){return i}},rotateMode:{set:function(t){this.__rotat=t,this.__scan()},get:function(){return this.__rotat}}})},__updateMatrix:function(){A(this)},__preUpdate:function(t,e){this.children&&T(this.children,t,e)},__postUpdate:function(t,e){this.children&&M(this.children,t,e)},onRender:function(t){this.__bg&&(t.fillStyle(this.__bg),t.fillRect(0,0,this.w,this.h))},background:function(t){if("string"==typeof t)this.__bg=t;else if(t instanceof self.Image)this.__bg=this.game.renderer.createPattern(t,arguments[1]);else if(!isNaN(t)){var e={};arguments[4]&&soya2d.ext(e,arguments[4]),e.type=t;var n=this.game.renderer.createGradient(arguments[1],arguments[2],arguments[3]||1,e);this.__bg=n}},__scan:function(){var t,e=this.game.w,n=this.game.h;switch(this.scaleMode){case soya2d.SCALEMODE_NOSCALE:break;case soya2d.SCALEMODE_NOBORDER:t=k;break;case soya2d.SCALEMODE_EXACTFIT:t=P;break;case soya2d.SCALEMODE_SHOWALL:default:t=I}if(t){var i=this.game.renderer,o=i.getCanvas().parentNode,s=o.clientWidth,r=o.clientHeight;"BODY"===o.tagName&&(r=window.innerHeight);var a=t(e,n,s,r,this.minWidth,this.minHeight,this.maxWidth,this.maxHeight);i.resize(a[0],a[1]),C(this.scaleMode,this.__rotat,i.getCanvas(),i,this)}}});soya2d.SCALEMODE_NOSCALE=0,soya2d.SCALEMODE_SHOWALL=1,soya2d.SCALEMODE_NOBORDER=2,soya2d.SCALEMODE_EXACTFIT=3,soya2d.ALIGNMODE_LEFT=1,soya2d.ALIGNMODE_CENTER=2,soya2d.ALIGNMODE_RIGHT=3,soya2d.ROTATEMODE_0=1,soya2d.ROTATEMODE_90=2,soya2d.ROTATEMODE_180=3,soya2d.ROTATEMODE_270=4,soya2d.BG_REPEAT="repeat",soya2d.BG_NOREPEAT="no-repeat",soya2d.BG_REPEAT_X="repeat-x",soya2d.BG_REPEAT_Y="repeat-y";var q=soya2d.class("",{"extends":soya2d.DisplayObjectContainer,constructor:function(){this.__soya_type="world"},setBounds:function(t,e){this.bounds.w=t,this.bounds.h=e,this.w=t,this.h=e}});soya2d.class("soya2d.Shape",{"extends":soya2d.DisplayObjectContainer}),O.prototype.reset=function(){this.index=0,this.lastUpdateTime=0};var U=soya2d.class("",{"extends":F,constructor:function(t,e){this.map={};for(var n=[],i=0;e>i;i++)n.push(i);this.defaultAnimation=new O(n),this.animation=null,this.playingK=null},destroy:function(){this.defaultAnimation=null,this.animation=null,this.playingK=null,this.__signalHandler=null},add:function(t,e,n,i){return this.map[t]=new O(e,n,i),this},play:function(t){return this.playingK===t?this:(this.animation=t?this.map[t]:this.defaultAnimation,this.playingK=t||!0,this)},stop:function(){return this.playingK=null,this.animation&&this.animation.reset(),this.animation=null,this}});soya2d.class("soya2d.Sprite",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){var e=t.images;e&&(this.animations=null,this.setImages(e),this.w=t.w||this.images[0].width,this.h=t.h||this.images[0].height,this.__frameIndex=t.frameIndex||0,this.__scale9grid=t.scale9grid,Object.defineProperties(this,{frameIndex:{set:function(t){this.__frameIndex=t,this.__cacheGrid=!0},get:function(){return this.__frameIndex},enumerable:!0},scale9grid:{set:function(t){t instanceof soya2d.Rectangle&&(this.__scale9grid=t,this.__cacheGrid=!0,this.__parseScale9())},get:function(){return this.__scale9grid},enumerable:!0}}))},clone:function(t){var e=new this.constructor({images:this.images.concat()});return soya2d.DisplayObject.prototype.clone.call(this,t,e)},onBuild:function(t){soya2d.DisplayObject.prototype.onBuild(t);for(var e in t){var n=e,i=t[e];switch(n){case"images":t[n]=i.split(",");break;case"frameIndex":t[n]=parseFloat(i);break;case"atlas":var o=t["atlas-prefix"];t.images=game.assets.atlas(i).getAll(o);break;case"scale9grid":var s=i.split(",");t[n]=new soya2d.Rectangle(parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]))}}},_onAdded:function(){soya2d.DisplayObject.prototype._onAdded.call(this),!this.__scale9grid||this.__w==this.images[0].width&&this.__h==this.images[0].height||(this.__cacheGrid=!0,this.__parseScale9())},_onUpdate:function(){this.__cacheGrid&&this.__scale9grid instanceof soya2d.Rectangle&&(this.cache(),this.__cacheW=this.__w,this.__cacheH=this.__h,this.__cacheGrid=!1)},__parseScale9:function(){var t=this.images[0].width,e=this.images[0].height,n=this.__scale9grid.y+this.__scale9grid.h,i=e-n,o=this.__scale9grid.x+this.__scale9grid.w,s=t-o,r=this.__w-this.__scale9grid.x-s,a=this.__h-this.__scale9grid.y-i,l=r+this.__scale9grid.x,c=a+this.__scale9grid.y,h=this.__scale9grid.x,u=this.__scale9grid.y,d=this.__scale9grid.w,f=this.__scale9grid.h;this.__scale9Data={t1:{x:0,y:0,w:h,h:u},t2:{x:h,y:0,w:d,h:u,dw:r},t3:{x:o,y:0,w:s,h:u,dx:l},m1:{x:0,y:u,w:h,h:f,dh:a},m2:{x:h,y:u,w:d,h:f,dw:r,dh:a},m3:{x:o,y:u,w:s,h:f,dx:l,dh:a},b1:{x:0,y:n,w:h,h:i,dy:c},b2:{x:h,y:n,w:d,h:i,dw:r,dy:c},b3:{x:o,y:n,w:s,h:i,dx:l,dy:c}}},onRender:function(t){if(this.animations.playingK){var e=this.animations.animation;e.lastUpdateTime||(e.lastUpdateTime=(new Date).getTime());var n=(new Date).getTime(),i=n-e.lastUpdateTime,o=i/(16.7*e.frameRate)>>0;if(o>0){if(e.index+=o,e.index>=e.frames.length){if(!e.loop){var s=this.animations.playingK;return this.animations.stop(),this.animations.emit("stop",s),void 0}e.index=0}e.lastUpdateTime=n}var r=e.frames[e.index];t.map(this.images[r],0,0,this.w,this.h)}else if(this.__scale9grid&&this.__updateCache){var a=this.images[this.__frameIndex],l=this.__scale9Data,c=l.t1,h=l.t2,u=l.t3,d=l.m1,f=l.m2,p=l.m3,_=l.b1,y=l.b2,m=l.b3;t.map(a,c.x,c.y,c.w,c.h,c.x,c.y,c.w,c.h),t.map(a,h.x,h.y,h.dw,h.h,h.x,h.y,h.w,h.h),t.map(a,u.dx,u.y,u.w,u.h,u.x,u.y,u.w,u.h),t.map(a,d.x,d.y,d.w,d.dh,d.x,d.y,d.w,d.h),t.map(a,f.x,f.y,f.dw,f.dh,f.x,f.y,f.w,f.h),t.map(a,p.dx,p.y,p.w,p.dh,p.x,p.y,p.w,p.h),t.map(a,_.x,_.dy,_.w,_.h,_.x,_.y,_.w,_.h),t.map(a,y.x,y.dy,y.dw,y.h,y.x,y.y,y.w,y.h),t.map(a,m.dx,m.dy,m.w,m.h,m.x,m.y,m.w,m.h)}else t.map(this.images[this.frameIndex],0,0,this.w,this.h)},nextFrame:function(t){this.frameIndex++,this.frameIndex>=this.images.length&&(this.frameIndex=t?0:this.images.length-1)},prevFrame:function(t){this.frameIndex--,this.frameIndex<0&&(t?frameIndex=this.images.length-1:this.frameIndex=0)},setImages:function(t,e){if("string"==typeof t)this.images=[this.game.assets.image(t)];else if(t instanceof self.Image||t.getContext&&1==t.nodeType)this.images=[t];else if(t instanceof Array){var n=[];t.forEach(function(t){"string"==typeof t?n.push(this.game.assets.image(t)):n.push(t)},this),this.images=n}else this.images=[];return this.images[0]||soya2d.console.error("soya2d.Sprite: invalid param [images]; "+this.images[0]),this.frameIndex=0,e&&(this.w=this.images[0].width,this.h=this.images[0].height),this.animations&&this.animations.destroy(),this.animations=new U(this,this.images.length),this}}),soya2d.class("soya2d.TileSprite",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){this.sprite=null,this.sprite=t.sprite instanceof soya2d.Sprite?t.sprite:new soya2d.Sprite({images:t.sprite}),this.w=t.w||this.sprite.w,this.h=t.h||this.sprite.h,this.autoScroll=t.autoScroll||!1,this.speed=t.speed||1,this.scrollAngle=t.scrollAngle||0,this.__tileOffx=0,this.__tileOffy=0},scroll:function(t,e){if(t||e)this.__tileOffx+=t||0,this.__tileOffy+=e||0;else{var n=(this.scrollAngle>>0)%360;this.__tileOffx+=soya2d.Math.COSTABLE[n]*this.speed,this.__tileOffy+=soya2d.Math.SINTABLE[n]*this.speed}},clone:function(t){var e=new this.constructor({sprite:this.sprite});return soya2d.DisplayObject.prototype.clone.call(this,t,e),e},_onUpdate:function(){if(this.autoScroll){var t=(this.scrollAngle>>0)%360;this.__tileOffx+=soya2d.Math.COSTABLE[t]*this.speed,this.__tileOffy+=soya2d.Math.SINTABLE[t]*this.speed}},onRender:function(t){t.beginPath(),t.push(),t.rect(0,0,this.w,this.h),t.clip();var e=this.sprite,n=e.w,i=e.h,o=n*e.scaleX,s=i*e.scaleY;o=0>o?-1*o:o,s=0>s?-1*s:s;var r=(this.w/o>>0)+2,a=(this.h/s>>0)+2,l=this.__tileOffx%o,c=this.__tileOffy%s;this.__tileOffx>0&&(l-=o),this.__tileOffy>0&&(c-=s);for(var h=this.sprite.images[0],u=a;u--;)for(var d=r;d--;){var f=d*o,p=u*s;t.map(h,f+l,p+c,o,s,0,0,n,i)}t.pop()}}),soya2d.CanvasGraphics=function(t){this.ctx=t,this.opacity=function(t){return 0===t||t?(this.ctx.globalAlpha=t,this):this.ctx.globalAlpha},this.closePath=function(){return this.ctx.closePath(),this},this.moveTo=function(t,e){return this.ctx.moveTo(t,e),this},this.lineTo=function(t,e){return this.ctx.lineTo(t,e),this},this.quadraticCurveTo=function(t,e,n,i){return this.ctx.quadraticCurveTo(t,e,n,i),this},this.bezierCurveTo=function(t,e,n,i,o,s){return this.ctx.bezierCurveTo(t,e,n,i,o,s),this},this.arcTo=function(t,e,n,i,o){return this.ctx.arcTo(t,e,n,i,o),this},this.arc=function(t,e,n,i,o){return this.ctx.arc(t,e,n,i||0,o||soya2d.Math.PIM2),this},this.eArc=function(e,n,i,o,s,r){s=(s||0)>>0,r=(r||360)>>0;var a=soya2d.Math,l=e+i*a.COSTABLE[s],c=n+o*a.SINTABLE[s];t.moveTo(l,c);var h=0;h=s>r?360-s+r:r-s;for(var u=1;h>=u;u++){var d=(s+u)%360;l=e+i*a.COSTABLE[d],c=n+o*a.SINTABLE[d],t.lineTo(l,c)}return this},this.rect=function(t,e,n,i){return this.ctx.rect(t,e,n,i),this},this.polygon=function(t){var e=this.ctx,n=t.length-1;e.moveTo(t[0],t[1]);for(var i=2;n>i;i+=2)e.lineTo(t[i],t[i+1]);return this},this.ellipse=function(t,e,n,i){var o=.5522848,s=n/2*o,r=i/2*o,a=t+n,l=e+i,c=t+n/2,h=e+i/2,u=this.ctx;return u.moveTo(t,h),u.bezierCurveTo(t,h-r,c-s,e,c,e),u.bezierCurveTo(c+s,e,a,h-r,a,h),u.bezierCurveTo(a,h+r,c+s,l,c,l),u.bezierCurveTo(c-s,l,t,h+r,t,h),this},this.roundRect=function(t,e,n,i,o){var s=this.ctx;return s.moveTo(t+o,e),s.lineTo(t+(n-(o<<1)),e),s.arc(t+n-o,e+o,o,3*Math.PI/2,0),s.lineTo(t+n,e+i-o),s.arc(t+n-o,e+i-o,o,0,soya2d.Math.PID2),s.lineTo(t+o,e+i),s.arc(t+o,e+i-o,o,soya2d.Math.PID2,Math.PI),s.lineTo(t,e+o),s.arc(t+o,e+o,o,Math.PI,3*Math.PI/2),this},this.regularPolygon=function(t,e,n,i,o){t=t||0,e=e||0,n=3>n?3:n;for(var s=soya2d.Math,r=[],a=360/n,l=0,c=0;360>l;l+=a,c++){var h=i;o&&(h=c%2!==0?i:o),s.COSTABLE[l]?r.push(t+h*s.COSTABLE[l],e+h*s.SINTABLE[l]):r.push(t+h*s.COSTABLE[Math.round(l)],e+h*s.SINTABLE[Math.round(l)])}return this.polygon(r),this},this.blendMode=function(t){return t?(this.ctx.globalCompositeOperation=t,this):this.ctx.globalCompositeOperation},this.strokeStyle=function(t){return t?(this.ctx.strokeStyle=t,this):this.ctx.strokeStyle},this.fillStyle=function(t){return t?(this.ctx.fillStyle=t,this):this.ctx.fillStyle},this.shadow=function(t,e,n,i){return this.ctx.shadowBlur=t,this.ctx.shadowColor=e,this.ctx.shadowOffsetX=n,this.ctx.shadowOffsetY=i,this},this.lineStyle=function(t,e,n,i){var o=this.ctx;return o.lineWidth=t,o.lineCap=e||o.lineCap,o.lineJoin=n||o.lineJoin,o.miterLimit=i||o.miterLimit,this},this.font=function(t){var e=this.ctx;return e.font=t.getDesc(),this},this.clip=function(){return this.ctx.clip(),this},this.push=function(){return this.ctx.save(),this},this.pop=function(){return this.ctx.restore(),this},this.beginPath=function(){return this.ctx.beginPath(),this},this.closePath=function(){return this.ctx.closePath(),this},this.fill=function(){return this.ctx.fill(),this},this.stroke=function(){return this.ctx.stroke(),this},this.path=function(t){t._insQ.forEach(function(t){var e=t[0].toLowerCase();switch(e){case"m":this.ctx.moveTo(t[1][0],t[1][1]);break;case"l":var n=t[1];if(n.length>2)for(var i=0;i<n.length;i+=2)this.ctx.lineTo(n[i],n[i+1]);else this.ctx.lineTo(n[0],n[1]);break;case"c":var n=t[1];if(n.length>6)for(var i=0;i<n.length;i+=6)this.ctx.bezierCurveTo(n[i],n[i+1],n[i+2],n[i+3],n[i+4],n[i+5]);else this.ctx.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]);break;case"q":var n=t[1];if(n.length>4)for(var i=0;i<n.length;i+=4)this.ctx.quadraticCurveTo(n[i],n[i+1],n[i+2],n[i+3]);else this.ctx.quadraticCurveTo(n[0],n[1],n[2],n[3]);break;case"z":this.ctx.closePath()}},this)},this.fillRect=function(t,e,n,i){return this.ctx.fillRect(t,e,n,i),this},this.strokeRect=function(t,e,n,i){return this.ctx.strokeRect(t,e,n,i),this},this.clearRect=function(t,e,n,i){return this.ctx.clearRect(t,e,n,i),this},this.map=function(t,e,n,i,o,s,r,a,l){return s=s||0,r=r||0,a=a||t.width,l=l||t.height,0!==a&&0!==l&&0!==i&&0!==o?(this.ctx.drawImage(t,s>>0,r>>0,a>>0,l>>0,e>>0,n>>0,i>>0,o>>0),this):void 0},this.fillText=function(t,e,n,i){return i?this.ctx.fillText(t,e||0,n||0,i):this.ctx.fillText(t,e||0,n||0),this},this.strokeText=function(t,e,n,i){return i?this.ctx.strokeText(t,e||0,n||0,i):this.ctx.strokeText(t,e||0,n||0),this}},soya2d.CanvasRenderer=function(t){function e(t){t.stroke=function(){},t.fill=function(){},t.fillRect=function(e,n,i,o){t.rect(e,n,i,o)},t.strokeRect=function(e,n,i,o){t.rect(e,n,i,o)},t.drawImage=function(e,n,i,o,s,r,a,l,c){3===arguments.length?t.rect(n,i,e.width,e.height):5===arguments.length?t.rect(n,i,o,s):9===arguments.length&&t.rect(r,a,l,c)},t.fillText=function(){},t.strokeText=function(){},t.beginPath=function(){},t.closePath=function(){}}function n(t){t.stroke=p.stroke,t.fill=p.fill,t.fillRect=p.fillRect,t.strokeRect=p.strokeRect,t.drawImage=p.drawImage,t.fillText=p.fillText,t.strokeText=p.strokeText,t.beginPath=p.beginPath,t.closePath=p.closePath}function i(t,e){if(e.onRender){var n=e.__worldTransform.e,o=e.worldPosition;t.setTransform(n[0],n[1],n[2],n[3],o.x,o.y);var s=e.anchorPosition;t.translate(-s.x,-s.y),e.onRender(u)}if(e.children&&e.children.length>0)for(var r=e.children,a=0;a<r.length;a++)i(t,r[a])}function o(t,s,r,a,l,c){if(0!==r.opacity&&r.visible&&!r.__masker){var h=r.__screenPosition;if(r.__renderable||1/0==h.x||1/0==h.y){if(f++,r.mask instanceof soya2d.DisplayObject&&(s.save(),s.beginPath(),e(s),i(s,r.mask),s.clip(),n(s),s.closePath()),r.onRender){var u=r.__worldTransform.e,d=r.anchorPosition,p=r.worldPosition;if(r.__updateCache){var _=d.x,y=d.y;s.setTransform(1,0,0,1,_,y)}else{var _=h.x,y=h.y;1/0==_&&1/0==y&&(_=p.x,y=p.y),s.setTransform(u[0],u[1],u[2],u[3],_,y)}c&&r.opacity<=1&&r.opacity!==c.opacity&&(c.opacity=r.opacity,s.globalAlpha=r.opacity),c&&c.blendMode!==r.blendMode&&(c.blendMode=r.blendMode,s.globalCompositeOperation=r.blendMode),s.translate(-d.x,-d.y),r.imageCache&&!r.__updateCache?s.drawImage(r.imageCache,0,0):r.onRender(a)}if(r.__renderable=!1,r.children&&r.children.length>0&&!r.__updateCache){var m=r.children;l&&m.sort(function(t,e){return t.z===e.z?t.__seq-e.__seq:t.z-e.z});for(var g=0;g<m.length;g++)o(t,s,m[g],a,l,c)}r.mask instanceof soya2d.DisplayObject&&s.restore()}}}t=t||{};var s=t.container;this.w=t.w||(s?s.clientWidth:0),this.h=t.h||(s?s.clientHeight:0),this.autoClear=void 0===t.autoClear?!0:t.autoClear,this.sortEnable=t.sortEnable||!1;var r=t.smoothEnable===!1?!1:t.smoothEnable||!0,a=t.crispEnable||!1,l=document.createElement("canvas");l.style.position="absolute";var c=window.getComputedStyle(t.container,null).position;"absolute"!==c&&"relative"!==c&&(s.style.position="relative"),c=null,s.appendChild(l),s=null;var h=l.getContext("2d"),u=new soya2d.CanvasGraphics(h);l.width=this.w,l.height=this.h,this.ctx=h,h.textBaseline=soya2d.TEXTVALIGN_TOP;var d={opacity:1,blendMode:"source-over"};this.getCanvas=function(){return l};var f=0;this.render=function(t,e){if(!(!t instanceof W)){h.setTransform(1,0,0,1,0,0),this.autoClear&&h.clearRect(0,0,this.w,this.h);var n=e.__view;return f=0,o(n,h,t,u,this.sortEnable,d),f}};var p={stroke:h.stroke,fill:h.fill,fillRect:h.fillRect,strokeRect:h.strokeRect,drawImage:h.drawImage,fillText:h.fillText,strokeText:h.strokeText,beginPath:h.beginPath,closePath:h.closePath};this.renderDO=o,this.destroy=function(){l.parentNode&&l.parentNode.removeChild(l),p=u=this.ctx=null},this.resize=function(t,e){var n=l.width,i=l.height;this.hr=t/n,this.vr=e/i,l.style.width=t+"px",l.style.height=e+"px"},this.hr=1,this.vr=1,this.smooth=function(t){return void 0!==t?(h.imageSmoothingEnabled=h.mozImageSmoothingEnabled=h.oImageSmoothingEnabled=h.msImageSmoothingEnabled=t,r=t,this):r},this.smooth(r),this.crisp=function(t){t?(l.style["image-rendering"]="optimizeSpeed",l.style["image-rendering"]="crisp-edges",l.style["image-rendering"]="-moz-crisp-edges",l.style["image-rendering"]="-webkit-optimize-contrast",l.style["image-rendering"]="optimize-contrast",l.style["image-rendering"]="pixelated",l.style.msInterpolationMode="nearest-neighbor"):(l.style["image-rendering"]="auto",l.style.msInterpolationMode="bicubic")},this.crisp(a),this.getImageData=function(t,e,n,i){return t=t||0,e=e||0,n=n||this.w,i=i||this.h,h.getImageData(t,e,n,i)},this.toDataURL=function(t){return l.toDataURL(t||"image/png")},this.createPattern=function(t,e){return h.createPattern(t,e||"repeat")},this.createGradient=function(t,e,n,i){var o=0,s=0,r=0,a=soya2d.GRADIENT_LINEAR,l=0,c=0;i&&(o=i.angle||0,s=i.x||0,r=i.y||0,a=i.type||soya2d.GRADIENT_LINEAR,l=i.focalRatio||0,c=i.focalRadius||0);var u,d=soya2d.Math;switch(o=Math.abs((o||0)>>0),a){case soya2d.GRADIENT_LINEAR:u=h.createLinearGradient(s,r,s+n*d.COSTABLE[o],r+n*d.SINTABLE[o]);for(var f=0,p=t.length;p>f;f++)u.addColorStop(t[f],e[f]||"RGBA(0,0,0,0)");break;case soya2d.GRADIENT_RADIAL:var _=n*l;u=h.createRadialGradient(s,r,c,s+_*d.COSTABLE[o],r+_*d.SINTABLE[o],n);for(var f=0,p=t.length;p>f;f++)u.addColorStop(t[f],e[f]||"RGBA(0,0,0,0)")}return u}},soya2d.CanvasRenderer.prototype.getImageFrom=function(t,e,n){var i=document.createElement("canvas");i.width=e||t.w,i.height=n||t.h;var o=i.getContext("2d"),s=new soya2d.CanvasGraphics(o),r=new Image;return r.src=i.toDataURL("image/png"),s=null,i=null,r},soya2d.Path=function(t){this.d=t||"",this.cmd=["m","l","c","q","z"],this._insQ=[],this.__parse()},soya2d.ext(soya2d.Path.prototype,{__parse:function(){var t=new RegExp("["+this.cmd.join("")+"]([^"+this.cmd.join("")+"]+|$)","img"),e=this.d.replace(/^\s+|\s+$/,"").match(t);e.forEach(function(t){t=t.replace(/^\s+|\s+$/,"");var e=t[0].toLowerCase();if(this.cmd.indexOf(e)>-1){var n=t.substr(1).replace(/^\s/gm,"").split(/\n|,|\s/gm);this._insQ.push([e,n])}},this)},setPath:function(t){this.d=t,this.__parse()}}),soya2d.Device=new function(){var t=this.userAgent=self.navigator.userAgent.toLowerCase(),e=t.indexOf("windows")>0?!0:!1,n=t.indexOf("linux")>0?!0:!1,i=t.indexOf("mac os")>0?!0:!1,o=t.indexOf("android")>0?!0:!1,s=t.indexOf("iphone")>0?!0:!1,r=t.indexOf("ipad")>0?!0:!1,a=t.indexOf("windows phone")>0?!0:!1;this.iphone=s,this.ipad=r,this.ios=s||r,this.android=o,this.wp=a,this.mobile=this.ios||o||a,this.windows=e,this.linux=n,this.mac=i;var l={Firefox:t.indexOf("firefox")+1,Opera:t.indexOf("opera")+1,Chrome:t.indexOf("chrome")+1,Safari:t.indexOf("safari")>-1&&t.indexOf("chrome")<0};this.ie=/msie|trident.*rv:/.test(t.toLowerCase()),this.ff=l.Firefox?!0:!1,this.opera=l.Opera?!0:!1,this.chrome=l.Chrome?!0:!1,this.safari=l.Safari?!0:!1},soya2d.Font=function(t){var e=document.createElement("span"),n=["padding:0 !important;","margin:0 !important;","top:-9999px !important;","left:-9999px !important;","white-space:nowrap !important;","position:absolute !important;"];e.style.cssText=n.join("")+"font:"+(t||"normal 400 13px/normal sans-serif"),document.body.appendChild(e),this.fontString=e.style.font,this.__textRenderer=function(t){if(t.font(this.font),this.__lines){t.fillStyle(this.fillStyle);for(var e=0,n=this.__lines.length;n>e;e++){var i=this.__lines[e];if(this.letterSpacing>0)for(var o=0,s=0,r=i.length;r>s;s++)t.fillText(i[s],o,(this.__lh+this.lineSpacing)*e),o+=this.letterSpacing+this.__uw;else t.fillText(i,0,(this.__lh+this.lineSpacing)*e)}}},this.clone=function(){return new soya2d.Font(this.getDesc())},this.getDesc=function(){return e.style.font},this.style=function(t){return arguments.length>0?(e.style.fontStyle=t,this.fontString=e.style.font,this):e.style.fontStyle},this.weight=function(t){return arguments.length>0?(e.style.fontWeight=t,this.fontString=e.style.font,this):e.style.fontWeight},this.size=function(t){return arguments.length>0?(e.style.fontSize=t+"px",this.fontString=e.style.font,this):e.style.fontSize},this.family=function(t){return arguments.length>0?(t&&(e.style.fontFamily=t,this.fontString=e.style.font),this):e.style.fontFamily},this.getBounds=function(t){e.innerText=t;var n=e.offsetHeight,i=e.offsetWidth;return{w:i,h:n}}},soya2d.ImageFont=function(t,e){this.__fontMap=t;var n=t.texs[Object.keys(t.texs)[0]].height;this.fontSize=e||n,this.fontWidth=t.texs[Object.keys(t.texs)[0]].width;var i=1;this.__textRenderer=function(t){if(this.__lines)for(var e=0,n=0,o=0,s=this.__lines.length;s>o;o++){for(var r=this.__lines[o],a=0,l=0,c=r.length;c>l;l++){var h=r[l],u=this.font.__fontMap.get(h);if(u){var d=u.width*i,f=u.height*i;n=d,t.map(u,a,e,d,f,0,0,u.width,u.height)}a+=n+this.letterSpacing}e+=this.font.fontSize+this.lineSpacing}},this.clone=function(){return new soya2d.ImageFont(this.__fontMap)},this.size=function(t){return arguments.length>0?(this.fontSize=parseInt(t)||n,i=this.fontSize/n,this):this.fontSize},this.getBounds=function(t){var e=t.length;return{w:e*this.fontWidth*i,h:this.fontSize}},e&&this.size(e)},soya2d.class("soya2d.Text",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){this.text=t.text||"",this.letterSpacing=t.letterSpacing||0,this.lineSpacing=t.lineSpacing||0,this.font=t.font||new soya2d.Font,"string"==typeof this.font?this.font=new soya2d.Font(this.font):this.font instanceof soya2d.Atlas&&(this.font=new soya2d.ImageFont(this.font,t.size)),this.__changed=!0,this.__lines,this.__renderer=this.font.__textRenderer,this.fillStyle=t.fillStyle||"#000";
var e=this.font.getBounds(this.text);this.w||(this.w=e.w),this.h||(this.h=e.h)},onBuild:function(t,e,n){soya2d.DisplayObject.prototype.onBuild(t);for(var i="",o=0;o<e.childNodes.length;o++)3===e.childNodes[o].nodeType&&(i+=e.childNodes[o].nodeValue);t.text=i.replace(/(^\s+)|(\s+$)/gm,"");var s=t.atlas;s&&(t.size=parseInt(t.size),t.font=n.assets.atlas(s));for(var o in t){var r=o,a=t[o];switch(r){case"letterSpacing":case"lineSpacing":t[r]=parseFloat(a)}}},onRender:function(t){this.__renderer(t)},refresh:function(){return this.__changed=!0,this},setFont:function(t){return t?(this.font=t,this.__renderer=this.font.__textRenderer,this):this},setText:function(t,e){return this.text=t+"",this.refresh(),e&&(this.w=this.font.getBounds(this.text).w),this},_onUpdate:function(){if(!this.__lh){var t=this.font.getBounds("s"),e=this.font.getBounds("è±†");this.__lh=(t.h+e.h)/2>>0,this.__uw=(t.w+e.w)/2>>0}this.__changed&&(this.__lines=this.__calc(),this.__changed=!1)},__calc:function(){var t=this.letterSpacing>>0,e=this.w/(this.__uw+t)>>0;1>e&&(this.w=1.5*this.__uw,e=1);for(var n=this.font,i=this.text.split("\n"),o=[],s=0,r=i.length;r>s;s++){var a=i[s];if(a)for(var l=a.length,c=0;l>c;){var h=a.substr(c,e+1),u=n.getBounds(h).w+h.length*t;if(u>this.w){for(var d=e+1;d--;)if(h=h.substr(0,h.length-1),u=n.getBounds(h).w+h.length*t,u<=this.w){if(0===u)return;o.push(h),c+=h.length;break}}else{for(var f=c,d=1;l-c>d;d++){if(h=a.substr(c,e+1+d),u=n.getBounds(h).w+h.length*t,u>this.w){o.push(h.substr(0,h.length-1)),c+=h.length-1;break}if(h===a){e=a.length-1;break}}if(c===f){h=a.substr(c,e+1),o.push(h);break}}}else o.push("")}return o}}),soya2d.Game=function(t){function n(t){h.running&&(c=requestAFrame(function(e){0===d&&(d=e);var i=e-d;if(d=e,_>l){var o=Date.now();t&&t(o,i),_%=l}_+=i,n(t)}))}t=t||{};var i=t.container||document.body;"string"==typeof i&&(i=document.querySelector(i));var s=(t.rendererType||soya2d.RENDERER_TYPE_CANVAS,i.offsetWidth||100),r=i.offsetHeight||100,a=null;a=new soya2d.CanvasRenderer({smoothEnable:t.smoothEnable,autoClear:t.autoClear,container:i,sortEnable:!0,w:t.w||s,h:t.h||r}),soya2d.ext(this,t),this.renderer=a,this.objects=new y(this),this.add=new m(this),this.scene=new u(this),this.stage=new W({game:this,w:a.w,h:a.h}),this.world=new q({game:this,w:a.w,h:a.h}),this.stage.add(this.world),this.camera=new e(a.w,a.h,this),this.assets=new o,this.load=new N(this),this.timer=new V,this.physics=new G,this.w=a.w,this.h=a.h,this.running=!1,this.input={pointer:{changeType:function(t){Y.changeType(t)}},keyboard:{},device:{}},this.start=function(){if(!this.running){this.running=!0,this.stage.__scan(this.w,this.h,i,a);var t=soya2d.module._getAll(),e=[],o=[],s=[],r=[];for(var c in t)t[c].onStart&&t[c].onStart(this),t[c].onBeforeUpdate&&e.push([t[c],t[c].onBeforeUpdate]),t[c].onPostUpdate&&o.push([t[c],t[c].onPostUpdate]),t[c].onBeforeRender&&s.push([t[c],t[c].onBeforeRender]),t[c].onPostRender&&r.push([t[c],t[c].onPostRender]);return Y.start(this),K.start(this),Q.start(this),l=1e3/p,n(function(t,n){e.forEach(function(e){e[1].call(e[0],h,t,n)}),h.physics.running&&h.physics.update(),h.camera.__onUpdate(),h.timer.__scan(n),Y.scan(h),K.scan(h),Q.scan(h),h.currentScene.onUpdate&&h.currentScene.onUpdate(h,n),h.stage.__preUpdate(h,n),h.stage.__updateMatrix(),h.stage.__postUpdate(h,n),o.length>0&&(t=Date.now(),o.forEach(function(e){e[1].call(e[0],h,t,n)})),Y.clear(),K.clear(),Q.clear(),h.camera.__cull(h.stage),h.camera.__viewport(h.world),s.length>0&&(t=Date.now(),s.forEach(function(e){e[1].call(e[0],h,t,n)}));var i=a.render(h.stage,h.camera);r.length>0&&(t=Date.now(),r.forEach(function(e){e[1].call(e[0],h,t,n,i)}))}),this}};var l,c,h=this,d=0,f=60,p=60,_=0;this.setFPS=function(t){return p=parseInt(t)||f,p=p>f?f:p,l=1e3/p,this},this.stop=function(){cancelAFrame(c),this.running=!1;var t=soya2d.module._getAll();for(var e in t)t[e].onStop&&t[e].onStop(this);return this},this.destroy=function(){this.running&&this.stop();var t=soya2d.module._getAll();for(var e in t)t[e].onDestroy&&t[e].onDestroy(this);this.renderer.destroy(),this.stage.destroy();var n=soya2d.games.indexOf(this);n>-1&&soya2d.games.splice(n,1)};var g=soya2d.module._getAll(),v=0;for(var x in g)g[x].onInit&&g[x].onInit(this),v++;this.objects.register("shape",soya2d.Shape),this.objects.register("sprite",soya2d.Sprite),this.objects.register("tileSprite",soya2d.TileSprite),this.objects.register("group",soya2d.DisplayObjectContainer),this.objects.register("text",soya2d.Text);var b="soya2d Game instance created...",w=v+" plugins loaded...";soya2d.console.info(b),soya2d.console.info(w),soya2d.games.push(this)},soya2d.games=[];var z="soya2d "+soya2d.version.toString()+" is working...",H="==== thank you for using soya2d, you'll love it! ====";soya2d.console.info(z),soya2d.console.info(H),soya2d.RENDERER_TYPE_AUTO=1,soya2d.RENDERER_TYPE_CANVAS=2,soya2d.RENDERER_TYPE_WEBGL=3;var X=new F;soya2d.KeyCode={DELETE:46,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"[":219,"]":221,"\\":220,"=":187,"-":189,",":188,".":190,"/":191,";":186,"'":222},R.prototype={setEvent:function(t,e){this.eventMap[t]=e},clear:function(){for(var t in this.eventMap)this.eventMap[t]=null;this.eventMap={}},start:function(t){this.onInit(t)},scan:function(t){this.onScan(t)}};var Y=new R({onInit:function(t){var e=t.renderer.getCanvas();this.cvs=e,this.fn_md=this.doMousedown.bind(this),this.fn_mm=this.doMousemove.bind(this),this.fn_mu=this.doMouseup.bind(this),this.fn_mo=this.doMouseout.bind(this),this.fn_mov=this.doMouseover.bind(this),this.fn_ts=this.doStart.bind(this),this.fn_tm=this.doMove.bind(this),this.fn_te=this.doEnd.bind(this),this.fn_tc=this.doCancel.bind(this),soya2d.Device.mobile?this.bindTouch(e):this.bindMouse(e),this.lastTapTime=0,this.lastClickTime=0,this.inList=[],this.pressStartTime=0},bindMouse:function(t){this.pointerType="mouse",t.addEventListener("mousedown",this.fn_md,!0),t.addEventListener("mousemove",this.fn_mm,!0),t.addEventListener("mouseup",this.fn_mu,!0),window.addEventListener("blur",this.fn_tc,!0),t.addEventListener("mouseout",this.fn_mo,!0),t.addEventListener("mouseover",this.fn_mov,!0)},bindTouch:function(t){this.pointerType="touch",t.addEventListener("touchstart",this.fn_ts,!0),t.addEventListener("touchmove",this.fn_tm,!0),t.addEventListener("touchend",this.fn_te,!0),t.addEventListener("touchcancel",this.fn_tc,!0)},changeType:function(t){if(this.pointerType!=t){var e=this.cvs;switch(this.pressing=!1,t){case"mouse":e.removeEventListener("touchstart",this.fn_ts,!0),e.removeEventListener("touchmove",this.fn_tm,!0),e.removeEventListener("touchend",this.fn_te,!0),e.removeEventListener("touchcancel",this.fn_tc,!0),this.bindMouse(e);break;case"touch":e.removeEventListener("mousedown",this.fn_md,!0),e.removeEventListener("mousemove",this.fn_mm,!0),e.removeEventListener("mouseup",this.fn_mu,!0),window.removeEventListener("blur",this.fn_tc,!0),e.removeEventListener("mouseout",this.fn_mo,!0),e.removeEventListener("mouseover",this.fn_mov,!0),this.bindTouch(e)}}},onScan:function(t){var e=t.input.pointer,n=t.renderer,i=!1,o=!1,s=!1,r=null;if(this.eventMap.down?(i=!0,r=this.eventMap.down,X.emit("pointerdown",r)):this.eventMap.up&&(o=!0,r=this.eventMap.up,X.emit("pointerup",r)),this.eventMap.move&&(s=!0,r=this.eventMap.move,X.emit("pointermove",r)),this.eventMap.tap&&(r=this.eventMap.tap,X.emit("pointertap",r)),this.eventMap.dbltap&&(r=this.eventMap.dbltap,X.emit("pointerdbltap",r)),e.isDown=i,e.isUp=o,e.isMove=s,e.isPressing=this.pressing,e.duration=0==this.pressStartTime?0:Date.now()-this.pressStartTime,e.e=r,e.touches=[],r){if(r.changedTouches){var a=this.handleTouches(r,r.changedTouches,t);if(e.position=a[0],e.touches=a,s)for(var l=a.length;l--&&!this.handleOverOut(r,a[l]););}else{e.button={left:0==r.button||1==r.button,right:2==r.button,middle:4==r.button||2==r.which};var c=(r.offsetX||r.layerX)/n.hr,h=(r.offsetY||r.layerY)/n.vr;e.position=new soya2d.Point(c,h),s&&this.handleOverOut(r,e.position)}this.eventMap.enterstage&&X.emit("enterstage",this.eventMap.enterstage),this.eventMap.leavestage&&X.emit("leavestage",this.eventMap.leavestage),this.eventMap.cancel&&X.emit("pointercancel",this.eventMap.cancel)}},handleOverOut:function(t,e){var n=[],i=X.__sigmap,o=i.pointerover,s=i.pointerout;if(o&&o.forEach(function(t){n.push(t)}),s&&s.forEach(function(t){for(var e=n.length;e--;)if(n[e][1]==t[1])return;n.push(t)}),n.length>0){var r=[],a=!1;n.forEach(function(n){{var i=n[1];n[0]}i.hitTest&&i.hitTest(e.x,e.y)&&(r.push(i),this.inList.indexOf(i)>-1||(this.inList.push(i),X.emit("pointerover",t),a=!0))},this);var l=[];if(this.inList.forEach(function(t){r.indexOf(t)<0&&l.push(t)}),l.length<1)return;for(var c=l.length;c--;){var h=this.inList.indexOf(l[c]);this.inList.splice(h,1);{l[c]}X.emit("pointerout",t),a=!0}return a}},doMousedown:function(t){this.setEvent("down",t),this.pressing=!0,this.pressStartTime=Date.now()},doMousemove:function(t){this.setEvent("move",t)},doMouseup:function(t){this.pressing=!1,this.pressStartTime=0,this.setEvent("up",t),this.canceled||0===t.button&&(this.setEvent("tap",t),Date.now()-this.lastClickTime<300&&this.setEvent("dbltap",t),this.lastClickTime=Date.now())},doMouseover:function(t){this.setEvent("enterstage",t)},doMouseout:function(t){this.setEvent("leavestage",t)},handleTouches:function(t,e,n){var i=[],o=[];if(e&&e.length>0){for(var s=t.target||t.srcElement,r=s.offsetLeft,a=s.offsetTop;(s=s.offsetParent)&&"BODY"!=s.tagName;)r+=s.offsetLeft-s.scrollLeft,a+=s.offsetTop-s.scrollTop;for(var l=document.body.scrollTop||document.documentElement.scrollTop,c=document.body.scrollLeft||document.documentElement.scrollLeft,h=0;h<e.length;h++){var u=e[h];i[h]=u.clientX-r+c,i[h+1]=u.clientY-a+l}}var d=n.renderer,f=d.getCanvas(),p=window.getComputedStyle(f,null).marginLeft;p=parseFloat(p)||0;var _=window.getComputedStyle(f,null).marginTop;_=parseFloat(_)||0;for(var h=0;h<i.length;h+=2){var y=i[h],m=i[h+1];switch(n.stage.rotateMode){case soya2d.ROTATEMODE_90:y=y+f.offsetLeft-_,m=m+f.offsetTop-p;var g=y;y=m,m=thisGame.stage.w-Math.abs(g);break;case soya2d.ROTATEMODE_270:y=y+f.offsetLeft-_,m=m+f.offsetTop-p;var g=m;m=y,y=thisGame.stage.h-Math.abs(g);break;case soya2d.ROTATEMODE_180:y=thisGame.stage.w-Math.abs(y),m=thisGame.stage.h-Math.abs(m)}y/=d.hr,m/=d.vr,o.push(new soya2d.Point(y,m))}return o},doStart:function(t){this.setEvent("down",t),this.pressing=!0,this.pressStartTime=Date.now(),this.hasMoved=!1,this.canceled=!1},doMove:function(t){this.setEvent("move",t),this.hasMoved=!0},doCancel:function(t){this.canceled=!0,this.setEvent("cancel",t),this.pressing=!1,this.pressStartTime=0},doEnd:function(t){this.setEvent("up",t),t.touches.length<1&&(this.pressing=!1,this.pressStartTime=0),this.canceled||this.hasMoved||(this.setEvent("tap",t),Date.now()-this.lastTapTime<300&&this.setEvent("dbltap",t),this.lastTapTime=Date.now())}}),K=new R({onInit:function(){window.addEventListener("keyup",this.doKeyUp.bind(this),!1),window.addEventListener("keydown",this.doKeyDown.bind(this),!1),window.addEventListener("blur",this.doBlur.bind(this),!1),this.preesingKeys=[],this.pressing=!1,this.lastEv=null},onScan:function(t){var e=t.input.keyboard,n=!1,i=!1,o=this.lastEv;this.eventMap.down?(n=!0,this.lastEv=o=this.eventMap.down,X.emit("keydown",o)):this.eventMap.up&&(i=!0,this.lastEv=o=this.eventMap.up,X.emit("keyup",o)),this.pressing&&X.emit("keypress",o),e.isDown=n,e.isUp=i,e.isPressing=this.pressing,e.e=o,e.shiftKey=o?o.shiftKey:!1,e.metaKey=o?o.metaKey:!1,e.ctrlKey=o?o.ctrlKey:!1,e.altKey=o?o.altKey:!1,e.keys=this.preesingKeys},doKeyUp:function(t){var e=this.preesingKeys,n=t.keyCode||t.which,i=e.indexOf(n);i>-1&&e.splice(i,1),e.length<1&&(this.pressing=!1),this.setEvent("up",t)},doKeyDown:function(t){var e=this.preesingKeys,n=t.keyCode||t.which;e.indexOf(n)<0&&(e.push(n),this.pressing=!0,this.setEvent("down",t))},doBlur:function(){this.preesingKeys=[],this.pressing=!1}}),Q=new R({onInit:function(){window.addEventListener("orientationchange",this.doHOV.bind(this),!1),window.addEventListener("deviceorientation",this.doTilt.bind(this),!1),window.addEventListener("devicemotion",this.doMotion.bind(this),!1)},onScan:function(t){var e=t.input.device,n=null;if(this.eventMap.hov){n=this.eventMap.hov,this.timer&&clearTimeout(this.timer);var i=this;this.timer=setTimeout(function(){var t=i.getOrientation();X.emit("hov",t)},500)}if(this.eventMap.tilt){n=this.eventMap.tilt;var o={z:n.alpha,x:n.beta,y:n.gamma,absolute:n.absolute};e.tilt=o,X.emit("tilt",o)}if(this.eventMap.motion){n=this.eventMap.motion;var s={x:n.acceleration.x,y:n.acceleration.y,z:n.acceleration.z,interval:n.interval};e.motion=s,X.emit("motion",s)}e.e=n},getOrientation:function(){var t,e=window.innerWidth,n=window.innerHeight;return t=e>n?"landscape":"portrait"},doHOV:function(t){this.setEvent("hov",t)},doTilt:function(t){this.setEvent("tilt",t)},doMotion:function(t){this.setEvent("motion",t)}});!function(){function t(t,e,n,i){this.duration=1e3*n,i=i||{},this.easing=i.easing||soya2d.Tween.Linear,this.repeat=i.repeat||0,this.yoyo=i.yoyo||!1,this.cacheable=i.cacheable||!1,this.delay=1e3*(i.delay||0),this.__attr=t[0],this.__attriNames=Object.keys(t[0]),this.__ratio=t[1],this.__initState=e,this.__loops=0}soya2d.class("soya2d.Tween",{"extends":F,constructor:function(t){this.target=t,this.__tds={},this.__startTimes=[],this.__long=0,this.position=0,this.__reversed=!1,this.__paused=!1,this.__infinite=!1,this.__state={},this.__status="paused",this.__runningTD,this.__changeTimes=0,this.__lastChangeTD},__calc:function(t,e,n){for(var i=Object.keys(t),o={},s={},r=i.length;r--;){var a=i[r],l=this.__state[a];if(void 0===l&&(l=this.target[a]),void 0!==l){var c=parseFloat(l||0),h=t[a];("string"==typeof h||h instanceof String)&&(h=0===h.indexOf("-")?c-parseFloat(h.substring(1,h.length)):0===h.indexOf("+")?c+parseFloat(h.substring(1,h.length)):parseFloat(h));var u=h-c;if(o[a]={initVal:c,varVal:u,endVal:h},this.__state[a]=h,this.cacheable)for(var d=o[a].dVal={},f=0;(f+=10)<e;){var p=n(f,0,1,e);s["p_"+f]=p,d["p_"+f]=c+u*p}}}return[o,s]},to:function(e,n,i){if(this.__infinite)return this;n=n||1,i=i||{};var o=i.easing||soya2d.Tween.Linear,s=this.__calc(e,n,o),r=i.yoyo||!1,a=i.repeat||0,l=a%2;if(r&&l)for(var c in s[0])this.__state[c]=s[0][c].initVal;var h={};soya2d.ext(h,this.__state);var u=new t(s,h,n,i);this.__long+=u.delay;for(var d in this.__tds){var f=this.__tds[d];for(var c in s[0])void 0===f.__initState[c]&&(f.__initState[c]=s[0][c].initVal)}return this.__tds[this.__long]=u,this.__startTimes.push(this.__long),u.__startPos=this.__long,-1===u.repeat&&(this.__infinite=!0,soya2d.console.warn("infinite loop instance")),this.__long+=u.duration*(u.repeat+1),this},play:function(t){return this.__reversed=!1,this.__status="running",this.keepAlive=t,this},reverse:function(){return this.__infinite?void 0:(this.__status="running",this.__reversed=!0,this)},pause:function(){return this.__status="paused",this.emit("pause"),this},restart:function(t){return this.position=0,this.play(t),this},__getTD:function(){for(var t=this.__startTimes.length;t--;)if(this.position>=this.__startTimes[t])return this.__tds[this.__startTimes[t]]},__onUpdate:function(t,e){this.emit("process",t,this.position/this.__long),(t>=1&&!this.__reversed||0===t&&this.__reversed)&&this.__lastChangeTD!=e&&(this.__onChange(++this.__changeTimes),this.__lastChangeTD=e)},__onChange:function(t){this.emit("change",t)},__onEnd:function(){this.emit("stop"),this.keepAlive||this.destroy()},__update:function(t,e){if("running"===this.__status){if(this.position>this.__long&&!this.__reversed&&!this.__infinite)return this.position=this.__long,this.pause(),this.__onEnd(),void 0;if(this.position<0&&this.__reversed&&!this.__infinite)return this.position=0,this.pause(),this.__onEnd(),void 0;e=this.__reversed?-e:e,this.position+=e;var n=this.__getTD();n&&(this.__runningTD!==n&&(this.__runningTD=n,this.__runningTD.__inited=!1),n.update(this,this.position))}},destroy:function(){this.__manager.__remove(this);for(var t in this.__tds)this.__tds[t].destroy();this.__tds=null,this.target=null,this.__currentTD=null}}),t.prototype={update:function(t,e){var n=e-this.__startPos;if(0!==this.repeat){if(this.__loops=Math.ceil(n/this.duration)-1,this.repeat>0&&this.__loops>this.repeat)return;n%=this.duration}else n=n>this.duration?this.duration:n;var i=t.target;if(!this.__inited){for(var o in this.__initState)i[o]=this.__initState[o];this.__inited=!0}var s;if(0===this.repeat)s=this.goTo(i,n);else{var r=this.__loops%2;s=r&&this.__loops>0&&this.yoyo?this.goTo(i,n,!0):this.goTo(i,n)}t.__onUpdate(s,this)},goTo:function(t,e,n){var i,o=this.__attriNames,s=this.__attr,r=t;if(this.cacheable){var a="p_"+10*(e/10>>0);i=this.__ratio[a],"p_0"===a&&(i=0),void 0===i&&(i=1);for(var l=o.length;l--;){var c=o[l];if(s[c]){var h=s[c].dVal[a];void 0===h&&(h=s[c].endVal),r[c]=h}}}else{0>e&&(e=0),i=this.easing(e,0,1,this.duration),e>this.duration&&(i=1);for(var l=o.length;l--;){var c=o[l];s[c]&&(r[c]=s[c].initVal+s[c].varVal*(n?1-i:i))}}return i},destroy:function(){this.__attr=null,this.__ratio=null,this.easing=null,this.target=null,this.onUpdate=null,this.onEnd=null}}}(),!function(){function t(t,e,n){this.duration=1e3*e,n=n||{},this.easing=n.easing||soya2d.Tween.Linear,this.repeat=n.repeat||0,this.yoyo=n.yoyo||!1,this.cacheable=n.cacheable||!1,this.delay=1e3*(n.delay||0),this.__pps=t,this.__radian=0,this.__loops=0}soya2d.class("soya2d.PathTween",{"extends":F,constructor:function(t){this.target=t,this.__tds={},this.__startTimes=[],this.__long=0,this.position=0,this.__reversed=!1,this.__paused=!1,this.__infinite=!1,this.__status="paused",this.__runningTD,this.__changeTimes=0,this.__lastChangeTD},__calc:function(t){var e=0,n=0,i=0,o=0,s=[];return"string"==typeof t&&(t=new soya2d.Path(t)),t._insQ.forEach(function(t){var r=t[0].toLowerCase();switch(r){case"m":i=e=parseFloat(t[1][0]),o=n=parseFloat(t[1][1]);break;case"l":for(var a=t[1],l=0;l<a.length;l+=2){for(var c=Math.atan2(a[l+1]-n,a[l]-e),h=soya2d.Math.len2D(e,n,a[l],a[l+1]),u=0;h>u;u++){var d=u*Math.cos(c)+e,f=u*Math.sin(c)+n;s.push(d,f)}e=parseFloat(a[l]),n=parseFloat(a[l+1])}break;case"c":for(var p=[],a=t[1],l=0;l<a.length;l+=6){for(var _=0;1>_;_+=.01){var y=_*_,m=y*_,d=e*(1-3*_+3*y-m)+3*a[l]*_*(1-2*_+y)+3*a[l+2]*y*(1-_)+a[l+4]*m,f=n*(1-3*_+3*y-m)+3*a[l+1]*_*(1-2*_+y)+3*a[l+3]*y*(1-_)+a[l+5]*m;p.push(d,f)}e=parseFloat(a[l+4]),n=parseFloat(a[l+5])}(p[p.length-2]!=a[a.length-2]||p[p.length-1]!=a[a.length-1])&&p.push(a[a.length-2],a[a.length-1]);for(var g=0,v={},l=0;l<p.length-2;l+=2){var h=soya2d.Math.len2D(p[l],p[l+1],p[l+2],p[l+3]),c=Math.atan2(p[l+3]-p[l+1],p[l+2]-p[l]);v[g]=[c,p[l],p[l+1],h],g+=h}for(var x=[p[0],p[1]],l=1;g>l;l++){for(var b,w,S,c=0,A=Object.keys(v),T=A.length;T--;)if(S=parseFloat(A[T]),l>=S){c=v[S][0],b=v[S][1],w=v[S][2];break}if(0!==c){var d=(l-S)*Math.cos(c)+b,f=(l-S)*Math.sin(c)+w;x.push(d,f)}}s=s.concat(x);break;case"q":for(var p=[],a=t[1],l=0;l<a.length;l+=4){for(var _=0;1>_;_+=.01){var y=_*_,m=y*_,d=e*(1-2*_+y)+2*a[l]*_*(1-_)+a[l+2]*y,f=n*(1-2*_+y)+2*a[l+1]*_*(1-_)+a[l+3]*y;p.push(d,f)}e=parseFloat(a[l+2]),n=parseFloat(a[l+3])}(p[p.length-2]!=a[a.length-2]||p[p.length-1]!=a[a.length-1])&&p.push(a[a.length-2],a[a.length-1]);for(var g=0,v={},l=0;l<p.length-2;l+=2){var h=soya2d.Math.len2D(p[l],p[l+1],p[l+2],p[l+3]),c=Math.atan2(p[l+3]-p[l+1],p[l+2]-p[l]);v[g]=[c,p[l],p[l+1],h],g+=h}for(var x=[p[0],p[1]],l=1;g>l;l++){for(var b,w,S,c=0,A=Object.keys(v),T=A.length;T--;)if(S=parseFloat(A[T]),l>=S){c=v[S][0],b=v[S][1],w=v[S][2];break}if(0!==c){var d=(l-S)*Math.cos(c)+b,f=(l-S)*Math.sin(c)+w;x.push(d,f)}}s=s.concat(x);break;case"z":for(var c=Math.atan2(o-n,i-e),h=soya2d.Math.len2D(e,n,i,o),u=0;h>u;u++){var d=u*Math.cos(c)+e,f=u*Math.sin(c)+n;s.push(d,f)}}},this),s},to:function(e,n,i){if(this.__infinite)return this;i=i||{};var o=i.easing||soya2d.Tween.Linear,s=this.__calc(e,n,o),r=new t(s,n,i);return this.__long+=r.delay,this.__tds[this.__long]=r,this.__startTimes.push(this.__long),r.__startPos=this.__long,-1===r.repeat&&(this.__infinite=!0,soya2d.console.warn("infinite loop instance")),this.__long+=r.duration*(r.repeat+1),this},play:function(t){return this.__reversed=!1,this.__status="running",this.keepAlive=t,this},reverse:function(){return this.__infinite?void 0:(this.__status="running",this.__reversed=!0,this)},pause:function(){return this.__status="paused",this.emit("pause"),this},restart:function(){return this.position=0,this.play(),this},__getTD:function(){for(var t=this.__startTimes.length;t--;)if(this.position>=this.__startTimes[t])return this.__tds[this.__startTimes[t]]},__onUpdate:function(t,e,n){this.emit("process",t,this.position/this.__long,e),(1===t&&!this.__reversed||0===t&&this.__reversed)&&this.__lastChangeTD!=n&&(this.__onChange(++this.__changeTimes),this.__lastChangeTD=n)},__onChange:function(t){this.emit("change",t)},__onEnd:function(){this.emit("stop"),this.keepAlive||this.destroy()},__update:function(t,e){if("running"===this.__status){if(this.position>this.__long&&!this.__reversed)return this.position=this.__long,this.pause(),this.__onEnd(),void 0;if(this.position<0&&this.__reversed)return this.position=0,this.pause(),this.__onEnd(),void 0;e=this.__reversed?-e:e,this.position+=e;var n=this.__getTD();n&&(this.__runningTD!==n&&(this.__runningTD=n,this.__runningTD.__inited=!1),n.update(this,this.position))}},destroy:function(){this.__manager.__remove(this);for(var t in this.__tds)this.__tds[t].destroy();this.__tds=null,this.target=null,this.__currentTD=null}}),t.prototype={update:function(t,e){var n=e-this.__startPos;if(0!==this.repeat){if(this.__loops=Math.ceil(n/this.duration)-1,this.repeat>0&&this.__loops>this.repeat)return;n%=this.duration}else n=n>this.duration?this.duration:n;var i=t.target;this.__inited||(i.x=this.__pps[0],i.y=this.__pps[1],this.__inited=!0);var o;if(0===this.repeat)o=this.goTo(i,n);else{var s=this.__loops%2;o=s&&this.__loops>0&&this.yoyo?this.goTo(i,n,!0):this.goTo(i,n)}t.__onUpdate(o,this.__radian*soya2d.Math.ONEANG,this)},goTo:function(t,e,n){var i,o=this.__pps,s=t;0>e&&(e=0),i=this.easing(e,0,1,this.duration);var r=(o.length-2)*(n?1-i:i)>>0;r>o.length-2&&(r=o.length-2),0>r&&(r*=-1),r%2!=0&&r++;var a=s.anchorPosition;s.x=o[r]-a.x,s.y=o[r+1]-a.y;var l,c,h=o[r],u=o[r+1];return 1>r?(l=o[r+2],c=o[r+3],this.__radian=Math.atan2(c-u,l-h)):(l=o[r-2],c=o[r-1],this.__radian=Math.atan2(u-c,h-l)),i},destroy:function(){this.__pps=null,this.easing=null,this.target=null,this.onUpdate=null,this.onEnd=null}}}(),soya2d.TweenManager=new function(){this.list=[],this.tweenMap={},this.add=function(t,e){var n=null;n=e===soya2d.TWEEN_TYPE_PATH?new soya2d.PathTween(t):new soya2d.Tween(t),this.list.push(n),n.__manager=this;var i=this.tweenMap[t.roid];return i||(i=this.tweenMap[t.roid]=[]),i.push(n),n},this.__remove=function(t){var e=this.list.indexOf(t);e>-1&&(this.list.splice(e,1),t.__manager=null,delete t.__manager);var n=this.tweenMap[t.target.roid];return n&&(e=n.indexOf(t),e>-1&&n.splice(e,1)),t},this.clearAll=function(t){var e=null;if(t){if(!this.tweenMap[t.roid])return;e=this.tweenMap[t.roid].concat()}else e=this.list.concat();for(var n=e.length;n--;)this.__remove(e[n])},this.pauseAll=function(t){var e=null;if(t){if(!this.tweenMap[t.roid])return;e=this.tweenMap[t.roid].concat()}else e=this.list.concat();for(var n=e.length;n--;)e[n].pause()},this.playAll=function(t){var e=null;if(t){if(!this.tweenMap[t.roid])return;e=this.tweenMap[t.roid].concat()}else e=this.list.concat();for(var n=e.length;n--;)e[n].play()},this.reverseAll=function(t){var e=null;if(t){if(!this.tweenMap[t.roid])return;e=this.tweenMap[t.roid].concat()}else e=this.list.concat();for(var n=e.length;n--;)e[n].reverse()},this.__refresh=function(){for(;;){for(var t=!0,e=this.list.length;e--;)this.list[e].target||(this.__remove(this.list[e]),t=!1);if(t)break}},this.__update=function(t,e){for(var n=!1,i=this.list.length;i--;)this.list[i].target?this.list[i].__update(t,e):n=!0;n&&this.__refresh()}},soya2d.TWEEN_TYPE_PATH=2,soya2d.Tween.Linear=function(t,e,n,i){return n*t/i+e},soya2d.Tween.Quad={In:function(t,e,n,i){return n*(t/=i)*t+e},Out:function(t,e,n,i){return-n*(t/=i)*(t-2)+e},InOut:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e}},soya2d.Tween.Cubic={In:function(t,e,n,i){return n*(t/=i)*t*t+e},Out:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},InOut:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e}},soya2d.Tween.Quart={In:function(t,e,n,i){return n*(t/=i)*t*t*t+e},Out:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},InOut:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e}},soya2d.Tween.Quint={In:function(t,e,n,i){return n*(t/=i)*t*t*t*t+e},Out:function(t,e,n,i){return n*((t=t/i-1)*t*t*t*t+1)+e},InOut:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e}},soya2d.Tween.Sine={In:function(t,e,n,i){return-n*Math.cos(t/i*(Math.PI/2))+n+e},Out:function(t,e,n,i){return n*Math.sin(t/i*(Math.PI/2))+e},InOut:function(t,e,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+e}},soya2d.Tween.Expo={In:function(t,e,n,i){return 0===t?e:n*Math.pow(2,10*(t/i-1))+e},Out:function(t,e,n,i){return t===i?e+n:n*(-Math.pow(2,-10*t/i)+1)+e},InOut:function(t,e,n,i){return 0===t?e:t===i?e+n:(t/=i/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(-Math.pow(2,-10*--t)+2)+e}},soya2d.Tween.Circ={In:function(t,e,n,i){return-n*(Math.sqrt(1-(t/=i)*t)-1)+e},Out:function(t,e,n,i){return n*Math.sqrt(1-(t=t/i-1)*t)+e},InOut:function(t,e,n,i){return(t/=i/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e}},soya2d.Tween.Elastic={In:function(t,e,n,i,o,s){if(0===t)return e;if(1===(t/=i))return e+n;if(s||(s=.3*i),!o||o<Math.abs(n)){o=n;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(n/o);return-(o*Math.pow(2,10*(t-=1))*Math.sin(2*(t*i-r)*Math.PI/s))+e},Out:function(t,e,n,i,o,s){if(0===t)return e;if(1===(t/=i))return e+n;if(s||(s=.3*i),!o||o<Math.abs(n)){o=n;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(n/o);return o*Math.pow(2,-10*t)*Math.sin(2*(t*i-r)*Math.PI/s)+n+e},InOut:function(t,e,n,i,o,s){if(0===t)return e;if(2===(t/=i/2))return e+n;if(s||(s=.3*i*1.5),!o||o<Math.abs(n)){o=n;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(n/o);return 1>t?-.5*o*Math.pow(2,10*(t-=1))*Math.sin(2*(t*i-r)*Math.PI/s)+e:o*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*i-r)*Math.PI/s)*.5+n+e}},soya2d.Tween.Back={In:function(t,e,n,i,o){return void 0===o&&(o=1.70158),n*(t/=i)*t*((o+1)*t-o)+e},Out:function(t,e,n,i,o){return void 0===o&&(o=.70158),n*((t=t/i-1)*t*((o+1)*t+o)+1)+e},InOut:function(t,e,n,i,o){return void 0===o&&(o=1.70158),(t/=i/2)<1?n/2*t*t*(((o*=1.525)+1)*t-o)+e:n/2*((t-=2)*t*(((o*=1.525)+1)*t+o)+2)+e}},soya2d.Tween.Bounce={In:function(t,e,n,i){return n-soya2d.Tween.Bounce.Out(i-t,0,n,i)+e},Out:function(t,e,n,i){return(t/=i)<1/2.75?7.5625*n*t*t+e:2/2.75>t?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},InOut:function(t,e,n,i){return i/2>t?.5*soya2d.Tween.Bounce.In(2*t,0,n,i)+e:.5*soya2d.Tween.Bounce.Out(2*t-i,0,n,i)+.5*n+e}},soya2d.module.install("tween",{onInit:function(t){t.tween=soya2d.TweenManager},onBeforeUpdate:function(t,e,n){soya2d.TweenManager.__update(e,n)},onStop:function(){soya2d.TweenManager.pauseAll()}}),soya2d.class("soya2d.Arc",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){t=t||{},this.bounds=new soya2d.Circle(0,0,this.w/2),this.fillStyle=t.fillStyle||"transparent"},onRender:function(t){t.beginPath();var e=this.w/2,n=this.h/2;t.fillStyle(this.fillStyle);var i=(this.startAngle||0)*soya2d.Math.ONERAD,o=(this.endAngle||0)*soya2d.Math.ONERAD;t.arc(e,n,this.w/2,i,o),o-i!=0&&360!=Math.abs(this.startAngle||0-this.endAngle||0)&&t.lineTo(e,n),t.fill(),t.closePath(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke()),t.moveTo(e,n)}}),soya2d.class("soya2d.Ellipse",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){t=t||{},this.fillStyle=t.fillStyle||"transparent"},onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.ellipse(0,0,this.w,this.h),t.closePath(),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.class("soya2d.Poly",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){t=t||{},this.bounds=new soya2d.Polygon(t.vtx),this.fillStyle=t.fillStyle||"transparent"},onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.polygon(this.vtx),t.fill(),t.closePath(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.class("soya2d.Rect",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){t=t||{},this.fillStyle=t.fillStyle||"transparent"},onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.rect(0,0,this.w,this.h),t.fill(),t.closePath(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.class("soya2d.RPoly",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){t=t||{},this.fillStyle=t.fillStyle||"transparent"},onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.regularPolygon(this.w/2,this.h/2,this.edgeCount,this.r||this.w/2,this.w/2),t.closePath(),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.class("soya2d.RRect",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){t=t||{},this.fillStyle=t.fillStyle||"transparent",this.r=t.r||0},onRender:function(t){t.beginPath(),t.moveTo(0,0),t.fillStyle(this.fillStyle),t.roundRect(0,0,this.w,this.h,this.r<0?0:this.r),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke()),t.closePath()}}),soya2d.class("soya2d.EArc",{"extends":soya2d.DisplayObjectContainer,constructor:function(t){t=t||{},this.fillStyle=t.fillStyle||"transparent"},onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle);var e=this.startAngle||0,n=this.endAngle||0;t.eArc(this.w/2,this.h/2,this.w/2,this.h/2,e,n),n-e!=0&&360!=Math.abs(e-n)&&t.lineTo(this.w/2,this.h/2),t.fill(),t.closePath(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.module.install("shapes",{onInit:function(t){t.objects.register("rect",soya2d.Rect),t.objects.register("rrect",soya2d.RRect),t.objects.register("poly",soya2d.Poly),t.objects.register("rpoly",soya2d.RPoly),t.objects.register("arc",soya2d.Arc),t.objects.register("earc",soya2d.EArc),t.objects.register("ellipse",soya2d.Ellipse)}}),!function(){var e=function(){this.init()};e.prototype={init:function(){var t=this||n;return t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.mobileAutoEnable=!0,t._setup(),t},volume:function(t){var e=this||n;if(t=parseFloat(t),e.ctx||h(),"undefined"!=typeof t&&t>=0&&1>=t){if(e._volume=t,e._muted)return e;e.usingWebAudio&&(e.masterGain.gain.value=t);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var o=e._howls[i]._getSoundIds(),s=0;s<o.length;s++){var r=e._howls[i]._soundById(o[s]);r&&r._node&&(r._node.volume=r._volume*t)}return e}return e._volume},mute:function(t){var e=this||n;e.ctx||h(),e._muted=t,e.usingWebAudio&&(e.masterGain.gain.value=t?0:e._volume);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var o=e._howls[i]._getSoundIds(),s=0;s<o.length;s++){var r=e._howls[i]._soundById(o[s]);r&&r._node&&(r._node.muted=!!t||r._muted)}return e},unload:function(){for(var t=this||n,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();
return t.usingWebAudio&&"undefined"!=typeof t.ctx.close&&(t.ctx.close(),t.ctx=null,h()),t},codecs:function(t){return(this||n)._codecs[t]},_setup:function(){var t=this||n;return t.state=t.ctx?t.ctx.state||"running":"running",t._autoSuspend(),t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||n,e="undefined"!=typeof Audio?new Audio:null;if(!e||"function"!=typeof e.canPlayType)return t;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,""),o=t._navigator&&t._navigator.userAgent.match(/OPR\/([0-6].)/g),s=o&&parseInt(o[0].split("/")[1],10)<33;return t._codecs={mp3:!(s||!i&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,"")},t},_enableMobileAudio:function(){var t=this||n,e=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(t._navigator&&t._navigator.userAgent),i=!!("ontouchend"in window||t._navigator&&t._navigator.maxTouchPoints>0||t._navigator&&t._navigator.msMaxTouchPoints>0);if(!t._mobileEnabled&&t.ctx&&(e||i)){t._mobileEnabled=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var o=function(){var e=t.ctx.createBufferSource();e.buffer=t._scratchBuffer,e.connect(t.ctx.destination),"undefined"==typeof e.start?e.noteOn(0):e.start(0),e.onended=function(){e.disconnect(0),t._mobileEnabled=!0,t.mobileAutoEnable=!1,document.removeEventListener("touchend",o,!0)}};return document.addEventListener("touchend",o,!0),t}},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&"undefined"!=typeof t.ctx.suspend&&n.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){t.autoSuspend&&(t._suspendTimer=null,t.state="suspending",t.ctx.suspend().then(function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())}))},3e4),t}},_autoResume:function(){var t=this;return t.ctx&&"undefined"!=typeof t.ctx.resume&&n.usingWebAudio?("running"===t.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state?(t.state="resuming",t.ctx.resume().then(function(){t.state="running"}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t):void 0}};var n=new e,i=function(t){var e=this;return t.src&&0!==t.src.length?void e.init(t):void console.error("An array of source files must be passed with any new Howl.")};i.prototype={init:function(t){var e=this;return n.ctx||h(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._webAudio=n.usingWebAudio&&!e._html5,"undefined"!=typeof n.ctx&&n.ctx&&n.mobileAutoEnable&&n._enableMobileAudio(),n._howls.push(e),e._preload&&e.load(),e},load:function(){var t=this,e=null;if(n.noAudio)return void t._emit("loaderror",null,"No audio support.");"string"==typeof t._src&&(t._src=[t._src]);for(var i=0;i<t._src.length;i++){var s,a;if(t._format&&t._format[i])s=t._format[i];else{if(a=t._src[i],"string"!=typeof a){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}s=/^data:audio\/([^;,]+);/i.exec(a),s||(s=/\.([^.]+)$/.exec(a.split("?",1)[0])),s&&(s=s[1].toLowerCase())}if(n.codecs(s)){e=t._src[i];break}}return e?(t._src=e,t._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(t._html5=!0,t._webAudio=!1),new o(t),t._webAudio&&r(t),t):void t._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(t,e){var i=this,o=null;if("number"==typeof t)o=t,t=null;else{if("string"==typeof t&&"loaded"===i._state&&!i._sprite[t])return null;if("undefined"==typeof t){t="__default";for(var s=0,r=0;r<i._sounds.length;r++)i._sounds[r]._paused&&!i._sounds[r]._ended&&(s++,o=i._sounds[r]._id);1===s?t=null:o=null}}var a=o?i._soundById(o):i._inactiveSound();if(!a)return null;if(o&&!t&&(t=a._sprite||"__default"),"loaded"!==i._state&&!i._sprite[t])return i._queue.push({event:"play",action:function(){i.play(i._soundById(a._id)?a._id:void 0)}}),a._id;if(o&&!a._paused)return e||setTimeout(function(){i._emit("play",a._id)},0),a._id;i._webAudio&&n._autoResume();var l=a._seek>0?a._seek:i._sprite[t][0]/1e3,c=(i._sprite[t][0]+i._sprite[t][1])/1e3-l,h=1e3*c/Math.abs(a._rate);a._paused=!1,a._ended=!1,a._sprite=t,a._seek=l,a._start=i._sprite[t][0]/1e3,a._stop=(i._sprite[t][0]+i._sprite[t][1])/1e3,a._loop=!(!a._loop&&!i._sprite[t][2]);var u=a._node;if(i._webAudio){var d=function(){i._refreshBuffer(a);var t=a._muted||i._muted?0:a._volume;u.gain.setValueAtTime(t,n.ctx.currentTime),a._playStart=n.ctx.currentTime,"undefined"==typeof u.bufferSource.start?a._loop?u.bufferSource.noteGrainOn(0,l,86400):u.bufferSource.noteGrainOn(0,l,c):a._loop?u.bufferSource.start(0,l,86400):u.bufferSource.start(0,l,c),h!==1/0&&(i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),h)),e||setTimeout(function(){i._emit("play",a._id)},0)};"loaded"===i._state?d():(i.once("load",d,a._id),i._clearTimer(a._id))}else{var f=function(){u.currentTime=l,u.muted=a._muted||i._muted||n._muted||u.muted,u.volume=a._volume*n.volume(),u.playbackRate=a._rate,setTimeout(function(){u.play(),h!==1/0&&(i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),h)),e||i._emit("play",a._id)},0)},p="loaded"===i._state&&(window&&window.ejecta||!u.readyState&&n._navigator.isCocoonJS);if(4===u.readyState||p)f();else{var _=function(){f(),u.removeEventListener(n._canPlayEvent,_,!1)};u.addEventListener(n._canPlayEvent,_,!1),i._clearTimer(a._id)}}return a._id},pause:function(t){var e=this;if("loaded"!==e._state)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var n=e._getSoundIds(t),i=0;i<n.length;i++){e._clearTimer(n[i]);var o=e._soundById(n[i]);if(o&&!o._paused){if(o._seek=e.seek(n[i]),o._rateSeek=0,o._paused=!0,e._stopFade(n[i]),o._node)if(e._webAudio){if(!o._node.bufferSource)return e;"undefined"==typeof o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),e._cleanBuffer(o._node)}else isNaN(o._node.duration)&&o._node.duration!==1/0||o._node.pause();arguments[1]||e._emit("pause",o._id)}}return e},stop:function(t,e){var n=this;if("loaded"!==n._state)return n._queue.push({event:"stop",action:function(){n.stop(t)}}),n;for(var i=n._getSoundIds(t),o=0;o<i.length;o++){n._clearTimer(i[o]);var s=n._soundById(i[o]);if(s&&!s._paused&&(s._seek=s._start||0,s._rateSeek=0,s._paused=!0,s._ended=!0,n._stopFade(i[o]),s._node))if(n._webAudio){if(!s._node.bufferSource)return n;"undefined"==typeof s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),n._cleanBuffer(s._node)}else isNaN(s._node.duration)&&s._node.duration!==1/0||(s._node.currentTime=s._start||0,s._node.pause());s&&!e&&n._emit("stop",s._id)}return n},mute:function(t,e){var i=this;if("loaded"!==i._state)return i._queue.push({event:"mute",action:function(){i.mute(t,e)}}),i;if("undefined"==typeof e){if("boolean"!=typeof t)return i._muted;i._muted=t}for(var o=i._getSoundIds(e),s=0;s<o.length;s++){var r=i._soundById(o[s]);r&&(r._muted=t,i._webAudio&&r._node?r._node.gain.setValueAtTime(t?0:r._volume,n.ctx.currentTime):r._node&&(r._node.muted=!!n._muted||t),i._emit("mute",r._id))}return i},volume:function(){var t,e,i=this,o=arguments;if(0===o.length)return i._volume;if(1===o.length){var s=i._getSoundIds(),r=s.indexOf(o[0]);r>=0?e=parseInt(o[0],10):t=parseFloat(o[0])}else o.length>=2&&(t=parseFloat(o[0]),e=parseInt(o[1],10));var a;if(!("undefined"!=typeof t&&t>=0&&1>=t))return a=e?i._soundById(e):i._sounds[0],a?a._volume:0;if("loaded"!==i._state)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,o)}}),i;"undefined"==typeof e&&(i._volume=t),e=i._getSoundIds(e);for(var l=0;l<e.length;l++)a=i._soundById(e[l]),a&&(a._volume=t,o[2]||i._stopFade(e[l]),i._webAudio&&a._node&&!a._muted?a._node.gain.setValueAtTime(t,n.ctx.currentTime):a._node&&!a._muted&&(a._node.volume=t*n.volume()),i._emit("volume",a._id));return i},fade:function(t,e,i,o){var s=this,r=Math.abs(t-e),a=t>e?"out":"in",l=r/.01,c=i/l;if("loaded"!==s._state)return s._queue.push({event:"fade",action:function(){s.fade(t,e,i,o)}}),s;s.volume(t,o);for(var h=s._getSoundIds(o),u=0;u<h.length;u++){var d=s._soundById(h[u]);if(d){if(o||s._stopFade(h[u]),s._webAudio&&!d._muted){var f=n.ctx.currentTime,p=f+i/1e3;d._volume=t,d._node.gain.setValueAtTime(t,f),d._node.gain.linearRampToValueAtTime(e,p)}var _=t;d._interval=setInterval(function(t,n){_+="in"===a?.01:-.01,_=Math.max(0,_),_=Math.min(1,_),_=Math.round(100*_)/100,s._webAudio?("undefined"==typeof o&&(s._volume=_),n._volume=_):s.volume(_,t,!0),_===e&&(clearInterval(n._interval),n._interval=null,s.volume(_,t),s._emit("fade",t))}.bind(s,h[u],d),c)}}return s},_stopFade:function(t){var e=this,i=e._soundById(t);return i&&i._interval&&(e._webAudio&&i._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(i._interval),i._interval=null,e._emit("fade",t)),e},loop:function(){var t,e,n,i=this,o=arguments;if(0===o.length)return i._loop;if(1===o.length){if("boolean"!=typeof o[0])return n=i._soundById(parseInt(o[0],10)),!!n&&n._loop;t=o[0],i._loop=t}else 2===o.length&&(t=o[0],e=parseInt(o[1],10));for(var s=i._getSoundIds(e),r=0;r<s.length;r++)n=i._soundById(s[r]),n&&(n._loop=t,i._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=t));return i},rate:function(){var t,e,i=this,o=arguments;if(0===o.length)e=i._sounds[0]._id;else if(1===o.length){var s=i._getSoundIds(),r=s.indexOf(o[0]);r>=0?e=parseInt(o[0],10):t=parseFloat(o[0])}else 2===o.length&&(t=parseFloat(o[0]),e=parseInt(o[1],10));var a;if("number"!=typeof t)return a=i._soundById(e),a?a._rate:i._rate;if("loaded"!==i._state)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,o)}}),i;"undefined"==typeof e&&(i._rate=t),e=i._getSoundIds(e);for(var l=0;l<e.length;l++)if(a=i._soundById(e[l])){a._rateSeek=i.seek(e[l]),a._playStart=i._webAudio?n.ctx.currentTime:a._playStart,a._rate=t,i._webAudio&&a._node&&a._node.bufferSource?a._node.bufferSource.playbackRate.value=t:a._node&&(a._node.playbackRate=t);var c=i.seek(e[l]),h=(i._sprite[a._sprite][0]+i._sprite[a._sprite][1])/1e3-c,u=1e3*h/Math.abs(a._rate);!i._endTimers[e[l]]&&a._paused||(i._clearTimer(e[l]),i._endTimers[e[l]]=setTimeout(i._ended.bind(i,a),u)),i._emit("rate",a._id)}return i},seek:function(){var t,e,i=this,o=arguments;if(0===o.length)e=i._sounds[0]._id;else if(1===o.length){var s=i._getSoundIds(),r=s.indexOf(o[0]);r>=0?e=parseInt(o[0],10):(e=i._sounds[0]._id,t=parseFloat(o[0]))}else 2===o.length&&(t=parseFloat(o[0]),e=parseInt(o[1],10));if("undefined"==typeof e)return i;if("loaded"!==i._state)return i._queue.push({event:"seek",action:function(){i.seek.apply(i,o)}}),i;var a=i._soundById(e);if(a){if(!("number"==typeof t&&t>=0)){if(i._webAudio){var l=i.playing(e)?n.ctx.currentTime-a._playStart:0,c=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(c+l*Math.abs(a._rate))}return a._node.currentTime}var h=i.playing(e);h&&i.pause(e,!0),a._seek=t,a._ended=!1,i._clearTimer(e),h&&i.play(e,!0),!i._webAudio&&a._node&&(a._node.currentTime=t),i._emit("seek",e)}return i},playing:function(t){var e=this;if("number"==typeof t){var n=e._soundById(t);return!!n&&!n._paused}for(var i=0;i<e._sounds.length;i++)if(!e._sounds[i]._paused)return!0;return!1},duration:function(t){var e=this,n=e._duration,i=e._soundById(t);return i&&(n=e._sprite[i._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,i=0;i<e.length;i++){e[i]._paused||(t.stop(e[i]._id),t._emit("end",e[i]._id)),t._webAudio||(e[i]._node.src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",e[i]._node.removeEventListener("error",e[i]._errorFn,!1),e[i]._node.removeEventListener(n._canPlayEvent,e[i]._loadFn,!1)),delete e[i]._node,t._clearTimer(e[i]._id);var o=n._howls.indexOf(t);o>=0&&n._howls.splice(o,1)}var r=!0;for(i=0;i<n._howls.length;i++)if(n._howls[i]._src===t._src){r=!1;break}return s&&r&&delete s[t._src],t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,n,i){var o=this,s=o["_on"+t];return"function"==typeof e&&s.push(i?{id:n,fn:e,once:i}:{id:n,fn:e}),o},off:function(t,e,n){var i=this,o=i["_on"+t],s=0;if(e){for(s=0;s<o.length;s++)if(e===o[s].fn&&n===o[s].id){o.splice(s,1);break}}else if(t)i["_on"+t]=[];else{var r=Object.keys(i);for(s=0;s<r.length;s++)0===r[s].indexOf("_on")&&Array.isArray(i[r[s]])&&(i[r[s]]=[])}return i},once:function(t,e,n){var i=this;return i.on(t,e,n,1),i},_emit:function(t,e,n){for(var i=this,o=i["_on"+t],s=o.length-1;s>=0;s--)o[s].id&&o[s].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,n)}.bind(i,o[s].fn),0),o[s].once&&i.off(t,o[s].fn,o[s].id));return i},_loadQueue:function(){var t=this;if(t._queue.length>0){var e=t._queue[0];t.once(e.event,function(){t._queue.shift(),t._loadQueue()}),e.action()}return t},_ended:function(t){var e=this,i=t._sprite,o=!(!t._loop&&!e._sprite[i][2]);if(e._emit("end",t._id),!e._webAudio&&o&&e.stop(t._id,!0).play(t._id),e._webAudio&&o){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=n.ctx.currentTime;var s=1e3*(t._stop-t._start)/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),s)}return e._webAudio&&!o&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),n._autoSuspend()),e._webAudio||o||e.stop(t._id),e},_clearTimer:function(t){var e=this;return e._endTimers[t]&&(clearTimeout(e._endTimers[t]),delete e._endTimers[t]),e},_soundById:function(t){for(var e=this,n=0;n<e._sounds.length;n++)if(t===e._sounds[n]._id)return e._sounds[n];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new o(t)},_drain:function(){var t=this,e=t._pool,n=0,i=0;if(!(t._sounds.length<e)){for(i=0;i<t._sounds.length;i++)t._sounds[i]._ended&&n++;for(i=t._sounds.length-1;i>=0;i--){if(e>=n)return;t._sounds[i]._ended&&(t._webAudio&&t._sounds[i]._node&&t._sounds[i]._node.disconnect(0),t._sounds.splice(i,1),n--)}}},_getSoundIds:function(t){var e=this;if("undefined"==typeof t){for(var n=[],i=0;i<e._sounds.length;i++)n.push(e._sounds[i]._id);return n}return[t]},_refreshBuffer:function(t){var e=this;return t._node.bufferSource=n.ctx.createBufferSource(),t._node.bufferSource.buffer=s[e._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop),t._node.bufferSource.playbackRate.value=t._rate,e},_cleanBuffer:function(t){var e=this;if(e._scratchBuffer){t.bufferSource.onended=null,t.bufferSource.disconnect(0);try{t.bufferSource.buffer=e._scratchBuffer}catch(t){}}return t.bufferSource=null,e}};var o=function(t){this._parent=t,this.init()};o.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._muted=e._muted,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=Math.round(Date.now()*Math.random()),e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,i=n._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node="undefined"==typeof n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),t._node.gain.setValueAtTime(i,n.ctx.currentTime),t._node.paused=!0,t._node.connect(n.masterGain)):(t._node=new Audio,t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(n._canPlayEvent,t._loadFn,!1),t._node.src=e._src,t._node.preload="auto",t._node.volume=i*n.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._muted=e._muted,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=Math.round(Date.now()*Math.random()),t},_errorListener:function(){var t=this;t._node.error&&4===t._node.error.code&&(n.noAudio=!0),t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorListener,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),e._autoplay&&e.play(),t._node.removeEventListener(n._canPlayEvent,t._loadFn,!1)}};var s={},r=function(t){var e=t._src;if(s[e])return t._duration=s[e].duration,void c(t);if(/^data:[^;]+;base64,/.test(e)){for(var n=atob(e.split(",")[1]),i=new Uint8Array(n.length),o=0;o<n.length;++o)i[o]=n.charCodeAt(o);l(i.buffer,t)}else{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){var e=(r.status+"")[0];return"0"!==e&&"2"!==e&&"3"!==e?void t._emit("loaderror",null,"Failed loading audio file with status: "+r.status+"."):void l(r.response,t)},r.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete s[e],t.load())},a(r)}},a=function(t){try{t.send()}catch(e){t.onerror()}},l=function(t,e){n.ctx.decodeAudioData(t,function(t){t&&e._sounds.length>0&&(s[e._src]=t,c(e,t))},function(){e._emit("loaderror",null,"Decoding audio data failed.")})},c=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),t._autoplay&&t.play()},h=function(){n.noAudio=!1;try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(t){n.usingWebAudio=!1}if(!n.usingWebAudio)if("undefined"!=typeof Audio)try{var t=new Audio;"undefined"==typeof t.oncanplaythrough&&(n._canPlayEvent="canplay")}catch(t){n.noAudio=!0}else n.noAudio=!0;try{var t=new Audio;t.muted&&(n.noAudio=!0)}catch(t){}var e=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),i=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),o=i?parseInt(i[1],10):null;if(e&&o&&9>o){var s=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());(n._navigator&&n._navigator.standalone&&!s||n._navigator&&!n._navigator.standalone&&!s)&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain="undefined"==typeof n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.value=1,n.masterGain.connect(n.ctx.destination)),n._setup()};"function"==typeof define&&define.amd&&define([],function(){return{Howler:n,Howl:i}}),"undefined"!=typeof exports&&(exports.Howler=n,exports.Howl=i),"undefined"!=typeof window?(window.HowlerGlobal=e,window.Howler=n,window.Howl=i,window.Sound=o):"undefined"!=typeof t&&(t.HowlerGlobal=e,t.Howler=n,t.Howl=i,t.Sound=o)}(),!function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var e=this;if(!e.ctx||!e.ctx.listener)return e;for(var n=e._howls.length-1;n>=0;n--)e._howls[n].stereo(t);return e},HowlerGlobal.prototype.pos=function(t,e,n){var i=this;return i.ctx&&i.ctx.listener?(e="number"!=typeof e?i._pos[1]:e,n="number"!=typeof n?i._pos[2]:n,"number"!=typeof t?i._pos:(i._pos=[t,e,n],i.ctx.listener.setPosition(i._pos[0],i._pos[1],i._pos[2]),i)):i},HowlerGlobal.prototype.orientation=function(t,e,n,i,o,s){var r=this;if(!r.ctx||!r.ctx.listener)return r;var a=r._orientation;return e="number"!=typeof e?a[1]:e,n="number"!=typeof n?a[2]:n,i="number"!=typeof i?a[3]:i,o="number"!=typeof o?a[4]:o,s="number"!=typeof s?a[5]:s,"number"!=typeof t?a:(r._orientation=[t,e,n,i,o,s],r.ctx.listener.setOrientation(t,e,n,i,o,s),r)},Howl.prototype.init=function(t){return function(e){var n=this;return n._orientation=e.orientation||[1,0,0],n._stereo=e.stereo||null,n._pos=e.pos||null,n._pannerAttr={coneInnerAngle:"undefined"!=typeof e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:"undefined"!=typeof e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:"undefined"!=typeof e.coneOuterGain?e.coneOuterGain:0,distanceModel:"undefined"!=typeof e.distanceModel?e.distanceModel:"inverse",maxDistance:"undefined"!=typeof e.maxDistance?e.maxDistance:1e4,panningModel:"undefined"!=typeof e.panningModel?e.panningModel:"HRTF",refDistance:"undefined"!=typeof e.refDistance?e.refDistance:1,rolloffFactor:"undefined"!=typeof e.rolloffFactor?e.rolloffFactor:1},n._onstereo=e.onstereo?[{fn:e.onstereo}]:[],n._onpos=e.onpos?[{fn:e.onpos}]:[],n._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,n){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"stereo",action:function(){i.stereo(e,n)}}),i;var o="undefined"==typeof Howler.ctx.createStereoPanner?"spatial":"stereo";if("undefined"==typeof n){if("number"!=typeof e)return i._stereo;i._stereo=e,i._pos=[e,0,0]}for(var s=i._getSoundIds(n),r=0;r<s.length;r++){var a=i._soundById(s[r]);if(a){if("number"!=typeof e)return a._stereo;a._stereo=e,a._pos=[e,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||t(a,o),"spatial"===o?a._panner.setPosition(e,0,0):a._panner.pan.value=e),i._emit("stereo",a._id)}}return i},Howl.prototype.pos=function(e,n,i,o){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"pos",action:function(){s.pos(e,n,i,o)}}),s;if(n="number"!=typeof n?0:n,i="number"!=typeof i?-.5:i,"undefined"==typeof o){if("number"!=typeof e)return s._pos;s._pos=[e,n,i]}for(var r=s._getSoundIds(o),a=0;a<r.length;a++){var l=s._soundById(r[a]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,n,i],l._node&&(l._panner&&!l._panner.pan||t(l,"spatial"),l._panner.setPosition(e,n,i)),s._emit("pos",l._id)}}return s},Howl.prototype.orientation=function(e,n,i,o){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"orientation",action:function(){s.orientation(e,n,i,o)}}),s;if(n="number"!=typeof n?s._orientation[1]:n,i="number"!=typeof i?s._orientation[2]:i,"undefined"==typeof o){if("number"!=typeof e)return s._orientation;s._orientation=[e,n,i]}for(var r=s._getSoundIds(o),a=0;a<r.length;a++){var l=s._soundById(r[a]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,n,i],l._node&&(l._panner||(l._pos||(l._pos=s._pos||[0,0,-.5]),t(l,"spatial")),l._panner.setOrientation(e,n,i)),s._emit("orientation",l._id)}}return s},Howl.prototype.pannerAttr=function(){var e,n,i,o=this,s=arguments;if(!o._webAudio)return o;if(0===s.length)return o._pannerAttr;if(1===s.length){if("object"!=typeof s[0])return i=o._soundById(parseInt(s[0],10)),i?i._pannerAttr:o._pannerAttr;e=s[0],"undefined"==typeof n&&(o._pannerAttr={coneInnerAngle:"undefined"!=typeof e.coneInnerAngle?e.coneInnerAngle:o._coneInnerAngle,coneOuterAngle:"undefined"!=typeof e.coneOuterAngle?e.coneOuterAngle:o._coneOuterAngle,coneOuterGain:"undefined"!=typeof e.coneOuterGain?e.coneOuterGain:o._coneOuterGain,distanceModel:"undefined"!=typeof e.distanceModel?e.distanceModel:o._distanceModel,maxDistance:"undefined"!=typeof e.maxDistance?e.maxDistance:o._maxDistance,panningModel:"undefined"!=typeof e.panningModel?e.panningModel:o._panningModel,refDistance:"undefined"!=typeof e.refDistance?e.refDistance:o._refDistance,rolloffFactor:"undefined"!=typeof e.rolloffFactor?e.rolloffFactor:o._rolloffFactor})}else 2===s.length&&(e=s[0],n=parseInt(s[1],10));for(var r=o._getSoundIds(n),a=0;a<r.length;a++)if(i=o._soundById(r[a])){var l=i._pannerAttr;l={coneInnerAngle:"undefined"!=typeof e.coneInnerAngle?e.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:"undefined"!=typeof e.coneOuterAngle?e.coneOuterAngle:l.coneOuterAngle,coneOuterGain:"undefined"!=typeof e.coneOuterGain?e.coneOuterGain:l.coneOuterGain,distanceModel:"undefined"!=typeof e.distanceModel?e.distanceModel:l.distanceModel,maxDistance:"undefined"!=typeof e.maxDistance?e.maxDistance:l.maxDistance,panningModel:"undefined"!=typeof e.panningModel?e.panningModel:l.panningModel,refDistance:"undefined"!=typeof e.refDistance?e.refDistance:l.refDistance,rolloffFactor:"undefined"!=typeof e.rolloffFactor?e.rolloffFactor:l.rolloffFactor};var c=i._panner;c?(c.coneInnerAngle=l.coneInnerAngle,c.coneOuterAngle=l.coneOuterAngle,c.coneOuterGain=l.coneOuterGain,c.distanceModel=l.distanceModel,c.maxDistance=l.maxDistance,c.panningModel=l.panningModel,c.refDistance=l.refDistance,c.rolloffFactor=l.rolloffFactor):(i._pos||(i._pos=o._pos||[0,0,-.5]),t(i,"spatial"))}return o},Sound.prototype.init=function(t){return function(){var e=this,n=e._parent;e._orientation=n._orientation,e._stereo=n._stereo,e._pos=n._pos,e._pannerAttr=n._pannerAttr,t.call(this),e._stereo?n.stereo(e._stereo):e._pos&&n.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this,n=e._parent;return e._orientation=n._orientation,e._pos=n._pos,e._pannerAttr=n._pannerAttr,t.call(this)}}(Sound.prototype.reset);var t=function(t,e){e=e||"spatial","spatial"===e?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.panningModel=t._pannerAttr.panningModel,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.value=t._stereo),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id)}}(),soya2d.Sound=function(t){t=t||{},this.__handler,this.src,this.__loop=t.loop||!1,this.__volume=t.volume||1,this.__muted=!1,this.__pos=0},soya2d.Sound.prototype={play:function(){return this.__handler.play(),this},pause:function(){return this.__handler.pause(),this},stop:function(){return this.pause(),this.loop(!1),this.__handler.stop(),this},mute:function(t){return void 0!=t?(this.__muted=t,t?this.__handler.mute(!0):this.__handler.mute(!1),this):this.__muted},loop:function(t){return void 0!=t?(this.__loop=t,this.__handler._loop=t,this):this.__loop},volume:function(t){return t?(this.__volume=t,this.__handler.volume(t),this):this.__volume},pos:function(t){return t?(this.__pos=t,this.__handler.pos(t),this):this.__pos},fade:function(t,e,n){return this.__handler.fade(t,e,n),this},on:function(t,e){return this.__handler.on(t,e),this},once:function(t,e){return this.__handler.once(t,e),this},off:function(t,e){return this.__handler.off(t,e),this}},soya2d.SoundManager=function(t){this.game=t,this.__sounds=t.assets.__assets.sound,this.muteAll=function(t){for(var e in this.__sounds)this.__sounds[e].mute(t)},this.stopAll=function(){for(var t in this.__sounds)this.__sounds[t].stop()}},soya2d.module.install("sound",{onInit:function(t){t.sound=new soya2d.SoundManager(t)},onStop:function(t){t.sound.stopAll()}}),!function(){function t(t){return"string"==typeof t||t instanceof Image||t instanceof Array?new soya2d.Sprite({images:t}):t instanceof soya2d.DisplayObject?t:(soya2d.console.error("soya2d.Emitter: invalid param [particles]; "+t),void 0)}function e(t,e){var n=(soya2d.Math,e/1e3);return t.lifeSpan-=n,t.lifeSpan<=0?(t.visible=!1,t.deadRate=0,void 0):(t.deadRate=t.lifeSpan/t.__maxLifeSpan,t.__speed.add(t.__deltaSpeed).add(t.__radialAcc),0!==t.__tanAcc&&(t.__tanDir.set(t.__speed.e[0],t.__speed.e[1]).rotate(t.__tans),t.__tans+=t.__tanAcc,t.__tans%=360,t.__speed.set(t.__tanDir.e[0],t.__tanDir.e[1])),t.x=t.__sx+t.__speed.e[0],t.y=t.__sy+t.__speed.e[1],void 0)}function n(t,e){var n=soya2d.Math,i=t.lifeSpan=e.lifeSpan;t.__maxLifeSpan=i,t.__sx=n.randomi(0,e.w-t.w),t.__sy=n.randomi(0,e.h-t.h);var o=e.maxAngle?e.maxAngle-e.minAngle:0,s=e.minAngle+o*Math.random();s=n.floor(s%=360);var r=e.maxSpeed?e.maxSpeed-e.minSpeed:0,a=e.minSpeed+r*Math.random(),l=new soya2d.Vector(n.COSTABLE[s],n.SINTABLE[s]);t.__speed=l.clone().mul(a),t.__deltaSpeed=new soya2d.Vector(t.__speed.e[0]/i,t.__speed.e[1]/i);var c=e.maxRadAcc?e.maxRadAcc-e.minRadAcc:0;t.__radialAcc=l.mul(e.minRadAcc+c*Math.random());var h=e.maxTanAcc?e.maxTanAcc-e.minTanAcc:0;t.__tanAcc=e.minTanAcc+h*Math.random(),0!==t.__tanAcc&&(t.__tans=t.__tanAcc,t.__tanDir=new soya2d.Vector(0,0))}soya2d.class("soya2d.Emitter",{"extends":soya2d.DisplayObjectContainer,constructor:function(e){var n=e||{};this.__particles=[],this.frequency=1e3*n.frequency||100,this.size=n.size,this.quantity=n.quantity||1,this.__template=t(n.particles),this.lifeSpan=n.lifeSpan||1,this.minSpeed=n.minSpeed||0,this.maxSpeed=n.maxSpeed||0,this.minRadAcc=n.minRadAcc||0,this.maxRadAcc=n.maxRadAcc||0,this.minTanAcc=n.minTanAcc||0,this.maxTanAcc=n.maxTanAcc||0,this.minAngle=n.minAngle||0,this.maxAngle=n.maxAngle||0;for(var i=this.size;i--;){var o=this.__template.clone();o.visible=!1,o.lifeSpan=0,o.deadRate=0,o.blendMode=n.blendMode,this.__particles.push(o)}this.__deltaSum=0,this.running=!1},tween:{__ts:[],add:function(){var t={__tds:[],to:function(t,e,n){return this.__tds.push([t,e,n]),this}};return this.__ts.push(t),t}},emit:function(){return this.running?void 0:(this.__particles.forEach(function(t){this.add(t)},this),this.running=!0,this.stopping&&clearTimeout(this.stopping),this)},stop:function(t){if(this.running){if(t>0){var e=this;return this.stopping=setTimeout(function(){e.running=!1,e.stopping=null,e.__particles.forEach(function(t){e.add(t)})},t),void 0}return this.running=!1,this}},_onUpdate:function(t,i){if(this.running){this.__deltaSum+=i;var o=0,s=this.__particles;if(this.__deltaSum>=this.frequency&&this.running&&(o=this.__deltaSum/this.frequency>>0,this.__deltaSum=0),o>0&&this.running){o=this.quantity;for(var r=this.size;r--&&o;){var a=s[r];a.lifeSpan<=0&&(this.onActive&&this.onActive(a),n(a,this),this.tween.__ts.length>0&&this.tween.__ts.forEach(function(e){var n=t.tween.add(a);e.__tds.forEach(function(t){n.to(t[0],t[1],t[2])}),n.play()}),o>0&&o--)}}for(var r=s.length;r--;){var a=s[r];a.lifeSpan>0&&(e(a,i),a.visible||(a.visible=!0))}this.onRunning&&this.onRunning(s)}}})}(),soya2d.module.install("particles",{onInit:function(t){t.objects.register("emitter",soya2d.Emitter)
}}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof t?t:"undefined"!=typeof self?self:this,n.Matter=e()}}(function(){return function t(e,n,i){function o(r,a){if(!n[r]){if(!e[r]){var l="function"==typeof require&&require;if(!a&&l)return l(r,!0);if(s)return s(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[r]={exports:{}};e[r][0].call(h.exports,function(t){var n=e[r][1][t];return o(n?n:t)},h,h.exports,t,e,n,i)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(t,e){var n={};e.exports=n;var i=t("../geometry/Vertices"),o=t("../geometry/Vector"),s=t("../core/Sleeping"),r=(t("../render/Render"),t("../core/Common")),a=t("../geometry/Bounds"),l=t("../geometry/Axes");!function(){n._inertiaScale=4,n._nextCollidingGroupId=1,n._nextNonCollidingGroupId=-1,n._nextCategory=1,n.create=function(e){var n={id:r.nextId(),type:"body",label:"Body",parts:[],angle:0,vertices:i.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:1.5}},o=r.extend(n,e);return t(o,e),o},n.nextGroup=function(t){return t?n._nextNonCollidingGroupId--:n._nextCollidingGroupId++},n.nextCategory=function(){return n._nextCategory=n._nextCategory<<1,n._nextCategory};var t=function(t,e){n.set(t,{bounds:t.bounds||a.create(t.vertices),positionPrev:t.positionPrev||o.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),i.rotate(t.vertices,t.angle,t.position),l.rotate(t.axes,t.angle),a.update(t.bounds,t.vertices,t.velocity),n.set(t,{axes:e.axes||t.axes,area:e.area||t.area,mass:e.mass||t.mass,inertia:e.inertia||t.inertia});var s=t.isStatic?"#eeeeee":r.choose(["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"]),c=r.shadeColor(s,-20);t.render.fillStyle=t.render.fillStyle||s,t.render.strokeStyle=t.render.strokeStyle||c,t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};n.set=function(t,e,i){var o;"string"==typeof e&&(o=e,e={},e[o]=i);for(o in e)if(i=e[o],e.hasOwnProperty(o))switch(o){case"isStatic":n.setStatic(t,i);break;case"isSleeping":s.set(t,i);break;case"mass":n.setMass(t,i);break;case"density":n.setDensity(t,i);break;case"inertia":n.setInertia(t,i);break;case"vertices":n.setVertices(t,i);break;case"position":n.setPosition(t,i);break;case"angle":n.setAngle(t,i);break;case"velocity":n.setVelocity(t,i);break;case"angularVelocity":n.setAngularVelocity(t,i);break;case"parts":n.setParts(t,i);break;default:t[o]=i}},n.setStatic=function(t,e){for(var n=0;n<t.parts.length;n++){var i=t.parts[n];i.isStatic=e,e&&(i.restitution=0,i.friction=1,i.mass=i.inertia=i.density=1/0,i.inverseMass=i.inverseInertia=0,i.positionPrev.x=i.position.x,i.positionPrev.y=i.position.y,i.anglePrev=i.angle,i.angularVelocity=0,i.speed=0,i.angularSpeed=0,i.motion=0)}},n.setMass=function(t,e){t.mass=e,t.inverseMass=1/t.mass,t.density=t.mass/t.area},n.setDensity=function(t,e){n.setMass(t,e*t.area),t.density=e},n.setInertia=function(t,e){t.inertia=e,t.inverseInertia=1/t.inertia},n.setVertices=function(t,e){t.vertices=e[0].body===t?e:i.create(e,t),t.axes=l.fromVertices(t.vertices),t.area=i.area(t.vertices),n.setMass(t,t.density*t.area);var o=i.centre(t.vertices);i.translate(t.vertices,o,-1),n.setInertia(t,n._inertiaScale*i.inertia(t.vertices,t.mass)),i.translate(t.vertices,t.position),a.update(t.bounds,t.vertices,t.velocity)},n.setParts=function(t,o,s){var r;for(o=o.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,r=0;r<o.length;r++){var a=o[r];a!==t&&(a.parent=t,t.parts.push(a))}if(1!==t.parts.length){if(s="undefined"!=typeof s?s:!0){var l=[];for(r=0;r<o.length;r++)l=l.concat(o[r].vertices);i.clockwiseSort(l);var c=i.hull(l),h=i.centre(c);n.setVertices(t,c),i.translate(t.vertices,h)}var u=e(t);t.area=u.area,t.parent=t,t.position.x=u.centre.x,t.position.y=u.centre.y,t.positionPrev.x=u.centre.x,t.positionPrev.y=u.centre.y,n.setMass(t,u.mass),n.setInertia(t,u.inertia),n.setPosition(t,u.centre)}},n.setPosition=function(t,e){var n=o.sub(e,t.position);t.positionPrev.x+=n.x,t.positionPrev.y+=n.y;for(var s=0;s<t.parts.length;s++){var r=t.parts[s];r.position.x+=n.x,r.position.y+=n.y,i.translate(r.vertices,n),a.update(r.bounds,r.vertices,t.velocity)}},n.setAngle=function(t,e){var n=e-t.angle;t.anglePrev+=n;for(var s=0;s<t.parts.length;s++){var r=t.parts[s];r.angle+=n,i.rotate(r.vertices,n,t.position),l.rotate(r.axes,n),a.update(r.bounds,r.vertices,t.velocity),s>0&&o.rotateAbout(r.position,n,t.position,r.position)}},n.setVelocity=function(t,e){t.positionPrev.x=t.position.x-e.x,t.positionPrev.y=t.position.y-e.y,t.velocity.x=e.x,t.velocity.y=e.y,t.speed=o.magnitude(t.velocity)},n.setAngularVelocity=function(t,e){t.anglePrev=t.angle-e,t.angularVelocity=e,t.angularSpeed=Math.abs(t.angularVelocity)},n.translate=function(t,e){n.setPosition(t,o.add(t.position,e))},n.rotate=function(t,e){n.setAngle(t,t.angle+e)},n.scale=function(t,o,s){for(var r=0;r<t.parts.length;r++){var c=t.parts[r];i.scale(c.vertices,o,s,t.position),c.axes=l.fromVertices(c.vertices),t.isStatic||(c.area=i.area(c.vertices),n.setMass(c,t.density*c.area),i.translate(c.vertices,{x:-c.position.x,y:-c.position.y}),n.setInertia(c,i.inertia(c.vertices,c.mass)),i.translate(c.vertices,{x:c.position.x,y:c.position.y})),a.update(c.bounds,c.vertices,t.velocity)}if(t.circleRadius&&(o===s?t.circleRadius*=o:t.circleRadius=null),!t.isStatic){var h=e(t);t.area=h.area,n.setMass(t,h.mass),n.setInertia(t,h.inertia)}},n.update=function(t,e,n,s){var r=Math.pow(e*n*t.timeScale,2),c=1-t.frictionAir*n*t.timeScale,h=t.position.x-t.positionPrev.x,u=t.position.y-t.positionPrev.y;t.velocity.x=h*c*s+t.force.x/t.mass*r,t.velocity.y=u*c*s+t.force.y/t.mass*r,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.angularVelocity=(t.angle-t.anglePrev)*c*s+t.torque/t.inertia*r,t.anglePrev=t.angle,t.angle+=t.angularVelocity,t.speed=o.magnitude(t.velocity),t.angularSpeed=Math.abs(t.angularVelocity);for(var d=0;d<t.parts.length;d++){var f=t.parts[d];i.translate(f.vertices,t.velocity),d>0&&(f.position.x+=t.velocity.x,f.position.y+=t.velocity.y),0!==t.angularVelocity&&(i.rotate(f.vertices,t.angularVelocity,t.position),l.rotate(f.axes,t.angularVelocity),d>0&&o.rotateAbout(f.position,t.angularVelocity,t.position,f.position)),a.update(f.bounds,f.vertices,t.velocity)}},n.applyForce=function(t,e,n){t.force.x+=n.x,t.force.y+=n.y;var i={x:e.x-t.position.x,y:e.y-t.position.y};t.torque+=i.x*n.y-i.y*n.x};var e=function(t){for(var e={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===t.parts.length?0:1;n<t.parts.length;n++){var i=t.parts[n];e.mass+=i.mass,e.area+=i.area,e.inertia+=i.inertia,e.centre=o.add(e.centre,o.mult(i.position,i.mass!==1/0?i.mass:1))}return e.centre=o.div(e.centre,e.mass!==1/0?e.mass:t.parts.length),e}}()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29}],2:[function(t,e){var n={};e.exports=n;var i=t("../core/Events"),o=t("../core/Common"),s=t("./Body");!function(){n.create=function(t){return o.extend({id:o.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite"},t)},n.setModified=function(t,e,i,o){if(t.isModified=e,i&&t.parent&&n.setModified(t.parent,e,i,o),o)for(var s=0;s<t.composites.length;s++){var r=t.composites[s];n.setModified(r,e,i,o)}},n.add=function(t,e){var s=[].concat(e);i.trigger(t,"beforeAdd",{object:e});for(var r=0;r<s.length;r++){var a=s[r];switch(a.type){case"body":if(a.parent!==a){o.log("Composite.add: skipped adding a compound body part (you must add its parent instead)","warn");break}n.addBody(t,a);break;case"constraint":n.addConstraint(t,a);break;case"composite":n.addComposite(t,a);break;case"mouseConstraint":n.addConstraint(t,a.constraint)}}return i.trigger(t,"afterAdd",{object:e}),t},n.remove=function(t,e,o){var s=[].concat(e);i.trigger(t,"beforeRemove",{object:e});for(var r=0;r<s.length;r++){var a=s[r];switch(a.type){case"body":n.removeBody(t,a,o);break;case"constraint":n.removeConstraint(t,a,o);break;case"composite":n.removeComposite(t,a,o);break;case"mouseConstraint":n.removeConstraint(t,a.constraint)}}return i.trigger(t,"afterRemove",{object:e}),t},n.addComposite=function(t,e){return t.composites.push(e),e.parent=t,n.setModified(t,!0,!0,!1),t},n.removeComposite=function(t,e,i){var s=o.indexOf(t.composites,e);if(-1!==s&&(n.removeCompositeAt(t,s),n.setModified(t,!0,!0,!1)),i)for(var r=0;r<t.composites.length;r++)n.removeComposite(t.composites[r],e,!0);return t},n.removeCompositeAt=function(t,e){return t.composites.splice(e,1),n.setModified(t,!0,!0,!1),t},n.addBody=function(t,e){return t.bodies.push(e),n.setModified(t,!0,!0,!1),t},n.removeBody=function(t,e,i){var s=o.indexOf(t.bodies,e);if(-1!==s&&(n.removeBodyAt(t,s),n.setModified(t,!0,!0,!1)),i)for(var r=0;r<t.composites.length;r++)n.removeBody(t.composites[r],e,!0);return t},n.removeBodyAt=function(t,e){return t.bodies.splice(e,1),n.setModified(t,!0,!0,!1),t},n.addConstraint=function(t,e){return t.constraints.push(e),n.setModified(t,!0,!0,!1),t},n.removeConstraint=function(t,e,i){var s=o.indexOf(t.constraints,e);if(-1!==s&&n.removeConstraintAt(t,s),i)for(var r=0;r<t.composites.length;r++)n.removeConstraint(t.composites[r],e,!0);return t},n.removeConstraintAt=function(t,e){return t.constraints.splice(e,1),n.setModified(t,!0,!0,!1),t},n.clear=function(t,e,i){if(i)for(var o=0;o<t.composites.length;o++)n.clear(t.composites[o],e,!0);return e?t.bodies=t.bodies.filter(function(t){return t.isStatic}):t.bodies.length=0,t.constraints.length=0,t.composites.length=0,n.setModified(t,!0,!0,!1),t},n.allBodies=function(t){for(var e=[].concat(t.bodies),i=0;i<t.composites.length;i++)e=e.concat(n.allBodies(t.composites[i]));return e},n.allConstraints=function(t){for(var e=[].concat(t.constraints),i=0;i<t.composites.length;i++)e=e.concat(n.allConstraints(t.composites[i]));return e},n.allComposites=function(t){for(var e=[].concat(t.composites),i=0;i<t.composites.length;i++)e=e.concat(n.allComposites(t.composites[i]));return e},n.get=function(t,e,i){var o,s;switch(i){case"body":o=n.allBodies(t);break;case"constraint":o=n.allConstraints(t);break;case"composite":o=n.allComposites(t).concat(t)}return o?(s=o.filter(function(t){return t.id.toString()===e.toString()}),0===s.length?null:s[0]):null},n.move=function(t,e,i){return n.remove(t,e),n.add(i,e),t},n.rebase=function(t){for(var e=n.allBodies(t).concat(n.allConstraints(t)).concat(n.allComposites(t)),i=0;i<e.length;i++)e[i].id=o.nextId();return n.setModified(t,!0,!0,!1),t},n.translate=function(t,e,i){for(var o=i?n.allBodies(t):t.bodies,r=0;r<o.length;r++)s.translate(o[r],e);return n.setModified(t,!0,!0,!1),t},n.rotate=function(t,e,i,o){for(var r=Math.cos(e),a=Math.sin(e),l=o?n.allBodies(t):t.bodies,c=0;c<l.length;c++){var h=l[c],u=h.position.x-i.x,d=h.position.y-i.y;s.setPosition(h,{x:i.x+(u*r-d*a),y:i.y+(u*a+d*r)}),s.rotate(h,e)}return n.setModified(t,!0,!0,!1),t},n.scale=function(t,e,i,o,r){for(var a=r?n.allBodies(t):t.bodies,l=0;l<a.length;l++){var c=a[l],h=c.position.x-o.x,u=c.position.y-o.y;s.setPosition(c,{x:o.x+h*e,y:o.y+u*i}),s.scale(c,e,i)}return n.setModified(t,!0,!0,!1),t}}()},{"../core/Common":14,"../core/Events":16,"./Body":1}],3:[function(t,e){var n={};e.exports=n;var i=t("./Composite"),o=(t("../constraint/Constraint"),t("../core/Common"));!function(){n.create=function(t){var e=i.create(),n={label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-(1/0),y:-(1/0)},max:{x:1/0,y:1/0}}};return o.extend(e,n,t)}}()},{"../constraint/Constraint":12,"../core/Common":14,"./Composite":2}],4:[function(t,e){var n={};e.exports=n,function(){n.create=function(t){return{id:n.id(t),vertex:t,normalImpulse:0,tangentImpulse:0}},n.id=function(t){return t.body.id+"_"+t.index}}()},{}],5:[function(t,e){var n={};e.exports=n;var i=t("./SAT"),o=t("./Pair"),s=t("../geometry/Bounds");!function(){n.collisions=function(t,e){for(var r=[],a=e.pairs.table,l=0;l<t.length;l++){var c=t[l][0],h=t[l][1];if((!c.isStatic&&!c.isSleeping||!h.isStatic&&!h.isSleeping)&&n.canCollide(c.collisionFilter,h.collisionFilter)&&s.overlaps(c.bounds,h.bounds))for(var u=c.parts.length>1?1:0;u<c.parts.length;u++)for(var d=c.parts[u],f=h.parts.length>1?1:0;f<h.parts.length;f++){var p=h.parts[f];if(d===c&&p===h||s.overlaps(d.bounds,p.bounds)){var _,y=o.id(d,p),m=a[y];_=m&&m.isActive?m.collision:null;var g=i.collides(d,p,_);g.collided&&r.push(g)}}}return r},n.canCollide=function(t,e){return t.group===e.group&&0!==t.group?t.group>0:0!==(t.mask&e.category)&&0!==(e.mask&t.category)}}()},{"../geometry/Bounds":24,"./Pair":7,"./SAT":11}],6:[function(t,e){var n={};e.exports=n;var i=t("./Pair"),o=t("./Detector"),s=t("../core/Common");!function(){n.create=function(t){var e={controller:n,detector:o.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return s.extend(e,t)},n.update=function(n,i,o,s){var r,d,f,p,_,y=o.world,m=n.buckets,g=!1;for(r=0;r<i.length;r++){var v=i[r];if((!v.isSleeping||s)&&!(v.bounds.max.x<y.bounds.min.x||v.bounds.min.x>y.bounds.max.x||v.bounds.max.y<y.bounds.min.y||v.bounds.min.y>y.bounds.max.y)){var x=e(n,v);if(!v.region||x.id!==v.region.id||s){v.region&&!s||(v.region=x);var b=t(x,v.region);for(d=b.startCol;d<=b.endCol;d++)for(f=b.startRow;f<=b.endRow;f++){_=a(d,f),p=m[_];var w=d>=x.startCol&&d<=x.endCol&&f>=x.startRow&&f<=x.endRow,S=d>=v.region.startCol&&d<=v.region.endCol&&f>=v.region.startRow&&f<=v.region.endRow;!w&&S&&S&&p&&h(n,p,v),(v.region===x||w&&!S||s)&&(p||(p=l(m,_)),c(n,p,v))}v.region=x,g=!0}}}g&&(n.pairsList=u(n))},n.clear=function(t){t.buckets={},t.pairs={},t.pairsList=[]};var t=function(t,e){var n=Math.min(t.startCol,e.startCol),i=Math.max(t.endCol,e.endCol),o=Math.min(t.startRow,e.startRow),s=Math.max(t.endRow,e.endRow);return r(n,i,o,s)},e=function(t,e){var n=e.bounds,i=Math.floor(n.min.x/t.bucketWidth),o=Math.floor(n.max.x/t.bucketWidth),s=Math.floor(n.min.y/t.bucketHeight),a=Math.floor(n.max.y/t.bucketHeight);return r(i,o,s,a)},r=function(t,e,n,i){return{id:t+","+e+","+n+","+i,startCol:t,endCol:e,startRow:n,endRow:i}},a=function(t,e){return t+","+e},l=function(t,e){var n=t[e]=[];return n},c=function(t,e,n){for(var o=0;o<e.length;o++){var s=e[o];if(!(n.id===s.id||n.isStatic&&s.isStatic)){var r=i.id(n,s),a=t.pairs[r];a?a[2]+=1:t.pairs[r]=[n,s,1]}}e.push(n)},h=function(t,e,n){e.splice(s.indexOf(e,n),1);for(var o=0;o<e.length;o++){var r=e[o],a=i.id(n,r),l=t.pairs[a];l&&(l[2]-=1)}},u=function(t){var e,n,i=[];e=s.keys(t.pairs);for(var o=0;o<e.length;o++)n=t.pairs[e[o]],n[2]>0?i.push(n):delete t.pairs[e[o]];return i}}()},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(t,e){var n={};e.exports=n;var i=t("./Contact");!function(){n.create=function(t,e){var i=t.bodyA,o=t.bodyB,s=t.parentA,r=t.parentB,a={id:n.id(i,o),bodyA:i,bodyB:o,contacts:{},activeContacts:[],separation:0,isActive:!0,isSensor:i.isSensor||o.isSensor,timeCreated:e,timeUpdated:e,inverseMass:s.inverseMass+r.inverseMass,friction:Math.min(s.friction,r.friction),frictionStatic:Math.max(s.frictionStatic,r.frictionStatic),restitution:Math.max(s.restitution,r.restitution),slop:Math.max(s.slop,r.slop)};return n.update(a,t,e),a},n.update=function(t,e,o){var s=t.contacts,r=e.supports,a=t.activeContacts,l=e.parentA,c=e.parentB;if(t.collision=e,t.inverseMass=l.inverseMass+c.inverseMass,t.friction=Math.min(l.friction,c.friction),t.frictionStatic=Math.max(l.frictionStatic,c.frictionStatic),t.restitution=Math.max(l.restitution,c.restitution),t.slop=Math.max(l.slop,c.slop),a.length=0,e.collided){for(var h=0;h<r.length;h++){var u=r[h],d=i.id(u),f=s[d];f?a.push(f):a.push(s[d]=i.create(u))}t.separation=e.depth,n.setActive(t,!0,o)}else t.isActive===!0&&n.setActive(t,!1,o)},n.setActive=function(t,e,n){e?(t.isActive=!0,t.timeUpdated=n):(t.isActive=!1,t.activeContacts.length=0)},n.id=function(t,e){return t.id<e.id?t.id+"_"+e.id:e.id+"_"+t.id}}()},{"./Contact":4}],8:[function(t,e){var n={};e.exports=n;var i=t("./Pair"),o=t("../core/Common");!function(){var t=1e3;n.create=function(t){return o.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},t)},n.update=function(t,e,n){var s,r,a,l,c=t.list,h=t.table,u=t.collisionStart,d=t.collisionEnd,f=t.collisionActive,p=[];for(u.length=0,d.length=0,f.length=0,l=0;l<e.length;l++)s=e[l],s.collided&&(r=i.id(s.bodyA,s.bodyB),p.push(r),a=h[r],a?(a.isActive?f.push(a):u.push(a),i.update(a,s,n)):(a=i.create(s,n),h[r]=a,u.push(a),c.push(a)));for(l=0;l<c.length;l++)a=c[l],a.isActive&&-1===o.indexOf(p,a.id)&&(i.setActive(a,!1,n),d.push(a))},n.removeOld=function(e,n){var i,o,s,r,a=e.list,l=e.table,c=[];for(r=0;r<a.length;r++)i=a[r],o=i.collision,o.bodyA.isSleeping||o.bodyB.isSleeping?i.timeUpdated=n:n-i.timeUpdated>t&&c.push(r);for(r=0;r<c.length;r++)s=c[r]-r,i=a[s],delete l[i.id],a.splice(s,1)},n.clear=function(t){return t.table={},t.list.length=0,t.collisionStart.length=0,t.collisionActive.length=0,t.collisionEnd.length=0,t}}()},{"../core/Common":14,"./Pair":7}],9:[function(t,e){var n={};e.exports=n;var i=t("../geometry/Vector"),o=t("./SAT"),s=t("../geometry/Bounds"),r=t("../factory/Bodies"),a=t("../geometry/Vertices");!function(){n.ray=function(t,e,n,a){a=a||1e-100;for(var l=i.angle(e,n),c=i.magnitude(i.sub(e,n)),h=.5*(n.x+e.x),u=.5*(n.y+e.y),d=r.rectangle(h,u,c,a,{angle:l}),f=[],p=0;p<t.length;p++){var _=t[p];if(s.overlaps(_.bounds,d.bounds))for(var y=1===_.parts.length?0:1;y<_.parts.length;y++){var m=_.parts[y];if(s.overlaps(m.bounds,d.bounds)){var g=o.collides(m,d);if(g.collided){g.body=g.bodyA=g.bodyB=_,f.push(g);break}}}}return f},n.region=function(t,e,n){for(var i=[],o=0;o<t.length;o++){var r=t[o],a=s.overlaps(r.bounds,e);(a&&!n||!a&&n)&&i.push(r)}return i},n.point=function(t,e){for(var n=[],i=0;i<t.length;i++){var o=t[i];if(s.contains(o.bounds,e))for(var r=1===o.parts.length?0:1;r<o.parts.length;r++){var l=o.parts[r];if(s.contains(l.bounds,e)&&a.contains(l.vertices,e)){n.push(o);break}}}return n}}()},{"../factory/Bodies":21,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27,"./SAT":11}],10:[function(t,e){var n={};e.exports=n;var i=t("../geometry/Vertices"),o=t("../geometry/Vector"),s=t("../core/Common"),r=t("../geometry/Bounds");!function(){n._restingThresh=4,n._restingThreshTangent=6,n._positionDampen=.9,n._positionWarming=.8,n._frictionNormalMultiplier=5,n.preSolvePosition=function(t){var e,n,i;for(e=0;e<t.length;e++)n=t[e],n.isActive&&(i=n.activeContacts.length,n.collision.parentA.totalContacts+=i,n.collision.parentB.totalContacts+=i)},n.solvePosition=function(t,e){var i,s,r,a,l,c,h,u,d,f=o._temp[0],p=o._temp[1],_=o._temp[2],y=o._temp[3];for(i=0;i<t.length;i++)s=t[i],s.isActive&&!s.isSensor&&(r=s.collision,a=r.parentA,l=r.parentB,c=r.normal,h=o.sub(o.add(l.positionImpulse,l.position,f),o.add(a.positionImpulse,o.sub(l.position,r.penetration,p),_),y),s.separation=o.dot(c,h));for(i=0;i<t.length;i++)s=t[i],!s.isActive||s.isSensor||s.separation<0||(r=s.collision,a=r.parentA,l=r.parentB,c=r.normal,d=(s.separation-s.slop)*e,(a.isStatic||l.isStatic)&&(d*=2),a.isStatic||a.isSleeping||(u=n._positionDampen/a.totalContacts,a.positionImpulse.x+=c.x*d*u,a.positionImpulse.y+=c.y*d*u),l.isStatic||l.isSleeping||(u=n._positionDampen/l.totalContacts,l.positionImpulse.x-=c.x*d*u,l.positionImpulse.y-=c.y*d*u))},n.postSolvePosition=function(t){for(var e=0;e<t.length;e++){var s=t[e];if(s.totalContacts=0,0!==s.positionImpulse.x||0!==s.positionImpulse.y){for(var a=0;a<s.parts.length;a++){var l=s.parts[a];i.translate(l.vertices,s.positionImpulse),r.update(l.bounds,l.vertices,s.velocity),l.position.x+=s.positionImpulse.x,l.position.y+=s.positionImpulse.y}s.positionPrev.x+=s.positionImpulse.x,s.positionPrev.y+=s.positionImpulse.y,o.dot(s.positionImpulse,s.velocity)<0?(s.positionImpulse.x=0,s.positionImpulse.y=0):(s.positionImpulse.x*=n._positionWarming,s.positionImpulse.y*=n._positionWarming)}}},n.preSolveVelocity=function(t){var e,n,i,s,r,a,l,c,h,u,d,f,p,_,y=o._temp[0],m=o._temp[1];for(e=0;e<t.length;e++)if(i=t[e],i.isActive&&!i.isSensor)for(s=i.activeContacts,r=i.collision,a=r.parentA,l=r.parentB,c=r.normal,h=r.tangent,n=0;n<s.length;n++)u=s[n],d=u.vertex,f=u.normalImpulse,p=u.tangentImpulse,0===f&&0===p||(y.x=c.x*f+h.x*p,y.y=c.y*f+h.y*p,a.isStatic||a.isSleeping||(_=o.sub(d,a.position,m),a.positionPrev.x+=y.x*a.inverseMass,a.positionPrev.y+=y.y*a.inverseMass,a.anglePrev+=o.cross(_,y)*a.inverseInertia),l.isStatic||l.isSleeping||(_=o.sub(d,l.position,m),l.positionPrev.x-=y.x*l.inverseMass,l.positionPrev.y-=y.y*l.inverseMass,l.anglePrev-=o.cross(_,y)*l.inverseInertia))},n.solveVelocity=function(t,e){for(var i=e*e,r=o._temp[0],a=o._temp[1],l=o._temp[2],c=o._temp[3],h=o._temp[4],u=o._temp[5],d=0;d<t.length;d++){var f=t[d];if(f.isActive&&!f.isSensor){var p=f.collision,_=p.parentA,y=p.parentB,m=p.normal,g=p.tangent,v=f.activeContacts,x=1/v.length;_.velocity.x=_.position.x-_.positionPrev.x,_.velocity.y=_.position.y-_.positionPrev.y,y.velocity.x=y.position.x-y.positionPrev.x,y.velocity.y=y.position.y-y.positionPrev.y,_.angularVelocity=_.angle-_.anglePrev,y.angularVelocity=y.angle-y.anglePrev;for(var b=0;b<v.length;b++){var w=v[b],S=w.vertex,A=o.sub(S,_.position,a),T=o.sub(S,y.position,l),M=o.add(_.velocity,o.mult(o.perp(A),_.angularVelocity),c),C=o.add(y.velocity,o.mult(o.perp(T),y.angularVelocity),h),E=o.sub(M,C,u),k=o.dot(m,E),I=o.dot(g,E),P=Math.abs(I),O=s.sign(I),B=(1+f.restitution)*k,R=s.clamp(f.separation+k,0,1)*n._frictionNormalMultiplier,D=I,L=1/0;P>f.friction*f.frictionStatic*R*i&&(L=P,D=s.clamp(f.friction*O*i,-L,L));var F=o.cross(A,m),N=o.cross(T,m),V=x/(_.inverseMass+y.inverseMass+_.inverseInertia*F*F+y.inverseInertia*N*N);if(B*=V,D*=V,0>k&&k*k>n._restingThresh*i)w.normalImpulse=0;else{var j=w.normalImpulse;w.normalImpulse=Math.min(w.normalImpulse+B,0),B=w.normalImpulse-j}if(I*I>n._restingThreshTangent*i)w.tangentImpulse=0;else{var G=w.tangentImpulse;w.tangentImpulse=s.clamp(w.tangentImpulse+D,-L,L),D=w.tangentImpulse-G}r.x=m.x*B+g.x*D,r.y=m.y*B+g.y*D,_.isStatic||_.isSleeping||(_.positionPrev.x+=r.x*_.inverseMass,_.positionPrev.y+=r.y*_.inverseMass,_.anglePrev+=o.cross(A,r)*_.inverseInertia),y.isStatic||y.isSleeping||(y.positionPrev.x-=r.x*y.inverseMass,y.positionPrev.y-=r.y*y.inverseMass,y.anglePrev-=o.cross(T,r)*y.inverseInertia)}}}}}()},{"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],11:[function(t,e){var n={};e.exports=n;var i=t("../geometry/Vertices"),o=t("../geometry/Vector");!function(){n.collides=function(e,n,r){var a,l,c,h,u=r,d=!1;if(u){var f=e.parent,p=n.parent,_=f.speed*f.speed+f.angularSpeed*f.angularSpeed+p.speed*p.speed+p.angularSpeed*p.angularSpeed;d=u&&u.collided&&.2>_,h=u}else h={collided:!1,bodyA:e,bodyB:n};if(u&&d){var y=h.axisBody,m=y===e?n:e,g=[y.axes[u.axisNumber]];if(c=t(y.vertices,m.vertices,g),h.reused=!0,c.overlap<=0)return h.collided=!1,h}else{if(a=t(e.vertices,n.vertices,e.axes),a.overlap<=0)return h.collided=!1,h;if(l=t(n.vertices,e.vertices,n.axes),l.overlap<=0)return h.collided=!1,h;a.overlap<l.overlap?(c=a,h.axisBody=e):(c=l,h.axisBody=n),h.axisNumber=c.axisNumber}h.bodyA=e.id<n.id?e:n,h.bodyB=e.id<n.id?n:e,h.collided=!0,h.normal=c.axis,h.depth=c.overlap,h.parentA=h.bodyA.parent,h.parentB=h.bodyB.parent,e=h.bodyA,n=h.bodyB,o.dot(h.normal,o.sub(n.position,e.position))>0&&(h.normal=o.neg(h.normal)),h.tangent=o.perp(h.normal),h.penetration={x:h.normal.x*h.depth,y:h.normal.y*h.depth};var v=s(e,n,h.normal),x=h.supports||[];if(x.length=0,i.contains(e.vertices,v[0])&&x.push(v[0]),i.contains(e.vertices,v[1])&&x.push(v[1]),x.length<2){var b=s(n,e,o.neg(h.normal));i.contains(n.vertices,b[0])&&x.push(b[0]),x.length<2&&i.contains(n.vertices,b[1])&&x.push(b[1])}return x.length<1&&(x=[v[0]]),h.supports=x,h};var t=function(t,n,i){for(var s,r,a=o._temp[0],l=o._temp[1],c={overlap:Number.MAX_VALUE},h=0;h<i.length;h++){if(r=i[h],e(a,t,r),e(l,n,r),s=Math.min(a.max-l.min,l.max-a.min),0>=s)return c.overlap=s,c;s<c.overlap&&(c.overlap=s,c.axis=r,c.axisNumber=h)}return c},e=function(t,e,n){for(var i=o.dot(e[0],n),s=i,r=1;r<e.length;r+=1){var a=o.dot(e[r],n);a>s?s=a:i>a&&(i=a)}t.min=i,t.max=s},s=function(t,e,n){for(var i,s,r,a,l=Number.MAX_VALUE,c=o._temp[0],h=e.vertices,u=t.position,d=0;d<h.length;d++)s=h[d],c.x=s.x-u.x,c.y=s.y-u.y,i=-o.dot(n,c),l>i&&(l=i,r=s);var f=r.index-1>=0?r.index-1:h.length-1;s=h[f],c.x=s.x-u.x,c.y=s.y-u.y,l=-o.dot(n,c),a=s;var p=(r.index+1)%h.length;return s=h[p],c.x=s.x-u.x,c.y=s.y-u.y,i=-o.dot(n,c),l>i&&(a=s),[r,a]}}()},{"../geometry/Vector":26,"../geometry/Vertices":27}],12:[function(t,e){var n={};e.exports=n;var i=t("../geometry/Vertices"),o=t("../geometry/Vector"),s=t("../core/Sleeping"),r=t("../geometry/Bounds"),a=t("../geometry/Axes"),l=t("../core/Common");!function(){var t=1e-6,e=.001;n.create=function(e){var n=e;n.bodyA&&!n.pointA&&(n.pointA={x:0,y:0}),n.bodyB&&!n.pointB&&(n.pointB={x:0,y:0});var i=n.bodyA?o.add(n.bodyA.position,n.pointA):n.pointA,s=n.bodyB?o.add(n.bodyB.position,n.pointB):n.pointB,r=o.magnitude(o.sub(i,s));n.length=n.length||r||t;var a={visible:!0,lineWidth:2,strokeStyle:"#666"};return n.render=l.extend(a,n.render),n.id=n.id||l.nextId(),n.label=n.label||"Constraint",n.type="constraint",n.stiffness=n.stiffness||1,n.angularStiffness=n.angularStiffness||0,n.angleA=n.bodyA?n.bodyA.angle:n.angleA,n.angleB=n.bodyB?n.bodyB.angle:n.angleB,n},n.solveAll=function(t,e){for(var i=0;i<t.length;i++)n.solve(t[i],e)},n.solve=function(n,i){var s=n.bodyA,r=n.bodyB,a=n.pointA,l=n.pointB;s&&!s.isStatic&&(n.pointA=o.rotate(a,s.angle-n.angleA),n.angleA=s.angle),r&&!r.isStatic&&(n.pointB=o.rotate(l,r.angle-n.angleB),n.angleB=r.angle);var c=a,h=l;if(s&&(c=o.add(s.position,a)),r&&(h=o.add(r.position,l)),c&&h){var u=o.sub(c,h),d=o.magnitude(u);0===d&&(d=t);var f=(d-n.length)/d,p=o.div(u,d),_=o.mult(u,.5*f*n.stiffness*i*i);if(!(Math.abs(1-d/n.length)<e*i)){var y,m,g,v,x,b,w,S;s&&!s.isStatic?(g={x:c.x-s.position.x+_.x,y:c.y-s.position.y+_.y},s.velocity.x=s.position.x-s.positionPrev.x,s.velocity.y=s.position.y-s.positionPrev.y,s.angularVelocity=s.angle-s.anglePrev,y=o.add(s.velocity,o.mult(o.perp(g),s.angularVelocity)),x=o.dot(g,p),w=s.inverseMass+s.inverseInertia*x*x):(y={x:0,y:0},w=s?s.inverseMass:0),r&&!r.isStatic?(v={x:h.x-r.position.x-_.x,y:h.y-r.position.y-_.y},r.velocity.x=r.position.x-r.positionPrev.x,r.velocity.y=r.position.y-r.positionPrev.y,r.angularVelocity=r.angle-r.anglePrev,m=o.add(r.velocity,o.mult(o.perp(v),r.angularVelocity)),b=o.dot(v,p),S=r.inverseMass+r.inverseInertia*b*b):(m={x:0,y:0},S=r?r.inverseMass:0);var A=o.sub(m,y),T=o.dot(p,A)/(w+S);T>0&&(T=0);var M,C={x:p.x*T,y:p.y*T};s&&!s.isStatic&&(M=o.cross(g,C)*s.inverseInertia*(1-n.angularStiffness),s.constraintImpulse.x-=_.x,s.constraintImpulse.y-=_.y,s.constraintImpulse.angle+=M,s.position.x-=_.x,s.position.y-=_.y,s.angle+=M),r&&!r.isStatic&&(M=o.cross(v,C)*r.inverseInertia*(1-n.angularStiffness),r.constraintImpulse.x+=_.x,r.constraintImpulse.y+=_.y,r.constraintImpulse.angle-=M,r.position.x+=_.x,r.position.y+=_.y,r.angle-=M)}}},n.postSolveAll=function(t){for(var e=0;e<t.length;e++){var n=t[e],l=n.constraintImpulse;if(0!==l.x||0!==l.y||0!==l.angle){s.set(n,!1);for(var c=0;c<n.parts.length;c++){var h=n.parts[c];i.translate(h.vertices,l),c>0&&(h.position.x+=l.x,h.position.y+=l.y),0!==l.angle&&(i.rotate(h.vertices,l.angle,n.position),a.rotate(h.axes,l.angle),c>0&&o.rotateAbout(h.position,l.angle,n.position,h.position)),r.update(h.bounds,h.vertices,n.velocity)}l.angle=0,l.x=0,l.y=0}}}}()},{"../core/Common":14,"../core/Sleeping":20,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],13:[function(t,e){var n={};e.exports=n;var i=t("../geometry/Vertices"),o=t("../core/Sleeping"),s=t("../core/Mouse"),r=t("../core/Events"),a=t("../collision/Detector"),l=t("./Constraint"),c=t("../body/Composite"),h=t("../core/Common"),u=t("../geometry/Bounds");!function(){n.create=function(e,i){var o=(e?e.mouse:null)||(i?i.mouse:null);o||(e&&e.render&&e.render.canvas?o=s.create(e.render.canvas):i&&i.element?o=s.create(i.element):(o=s.create(),h.log("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected","warn")));var a=l.create({label:"Mouse Constraint",pointA:o.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),u={type:"mouseConstraint",mouse:o,element:null,body:null,constraint:a,collisionFilter:{category:1,mask:4294967295,group:0}},d=h.extend(u,i);return r.on(e,"tick",function(){var i=c.allBodies(e.world);n.update(d,i),t(d)}),d},n.update=function(t,e){var n=t.mouse,s=t.constraint,l=t.body;if(0===n.button){if(s.bodyB)o.set(s.bodyB,!1),s.pointA=n.position;else for(var c=0;c<e.length;c++)if(l=e[c],u.contains(l.bounds,n.position)&&a.canCollide(l.collisionFilter,t.collisionFilter))for(var h=l.parts.length>1?1:0;h<l.parts.length;h++){var d=l.parts[h];if(i.contains(d.vertices,n.position)){s.pointA=n.position,s.bodyB=t.body=l,s.pointB={x:n.position.x-l.position.x,y:n.position.y-l.position.y},s.angleB=l.angle,o.set(l,!1),r.trigger(t,"startdrag",{mouse:n,body:l});break}}}else s.bodyB=t.body=null,s.pointB=null,l&&r.trigger(t,"enddrag",{mouse:n,body:l})};var t=function(t){var e=t.mouse,n=e.sourceEvents;n.mousemove&&r.trigger(t,"mousemove",{mouse:e}),n.mousedown&&r.trigger(t,"mousedown",{mouse:e}),n.mouseup&&r.trigger(t,"mouseup",{mouse:e}),s.clearSourceEvents(e)}}()},{"../body/Composite":2,"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":18,"../core/Sleeping":20,"../geometry/Bounds":24,"../geometry/Vertices":27,"./Constraint":12}],14:[function(t,e){var n={};e.exports=n,function(){n._nextId=0,n._seed=0,n.extend=function(t,e){var i,o,s;"boolean"==typeof e?(i=2,s=e):(i=1,s=!0),o=Array.prototype.slice.call(arguments,i);for(var r=0;r<o.length;r++){var a=o[r];if(a)for(var l in a)s&&a[l]&&a[l].constructor===Object?t[l]&&t[l].constructor!==Object?t[l]=a[l]:(t[l]=t[l]||{},n.extend(t[l],s,a[l])):t[l]=a[l]}return t},n.clone=function(t,e){return n.extend({},e,t)},n.keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)e.push(n);return e},n.values=function(t){var e=[];if(Object.keys){for(var n=Object.keys(t),i=0;i<n.length;i++)e.push(t[n[i]]);return e}for(var o in t)e.push(t[o]);return e},n.shadeColor=function(t,e){var n=parseInt(t.slice(1),16),i=Math.round(2.55*e),o=(n>>16)+i,s=(n>>8&255)+i,r=(255&n)+i;return"#"+(16777216+65536*(255>o?1>o?0:o:255)+256*(255>s?1>s?0:s:255)+(255>r?1>r?0:r:255)).toString(16).slice(1)},n.shuffle=function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(n.random()*(e+1)),o=t[e];t[e]=t[i],t[i]=o}return t},n.choose=function(t){return t[Math.floor(n.random()*t.length)]},n.isElement=function(t){try{return t instanceof HTMLElement}catch(e){return"object"==typeof t&&1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument}},n.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},n.clamp=function(t,e,n){return e>t?e:t>n?n:t},n.sign=function(t){return 0>t?-1:1},n.now=function(){var t=window.performance||{};return t.now=function(){return t.now||t.webkitNow||t.msNow||t.oNow||t.mozNow||function(){return+new Date
}}(),t.now()},n.random=function(e,n){return e="undefined"!=typeof e?e:0,n="undefined"!=typeof n?n:1,e+t()*(n-e)},n.colorToNumber=function(t){return t=t.replace("#",""),3==t.length&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),parseInt(t,16)},n.log=function(t,e){if(console&&console.log&&console.warn)switch(e){case"warn":console.warn("Matter.js:",t);break;case"error":console.log("Matter.js:",t)}},n.nextId=function(){return n._nextId++},n.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1};var t=function(){return n._seed=(9301*n._seed+49297)%233280,n._seed/233280}}()},{}],15:[function(t,e){var n={};e.exports=n;var i=t("../body/World"),o=t("./Sleeping"),s=t("../collision/Resolver"),r=t("../render/Render"),a=t("../collision/Pairs"),l=(t("./Metrics"),t("../collision/Grid")),c=t("./Events"),h=t("../body/Composite"),u=t("../constraint/Constraint"),d=t("./Common"),f=t("../body/Body");!function(){n.create=function(t,e){e=d.isElement(t)?e:t,t=d.isElement(t)?t:null,e=e||{},(t||e.render)&&d.log("Engine.create: engine.render is deprecated (see docs)","warn");var n={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],timing:{timestamp:0,timeScale:1},broadphase:{controller:l}},o=d.extend(n,e);if(t||o.render){var s={element:t,controller:r};o.render=d.extend(s,o.render)}return o.render&&o.render.controller&&(o.render=o.render.controller.create(o.render)),o.render&&(o.render.engine=o),o.world=e.world||i.create(o.world),o.pairs=a.create(),o.broadphase=o.broadphase.controller.create(o.broadphase),o.metrics=o.metrics||{extended:!1},o},n.update=function(n,i,r){i=i||1e3/60,r=r||1;var l,d=n.world,f=n.timing,_=n.broadphase,y=[];f.timestamp+=i*f.timeScale;var m={timestamp:f.timestamp};c.trigger(n,"beforeUpdate",m);var g=h.allBodies(d),v=h.allConstraints(d);for(n.enableSleeping&&o.update(g,f.timeScale),e(g,d.gravity),p(g,i,f.timeScale,r,d.bounds),l=0;l<n.constraintIterations;l++)u.solveAll(v,f.timeScale);u.postSolveAll(g),_.controller?(d.isModified&&_.controller.clear(_),_.controller.update(_,g,n,d.isModified),y=_.pairsList):y=g,d.isModified&&h.setModified(d,!1,!1,!0);var x=_.detector(y,n),b=n.pairs,w=f.timestamp;for(a.update(b,x,w),a.removeOld(b,w),n.enableSleeping&&o.afterCollisions(b.list,f.timeScale),b.collisionStart.length>0&&c.trigger(n,"collisionStart",{pairs:b.collisionStart}),s.preSolvePosition(b.list),l=0;l<n.positionIterations;l++)s.solvePosition(b.list,f.timeScale);for(s.postSolvePosition(g),s.preSolveVelocity(b.list),l=0;l<n.velocityIterations;l++)s.solveVelocity(b.list,f.timeScale);return b.collisionActive.length>0&&c.trigger(n,"collisionActive",{pairs:b.collisionActive}),b.collisionEnd.length>0&&c.trigger(n,"collisionEnd",{pairs:b.collisionEnd}),t(g),c.trigger(n,"afterUpdate",m),n},n.merge=function(t,e){if(d.extend(t,e),e.world){t.world=e.world,n.clear(t);for(var i=h.allBodies(t.world),s=0;s<i.length;s++){var r=i[s];o.set(r,!1),r.id=d.nextId()}}},n.clear=function(t){var e=t.world;a.clear(t.pairs);var n=t.broadphase;if(n.controller){var i=h.allBodies(e);n.controller.clear(n),n.controller.update(n,i,t,!0)}};var t=function(t){for(var e=0;e<t.length;e++){var n=t[e];n.force.x=0,n.force.y=0,n.torque=0}},e=function(t,e){var n="undefined"!=typeof e.scale?e.scale:.001;if((0!==e.x||0!==e.y)&&0!==n)for(var i=0;i<t.length;i++){var o=t[i];o.isStatic||o.isSleeping||(o.force.y+=o.mass*e.y*n,o.force.x+=o.mass*e.x*n)}},p=function(t,e,n,i){for(var o=0;o<t.length;o++){var s=t[o];s.isStatic||s.isSleeping||f.update(s,e,n,i)}}}()},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":29,"./Common":14,"./Events":16,"./Metrics":17,"./Sleeping":20}],16:[function(t,e){var n={};e.exports=n;var i=t("./Common");!function(){n.on=function(t,e,n){for(var i,o=e.split(" "),s=0;s<o.length;s++)i=o[s],t.events=t.events||{},t.events[i]=t.events[i]||[],t.events[i].push(n);return n},n.off=function(t,e,n){if(!e)return void(t.events={});"function"==typeof e&&(n=e,e=i.keys(t.events).join(" "));for(var o=e.split(" "),s=0;s<o.length;s++){var r=t.events[o[s]],a=[];if(n&&r)for(var l=0;l<r.length;l++)r[l]!==n&&a.push(r[l]);t.events[o[s]]=a}},n.trigger=function(t,e,n){var o,s,r,a;if(t.events){n||(n={}),o=e.split(" ");for(var l=0;l<o.length;l++)if(s=o[l],r=t.events[s]){a=i.clone(n,!1),a.name=s,a.source=t;for(var c=0;c<r.length;c++)r[c].apply(t,[a])}}}}()},{"./Common":14}],17:[function(){},{"../body/Composite":2,"./Common":14}],18:[function(t,e){var n={};e.exports=n;var i=t("../core/Common");!function(){n.create=function(e){var o={};return e||i.log("Mouse.create: element was undefined, defaulting to document.body","warn"),o.element=e||document.body,o.absolute={x:0,y:0},o.position={x:0,y:0},o.mousedownPosition={x:0,y:0},o.mouseupPosition={x:0,y:0},o.offset={x:0,y:0},o.scale={x:1,y:1},o.wheelDelta=0,o.button=-1,o.pixelRatio=o.element.getAttribute("data-pixel-ratio")||1,o.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},o.mousemove=function(e){var n=t(e,o.element,o.pixelRatio),i=e.changedTouches;i&&(o.button=0,e.preventDefault()),o.absolute.x=n.x,o.absolute.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.sourceEvents.mousemove=e},o.mousedown=function(e){var n=t(e,o.element,o.pixelRatio),i=e.changedTouches;i?(o.button=0,e.preventDefault()):o.button=e.button,o.absolute.x=n.x,o.absolute.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mousedownPosition.x=o.position.x,o.mousedownPosition.y=o.position.y,o.sourceEvents.mousedown=e},o.mouseup=function(e){var n=t(e,o.element,o.pixelRatio),i=e.changedTouches;i&&e.preventDefault(),o.button=-1,o.absolute.x=n.x,o.absolute.y=n.y,o.position.x=o.absolute.x*o.scale.x+o.offset.x,o.position.y=o.absolute.y*o.scale.y+o.offset.y,o.mouseupPosition.x=o.position.x,o.mouseupPosition.y=o.position.y,o.sourceEvents.mouseup=e},o.mousewheel=function(t){o.wheelDelta=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),t.preventDefault()},n.setElement(o,o.element),o},n.setElement=function(t,e){t.element=e,e.addEventListener("mousemove",t.mousemove),e.addEventListener("mousedown",t.mousedown),e.addEventListener("mouseup",t.mouseup),e.addEventListener("mousewheel",t.mousewheel),e.addEventListener("DOMMouseScroll",t.mousewheel),e.addEventListener("touchmove",t.mousemove),e.addEventListener("touchstart",t.mousedown),e.addEventListener("touchend",t.mouseup)},n.clearSourceEvents=function(t){t.sourceEvents.mousemove=null,t.sourceEvents.mousedown=null,t.sourceEvents.mouseup=null,t.sourceEvents.mousewheel=null,t.wheelDelta=0},n.setOffset=function(t,e){t.offset.x=e.x,t.offset.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},n.setScale=function(t,e){t.scale.x=e.x,t.scale.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y};var t=function(t,e,n){var i,o,s=e.getBoundingClientRect(),r=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:r.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:r.scrollTop,c=t.changedTouches;return c?(i=c[0].pageX-s.left-a,o=c[0].pageY-s.top-l):(i=t.pageX-s.left-a,o=t.pageY-s.top-l),{x:i/(e.clientWidth/e.width*n),y:o/(e.clientHeight/e.height*n)}}}()},{"../core/Common":14}],19:[function(t,e){var n={};e.exports=n;var i=t("./Events"),o=t("./Engine"),s=t("./Common");!function(){var t,e;"undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(function(){t(s.now())},1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n.create=function(t){var e={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},n=s.extend(e,t);return n.delta=n.delta||1e3/n.fps,n.deltaMin=n.deltaMin||1e3/n.fps,n.deltaMax=n.deltaMax||1e3/(.5*n.fps),n.fps=1e3/n.delta,n},n.run=function(e,i){return"undefined"!=typeof e.positionIterations&&(i=e,e=n.create()),function o(s){e.frameRequestId=t(o),s&&e.enabled&&n.tick(e,i,s)}(),e},n.tick=function(t,e,n){var s,r=e.timing,a=1,l={timestamp:r.timestamp};i.trigger(t,"beforeTick",l),i.trigger(e,"beforeTick",l),t.isFixed?s=t.delta:(s=n-t.timePrev||t.delta,t.timePrev=n,t.deltaHistory.push(s),t.deltaHistory=t.deltaHistory.slice(-t.deltaSampleSize),s=Math.min.apply(null,t.deltaHistory),s=s<t.deltaMin?t.deltaMin:s,s=s>t.deltaMax?t.deltaMax:s,a=s/t.delta,t.delta=s),0!==t.timeScalePrev&&(a*=r.timeScale/t.timeScalePrev),0===r.timeScale&&(a=0),t.timeScalePrev=r.timeScale,t.correction=a,t.frameCounter+=1,n-t.counterTimestamp>=1e3&&(t.fps=t.frameCounter*((n-t.counterTimestamp)/1e3),t.counterTimestamp=n,t.frameCounter=0),i.trigger(t,"tick",l),i.trigger(e,"tick",l),e.world.isModified&&e.render&&e.render.controller&&e.render.controller.clear&&e.render.controller.clear(e.render),i.trigger(t,"beforeUpdate",l),o.update(e,s,a),i.trigger(t,"afterUpdate",l),e.render&&e.render.controller&&(i.trigger(t,"beforeRender",l),i.trigger(e,"beforeRender",l),e.render.controller.world(e.render),i.trigger(t,"afterRender",l),i.trigger(e,"afterRender",l)),i.trigger(t,"afterTick",l),i.trigger(e,"afterTick",l)},n.stop=function(t){e(t.frameRequestId)},n.start=function(t,e){n.run(t,e)}}()},{"./Common":14,"./Engine":15,"./Events":16}],20:[function(t,e){var n={};e.exports=n;var i=t("./Events");!function(){n._motionWakeThreshold=.18,n._motionSleepThreshold=.08,n._minBias=.9,n.update=function(t,e){for(var i=e*e*e,o=0;o<t.length;o++){var s=t[o],r=s.speed*s.speed+s.angularSpeed*s.angularSpeed;if(0===s.force.x&&0===s.force.y){var a=Math.min(s.motion,r),l=Math.max(s.motion,r);s.motion=n._minBias*a+(1-n._minBias)*l,s.sleepThreshold>0&&s.motion<n._motionSleepThreshold*i?(s.sleepCounter+=1,s.sleepCounter>=s.sleepThreshold&&n.set(s,!0)):s.sleepCounter>0&&(s.sleepCounter-=1)}else n.set(s,!1)}},n.afterCollisions=function(t,e){for(var i=e*e*e,o=0;o<t.length;o++){var s=t[o];if(s.isActive){var r=s.collision,a=r.bodyA.parent,l=r.bodyB.parent;if(!(a.isSleeping&&l.isSleeping||a.isStatic||l.isStatic)&&(a.isSleeping||l.isSleeping)){var c=a.isSleeping&&!a.isStatic?a:l,h=c===a?l:a;!c.isStatic&&h.motion>n._motionWakeThreshold*i&&n.set(c,!1)}}}},n.set=function(t,e){var n=t.isSleeping;e?(t.isSleeping=!0,t.sleepCounter=t.sleepThreshold,t.positionImpulse.x=0,t.positionImpulse.y=0,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.anglePrev=t.angle,t.speed=0,t.angularSpeed=0,t.motion=0,n||i.trigger(t,"sleepStart")):(t.isSleeping=!1,t.sleepCounter=0,n&&i.trigger(t,"sleepEnd"))}}()},{"./Events":16}],21:[function(t,e){var n={};e.exports=n;var i=t("../geometry/Vertices"),o=t("../core/Common"),s=t("../body/Body"),r=t("../geometry/Bounds"),a=t("../geometry/Vector");!function(){n.rectangle=function(t,e,n,r,a){a=a||{};var l={label:"Rectangle Body",position:{x:t,y:e},vertices:i.fromPath("L 0 0 L "+n+" 0 L "+n+" "+r+" L 0 "+r)};if(a.chamfer){var c=a.chamfer;l.vertices=i.chamfer(l.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete a.chamfer}return s.create(o.extend({},l,a))},n.trapezoid=function(t,e,n,r,a,l){l=l||{},a*=.5;var c,h=(1-2*a)*n,u=n*a,d=u+h,f=d+u;c=.5>a?"L 0 0 L "+u+" "+-r+" L "+d+" "+-r+" L "+f+" 0":"L 0 0 L "+d+" "+-r+" L "+f+" 0";var p={label:"Trapezoid Body",position:{x:t,y:e},vertices:i.fromPath(c)};if(l.chamfer){var _=l.chamfer;p.vertices=i.chamfer(p.vertices,_.radius,_.quality,_.qualityMin,_.qualityMax),delete l.chamfer}return s.create(o.extend({},p,l))},n.circle=function(t,e,i,s,r){s=s||{};var a={label:"Circle Body",circleRadius:i};r=r||25;var l=Math.ceil(Math.max(10,Math.min(r,i)));return l%2===1&&(l+=1),n.polygon(t,e,l,i,o.extend({},a,s))},n.polygon=function(t,e,r,a,l){if(l=l||{},3>r)return n.circle(t,e,a,l);for(var c=2*Math.PI/r,h="",u=.5*c,d=0;r>d;d+=1){var f=u+d*c,p=Math.cos(f)*a,_=Math.sin(f)*a;h+="L "+p.toFixed(3)+" "+_.toFixed(3)+" "}var y={label:"Polygon Body",position:{x:t,y:e},vertices:i.fromPath(h)};if(l.chamfer){var m=l.chamfer;y.vertices=i.chamfer(y.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete l.chamfer}return s.create(o.extend({},y,l))},n.fromVertices=function(t,e,n,l,c,h,u){var d,f,p,_,y,m,g,v,x;for(l=l||{},f=[],c="undefined"!=typeof c?c:!1,h="undefined"!=typeof h?h:.01,u="undefined"!=typeof u?u:10,window.decomp||o.log("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull.","warn"),o.isArray(n[0])||(n=[n]),v=0;v<n.length;v+=1)if(_=n[v],p=i.isConvex(_),p||!window.decomp)_=p?i.clockwiseSort(_):i.hull(_),f.push({position:{x:t,y:e},vertices:_});else{var b=new decomp.Polygon;for(y=0;y<_.length;y++)b.vertices.push([_[y].x,_[y].y]);b.makeCCW(),h!==!1&&b.removeCollinearPoints(h);var w=b.quickDecomp();for(y=0;y<w.length;y++){var S=w[y],A=[];for(m=0;m<S.vertices.length;m++)A.push({x:S.vertices[m][0],y:S.vertices[m][1]});u>0&&i.area(A)<u||f.push({position:i.centre(A),vertices:A})}}for(y=0;y<f.length;y++)f[y]=s.create(o.extend(f[y],l));if(c){var T=5;for(y=0;y<f.length;y++){var M=f[y];for(m=y+1;m<f.length;m++){var C=f[m];if(r.overlaps(M.bounds,C.bounds)){var E=M.vertices,k=C.vertices;for(g=0;g<M.vertices.length;g++)for(x=0;x<C.vertices.length;x++){var I=a.magnitudeSquared(a.sub(E[(g+1)%E.length],k[x])),P=a.magnitudeSquared(a.sub(E[g],k[(x+1)%k.length]));T>I&&T>P&&(E[g].isInternal=!0,k[x].isInternal=!0)}}}}}return f.length>1?(d=s.create(o.extend({parts:f.slice(0)},l)),s.setPosition(d,{x:t,y:e}),d):f[0]}}()},{"../body/Body":1,"../core/Common":14,"../geometry/Bounds":24,"../geometry/Vector":26,"../geometry/Vertices":27}],22:[function(t,e){var n={};e.exports=n;var i=t("../body/Composite"),o=t("../constraint/Constraint"),s=t("../core/Common"),r=t("../body/Body"),a=t("./Bodies");!function(){n.stack=function(t,e,n,o,s,a,l){for(var c,h=i.create({label:"Stack"}),u=t,d=e,f=0,p=0;o>p;p++){for(var _=0,y=0;n>y;y++){var m=l(u,d,y,p,c,f);if(m){var g=m.bounds.max.y-m.bounds.min.y,v=m.bounds.max.x-m.bounds.min.x;g>_&&(_=g),r.translate(m,{x:.5*v,y:.5*g}),u=m.bounds.max.x+s,i.addBody(h,m),c=m,f+=1}else u+=s}d+=_+a,u=t}return h},n.chain=function(t,e,n,r,a,l){for(var c=t.bodies,h=1;h<c.length;h++){var u=c[h-1],d=c[h],f=u.bounds.max.y-u.bounds.min.y,p=u.bounds.max.x-u.bounds.min.x,_=d.bounds.max.y-d.bounds.min.y,y=d.bounds.max.x-d.bounds.min.x,m={bodyA:u,pointA:{x:p*e,y:f*n},bodyB:d,pointB:{x:y*r,y:_*a}},g=s.extend(m,l);i.addConstraint(t,o.create(g))}return t.label+=" Chain",t},n.mesh=function(t,e,n,r,a){var l,c,h,u,d,f=t.bodies;for(l=0;n>l;l++){for(c=1;e>c;c++)h=f[c-1+l*e],u=f[c+l*e],i.addConstraint(t,o.create(s.extend({bodyA:h,bodyB:u},a)));if(l>0)for(c=0;e>c;c++)h=f[c+(l-1)*e],u=f[c+l*e],i.addConstraint(t,o.create(s.extend({bodyA:h,bodyB:u},a))),r&&c>0&&(d=f[c-1+(l-1)*e],i.addConstraint(t,o.create(s.extend({bodyA:d,bodyB:u},a)))),r&&e-1>c&&(d=f[c+1+(l-1)*e],i.addConstraint(t,o.create(s.extend({bodyA:d,bodyB:u},a))))}return t.label+=" Mesh",t},n.pyramid=function(t,e,i,o,s,a,l){return n.stack(t,e,i,o,s,a,function(e,n,a,c,h,u){var d=Math.min(o,Math.ceil(i/2)),f=h?h.bounds.max.x-h.bounds.min.x:0;if(!(c>d)){c=d-c;var p=c,_=i-1-c;if(!(p>a||a>_)){1===u&&r.translate(h,{x:(a+(i%2===1?1:-1))*f,y:0});var y=h?a*f:0;return l(t+y+a*s,n,a,c,h,u)}}})},n.newtonsCradle=function(t,e,n,s,r){for(var l=i.create({label:"Newtons Cradle"}),c=0;n>c;c++){var h=1.9,u=a.circle(t+c*s*h,e+r,s,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),d=o.create({pointA:{x:t+c*s*h,y:e},bodyB:u});i.addBody(l,u),i.addConstraint(l,d)}return l},n.car=function(t,e,n,s,l){var c=r.nextGroup(!0),h=-20,u=.5*-n+h,d=.5*n-h,f=0,p=i.create({label:"Car"}),_=a.trapezoid(t,e,n,s,.3,{collisionFilter:{group:c},friction:.01,chamfer:{radius:10}}),y=a.circle(t+u,e+f,l,{collisionFilter:{group:c},friction:.8,density:.01}),m=a.circle(t+d,e+f,l,{collisionFilter:{group:c},friction:.8,density:.01}),g=o.create({bodyA:_,pointA:{x:u,y:f},bodyB:y,stiffness:.2}),v=o.create({bodyA:_,pointA:{x:d,y:f},bodyB:m,stiffness:.2});return i.addBody(p,_),i.addBody(p,y),i.addBody(p,m),i.addConstraint(p,g),i.addConstraint(p,v),p},n.softBody=function(t,e,i,o,r,l,c,h,u,d){u=s.extend({inertia:1/0},u),d=s.extend({stiffness:.4},d);var f=n.stack(t,e,i,o,r,l,function(t,e){return a.circle(t,e,h,u)});return n.mesh(f,i,o,c,d),f.label="Soft Body",f}}()},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":21}],23:[function(t,e){var n={};e.exports=n;var i=t("../geometry/Vector"),o=t("../core/Common");!function(){n.fromVertices=function(t){for(var e={},n=0;n<t.length;n++){var s=(n+1)%t.length,r=i.normalise({x:t[s].y-t[n].y,y:t[n].x-t[s].x}),a=0===r.y?1/0:r.x/r.y;a=a.toFixed(3).toString(),e[a]=r}return o.values(e)},n.rotate=function(t,e){if(0!==e)for(var n=Math.cos(e),i=Math.sin(e),o=0;o<t.length;o++){var s,r=t[o];s=r.x*n-r.y*i,r.y=r.x*i+r.y*n,r.x=s}}}()},{"../core/Common":14,"../geometry/Vector":26}],24:[function(t,e){var n={};e.exports=n,function(){n.create=function(t){var e={min:{x:0,y:0},max:{x:0,y:0}};return t&&n.update(e,t),e},n.update=function(t,e,n){t.min.x=1/0,t.max.x=-(1/0),t.min.y=1/0,t.max.y=-(1/0);for(var i=0;i<e.length;i++){var o=e[i];o.x>t.max.x&&(t.max.x=o.x),o.x<t.min.x&&(t.min.x=o.x),o.y>t.max.y&&(t.max.y=o.y),o.y<t.min.y&&(t.min.y=o.y)}n&&(n.x>0?t.max.x+=n.x:t.min.x+=n.x,n.y>0?t.max.y+=n.y:t.min.y+=n.y)},n.contains=function(t,e){return e.x>=t.min.x&&e.x<=t.max.x&&e.y>=t.min.y&&e.y<=t.max.y},n.overlaps=function(t,e){return t.min.x<=e.max.x&&t.max.x>=e.min.x&&t.max.y>=e.min.y&&t.min.y<=e.max.y},n.translate=function(t,e){t.min.x+=e.x,t.max.x+=e.x,t.min.y+=e.y,t.max.y+=e.y},n.shift=function(t,e){var n=t.max.x-t.min.x,i=t.max.y-t.min.y;t.min.x=e.x,t.max.x=e.x+n,t.min.y=e.y,t.max.y=e.y+i}}()},{}],25:[function(t,e){var n={};e.exports=n,t("../geometry/Bounds"),!function(){n.pathToVertices=function(e,n){var i,o,s,r,a,l,c,h,u,d,f,p,_=[],y=0,m=0,g=0;n=n||15;var v=function(t,e,n){var i=n%2===1&&n>1;if(!u||t!=u.x||e!=u.y){u&&i?(f=u.x,p=u.y):(f=0,p=0);var o={x:f+t,y:p+e};!i&&u||(u=o),_.push(o),m=f+t,g=p+e}},x=function(t){var e=t.pathSegTypeAsLetter.toUpperCase();if("Z"!==e){switch(e){case"M":case"L":case"T":case"C":case"S":case"Q":m=t.x,g=t.y;break;case"H":m=t.x;break;case"V":g=t.y}v(m,g,t.pathSegType)}};for(t(e),s=e.getTotalLength(),l=[],i=0;i<e.pathSegList.numberOfItems;i+=1)l.push(e.pathSegList.getItem(i));for(c=l.concat();s>y;){if(d=e.getPathSegAtLength(y),a=l[d],a!=h){for(;c.length&&c[0]!=a;)x(c.shift());h=a}switch(a.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":r=e.getPointAtLength(y),v(r.x,r.y,0)}y+=n}for(i=0,o=c.length;o>i;++i)x(c[i]);return _};var t=function(t){for(var e,n,i,o,s,r,a=t.pathSegList,l=0,c=0,h=a.numberOfItems,u=0;h>u;++u){var d=a.getItem(u),f=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(f))"x"in d&&(l=d.x),"y"in d&&(c=d.y);else switch("x1"in d&&(i=l+d.x1),"x2"in d&&(s=l+d.x2),"y1"in d&&(o=c+d.y1),"y2"in d&&(r=c+d.y2),"x"in d&&(l+=d.x),"y"in d&&(c+=d.y),f){case"m":a.replaceItem(t.createSVGPathSegMovetoAbs(l,c),u);break;case"l":a.replaceItem(t.createSVGPathSegLinetoAbs(l,c),u);break;case"h":a.replaceItem(t.createSVGPathSegLinetoHorizontalAbs(l),u);break;case"v":a.replaceItem(t.createSVGPathSegLinetoVerticalAbs(c),u);break;case"c":a.replaceItem(t.createSVGPathSegCurvetoCubicAbs(l,c,i,o,s,r),u);break;case"s":a.replaceItem(t.createSVGPathSegCurvetoCubicSmoothAbs(l,c,s,r),u);break;case"q":a.replaceItem(t.createSVGPathSegCurvetoQuadraticAbs(l,c,i,o),u);break;case"t":a.replaceItem(t.createSVGPathSegCurvetoQuadraticSmoothAbs(l,c),u);break;case"a":a.replaceItem(t.createSVGPathSegArcAbs(l,c,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),u);break;case"z":case"Z":l=e,c=n}"M"!=f&&"m"!=f||(e=l,n=c)}}}()},{"../geometry/Bounds":24}],26:[function(t,e){var n={};e.exports=n,function(){n.create=function(t,e){return{x:t||0,y:e||0}},n.clone=function(t){return{x:t.x,y:t.y}},n.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},n.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},n.rotate=function(t,e){var n=Math.cos(e),i=Math.sin(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}},n.rotateAbout=function(t,e,n,i){var o=Math.cos(e),s=Math.sin(e);i||(i={});var r=n.x+((t.x-n.x)*o-(t.y-n.y)*s);return i.y=n.y+((t.x-n.x)*s+(t.y-n.y)*o),i.x=r,i},n.normalise=function(t){var e=n.magnitude(t);return 0===e?{x:0,y:0}:{x:t.x/e,y:t.y/e}},n.dot=function(t,e){return t.x*e.x+t.y*e.y},n.cross=function(t,e){return t.x*e.y-t.y*e.x},n.cross3=function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)},n.add=function(t,e,n){return n||(n={}),n.x=t.x+e.x,n.y=t.y+e.y,n},n.sub=function(t,e,n){return n||(n={}),n.x=t.x-e.x,n.y=t.y-e.y,n},n.mult=function(t,e){return{x:t.x*e,y:t.y*e}},n.div=function(t,e){return{x:t.x/e,y:t.y/e}},n.perp=function(t,e){return e=e===!0?-1:1,{x:e*-t.y,y:e*t.x}},n.neg=function(t){return{x:-t.x,y:-t.y}},n.angle=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]}()},{}],27:[function(t,e){var n={};e.exports=n;var i=t("../geometry/Vector"),o=t("../core/Common");!function(){n.create=function(t,e){for(var n=[],i=0;i<t.length;i++){var o=t[i],s={x:o.x,y:o.y,index:i,body:e,isInternal:!1};n.push(s)}return n},n.fromPath=function(t,e){var i=/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,o=[];return t.replace(i,function(t,e,n){o.push({x:parseFloat(e),y:parseFloat(n)})}),n.create(o,e)},n.centre=function(t){for(var e,o,s,r=n.area(t,!0),a={x:0,y:0},l=0;l<t.length;l++)s=(l+1)%t.length,e=i.cross(t[l],t[s]),o=i.mult(i.add(t[l],t[s]),e),a=i.add(a,o);return i.div(a,6*r)},n.mean=function(t){for(var e={x:0,y:0},n=0;n<t.length;n++)e.x+=t[n].x,e.y+=t[n].y;return i.div(e,t.length)},n.area=function(t,e){for(var n=0,i=t.length-1,o=0;o<t.length;o++)n+=(t[i].x-t[o].x)*(t[i].y+t[o].y),i=o;return e?n/2:Math.abs(n)/2},n.inertia=function(t,e){for(var n,o,s=0,r=0,a=t,l=0;l<a.length;l++)o=(l+1)%a.length,n=Math.abs(i.cross(a[o],a[l])),s+=n*(i.dot(a[o],a[o])+i.dot(a[o],a[l])+i.dot(a[l],a[l])),r+=n;return e/6*(s/r)},n.translate=function(t,e,n){var i;if(n)for(i=0;i<t.length;i++)t[i].x+=e.x*n,t[i].y+=e.y*n;else for(i=0;i<t.length;i++)t[i].x+=e.x,t[i].y+=e.y;return t},n.rotate=function(t,e,n){if(0!==e){for(var i=Math.cos(e),o=Math.sin(e),s=0;s<t.length;s++){var r=t[s],a=r.x-n.x,l=r.y-n.y;r.x=n.x+(a*i-l*o),r.y=n.y+(a*o+l*i)}return t}},n.contains=function(t,e){for(var n=0;n<t.length;n++){var i=t[n],o=t[(n+1)%t.length];if((e.x-i.x)*(o.y-i.y)+(e.y-i.y)*(i.x-o.x)>0)return!1}return!0},n.scale=function(t,e,o,s){if(1===e&&1===o)return t;s=s||n.centre(t);for(var r,a,l=0;l<t.length;l++)r=t[l],a=i.sub(r,s),t[l].x=s.x+a.x*e,t[l].y=s.y+a.y*o;return t},n.chamfer=function(t,e,n,s,r){e=e||[8],e.length||(e=[e]),n="undefined"!=typeof n?n:-1,s=s||2,r=r||14;for(var a=[],l=0;l<t.length;l++){var c=t[l-1>=0?l-1:t.length-1],h=t[l],u=t[(l+1)%t.length],d=e[l<e.length?l:e.length-1];if(0!==d){var f=i.normalise({x:h.y-c.y,y:c.x-h.x}),p=i.normalise({x:u.y-h.y,y:h.x-u.x}),_=Math.sqrt(2*Math.pow(d,2)),y=i.mult(o.clone(f),d),m=i.normalise(i.mult(i.add(f,p),.5)),g=i.sub(h,i.mult(m,_)),v=n;-1===n&&(v=1.75*Math.pow(d,.32)),v=o.clamp(v,s,r),v%2===1&&(v+=1);for(var x=Math.acos(i.dot(f,p)),b=x/v,w=0;v>w;w++)a.push(i.add(i.rotate(y,b*w),g))}else a.push(h)}return a},n.clockwiseSort=function(t){var e=n.mean(t);return t.sort(function(t,n){return i.angle(e,t)-i.angle(e,n)}),t},n.isConvex=function(t){var e,n,i,o,s=0,r=t.length;if(3>r)return null;for(e=0;r>e;e++)if(n=(e+1)%r,i=(e+2)%r,o=(t[n].x-t[e].x)*(t[i].y-t[n].y),o-=(t[n].y-t[e].y)*(t[i].x-t[n].x),0>o?s|=1:o>0&&(s|=2),3===s)return!1;return 0!==s?!0:null},n.hull=function(t){var e,n,o=[],s=[];for(t=t.slice(0),t.sort(function(t,e){var n=t.x-e.x;return 0!==n?n:t.y-e.y}),n=0;n<t.length;n++){for(e=t[n];s.length>=2&&i.cross3(s[s.length-2],s[s.length-1],e)<=0;)s.pop();s.push(e)}for(n=t.length-1;n>=0;n--){for(e=t[n];o.length>=2&&i.cross3(o[o.length-2],o[o.length-1],e)<=0;)o.pop();o.push(e)}return o.pop(),s.pop(),o.concat(s)}}()},{"../core/Common":14,"../geometry/Vector":26}],28:[function(t,e){var n=e.exports={};n.version="master",n.Body=t("../body/Body"),n.Composite=t("../body/Composite"),n.World=t("../body/World"),n.Contact=t("../collision/Contact"),n.Detector=t("../collision/Detector"),n.Grid=t("../collision/Grid"),n.Pairs=t("../collision/Pairs"),n.Pair=t("../collision/Pair"),n.Query=t("../collision/Query"),n.Resolver=t("../collision/Resolver"),n.SAT=t("../collision/SAT"),n.Constraint=t("../constraint/Constraint"),n.MouseConstraint=t("../constraint/MouseConstraint"),n.Common=t("../core/Common"),n.Engine=t("../core/Engine"),n.Events=t("../core/Events"),n.Mouse=t("../core/Mouse"),n.Runner=t("../core/Runner"),n.Sleeping=t("../core/Sleeping"),n.Bodies=t("../factory/Bodies"),n.Composites=t("../factory/Composites"),n.Axes=t("../geometry/Axes"),n.Bounds=t("../geometry/Bounds"),n.Svg=t("../geometry/Svg"),n.Vector=t("../geometry/Vector"),n.Vertices=t("../geometry/Vertices"),n.Render=t("../render/Render"),n.RenderPixi=t("../render/RenderPixi"),n.World.add=n.Composite.add,n.World.remove=n.Composite.remove,n.World.addComposite=n.Composite.addComposite,n.World.addBody=n.Composite.addBody,n.World.addConstraint=n.Composite.addConstraint,n.World.clear=n.Composite.clear,n.Engine.run=n.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Metrics":17,"../core/Mouse":18,"../core/Runner":19,"../core/Sleeping":20,"../factory/Bodies":21,"../factory/Composites":22,"../geometry/Axes":23,"../geometry/Bounds":24,"../geometry/Svg":25,"../geometry/Vector":26,"../geometry/Vertices":27,"../render/Render":29,"../render/RenderPixi":30}],29:[function(t,e){var n={};e.exports=n;var i=t("../core/Common"),o=t("../body/Composite"),s=t("../geometry/Bounds"),r=t("../core/Events"),a=t("../collision/Grid"),l=t("../geometry/Vector");!function(){var t,e;"undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(function(){t(i.now())},1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n.create=function(t){var e={controller:n,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#fafafa",wireframeBackground:"#222",hasBounds:!!t.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},o=i.extend(e,t);return o.canvas&&(o.canvas.width=o.options.width||o.canvas.width,o.canvas.height=o.options.height||o.canvas.height),o.mouse=t.mouse,o.engine=t.engine,o.canvas=o.canvas||c(o.options.width,o.options.height),o.context=o.canvas.getContext("2d"),o.textures={},o.bounds=o.bounds||{min:{x:0,y:0},max:{x:o.canvas.width,y:o.canvas.height}},1!==o.options.pixelRatio&&n.setPixelRatio(o,o.options.pixelRatio),i.isElement(o.element)?o.element.appendChild(o.canvas):i.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),o},n.run=function(e){!function i(){e.frameRequestId=t(i),n.world(e)}()},n.stop=function(t){e(t.frameRequestId)},n.setPixelRatio=function(t,e){var n=t.options,i=t.canvas;"auto"===e&&(e=h(i)),n.pixelRatio=e,i.setAttribute("data-pixel-ratio",e),i.width=n.width*e,i.height=n.height*e,i.style.width=n.width+"px",i.style.height=n.height+"px",t.context.scale(e,e)},n.world=function(t){var e,i=t.engine,c=i.world,h=t.canvas,u=t.context,f=t.options,p=o.allBodies(c),_=o.allConstraints(c),y=f.wireframes?f.wireframeBackground:f.background,m=[],g=[],v={timestamp:i.timing.timestamp};if(r.trigger(t,"beforeRender",v),t.currentBackground!==y&&d(t,y),u.globalCompositeOperation="source-in",u.fillStyle="transparent",u.fillRect(0,0,h.width,h.height),u.globalCompositeOperation="source-over",f.hasBounds){var x=t.bounds.max.x-t.bounds.min.x,b=t.bounds.max.y-t.bounds.min.y,w=x/f.width,S=b/f.height;for(e=0;e<p.length;e++){var A=p[e];s.overlaps(A.bounds,t.bounds)&&m.push(A)}for(e=0;e<_.length;e++){var T=_[e],M=T.bodyA,C=T.bodyB,E=T.pointA,k=T.pointB;M&&(E=l.add(M.position,T.pointA)),C&&(k=l.add(C.position,T.pointB)),E&&k&&(s.contains(t.bounds,E)||s.contains(t.bounds,k))&&g.push(T)}u.scale(1/w,1/S),u.translate(-t.bounds.min.x,-t.bounds.min.y)}else g=_,m=p;!f.wireframes||i.enableSleeping&&f.showSleeping?n.bodies(t,m,u):(f.showConvexHulls&&n.bodyConvexHulls(t,m,u),n.bodyWireframes(t,m,u)),f.showBounds&&n.bodyBounds(t,m,u),(f.showAxes||f.showAngleIndicator)&&n.bodyAxes(t,m,u),f.showPositions&&n.bodyPositions(t,m,u),f.showVelocity&&n.bodyVelocity(t,m,u),f.showIds&&n.bodyIds(t,m,u),f.showSeparations&&n.separations(t,i.pairs.list,u),f.showCollisions&&n.collisions(t,i.pairs.list,u),f.showVertexNumbers&&n.vertexNumbers(t,m,u),f.showMousePosition&&n.mousePosition(t,t.mouse,u),n.constraints(g,u),f.showBroadphase&&i.broadphase.controller===a&&n.grid(t,i.broadphase,u),f.showDebug&&n.debug(t,u),f.hasBounds&&u.setTransform(f.pixelRatio,0,0,f.pixelRatio,0,0),r.trigger(t,"afterRender",v)},n.debug=function(t,e){var n=e,i=t.engine,s=i.world,r=i.metrics,a=t.options,l=(o.allBodies(s),"    ");if(i.timing.timestamp-(t.debugTimestamp||0)>=500){var c="";r.timing&&(c+="fps: "+Math.round(r.timing.fps)+l),t.debugString=c,t.debugTimestamp=i.timing.timestamp}if(t.debugString){n.font="12px Arial",n.fillStyle=a.wireframes?"rgba(255,255,255,0.5)":"rgba(0,0,0,0.5)";for(var h=t.debugString.split("\n"),u=0;u<h.length;u++)n.fillText(h[u],50,50+18*u)}},n.constraints=function(t,e){for(var n=e,i=0;i<t.length;i++){var o=t[i];if(o.render.visible&&o.pointA&&o.pointB){var s=o.bodyA,r=o.bodyB;s?(n.beginPath(),n.moveTo(s.position.x+o.pointA.x,s.position.y+o.pointA.y)):(n.beginPath(),n.moveTo(o.pointA.x,o.pointA.y)),r?n.lineTo(r.position.x+o.pointB.x,r.position.y+o.pointB.y):n.lineTo(o.pointB.x,o.pointB.y),n.lineWidth=o.render.lineWidth,n.strokeStyle=o.render.strokeStyle,n.stroke()}}},n.bodyShadows=function(t,e,n){for(var i=n,o=(t.engine,0);o<e.length;o++){var s=e[o];if(s.render.visible){if(s.circleRadius)i.beginPath(),i.arc(s.position.x,s.position.y,s.circleRadius,0,2*Math.PI),i.closePath();else{i.beginPath(),i.moveTo(s.vertices[0].x,s.vertices[0].y);for(var r=1;r<s.vertices.length;r++)i.lineTo(s.vertices[r].x,s.vertices[r].y);i.closePath()}var a=s.position.x-.5*t.options.width,l=s.position.y-.2*t.options.height,c=Math.abs(a)+Math.abs(l);i.shadowColor="rgba(0,0,0,0.15)",i.shadowOffsetX=.05*a,i.shadowOffsetY=.05*l,i.shadowBlur=1+12*Math.min(1,c/1e3),i.fill(),i.shadowColor=null,i.shadowOffsetX=null,i.shadowOffsetY=null,i.shadowBlur=null}}},n.bodies=function(t,e,n){var i,o,s,r,a=n,l=(t.engine,t.options),c=l.showInternalEdges||!l.wireframes;for(s=0;s<e.length;s++)if(i=e[s],i.render.visible)for(r=i.parts.length>1?1:0;r<i.parts.length;r++)if(o=i.parts[r],o.render.visible){if(l.showSleeping&&i.isSleeping?a.globalAlpha=.5*o.render.opacity:1!==o.render.opacity&&(a.globalAlpha=o.render.opacity),o.render.sprite&&o.render.sprite.texture&&!l.wireframes){var h=o.render.sprite,d=u(t,h.texture);a.translate(o.position.x,o.position.y),a.rotate(o.angle),a.drawImage(d,d.width*-h.xOffset*h.xScale,d.height*-h.yOffset*h.yScale,d.width*h.xScale,d.height*h.yScale),a.rotate(-o.angle),a.translate(-o.position.x,-o.position.y)
}else{if(o.circleRadius)a.beginPath(),a.arc(o.position.x,o.position.y,o.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(o.vertices[0].x,o.vertices[0].y);for(var f=1;f<o.vertices.length;f++)!o.vertices[f-1].isInternal||c?a.lineTo(o.vertices[f].x,o.vertices[f].y):a.moveTo(o.vertices[f].x,o.vertices[f].y),o.vertices[f].isInternal&&!c&&a.moveTo(o.vertices[(f+1)%o.vertices.length].x,o.vertices[(f+1)%o.vertices.length].y);a.lineTo(o.vertices[0].x,o.vertices[0].y),a.closePath()}l.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb"):(a.fillStyle=o.render.fillStyle,a.lineWidth=o.render.lineWidth,a.strokeStyle=o.render.strokeStyle,a.fill()),a.stroke()}a.globalAlpha=1}},n.bodyWireframes=function(t,e,n){var i,o,s,r,a,l=n,c=t.options.showInternalEdges;for(l.beginPath(),s=0;s<e.length;s++)if(i=e[s],i.render.visible)for(a=i.parts.length>1?1:0;a<i.parts.length;a++){for(o=i.parts[a],l.moveTo(o.vertices[0].x,o.vertices[0].y),r=1;r<o.vertices.length;r++)!o.vertices[r-1].isInternal||c?l.lineTo(o.vertices[r].x,o.vertices[r].y):l.moveTo(o.vertices[r].x,o.vertices[r].y),o.vertices[r].isInternal&&!c&&l.moveTo(o.vertices[(r+1)%o.vertices.length].x,o.vertices[(r+1)%o.vertices.length].y);l.lineTo(o.vertices[0].x,o.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},n.bodyConvexHulls=function(t,e,n){var i,o,s,r=n;for(r.beginPath(),o=0;o<e.length;o++)if(i=e[o],i.render.visible&&1!==i.parts.length){for(r.moveTo(i.vertices[0].x,i.vertices[0].y),s=1;s<i.vertices.length;s++)r.lineTo(i.vertices[s].x,i.vertices[s].y);r.lineTo(i.vertices[0].x,i.vertices[0].y)}r.lineWidth=1,r.strokeStyle="rgba(255,255,255,0.2)",r.stroke()},n.vertexNumbers=function(t,e,n){var i,o,s,r=n;for(i=0;i<e.length;i++){var a=e[i].parts;for(s=a.length>1?1:0;s<a.length;s++){var l=a[s];for(o=0;o<l.vertices.length;o++)r.fillStyle="rgba(255,255,255,0.2)",r.fillText(i+"_"+o,l.position.x+.8*(l.vertices[o].x-l.position.x),l.position.y+.8*(l.vertices[o].y-l.position.y))}}},n.mousePosition=function(t,e,n){var i=n;i.fillStyle="rgba(255,255,255,0.8)",i.fillText(e.position.x+"  "+e.position.y,e.position.x+5,e.position.y-5)},n.bodyBounds=function(t,e,n){var i=n,o=(t.engine,t.options);i.beginPath();for(var s=0;s<e.length;s++){var r=e[s];if(r.render.visible)for(var a=e[s].parts,l=a.length>1?1:0;l<a.length;l++){var c=a[l];i.rect(c.bounds.min.x,c.bounds.min.y,c.bounds.max.x-c.bounds.min.x,c.bounds.max.y-c.bounds.min.y)}}i.strokeStyle=o.wireframes?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.1)",i.lineWidth=1,i.stroke()},n.bodyAxes=function(t,e,n){var i,o,s,r,a=n,l=(t.engine,t.options);for(a.beginPath(),o=0;o<e.length;o++){var c=e[o],h=c.parts;if(c.render.visible)if(l.showAxes)for(s=h.length>1?1:0;s<h.length;s++)for(i=h[s],r=0;r<i.axes.length;r++){var u=i.axes[r];a.moveTo(i.position.x,i.position.y),a.lineTo(i.position.x+20*u.x,i.position.y+20*u.y)}else for(s=h.length>1?1:0;s<h.length;s++)for(i=h[s],r=0;r<i.axes.length;r++)a.moveTo(i.position.x,i.position.y),a.lineTo((i.vertices[0].x+i.vertices[i.vertices.length-1].x)/2,(i.vertices[0].y+i.vertices[i.vertices.length-1].y)/2)}l.wireframes?a.strokeStyle="indianred":(a.strokeStyle="rgba(0,0,0,0.8)",a.globalCompositeOperation="overlay"),a.lineWidth=1,a.stroke(),a.globalCompositeOperation="source-over"},n.bodyPositions=function(t,e,n){var i,o,s,r,a=n,l=(t.engine,t.options);for(a.beginPath(),s=0;s<e.length;s++)if(i=e[s],i.render.visible)for(r=0;r<i.parts.length;r++)o=i.parts[r],a.arc(o.position.x,o.position.y,3,0,2*Math.PI,!1),a.closePath();for(a.fillStyle=l.wireframes?"indianred":"rgba(0,0,0,0.5)",a.fill(),a.beginPath(),s=0;s<e.length;s++)i=e[s],i.render.visible&&(a.arc(i.positionPrev.x,i.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},n.bodyVelocity=function(t,e,n){var i=n;i.beginPath();for(var o=0;o<e.length;o++){var s=e[o];s.render.visible&&(i.moveTo(s.position.x,s.position.y),i.lineTo(s.position.x+2*(s.position.x-s.positionPrev.x),s.position.y+2*(s.position.y-s.positionPrev.y)))}i.lineWidth=3,i.strokeStyle="cornflowerblue",i.stroke()},n.bodyIds=function(t,e,n){var i,o,s=n;for(i=0;i<e.length;i++)if(e[i].render.visible){var r=e[i].parts;for(o=r.length>1?1:0;o<r.length;o++){var a=r[o];s.font="12px Arial",s.fillStyle="rgba(255,255,255,0.5)",s.fillText(a.id,a.position.x+10,a.position.y-10)}}},n.collisions=function(t,e,n){var i,o,s,r,a=n,l=t.options;for(a.beginPath(),s=0;s<e.length;s++)if(i=e[s],i.isActive)for(o=i.collision,r=0;r<i.activeContacts.length;r++){var c=i.activeContacts[r],h=c.vertex;a.rect(h.x-1.5,h.y-1.5,3.5,3.5)}for(a.fillStyle=l.wireframes?"rgba(255,255,255,0.7)":"orange",a.fill(),a.beginPath(),s=0;s<e.length;s++)if(i=e[s],i.isActive&&(o=i.collision,i.activeContacts.length>0)){var u=i.activeContacts[0].vertex.x,d=i.activeContacts[0].vertex.y;2===i.activeContacts.length&&(u=(i.activeContacts[0].vertex.x+i.activeContacts[1].vertex.x)/2,d=(i.activeContacts[0].vertex.y+i.activeContacts[1].vertex.y)/2),o.bodyB===o.supports[0].body||o.bodyA.isStatic===!0?a.moveTo(u-8*o.normal.x,d-8*o.normal.y):a.moveTo(u+8*o.normal.x,d+8*o.normal.y),a.lineTo(u,d)}a.strokeStyle=l.wireframes?"rgba(255,165,0,0.7)":"orange",a.lineWidth=1,a.stroke()},n.separations=function(t,e,n){var i,o,s,r,a,l=n,c=t.options;for(l.beginPath(),a=0;a<e.length;a++)if(i=e[a],i.isActive){o=i.collision,s=o.bodyA,r=o.bodyB;var h=1;r.isStatic||s.isStatic||(h=.5),r.isStatic&&(h=0),l.moveTo(r.position.x,r.position.y),l.lineTo(r.position.x-o.penetration.x*h,r.position.y-o.penetration.y*h),h=1,r.isStatic||s.isStatic||(h=.5),s.isStatic&&(h=0),l.moveTo(s.position.x,s.position.y),l.lineTo(s.position.x+o.penetration.x*h,s.position.y+o.penetration.y*h)}l.strokeStyle=c.wireframes?"rgba(255,165,0,0.5)":"orange",l.stroke()},n.grid=function(t,e,n){var o=n,s=t.options;o.strokeStyle=s.wireframes?"rgba(255,180,0,0.1)":"rgba(255,180,0,0.5)",o.beginPath();for(var r=i.keys(e.buckets),a=0;a<r.length;a++){var l=r[a];if(!(e.buckets[l].length<2)){var c=l.split(",");o.rect(.5+parseInt(c[0],10)*e.bucketWidth,.5+parseInt(c[1],10)*e.bucketHeight,e.bucketWidth,e.bucketHeight)}}o.lineWidth=1,o.stroke()},n.inspector=function(t,e){var n,i=(t.engine,t.selected),o=t.render,s=o.options;if(s.hasBounds){var r=o.bounds.max.x-o.bounds.min.x,a=o.bounds.max.y-o.bounds.min.y,l=r/o.options.width,c=a/o.options.height;e.scale(1/l,1/c),e.translate(-o.bounds.min.x,-o.bounds.min.y)}for(var h=0;h<i.length;h++){var u=i[h].data;switch(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.9)",e.setLineDash([1,2]),u.type){case"body":n=u.bounds,e.beginPath(),e.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),e.closePath(),e.stroke();break;case"constraint":var d=u.pointA;u.bodyA&&(d=u.pointB),e.beginPath(),e.arc(d.x,d.y,10,0,2*Math.PI),e.closePath(),e.stroke()}e.setLineDash([]),e.translate(-.5,-.5)}null!==t.selectStart&&(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.6)",e.fillStyle="rgba(255,165,0,0.1)",n=t.selectBounds,e.beginPath(),e.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),e.closePath(),e.stroke(),e.fill(),e.translate(-.5,-.5)),s.hasBounds&&e.setTransform(1,0,0,1,0,0)};var c=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},h=function(t){var e=t.getContext("2d"),n=window.devicePixelRatio||1,i=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return n/i},u=function(t,e){var n=t.textures[e];return n?n:(n=t.textures[e]=new Image,n.src=e,n)},d=function(t,e){var n=e;/(jpg|gif|png)$/.test(e)&&(n="url("+e+")"),t.canvas.style.background=n,t.canvas.style.backgroundSize="contain",t.currentBackground=e}}()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":24,"../geometry/Vector":26}],30:[function(t,e){var n={};e.exports=n;var i=t("../body/Composite"),o=t("../core/Common");!function(){var t,e;"undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(function(){t(o.now())},1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n.create=function(t){o.log("RenderPixi.create: Matter.RenderPixi is deprecated (see docs)","warn");var e={controller:n,engine:null,element:null,frameRequestId:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},i=o.extend(e,t),s=!i.options.wireframes&&"transparent"===i.options.background;return i.pixiOptions=i.pixiOptions||{view:i.canvas,transparent:s,antialias:!0,backgroundColor:t.background},i.mouse=t.mouse,i.engine=t.engine,i.renderer=i.renderer||new PIXI.WebGLRenderer(i.options.width,i.options.height,i.pixiOptions),i.container=i.container||new PIXI.Container,i.spriteContainer=i.spriteContainer||new PIXI.Container,i.canvas=i.canvas||i.renderer.view,i.bounds=i.bounds||{min:{x:0,y:0},max:{x:i.options.width,y:i.options.height}},i.textures={},i.sprites={},i.primitives={},i.container.addChild(i.spriteContainer),o.isElement(i.element)?i.element.appendChild(i.canvas):o.log('No "render.element" passed, "render.canvas" was not inserted into document.',"warn"),i.canvas.oncontextmenu=function(){return!1},i.canvas.onselectstart=function(){return!1},i},n.run=function(e){!function i(){e.frameRequestId=t(i),n.world(e)}()},n.stop=function(t){e(t.frameRequestId)},n.clear=function(t){for(var e=t.container,n=t.spriteContainer;e.children[0];)e.removeChild(e.children[0]);for(;n.children[0];)n.removeChild(n.children[0]);var i=t.sprites["bg-0"];t.textures={},t.sprites={},t.primitives={},t.sprites["bg-0"]=i,i&&e.addChildAt(i,0),t.container.addChild(t.spriteContainer),t.currentBackground=null,e.scale.set(1,1),e.position.set(0,0)},n.setBackground=function(t,e){if(t.currentBackground!==e){var n=e.indexOf&&-1!==e.indexOf("#"),i=t.sprites["bg-0"];if(n){var s=o.colorToNumber(e);t.renderer.backgroundColor=s,i&&t.container.removeChild(i)}else if(!i){var r=a(t,e);i=t.sprites["bg-0"]=new PIXI.Sprite(r),i.position.x=0,i.position.y=0,t.container.addChildAt(i,0)}t.currentBackground=e}},n.world=function(t){var e,o=t.engine,s=o.world,r=t.renderer,a=t.container,l=t.options,c=i.allBodies(s),h=i.allConstraints(s),u=[];l.wireframes?n.setBackground(t,l.wireframeBackground):n.setBackground(t,l.background);var d=t.bounds.max.x-t.bounds.min.x,f=t.bounds.max.y-t.bounds.min.y,p=d/t.options.width,_=f/t.options.height;if(l.hasBounds){for(e=0;e<c.length;e++){var y=c[e];y.render.sprite.visible=Bounds.overlaps(y.bounds,t.bounds)}for(e=0;e<h.length;e++){var m=h[e],g=m.bodyA,v=m.bodyB,x=m.pointA,b=m.pointB;g&&(x=Vector.add(g.position,m.pointA)),v&&(b=Vector.add(v.position,m.pointB)),x&&b&&(Bounds.contains(t.bounds,x)||Bounds.contains(t.bounds,b))&&u.push(m)}a.scale.set(1/p,1/_),a.position.set(-t.bounds.min.x*(1/p),-t.bounds.min.y*(1/_))}else u=h;for(e=0;e<c.length;e++)n.body(t,c[e]);for(e=0;e<u.length;e++)n.constraint(t,u[e]);r.render(a)},n.constraint=function(t,e){var n=(t.engine,e.bodyA),i=e.bodyB,s=e.pointA,r=e.pointB,a=t.container,l=e.render,c="c-"+e.id,h=t.primitives[c];return h||(h=t.primitives[c]=new PIXI.Graphics),l.visible&&e.pointA&&e.pointB?(-1===o.indexOf(a.children,h)&&a.addChild(h),h.clear(),h.beginFill(0,0),h.lineStyle(l.lineWidth,o.colorToNumber(l.strokeStyle),1),n?h.moveTo(n.position.x+s.x,n.position.y+s.y):h.moveTo(s.x,s.y),i?h.lineTo(i.position.x+r.x,i.position.y+r.y):h.lineTo(r.x,r.y),void h.endFill()):void h.clear()},n.body=function(t,e){var n=(t.engine,e.render);if(n.visible)if(n.sprite&&n.sprite.texture){var i="b-"+e.id,a=t.sprites[i],l=t.spriteContainer;a||(a=t.sprites[i]=s(t,e)),-1===o.indexOf(l.children,a)&&l.addChild(a),a.position.x=e.position.x,a.position.y=e.position.y,a.rotation=e.angle,a.scale.x=n.sprite.xScale||1,a.scale.y=n.sprite.yScale||1}else{var c="b-"+e.id,h=t.primitives[c],u=t.container;h||(h=t.primitives[c]=r(t,e),h.initialAngle=e.angle),-1===o.indexOf(u.children,h)&&u.addChild(h),h.position.x=e.position.x,h.position.y=e.position.y,h.rotation=e.angle-h.initialAngle}};var s=function(t,e){var n=e.render,i=n.sprite.texture,o=a(t,i),s=new PIXI.Sprite(o);return s.anchor.x=e.render.sprite.xOffset,s.anchor.y=e.render.sprite.yOffset,s},r=function(t,e){var n,i=e.render,s=t.options,r=new PIXI.Graphics,a=o.colorToNumber(i.fillStyle),l=o.colorToNumber(i.strokeStyle),c=o.colorToNumber(i.strokeStyle),h=o.colorToNumber("#bbb"),u=o.colorToNumber("#CD5C5C");r.clear();for(var d=e.parts.length>1?1:0;d<e.parts.length;d++){n=e.parts[d],s.wireframes?(r.beginFill(0,0),r.lineStyle(1,h,1)):(r.beginFill(a,1),r.lineStyle(i.lineWidth,l,1)),r.moveTo(n.vertices[0].x-e.position.x,n.vertices[0].y-e.position.y);for(var f=1;f<n.vertices.length;f++)r.lineTo(n.vertices[f].x-e.position.x,n.vertices[f].y-e.position.y);r.lineTo(n.vertices[0].x-e.position.x,n.vertices[0].y-e.position.y),r.endFill(),(s.showAngleIndicator||s.showAxes)&&(r.beginFill(0,0),s.wireframes?r.lineStyle(1,u,1):r.lineStyle(1,c),r.moveTo(n.position.x-e.position.x,n.position.y-e.position.y),r.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2-e.position.x,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2-e.position.y),r.endFill())}return r},a=function(t,e){var n=t.textures[e];return n||(n=t.textures[e]=PIXI.Texture.fromImage(e)),n}}()},{"../body/Composite":2,"../core/Common":14}]},{},[28])(28)}),soya2d.module.install("physics",{onInit:function(t){var e;t.physics.setup({onStart:function(n){e=Matter.Engine.create(),e.world.gravity.x=n.gravity[0],e.world.gravity.y=n.gravity[1],e.enableSleeping=n.enableSleeping,Matter.Events.on(e,"collisionStart collisionEnd",function(e){for(var n=e.pairs,i=0;i<n.length;i++){var o=n[i];t.physics.emit(e.name,o.bodyA.__sprite,o.bodyB.__sprite),X.emit(e.name.toLowerCase(),o.bodyA.__sprite,o.bodyB.__sprite)}})},onUpdate:function(){Matter.Engine.update(e,0,1);for(var t=e.world.bodies,n=t.length;n--;){var i=t[n],o=i.__sprite;i.isStatic||(o.__x=i.position.x,o.__y=i.position.y,o.angle=i.angle*soya2d.Math.ONEANG)}},onUnbind:function(t){Matter.World.remove(e.world,t)},onBind:function(t){var n,i={angle:t.angle*soya2d.Math.ONERAD,position:{x:t.x,y:t.y}};if(t.bounds instanceof soya2d.Rectangle)n=Matter.Bodies.rectangle(t.x,t.y,t.w,t.h,i);else if(t.bounds instanceof soya2d.Circle)n=Matter.Bodies.circle(0,0,t.bounds.r,i);else if(t.bounds instanceof soya2d.Polygon){var o=t.bounds.vtx,s=Matter.Vertices.fromPath(o.join(","));n=Matter.Bodies.fromVertices(0,0,s,i)}return Matter.World.add(e.world,n),Matter.Events.on(n,"sleepStart sleepEnd",function(e){t.emit(e.name,this.isSleeping)}),n},body:{sensor:function(t,e){t.isSensor=e},moveTo:function(t,e,n){Matter.Body.setPosition(t,{x:e,y:n})},moveBy:function(t,e,n){Matter.Body.translate(t,{x:e,y:n})},"static":function(t,e){Matter.Body.setStatic(t,e)},mass:function(t,e){Matter.Body.setMass(t,e)},rotateBy:function(t,e){Matter.Body.rotate(t,e)},rotateTo:function(t,e){Matter.Body.setAngle(t,soya2d.Math.toRadian(e))},friction:function(t,e){t.friction=e},restitution:function(t,e){t.restitution=e},velocity:function(t,e,n){Matter.Body.setVelocity(t,{x:e,y:n})},inertia:function(t,e){Matter.Body.setInertia(t,e)}}})}}),D.prototype={get:function(t){return this.map[t]},add:function(t,e){return e.game=this.game,this.map[t]=new J(e),this.map[t]}};var $=soya2d.class("",{"extends":soya2d.DisplayObjectContainer,constructor:function(t,e){this.tilemap=t,this.w=t.w,this.h=t.h,this.tw=t.tilewidth,this.th=t.tileheight,this.cols=t.columns,this.data=e,this.range={row:[0,t.rows],col:[0,t.columns]},this.tilesets=t.tilesets},onUpdate:function(){var t=this.worldPosition.x-this.anchorPosition.x,e=this.worldPosition.y-this.anchorPosition.y;if(!(0>t||0>e||this.lastcx==this.game.camera.x&&this.lastcy==this.game.camera.y)){this.lastcy=this.game.camera.y,this.lastcx=this.game.camera.x;var n=this.game.camera.x,i=this.game.camera.y,o=this.game.camera.w,s=this.game.camera.h,r=n-t,a=i-e,l=Math.floor(r/this.tw),c=Math.floor(a/this.th),h=Math.floor(o/this.tw)+1,u=Math.floor(s/this.th)+1;this.range.col[0]=l,this.range.col[1]=l+h,this.range.row[0]=c,this.range.row[1]=c+u}},onRender:function(t){for(var e=this.range.row[0],n=this.range.row[1],i=this.range.col[0],o=this.range.col[1],s=e;n>s;s++)for(var r=i;o>r;r++){var a=this.data[s*this.cols+r],l=this.tilesets.set[a];l&&(t.map(l,r*this.tw,s*this.th,this.tw,this.th),this.tilemap.__debug&&(t.fillText(s*this.cols+r,r*this.tw+this.tw/2,s*this.th+this.th/2-10),t.fillText(s+","+r,r*this.tw+this.tw/2,s*this.th+this.th/2+10)))}}}),J=soya2d.class("",{"extends":F,constructor:function(t){this.tilewidth=t.tilewidth,this.tileheight=t.tileheight,this.rows=t.rows,this.columns=t.columns,this.layersData=t.layers,this.tilesetsData=t.tilesets,this.tilesets={},this.layers={},this.tiles={};for(var e=0,n=0;n<this.rows;n++)for(var i=0;i<this.columns;i++){var o=i*this.tilewidth,s=n*this.tileheight;this.tiles[e++]={x:o,y:s}}this.tileMatrix={};for(var n=0;n<this.rows;n++)for(var i=0;i<this.columns;i++){var o=i*this.tilewidth,s=n*this.tileheight;this.tileMatrix[n+"_"+i]={x:o,y:s}}this.w=this.tilewidth*this.columns,this.h=this.tileheight*this.rows,this.game=t.game,this.__blocks=[],this.__debug=!1,Object.defineProperty(this,"debug",{get:function(){return this.__debug},set:function(t){this.__debug=t,t&&this.__blocks.forEach(function(t){t.fillStyle="red",t.opacity=.5})}})},bindTileset:function(t,e){var n=this.tilesetsData[t],i=null;"string"==typeof e&&(i=this.game.assets.image(e));var o=new Z(i,n.sid,this.tilewidth,this.tileheight);return soya2d.ext(this.tilesets,o),this},createLayer:function(t,e,n){var i=this.layersData[t],o=n;return i&&(o=i.data),this.layers[t]=new $(this,o),e=e||this.game.world,e.add(this.layers[t]),this.layers[t]},resizeWorld:function(){this.game.world.setBounds(this.w,this.h)},setCollisionBetween:function(t,e){var n=this.tiles[t],i=this.tiles[e];if(n&&i){var o=i.x-n.x+this.tilewidth,s=i.y-n.y+this.tileheight,r=game.add.rect({w:o,h:s,x:n.x+o/2,y:n.y+s/2});return this.game.physics.enable(r),r.tilemap=this,r.on("collisionStart",L),r.body.static(!0).friction(0),this.__blocks.push(r),this}},setCollision:function(t,e){var n=this.tileMatrix[t+"_"+e];if(n){var i=this.tilewidth,o=this.tileheight,s=game.add.rect({w:i,h:o,x:n.x+i/2,y:n.y+o/2});return this.game.physics.enable(s),s.tilemap=this,s.on("collisionStart",L),s.body.static(!0).friction(0),this.__blocks.push(s),this}},setCollisionZone:function(t,e,n,i){var o=this.tileMatrix[t+"_"+e],s=this.tileMatrix[n+"_"+i];if(o&&s){var r=s.x-o.x+this.tilewidth,a=s.y-o.y+this.tileheight,l=game.add.rect({w:r,h:a,x:o.x+r/2,y:o.y+a/2});return l.tilemap=this,l.on("collisionStart",L),this.game.physics.enable(l),l.body.static(!0).friction(0),this.__blocks.push(l),this}},getTile:function(t,e){return this.tileMatrix[t+"_"+e]}}),Z=soya2d.class("",{constructor:function(t,e,n,i){this.set={},this.index=e;for(var o=t.width/n,s=t.height/i,r=0;s>r;r++)for(var a=0;o>a;a++)this.__getTileImage(t,a*n,r*i,n,i)},__getTileImage:function(t,e,n,i,o){var s=document.createElement("canvas");s.width=i,s.height=o;var r=s.getContext("2d");r.translate(i/2,o/2),r.drawImage(t,e,n,i,o,-i/2>>0,-o/2>>0,i,o),this.set[this.index++]=s}});soya2d.module.install("tilemap",{onInit:function(t){t.tilemap=new D(t)}})}(window||this);