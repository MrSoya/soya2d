var soya2d=new function(){this.__roIndex=0,this.version={v:[0,1,0,156],state:"alpha",toString:function(){return soya2d.version.v.join(".")+" "+soya2d.version.state}},this.website="http://soya2d.com",this.ext=function(t,e,o){for(var n=Object.keys(e),i=n.length;i--;){var s=n[i];(!t.hasOwnProperty(s)||o)&&(t[s]=e[s])}},this.inherits=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype},this.module=new function(){var t={};this.install=function(e,o){t[e]=o},this._getAll=function(){return t}}},soya=soya2d;self.Int8Array=self.Int8Array||Array,self.Uint8Array=self.Uint8Array||Array,self.Int16Array=self.Int16Array||Array,self.Uint16Array=self.Uint16Array||Array,self.Int32Array=self.Int32Array||Array,self.Uint32Array=self.Uint32Array||Array,self.Float32Array=self.Float32Array||Array,self.console=self.console||new function(){this.log=function(){},this.info=function(){},this.debug=function(){},this.error=function(){},this.warn=function(){}},soya2d.console=new function(){this.log=function(t,e){soya2d.Device.ie?console.log(t):console.log("%c"+t,e||"padding:1px 50px;font-size:14px;color:#fff;background:#2DB008;")},this.debug=function(t,e){soya2d.Device.ie?console.debug(t):console.debug("%c"+t,e||"padding:1px 50px;font-size:14px;color:#fff;background:#0069D6;")},this.error=function(t,e){soya2d.Device.ie?console.error(t):console.error("%c"+t,e||"padding:1px 50px;font-size:14px;color:#fff;background:#ff0000;")},this.warn=function(t,e){soya2d.Device.ie?console.warn(t):console.warn("%c"+t,e||"padding:1px 50px;font-size:14px;color:#fff;background:#FFB502;")}},self.cancelAFrame=function(t){return t.cancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.clearTimeout}(self),self.requestAFrame=function(t){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||function(e){return t.setTimeout(function(){e(Date.now())},16.7)}}(self),soya2d.BLEND_NORMAL="source-over",soya2d.BLEND_LIGHTER="lighter",soya2d.BLEND_MASK="destination-in",soya2d.BLEND_CLEAR="destination-out",soya2d.LINECAP_BUTT="butt",soya2d.LINECAP_ROUND="round",soya2d.LINECAP_SQUARE="square",soya2d.LINEJOIN_BEVEL="bevel",soya2d.LINEJOIN_ROUND="round",soya2d.LINEJOIN_MITER="miter",soya2d.TEXTALIGN_LEFT="left",soya2d.TEXTALIGN_CENTER="center",soya2d.TEXTALIGN_RIGHT="right",soya2d.TEXTVALIGN_TOP="hanging",soya2d.TEXTVALIGN_MIDDLE="middle",soya2d.TEXTVALIGN_BOTTOM="alphabetic",soya2d.TEXTDIR_LTR="ltr",soya2d.TEXTDIR_RTL="rtl",soya2d.REPEAT="repeat",soya2d.NOREPEAT="no-repeat",soya2d.REPEAT_X="repeat-x",soya2d.REPEAT_Y="repeat-y",soya2d.GRADIENTTYPE_LINEAR=1,soya2d.GRADIENTTYPE_RADIAL=2,soya2d.HITTEST_PATH=1,soya2d.HITTEST_PIXEL=2,soya2d.Math={PI:3.141592654,PIM2:6.283185307,PID2:1.570796327,PID4:.785398163,ONERAD:.017453292,ONEANG:57.295779513,toRadian:function(t){return t*this.ONERAD},toAngle:function(t){return t*this.ONEANG},randomf:function(t,e){return t+Math.random()*(e-t)},randomi:function(t,e){return t+Math.random()*(e-t)>>0},round:function(t){return.5+t>>0},floor:function(t){return 0|t},len2D:function(t,e,o,n){return Math.sqrt((n-e)*(n-e)+(o-t)*(o-t))},len2Df:function(t,e){t=Math.abs(t),e=Math.abs(e);var o=Math.min(t,e);return t+e-(o>>1)-(o>>2)+(o>>4)},SINTABLE:function(){for(var t=new Float32Array(361),e=.017453292,o=0;360>=o;o++){var n=o*e,i=Math.sin(n);t[o]=i}return t}(),COSTABLE:function(){for(var t=new Float32Array(361),e=.017453292,o=0;360>=o;o++){var n=o*e,i=Math.cos(n);t[o]=i}return t}()},soya2d.ResourceManager=function(){this.urlMap={}},soya2d.ResourceManager.prototype={findOne:function(t){if(!t)return null;if("string"==typeof t){var e=t;t={},t.urls=[e]}else t.urls=[t.url];var o=this.find(t);return 0==o.length?null:o[0]},find:function(t){var e=Object.keys(this.urlMap);if("string"==typeof t){var o=t;t={},t.urls=[o]}var n=t?t.fuzzy||!0:!0,i=[];if(t)for(var s=t.urls.length;s--;){var o=t.urls[s];if(n)for(var r=e.length;r--;)e[r].indexOf(o)>-1&&i.push(e[r]);else for(var r=e.length;r--;)e[r]==o&&i.push(e[r])}else i=e;for(var a=[],r=i.length;r--;)a.push(this.urlMap[i[r]]);return a}},soya2d.Circle=function(t,e,o){this.x=t||0,this.y=e||0,this.r=o||0},soya2d.Circle.prototype={toString:function(){return"{x:"+this.x+",y:"+this.y+",r:"+this.r+"}"},clone:function(){return new soya2d.Circle(this.x,this.y,this.r)}},soya2d.Polygon=function(t){this.vtx=t},soya2d.Polygon.prototype={toString:function(){return this.vtx},clone:function(){return new soya2d.Polygon(this.vtx.concat())}},soya2d.Rectangle=function(t,e,o,n){this.x=t||0,this.y=e||0,this.w=o||0,this.h=n||0},soya2d.Rectangle.prototype={toString:function(){return"{x:"+this.x+",y:"+this.y+",w:"+this.w+",h:"+this.h+"}"},clone:function(){return new soya2d.Rectangle(this.x,this.y,this.w,this.h)},getRight:function(){return this.x+this.w},getBottom:function(){return this.y+this.h},contains:function(t,e){return t<this.x||t>this.x+this.w?!1:e<this.y||e>this.y+this.h?!1:!0}},soya2d.Matrix2x2=function(){this.e=new Float32Array(4),this.identity()},soya2d.Matrix2x2.prototype={toString:function(){return"["+this.e[0]+","+this.e[1]+","+this.e[2]+","+this.e[3]+"]"},set:function(t,e,o,n){var i=this.e;return i[0]=t||1,i[1]=e||0,i[2]=o||0,i[3]=n||1,this},clone:function(){return(new soya2d.Matrix2x2).set(this.e[0],this.e[1],this.e[2],this.e[3])},identity:function(){return this.set(1,0,0,1),this},mul:function(t){var e=this.e[0],o=this.e[1],n=this.e[2],i=this.e[3],s=t.e;return this.e[0]=s[0]*e+s[2]*o,this.e[1]=s[1]*e+s[3]*o,this.e[2]=s[0]*n+s[2]*i,this.e[3]=s[1]*n+s[3]*i,this},scale:function(t,e){return this.e[0]*=t,this.e[1]*=e,this.e[2]*=t,this.e[3]*=e,this},rotate:function(t){if(!t)return this;var e=soya2d.Math;t=0>t?360+t%360:t,t>360&&(t%=360);var o=this.e[0],n=this.e[1],i=this.e[2],s=this.e[3],r=e.SINTABLE[t],a=e.COSTABLE[t];return void 0===r&&(r=Math.sin(t*e.ONERAD),a=Math.cos(t*e.ONERAD)),this.e[0]=o*a+n*-r,this.e[1]=o*r+n*a,this.e[2]=i*a+s*-r,this.e[3]=i*r+s*a,this},skew:function(t,e){var o=this.e[0],n=this.e[1],i=this.e[2],s=this.e[3];if(t){var r;this.skewX===t&&this.sx?r=this.sx:(r=Math.tan(.017453292*t),this.sx=r),this.e[0]+=n*r,this.e[2]+=s*r}if(e){var a;this.skewY===t&&this.sy?a=this.sy:(a=Math.tan(.017453292*e),this.sy=a),this.e[1]+=o*a,this.e[3]+=i*a}return this}},soya2d.Vector=function(t,e){this.e=new Float32Array(2),this.e[0]=t||0,this.e[1]=e||0},soya2d.Vector.prototype={toString:function(){return"{x:"+this.e[0]+",y:"+this.e[1]+"}"},clone:function(){return new soya2d.Vector(this.e[0],this.e[1])},set:function(t,e){return this.e[0]=t||0,this.e[1]=e||0,this},dot:function(t){return this.e[0]*t.e[0]+this.e[1]*t.e[1]},negate:function(){return this.e[0]*=-1,this.e[1]*=-1,this},add:function(t){return this.e[0]+=t.e[0],this.e[1]+=t.e[1],this},sub:function(t){return this.e[0]-=t.e[0],this.e[1]-=t.e[1],this},mul:function(t){return this.e[0]*=t,this.e[1]*=t,this},div:function(t){return t?(this.e[0]/=t,this.e[1]/=t):(this.e[0]=0,this.e[1]=0),this},getAngle:function(){return Math.atan2(this.e[1],this.e[0])},getAngleBetween:function(t){var e=this.dot(t),o=e/(this.length()*t.length());return Math.acos(o)},rotate:function(t){var e=soya2d.Math,o=e.SINTABLE[t],n=e.COSTABLE[t];void 0===o&&(o=Math.sin(t*e.ONERAD),n=Math.cos(t*e.ONERAD));var i=this.e[0],s=this.e[1];return this.e[0]=i*n-s*o,this.e[1]=i*o+s*n,this},lengthSq:function(){return this.e[0]*this.e[0]+this.e[1]*this.e[1]},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.div(this.length())}},soya2d.DisplayObject=function(t){t=t||{},this.__seq=soya2d.__roIndex++,this.roid="roid_"+this.__seq,this.name=t.name||this.roid,this.visible=t.visible===!1?!1:t.visible||!0,this.__opacity=0===t.opacity?0:t.opacity||1,this.__x=t.x||0,this.__y=t.y||0,this.__w=t.w||0,this.__h=t.h||0,this.__originX=0===t.originX?0:t.originX||"50%",this.__originY=0===t.originY?0:t.originY||"50%",this.__rotation=t.rotation||0,this.__scaleX=t.scaleX||1,this.__scaleY=t.scaleY||1,this.__skewX=t.skewX||0,this.__skewY=t.skewY||0,Object.defineProperties(this,{opacity:{set:function(t){t=0==t?0:parseFloat(t)||1,this.__opacity=0>t?0:t>1?1:t},get:function(){return this.__opacity},enumerable:!0},x:{set:function(t){this.__x=t||0,this.__localChange=!0},get:function(){return this.__x},enumerable:!0},y:{set:function(t){this.__y=t||0,this.__localChange=!0},get:function(){return this.__y},enumerable:!0},w:{set:function(t){this.__w=t,this.__originChange=!0},get:function(){return this.__w},enumerable:!0},h:{set:function(t){this.__h=t,this.__originChange=!0},get:function(){return this.__h},enumerable:!0},originX:{set:function(t){this.__originX=t,this.__originChange=!0},get:function(){return this.__originX},enumerable:!0},originY:{set:function(t){this.__originY=t,this.__originChange=!0},get:function(){return this.__originY},enumerable:!0},rotation:{set:function(t){this.__rotation=t,this.__localChange=!0},get:function(){return this.__rotation},enumerable:!0},scaleX:{set:function(t){this.__scaleX=t,this.__localChange=!0},get:function(){return this.__scaleX},enumerable:!0},scaleY:{set:function(t){this.__scaleY=t,this.__localChange=!0},get:function(){return this.__scaleY},enumerable:!0},skewX:{set:function(t){this.__skewX=t,this.__localChange=!0},get:function(){return this.__skewX},enumerable:!0},skewY:{set:function(t){this.__skewY=t,this.__localChange=!0},get:function(){return this.__skewY},enumerable:!0}}),this.z=t.z||0,this.__localChange=!0,this.__originChange=!0,this.__localTransform=new soya2d.Matrix2x2,this.__worldTransform=new soya2d.Matrix2x2,this.__worldPosition=new soya2d.Vector,this.__originPosition=new soya2d.Vector,this.blendMode=t.blendMode||"source-over",this.mask=t.mask||new soya2d.Mask,this.bounds=t.bounds||new soya2d.Rectangle(0,0,this.__w,this.__h),this.__boundRect=new soya2d.Rectangle(0,0,1,1),this.body=null},soya2d.ext(soya2d.DisplayObject.prototype,{toString:function(){return'{roid:"'+this.roid+'";name:"'+this.name+'"}'},updateTransform:function(){var t=this.__x,e=this.__y;this.__localChange&&(this.__localTransform.identity(),this.__localTransform.scale(this.__scaleX,this.__scaleY).rotate(this.__rotation).skew(this.__skewX,this.__skewY));var o=this.__localTransform,n=this.__worldTransform,i=this.__originPosition,s=o.e,r=i.e,a=r[0],u=r[1];if(this.__originChange&&(a=this.__originX,u=this.__originY,a="number"==typeof a?a:parseFloat(a)/100*this.__w,u="number"==typeof u?u:parseFloat(u)/100*this.__h,i.set(a,u)),t+=a,e+=u,n.set(s[0],s[1],s[2],s[3]),this.parent){var l=this.parent.__worldTransform,c=l.e,h=this.parent.__worldPosition.e,d=this.parent.__originPosition.e,f=d[0]*c[0]+d[1]*c[2],p=d[0]*c[1]+d[1]*c[3],m=t*c[0]+e*c[2],y=t*c[1]+e*c[3];t=m+h[0]-f,e=y+h[1]-p,n.mul(l)}this.__worldPosition.set(t,e),this.__localChange=this.__originChange=!1},isRendered:function(){if(!this.visible||0===this.opacity)return!1;for(var t=this.parent;t;){if(!t.visible||0===t.opacity)return!1;t=t.parent}return!0},clone:function(t,e){e=e||new this.constructor;for(var o=Object.keys(this),n=o.length;n--;){var i=o[n];if("parent"!==i&&"__seq"!==i&&"roid"!==i&&"__localTransform"!==i&&"__worldTransform"!==i&&"__worldPosition"!==i&&"__originPosition"!==i&&(t||"children"!==i))if(t&&"children"===i&&this[i]&&this[i].length>0){e[i]=[];for(var s=0;s<this[i].length;s++){var r=this[i][s],a=r.clone(t);a.parent=e,e[i].push(a)}}else e[i]=this[i]instanceof Array?this[i].slice(0):this[i]}return e},moveBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.x+=t,this.y+=e,this},moveTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.x=t,this.y=e,this},opacifyTo:function(t){return this.opacity=t>1?1:0>t?0:t,this},opacifyBy:function(t){return this.opacity+=t,this.opacity>1&&(this.opacity=1),this.opacity<0&&(this.opacity=0),this},resizeTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.w=t,this.h=e,this},scaleBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.scaleX+=t,this.scaleY+=e,this},scaleTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.scaleX=t,this.scaleY=e,this},skewBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.skewX+=t,this.skewY+=e,this},skewTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.skewX=t,this.skewY=e,this},rotateBy:function(t){return this.angle+=t,this},rotateTo:function(t){return this.angle=t,this},originBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.originX+=t,this.originY+=e,this},originTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.originX=t,this.originY=e,this},getBoundingPoints:function(){var t=this.__worldTransform.e,e=this.__worldPosition.e,o=this.__originPosition.e,n=e[0],i=e[1],s=t[0],r=t[1],a=t[2],u=t[3],l=o[0],c=o[1],h=-l,d=-c,f=this.w-l,p=-c,m=-l,y=this.h-c,g=this.w-l,v=this.h-c;return[h*s+d*a+n,h*r+d*u+i,f*s+p*a+n,f*r+p*u+i,g*s+v*a+n,g*r+v*u+i,m*s+y*a+n,m*r+y*u+i]},getBoundingBox:function(){var t,e,o,n,i=this.getBoundingPoints();o=i[0],t=i[0],n=i[1],e=i[1];for(var s=i.length;s--;)s%2===0?(i[s]>o&&(o=i[s]),i[s]<t&&(t=i[s])):(i[s]>n&&(n=i[s]),i[s]<e&&(e=i[s]));return sx=t,sy=e,sw=o-t,sh=n-e,this.__boundRect.x=sx,this.__boundRect.y=sy,this.__boundRect.w=sw,this.__boundRect.h=sh,this.__boundRect},hitTest:function(t,e){var o=this.__worldPosition.e;if(this.bounds instanceof soya2d.Circle){var n=Math.abs(soya2d.Math.len2D(o[0],o[1],t,e));if(n<=this.bounds.r)return!0}else if(this.bounds instanceof soya2d.Rectangle||this.bounds instanceof soya2d.Polygon){var i;if(this.bounds.vtx){var s=this.__worldTransform.e,r=this.__originPosition.e,a=o[0],u=o[1],l=s[0],c=s[1],h=s[2],d=s[3],f=r[0],p=r[1],m=-f,y=-p;i=[];for(var g=0;g<this.bounds.vtx.length;g+=2){var v=this.bounds.vtx[g]+m,b=this.bounds.vtx[g+1]+y;i.push(v*l+b*h+a,v*c+b*d+u)}}else i=this.getBoundingPoints();for(var _=!1,g=0;g<i.length;g+=2){var v=i[g],b=i[g+1],w=i[g+2]||i[0],E=i[g+3]||i[1];if(v===t&&b===e||w===t&&E===e)return!0;if(e>b&&E>=e||b>=e&&e>E){var A=(e-b)/(E-b)*(w-v)+v;if(A===t)return!0;A>t&&(_=!_)}}return _}return!1},getAnchorPosition:function(){var t=this.__worldTransform.e,e=this.__worldPosition.e,o=this.__originPosition.e,n=e[0],i=e[1],s=t[0],r=t[1],a=t[2],u=t[3],l=o[0],c=o[1],h=-l,d=-c,f=this.w*parseInt(this.originX)/100,p=this.h*parseInt(this.originY)/100,m=Math.sqrt(p*p+f*f),y=Math.atan2(p,f);return f=Math.cos(y)*m+h,p=Math.sin(y)*m+d,[f*s+p*a+n,f*r+p*u+i]}}),soya2d.DisplayObjectContainer=function(t){t=t||{},soya2d.DisplayObject.call(this,t),this.children=[],this.parent=null},soya2d.inherits(soya2d.DisplayObjectContainer,soya2d.DisplayObject),soya2d.ext(soya2d.DisplayObjectContainer.prototype,{add:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];e.parent||(this.children.push(e),e.parent=this)}return this},remove:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t],o=this.children.indexOf(e);0>o||(this.children.splice(o,1),e.parent=null)}return this},clear:function(){for(var t=this.children.length;t--;)this.children[t].parent=null;var e=this.children;return this.children=[],e},find:function(t,e){if(this.children.length<1)return[];var o;return e?(o=[],!function(e){for(var n=e.children.length;n--;){var i=e.children[n];t(i)&&o.push(i),i.children&&i.children.length>0&&arguments.callee(i)}}(this)):o=this.children.filter(t),o}}),soya2d.Mask=function(){this.list=[]},soya2d.ext(soya2d.Mask.prototype,{add:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];this.list.push(e)}return this},getShape:function(t){return this.list[t]},clear:function(){if(arguments.length>0)for(var t=0;t<arguments.length;t++){var e=arguments[t],o=this.children.indexOf(e);0>o||this.list.splice(o,1)}else this.list=[];return this}}),soya2d.Scene=function(t){function e(t,o){if(t.updateTransform(),t.children)for(var n=t.children.length;n--;){var i=t.children[n];i.opacity>0&&i.visible&&(o.push(i),e(i,o))}}function o(t,e){for(var n=t.length;n--;){var i=t[n];i._onUpdate&&i._onUpdate(e),i.onUpdate&&i.onUpdate(e),i.children&&o(i.children,e)}}t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.__updateMatrix=function(){this.__renderQueue=[],e(this,this.__renderQueue)},this.__update=function(t){this.children&&o(this.children,t)},this.findVisible=function(t){return this.__renderQueue?this.__renderQueue.filter(t):[]}},soya2d.inherits(soya2d.Scene,soya2d.DisplayObjectContainer),soya2d.ScrollSprite=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.scope=t.scope,this.freezone=t.freezone,this.__boundContainer=new soya2d.DisplayObjectContainer,this.children.push(this.__boundContainer)},soya2d.inherits(soya2d.ScrollSprite,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.ScrollSprite.prototype,{add:function(){return this.__boundContainer.add.apply(this.__boundContainer,arguments),this},remove:function(){return this.__boundContainer.remove.apply(this.__boundContainer,arguments),this},clear:function(){return this.__boundContainer.clear()},find:function(t,e){return this.__boundContainer.find(t,e)},follow:function(t){var e=this.__boundContainer.find(function(e){return t.roid===e.roid?!0:void 0},!0);return e.length<0&&console.error("soya2d.ScrollSprite: "+t.toString()+" must be a child node of soya2d.ScrollSprite"),this.target=t,this._onUpdate(),this},unfollow:function(){this.target=null},scrollTo:function(t,e){this.target||(this.__boundContainer.x=t,this.__boundContainer.y=e,this.__checkBounds())},scrollBy:function(t,e){this.target||(this.__boundContainer.x+=t,this.__boundContainer.y+=e,this.__checkBounds())},__checkBounds:function(){if(this.scope){var t=this.scope.x,e=this.scope.y,o=this.scope.w,n=this.scope.h,i=this.__boundContainer.x;i>t&&(this.__boundContainer.x=t),o>0&&i<this.w-o&&(this.__boundContainer.x=this.w-o);var s=this.__boundContainer.y;s>e&&(this.__boundContainer.y=e),n>0&&s<this.h-n&&(this.__boundContainer.y=this.h-n)}},setScope:function(t){t&&(this.scope=t,this.__boundContainer.w=t.w,this.__boundContainer.h=t.h)},_onUpdate:function(){if(this.target){var t,e;this.target.updateTransform();var o=this.target.__worldPosition.e;t=o[0],e=o[1];var n,i,s=this.target.w,r=this.target.h,a=this.__boundContainer.getBoundingPoints(),u=a[0],l=a[1],c=t-u,h=e-l;if(this.freezone){var d=-1*this.__boundContainer.x,f=-1*this.__boundContainer.y,p=c-d,m=h-f,y=s/2,g=r/2,v=this.freezone.x,b=this.freezone.y,_=this.freezone.w,w=this.freezone.h;if(v>p-y?n=c-y-v:p+y>v+_&&(n=c+y-v-_),b>m-g?i=h-g-b:m+g>b+w&&(i=h+g-b-w),!n&&!i)return}else n=c-this.w/2,i=h-this.h/2;n&&(this.__boundContainer.x=-n),i&&(this.__boundContainer.y=-i),this.__checkBounds()}},onRender:function(t){t.beginPath(),t.rect(0,0,this.w,this.h),t.clip()}}),soya2d.Shape=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t)},soya2d.inherits(soya2d.Shape,soya2d.DisplayObjectContainer),soya2d.Sprite=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t);var e=t.textures;this.setTextures(e),this.w=t.w||this.textures[0].w,this.h=t.h||this.textures[0].h,this.multiFrame=this.textures.length>1?!0:!1,this.frameIndex=0,this.__currTex,this.__lastUpdateTime=0,this.frameRate=t.frameRate||10,this.loop=t.loop===!1?!1:t.loop||!0,this.autoplay=t.autoplay||!1},soya2d.inherits(soya2d.Sprite,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Sprite.prototype,{clone:function(t){var e=new this.constructor({textures:this.textures.concat()});return soya2d.DisplayObject.prototype.clone.call(this,t,e)},onRender:function(t){if(this.multiFrame){if(this.__lastUpdateTime||(this.__lastUpdateTime=(new Date).getTime()),this.autoplay){var e=(new Date).getTime(),o=e-this.__lastUpdateTime,n=o/(16.7*this.frameRate)>>0;n>0&&(this.frameIndex+=n,this.frameIndex>=this.textures.length&&(this.frameIndex=this.loop?0:this.textures.length-1),this.__lastUpdateTime=e)}this.__currTex=this.textures[this.frameIndex],t.map(this.__currTex,0,0,this.w,this.h)}else t.map(this.textures[0],0,0,this.w,this.h)},nextFrame:function(){this.frameIndex++,this.frameIndex>=this.textures.length&&(this.frameIndex=this.loop?0:this.textures.length-1)},prevFrame:function(){this.frameIndex--,this.frameIndex<0&&(this.frameIndex=this.loop?this.textures.length-1:0)},setTextures:function(t){this.textures=t instanceof soya2d.Texture?[t]:t instanceof self.Image?[soya2d.Texture.fromImage(t)]:t instanceof Array?t:[],this.textures[0]||console.error("soya2d.Sprite: invalid param [textures]; "+this.textures[0])}}),soya2d.TileSprite=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.sprite=null,t.sprite instanceof soya2d.Texture||t.sprite instanceof self.Image?this.sprite=new soya2d.Sprite({textures:t.sprite}):t.sprite instanceof soya2d.Sprite&&(this.sprite=t.sprite),this.w=t.w||this.sprite.w,this.h=t.h||this.sprite.h,this.autoScroll=t.autoScroll||!1,this.speed=t.speed||1,this.angle=t.angle||0,this.__tileOffx=0,this.__tileOffy=0},soya2d.inherits(soya2d.TileSprite,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.TileSprite.prototype,{scroll:function(t,e){if(t||e)this.__tileOffx+=t||0,this.__tileOffy+=e||0;else{var o=(this.angle>>0)%360;this.__tileOffx+=soya2d.Math.COSTABLE[o]*this.speed,this.__tileOffy+=soya2d.Math.SINTABLE[o]*this.speed}},clone:function(t){var e=new this.constructor({sprite:this.sprite});return soya2d.DisplayObject.prototype.clone.call(this,t,e),e},_onUpdate:function(){if(this.autoScroll){var t=(this.angle>>0)%360;this.__tileOffx+=soya2d.Math.COSTABLE[t]*this.speed,this.__tileOffy+=soya2d.Math.SINTABLE[t]*this.speed}},onRender:function(t){t.beginPath(),t.push(),t.rect(0,0,this.w,this.h),t.clip();var e=this.sprite,o=e.w,n=e.h,i=o*e.scaleX,s=n*e.scaleY;i=0>i?-1*i:i,s=0>s?-1*s:s;var r=(this.w/i>>0)+2,a=(this.h/s>>0)+2,u=this.__tileOffx%i,l=this.__tileOffy%s;this.__tileOffx>0&&(u-=i),this.__tileOffy>0&&(l-=s);for(var c=this.sprite.textures[0],h=a;h--;)for(var d=r;d--;){var f=d*i,p=h*s;t.map(c,f+u,p+l,i,s,0,0,o,n)}t.pop()}}),soya2d.CanvasGraphics=function(t){this.ctx=t,this.opacity=function(t){return 0===t||t?(this.ctx.globalAlpha=t,this):this.ctx.globalAlpha},this.closePath=function(){return this.ctx.closePath(),this},this.moveTo=function(t,e){return this.ctx.moveTo(t,e),this},this.lineTo=function(t,e){return this.ctx.lineTo(t,e),this},this.quadraticCurveTo=function(t,e,o,n){return this.ctx.quadraticCurveTo(t,e,o,n),this},this.bezierCurveTo=function(t,e,o,n,i,s){return this.ctx.bezierCurveTo(t,e,o,n,i,s),this},this.arcTo=function(t,e,o,n,i){return this.ctx.arcTo(t,e,o,n,i),this},this.rect=function(t,e,o,n){return this.ctx.rect(t,e,o,n),this},this.polygon=function(t){var e=this.ctx,o=t.length-1;e.moveTo(t[0],t[1]);for(var n=2;o>n;n+=2)e.lineTo(t[n],t[n+1]);return this},this.ellipse=function(t,e,o,n){var i=.5522848,s=o/2*i,r=n/2*i,a=t+o,u=e+n,l=t+o/2,c=e+n/2,h=this.ctx;return h.moveTo(t,c),h.bezierCurveTo(t,c-r,l-s,e,l,e),h.bezierCurveTo(l+s,e,a,c-r,a,c),h.bezierCurveTo(a,c+r,l+s,u,l,u),h.bezierCurveTo(l-s,u,t,c+r,t,c),this},this.roundRect=function(t,e,o,n,i){var s=this.ctx;return s.moveTo(t+i,e),s.lineTo(t+(o-(i<<1)),e),s.arc(t+o-i,e+i,i,3*Math.PI/2,0),s.lineTo(t+o,e+n-i),s.arc(t+o-i,e+n-i,i,0,soya2d.Math.PID2),s.lineTo(t+i,e+n),s.arc(t+i,e+n-i,i,soya2d.Math.PID2,Math.PI),s.lineTo(t,e+i),s.arc(t+i,e+i,i,Math.PI,3*Math.PI/2),this},this.arc=function(t,e,o,n,i){return this.ctx.arc(t,e,o,n||0,i||soya2d.Math.PIM2),this},this.regularPolygon=function(t,e,o,n,i){t=t||0,e=e||0,o=3>o?3:o;for(var s=soya2d.Math,r=[],a=360/o,u=0,l=0;360>u;u+=a,l++){var c=n;i&&(c=l%2!==0?n:i),s.COSTABLE[u]?r.push(t+c*s.COSTABLE[u],e+c*s.SINTABLE[u]):r.push(t+c*s.COSTABLE[Math.round(u)],e+c*s.SINTABLE[Math.round(u)])}return this.polygon(r),this},this.blendMode=function(t){return t?(this.ctx.globalCompositeOperation=t,this):this.ctx.globalCompositeOperation},this.strokeStyle=function(t){return t?(this.ctx.strokeStyle=t,this):this.ctx.strokeStyle},this.fillStyle=function(t){return t?(this.ctx.fillStyle=t,this):this.ctx.fillStyle},this.shadow=function(t,e,o,n){return this.ctx.shadowBlur=t,this.ctx.shadowColor=e,this.ctx.shadowOffsetX=o,this.ctx.shadowOffsetY=n,this},this.lineStyle=function(t,e,o,n){var i=this.ctx;return i.lineWidth=t,i.lineCap=e||i.lineCap,i.lineJoin=o||i.lineJoin,i.miterLimit=n||i.miterLimit,this},this.font=function(t){var e=this.ctx;return e.font=t.getDesc(),this},this.clip=function(){return this.ctx.clip(),this},this.push=function(){return this.ctx.save(),this},this.pop=function(){return this.ctx.restore(),this},this.beginPath=function(){return this.ctx.beginPath(),this},this.closePath=function(){return this.ctx.closePath(),this},this.fill=function(){return this.ctx.fill(),this},this.stroke=function(){return this.ctx.stroke(),this},this.fillRect=function(t,e,o,n){return this.ctx.fillRect(t,e,o,n),this},this.strokeRect=function(t,e,o,n){return this.ctx.strokeRect(t,e,o,n),this},this.clearRect=function(t,e,o,n){return this.ctx.clearRect(t,e,o,n),this},this.map=function(t,e,o,n,i,s,r,a,u){return s=s||0,r=r||0,a=a||t.w,u=u||t.h,0!==a&&0!==u&&0!==i&&0!==i?(this.ctx.drawImage(t.__data,s>>0,r>>0,a>>0,u>>0,e>>0,o>>0,n>>0,i>>0),this):void 0},this.fillText=function(t,e,o,n){return n?this.ctx.fillText(t,e||0,o||0,n):this.ctx.fillText(t,e||0,o||0),this},this.strokeText=function(t,e,o,n){return n?this.ctx.strokeText(t,e||0,o||0,n):this.ctx.strokeText(t,e||0,o||0),this}},soya2d.CanvasRenderer=function(t){function e(t,o,n,i){if(0!==o.opacity&&o.visible){if(o.mask instanceof soya2d.Mask&&o.mask.list.length>0){t.save(),t.beginPath(),t.setTransform(1,0,0,1,0,0);for(var s=o.mask.list,r=0;r<s.length;r++){var a=s[r];a instanceof soya2d.Rectangle?u.rect(a.x,a.y,a.w,a.h):a instanceof soya2d.Circle?(t.moveTo(a.x+a.r,a.y),u.arc(a.x,a.y,a.r)):a instanceof soya2d.Polygon&&u.polygon(a.vtx)}t.closePath(),t.clip()}if(o instanceof soya2d.ScrollSprite&&t.save(),o.onRender){var l=o.__worldTransform.e,c=o.__worldPosition.e;t.setTransform(l[0],l[1],l[2],l[3],c[0],c[1]),o.opacity<=1&&o.opacity!==n.opacity&&(n.opacity=o.opacity,t.globalAlpha=o.opacity),n.blendMode!==o.blendMode&&(n.blendMode=o.blendMode,t.globalCompositeOperation=o.blendMode);var h=o.__originPosition.e;t.translate(-h[0],-h[1]),o.onRender(u)}if(o.children&&o.children.length>0){var d=o.children;i&&d.sort(function(t,e){return t.z===e.z?t.__seq-e.__seq:t.z-e.z});for(var f=0;f<d.length;f++)e(t,d[f],n,i)}o instanceof soya2d.ScrollSprite&&t.restore(),o.mask instanceof soya2d.Mask&&o.mask.list.length>0&&t.restore()}}t=t||{};var o=t.container;this.w=t.w||(o?o.clientWidth:0),this.h=t.h||(o?o.clientHeight:0),this.autoClear=void 0===t.autoClear?!0:t.autoClear,this.sortEnable=t.sortEnable||!1;var n=t.smoothEnable===!1?!1:t.smoothEnable||!0,i=t.crispEnable===!1?!1:t.crispEnable||!0,s=document.createElement("canvas");s.style.position="absolute";var r=window.getComputedStyle(t.container,null).position;"absolute"!==r&&"relative"!==r&&(o.style.position="relative"),r=null,o.appendChild(s),o=null;var a=s.getContext("2d"),u=new soya2d.CanvasGraphics(a);s.width=this.w,s.height=this.h,this.ctx=a,a.textBaseline=soya2d.TEXTVALIGN_TOP;var l={opacity:1,blendMode:"source-over"};this.getCanvas=function(){return s},this.render=function(t){!t instanceof soya2d.Scene||(t.__updateMatrix(),a.setTransform(1,0,0,1,0,0),this.autoClear&&a.clearRect(0,0,this.w,this.h),e(a,t,l,this.sortEnable))},this.resize=function(t,e){var o=s.width,n=s.height;this.hr=t/o,this.vr=e/n,s.style.width=t+"px",s.style.height=e+"px"},this.hr=1,this.vr=1,this.smooth=function(t){return void 0!==t?(a.imageSmoothingEnabled=a.webkitImageSmoothingEnabled=a.mozImageSmoothingEnabled=a.oImageSmoothingEnabled=a.msImageSmoothingEnabled=t,n=t,this):n},this.smooth(n),this.crisp=function(t){t?(s.style["image-rendering"]="optimizeSpeed",s.style["image-rendering"]="crisp-edges",s.style["image-rendering"]="-moz-crisp-edges",s.style["image-rendering"]="-webkit-optimize-contrast",s.style["image-rendering"]="optimize-contrast",s.style["image-rendering"]="pixelated",s.style.msInterpolationMode="nearest-neighbor"):(s.style["image-rendering"]="auto",s.style.msInterpolationMode="bicubic")},this.crisp(i),this.getImageData=function(t,e,o,n){return t=t||0,e=e||0,o=o||this.w,n=n||this.h,a.getImageData(t,e,o,n)},this.toDataURL=function(t){return s.toDataURL(t||"image/png")},this.getHitTester=function(t){switch(t){case 2:return this.__pixelTester;case 1:default:return this.__pathTester}},this.__pixelTester=new soya2d.__HitPixelTester(this.w,this.h),this.__pathTester=new soya2d.__HitPathTester(this.w,this.h),this.createPattern=function(t,e){return a.createPattern(t,e||"repeat")},this.createGradient=function(t,e,o,n){var i=0,s=0,r=0,u=soya2d.GRADIENTTYPE_LINEAR,l=0,c=0;n&&(i=n.angle||0,s=n.x||0,r=n.y||0,u=n.type||soya2d.GRADIENTTYPE_LINEAR,l=n.focalRatio||0,c=n.focalRadius||0);var h,d=soya2d.Math;switch(i=Math.abs((i||0)>>0),u){case soya2d.GRADIENTTYPE_LINEAR:h=a.createLinearGradient(s,r,s+o*d.COSTABLE[i],r+o*d.SINTABLE[i]);for(var f=0,p=t.length;p>f;f++)h.addColorStop(t[f],e[f]||"RGBA(0,0,0,0)");break;case soya2d.GRADIENTTYPE_RADIAL:var m=o*l;h=a.createRadialGradient(s,r,c,s+m*d.COSTABLE[i],r+m*d.SINTABLE[i],o);for(var f=0,p=t.length;p>f;f++)h.addColorStop(t[f],e[f]||"RGBA(0,0,0,0)")}return h}},soya2d.CanvasRenderer.prototype.getImageFrom=function(t,e,o){var n=document.createElement("canvas");n.width=e||t.w,n.height=o||t.h;var i=n.getContext("2d"),s=new soya2d.CanvasGraphics(i),r=new Image;return r.src=n.toDataURL("image/png"),s=null,n=null,r},soya2d.__HitPathTester=function(t,e){function o(t){t.stroke=function(){},t.fill=function(){},t.fillRect=function(e,o,n,i){t.rect(e,o,n,i)},t.strokeRect=function(e,o,n,i){t.rect(e,o,n,i)},t.drawImage=function(e,o,n,i,s,r,a,u,l){3===arguments.length?t.rect(o,n,e.width,e.height):5===arguments.length?t.rect(o,n,i,s):9===arguments.length&&t.rect(r,a,u,l)},t.fillText=function(){},t.strokeText=function(){}}function n(t,e,o){var n=t.__worldTransform.e,i=t.__worldPosition.e;if(e.setTransform(n[0],n[1],n[2],n[3],i[0],i[1]),t.onRender){e.beginPath();var s=t.__originPosition.e;e.translate(-s[0],-s[1]),t.onRender(o)}}var i=document.createElement("canvas");i.width=t,i.height=e;var s=i.getContext("2d"),r=new soya2d.CanvasGraphics(s);o(s),this.test=function(t,e,o){return n(t,s,r),s.isPointInPath(e,o)}},soya2d.__HitPixelTester=function(t,e){function o(t,e,o){var n=t.__worldTransform.e,i=t.__worldPosition.e;if(e.setTransform(n[0],n[1],n[2],n[3],i[0],i[1]),t.onRender){e.beginPath();var s=t.__originPosition.e;e.translate(-s[0],-s[1]),t.onRender(o)}}var t,e,n=document.createElement("canvas");n.width=t,n.height=e;var i=n.getContext("2d"),s=new soya2d.CanvasGraphics(i);this.test=function(n,r,a){o(n,i,s);var u=i.getImageData(0,0,t,e).data;return!!u[4*(t*a+r)+3]}},soya2d.HitTester=function(){soya2d.HitTester.prototype.test=function(){}},soya2d.Device=new function(){var t=this.userAgent=self.navigator.userAgent.toLowerCase(),e=t.indexOf("windows")>0?!0:!1,o=t.indexOf("linux")>0?!0:!1,n=t.indexOf("mac os")>0?!0:!1,i=t.indexOf("android")>0?!0:!1,s=t.indexOf("iphone")>0?!0:!1,r=t.indexOf("ipad")>0?!0:!1,a=t.indexOf("windows phone")>0?!0:!1;this.iphone=s,this.ipad=r,this.ios=s||r,this.android=i,this.wp=a,this.mobile=this.ios||i||a,this.windows=e,this.linux=o,this.mac=n;var u={Firefox:t.indexOf("firefox")+1,Opera:t.indexOf("opera")+1,Chrome:t.indexOf("chrome")+1,Safari:t.indexOf("safari")>-1&&t.indexOf("chrome")<0};this.ie=/msie|trident.*rv:/.test(t.toLowerCase()),this.ff=u.Firefox?!0:!1,this.opera=u.Opera?!0:!1,this.chrome=u.Chrome?!0:!1,this.safari=u.Safari?!0:!1},!function(){function t(t,e,o,n,i,s,r,a){o=r&&o>r?r:o,n=a&&n>a?a:n;var u=Math.max(o/t,n/e),l=t*u,c=e*u;return[l,c]}function e(t,e,o,n,i,s,r,a){o=r&&o>r?r:o,n=a&&n>a?a:n;var u=Math.min(o/t,n/e),l=t*u,c=e*u;return[l,c]}function o(t,e,o,n,i,s,r,a){var u,l;return u=i&&i>o?i:r&&o>r?r:o,l=s&&s>n?s:a&&n>a?a:n,[u,l]
}soya2d.View=function(n){function i(){var t,e=window.innerWidth,o=window.innerHeight;return t=e>o?"landscape":"portrait"}function s(t,e,o,n){switch(e){case soya2d.ROTATEMODE_90:rs="rotate(90deg)";break;case soya2d.ROTATEMODE_180:rs="rotate(180deg)";break;case soya2d.ROTATEMODE_270:rs="rotate(270deg)";break;case soya2d.ROTATEMODE_0:default:rs="rotate(0deg)",u=soya2d.ROTATEMODE_0}if(o.style.transform=o.style.webkitTransform=o.style.mozTransform=o.style.msTransform=o.style.oTransform=rs,o.style.left=o.style.top=0,e===soya2d.ROTATEMODE_90||e===soya2d.ROTATEMODE_270){var i=o.offsetWidth,s=o.offsetHeight;if(t===soya2d.SCALEMODE_NOBORDER){var r=this.game.w,a=this.game.h;i=i>a?a:i,s=s>r?r:s}if(n.resize(s,i),t===soya2d.SCALEMODE_EXACTFIT){var l=(i-s)/2;l=s%2===0?l:Math.floor(l);var c=(s-i)/2;c=i%2===0?c:Math.floor(c),o.style.left=l+"px",o.style.top=c+"px"}}}this.game=n,this.scaleMode=soya2d.SCALEMODE_SHOWALL,this.minWidth=0,this.minHeight=0,this.maxWidth=0,this.maxHeight=0,this.autoScale=!0,this.scan=function(){if(this.game){var n,i=this.game.w,r=this.game.h;switch(this.scaleMode){case soya2d.SCALEMODE_NOSCALE:break;case soya2d.SCALEMODE_NOBORDER:n=t;break;case soya2d.SCALEMODE_EXACTFIT:n=o;break;case soya2d.SCALEMODE_SHOWALL:default:n=e}if(n){var a=this.game.getRenderer(),l=a.getCanvas().parentNode,c=l.clientWidth,h=l.clientHeight;"BODY"===l.tagName&&(h=window.innerHeight);var d=n(i,r,c,h,this.minWidth,this.minHeight,this.maxWidth,this.maxHeight);a.resize(d[0],d[1]),this.w=d[0],this.h=d[1],s(this.scaleMode,u,a.getCanvas(),a)}}},this.orientation=i();var r,a=this;window.addEventListener("orientationchange",function(){clearTimeout(r),r=setTimeout(function(){a.orientation=i()},500),a.autoScale&&a.scan()},!1),window.addEventListener("resize",function(){a.orientation=i(),a.autoScale&&a.scan()},!1);var u=soya2d.ROTATEMODE_0;this.rotate=function(t){return this.game?t?(u=t,this.scan(),this):u:void 0};var l=soya2d.ALIGNMODE_CENTER;this.align=function(t){if(this.game){if(t&&this.scaleMode===soya2d.SCALEMODE_SHOWALL){var e=this.game.getRenderer().getCanvas();switch(l=t,t){case soya2d.ALIGNMODE_LEFT:e.style.left=0,e.style.right="auto";break;case soya2d.ALIGNMODE_RIGHT:e.style.left="auto",e.style.right=0;break;case soya2d.ALIGNMODE_CENTER:default:e.style.left=0,e.style.right=0,l=soya2d.ALIGNMODE_CENTER}return e.style.margin="auto",this}return l}}},soya2d.SCALEMODE_NOSCALE=0,soya2d.SCALEMODE_SHOWALL=1,soya2d.SCALEMODE_NOBORDER=2,soya2d.SCALEMODE_EXACTFIT=3,soya2d.ALIGNMODE_LEFT=1,soya2d.ALIGNMODE_CENTER=2,soya2d.ALIGNMODE_RIGHT=3,soya2d.ROTATEMODE_0=1,soya2d.ROTATEMODE_90=2,soya2d.ROTATEMODE_180=3,soya2d.ROTATEMODE_270=4}(),soya2d.Font=function(t){var e=document.createElement("span");e.style.cssText="position:absolute;top:-9999px;left:-9999px;white-space:nowrap;font:"+(t||"normal 400 13px/normal sans-serif"),this.fontString=e.style.font,this.fontSize=parseInt(e.style.fontSize)||13,this.__renderText=function(t){if(t.font(this.font),this.__lines){t.fillStyle(this.fillStyle);for(var e=0,o=this.__lines.length;o>e;e++){var n=this.__lines[e];if(this.letterSpacing>0)for(var i=0,s=0,r=n.length;r>s;s++)t.fillText(n[s],i,(this.__lh+this.lineSpacing)*e),i+=this.letterSpacing+this.__uw;else t.fillText(n,0,(this.__lh+this.lineSpacing)*e)}}},this.clone=function(){return new soya2d.Font(this.getDesc())},this.getDesc=function(){return e.style.font},this.style=function(t){return arguments.length>0?(e.style.fontStyle=t,this.fontString=e.style.font,this):e.style.fontStyle},this.weight=function(t){return arguments.length>0?(e.style.fontWeight=t,this.fontString=e.style.font,this):e.style.fontWeight},this.size=function(t){return arguments.length>0?(e.style.fontSize=t+"px",this.fontString=e.style.font,this.fontSize=t,this):e.style.fontSize},this.family=function(t){return arguments.length>0?(t&&(e.style.fontFamily=t,this.fontString=e.style.font),this):e.style.fontFamily},this.getBounds=function(t,e){var o=e.ctx;o.font=this.getDesc();var n=o.measureText(t).width;return{w:n,h:this.fontSize}}},soya2d.ImageFont=function(t){this.__fontMap=t;var e=t.texs[Object.keys(t.texs)[0]].h;this.fontSize=e;var o=t.texs[Object.keys(t.texs)[0]].w,n=1;this.__renderText=function(t){if(this.__lines)for(var e=0,o=0,i=0,s=this.__lines.length;s>i;i++){for(var r=this.__lines[i],a=0,u=0,l=r.length;l>u;u++){var c=r[u],h=this.font.__fontMap.getTexture(c);if(h){var d=h.w*n,f=h.h*n;o=d,t.map(h,a,e,d,f,0,0,h.w,h.h)}a+=o+this.letterSpacing}e+=this.font.fontSize+this.lineSpacing}},this.clone=function(){return new soya2d.ImageFont(this.__fontMap)},this.size=function(t){return arguments.length>0?(this.fontSize=parseInt(t)||e,n=this.fontSize/e,this):this.fontSize},this.getBounds=function(t){var e=t.length;return{w:e*o*n,h:this.fontSize}}},soya2d.Text=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.text=t.text||"",this.letterSpacing=t.letterSpacing||0,this.lineSpacing=t.lineSpacing||0,this.font=t.font,"string"==typeof this.font&&(this.font=new soya2d.Font(this.font));var e=this.font||new soya2d.Font;this.font=e,this.__changed=!0,this.__lines,this.__renderer=this.font.__renderText},soya2d.inherits(soya2d.Text,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Text.prototype,{onRender:function(t){this.__renderer(t)},refresh:function(){this.__changed=!0},setFont:function(t){t&&(this.font=t,this.__renderer=this.font.__renderText)},setText:function(t){this.text=t+"",this.refresh()},_onUpdate:function(t){if(!this.__lh){var e=this.font.getBounds("s",t.getRenderer()),o=this.font.getBounds("豆",t.getRenderer());this.__lh=(e.h+o.h)/2>>0,this.__uw=(e.w+o.w)/2>>0}this.__changed&&(this.__lines=this.__calc(t.getRenderer()),this.__changed=!1)},__calc:function(t){var e=this.letterSpacing,o=this.w/(this.__uw+e)>>0;1>o&&(this.w=1.5*this.__uw,o=1);for(var n=this.font,i=this.text.split("\n"),s=[],r=0,a=i.length;a>r;r++){var u=i[r];if(u)for(var l=u.length,c=0;l>c;){var h=u.substr(c,o+1),d=n.getBounds(h,t).w+h.length*e;if(d>this.w){for(var f=o+1;f--;)if(h=h.substr(0,h.length-1),d=n.getBounds(h,t).w+h.length*e,d<=this.w){if(0===d)return;s.push(h),c+=h.length;break}}else{for(var p=c,f=1;l-c>f;f++){if(h=u.substr(c,o+1+f),d=n.getBounds(h,t).w+h.length*e,d>this.w){s.push(h.substr(0,h.length-1)),c+=h.length-1;break}if(h===u){o=u.length-1;break}}if(c===p){h=u.substr(c,o+1),s.push(h);break}}}else s.push("")}return s}}),soya2d.Texture=function(t,e,o){this.__data=t,this.w=parseInt(e)||t.width,this.h=parseInt(o)||t.height},soya2d.ext(soya2d.Texture,{fromImage:function(t){return new soya2d.Texture(t,t.width,t.height)},fromColor:function(t,e,o){var n=document.createElement("canvas");n.width=t,n.height=e;var i=n.getContext("2d");if(o instanceof Array){for(var s=soya2d.RGBColor.parse(o[0]||"#000000"),r=soya2d.RGBColor.parse(o[1]||"#000000"),a=soya2d.RGBColor.parse(o[2]||"#000000"),u=soya2d.RGBColor.parse(o[3]||"#000000"),l=new soya2d.HSLColor(s[0],s[1],s[2]),c=l.l,h=new soya2d.HSLColor(r[0],r[1],r[2]),d=h.l,f=new soya2d.HSLColor(a[0],a[1],a[2]),p=f.l,m=new soya2d.HSLColor(u[0],u[1],u[2]),y=m.l,g=i.createImageData(t,e),v=g.data,b=0,_=v.length;_>b;b+=4){var w=b/4%t,E=b/4/t>>0,A=(t-w)/t,S=(e-E)/e,x=A*S;l.lighteness(x*c);var T=l.getRGB();A=w/t,S=(e-E)/e,x=A*S,h.lighteness(x*d);var B=h.getRGB();A=(t-w)/t,S=E/e,x=A*S,f.lighteness(x*p);var C=f.getRGB();A=w/t,S=E/e,x=A*S,m.lighteness(x*y);var L=m.getRGB();v[b]=T[0]+B[0]+C[0]+L[0],v[b+1]=T[1]+B[1]+C[1]+L[1],v[b+2]=T[2]+B[2]+C[2]+L[2],v[b+3]=255}i.putImageData(g,0,0)}else i.fillStyle=o,i.fillRect(0,0,t,e);return new soya2d.Texture(n,t,e)}}),soya2d.Texture.prototype={dispose:function(){this.__data=null}},soya2d.TextureAtlas=function(t,e){this.texs={},e.forEach(function(e){var o=document.createElement("canvas");o.width=e.w,o.height=e.h;var n=o.getContext("2d");n.translate(e.w/2,e.h/2),n.rotate((e.r||0)*Math.PI/180);var i=e.w>>0,s=e.h>>0;return 0===i||0===s?(console.error("soya2d.TextureAtlas: invalid ssheet unit，w/h must be a positive;[w:"+i+",h:"+s+"] "),void 0):(n.drawImage(t.__data,e.x>>0,e.y>>0,i,s,-i/2>>0,-s/2>>0,i,s),this.texs[e.n]=new soya2d.Texture(o,i,s),void 0)},this)},soya2d.TextureAtlas.prototype={getTextures:function(t){var e=[];for(var o in this.texs)0===o.indexOf(t)&&e.push(this.texs[o]);return e},getTexture:function(t){return this.texs[t]},dispose:function(){for(var t in this.texs)this.texs[t].dispose();this.texs=null}},soya2d.TextureAtlasManager=function(){soya2d.ResourceManager.call(this),this._add=function(t,e){this.urlMap[t]=e}},soya2d.inherits(soya2d.TextureAtlasManager,soya2d.ResourceManager),soya2d.TextureManager=function(){soya2d.ResourceManager.call(this),this._add=function(t,e){this.urlMap[t]=e}},soya2d.inherits(soya2d.TextureManager,soya2d.ResourceManager),soya2d.AJAXLoader=new function(){function t(t){var e="";for(var o in t)e+="&"+o+"="+escape(t[o]);return e.substr(1)}function e(e,o,i,s,r,a,u,l,c,h){var d=new XMLHttpRequest;e=e||"get","get"===e&&(c="string"==typeof c?c:t(c),o.indexOf("?")>-1?(o=o.replace(/&$/,""),o+="&"+c.replace(/^&/,"")):o+="?"+c.replace(/^&/,""),c=null),d.open(e,o,i===!1?!1:!0),d.timeout=l||n,d.ontimeout=a,d.onerror=u,null===d.onload?(d.onload=function(){(0===d.status||d.status>=200&&d.status<300||304===d.status)&&s(d)},d.onprogress=function(t){r&&t.lengthComputable&&r(d,t.loaded,t.total)}):d.onreadystatechange=function(){(0===d.status||(d.status>=200&&d.status<300||304===d.status)&&4===d.readyState)&&s(d)},"post"===e&&(c="string"==typeof c?c:t(c),d.setRequestHeader("Content-Type",h||"application/x-www-form-urlencoded")),d.send(c)}function o(e,o,i,s,r,a,u,l,c,h){var d=new XMLHttpRequest;d.open("post",o,i===!1?!1:!0),d.timeout=l||n,d.ontimeout=a,d.upload&&(d.upload.addEventListener("progress",function(t){if(r&&t.lengthComputable){{t.loaded/t.total}r(d,t.loaded,t.total)}},!1),d.upload.addEventListener("error",u,!1)),null===d.onload?d.onload=function(){(0===d.status||d.status>=200&&d.status<300||304===d.status)&&s(d)}:d.onreadystatechange=function(){(0===d.status||(d.status>=200&&d.status<300||304===d.status)&&4===d.readyState)&&s(d)},d.setRequestHeader("Content-Type",h||"application/x-www-form-urlencoded"),c="string"==typeof c?c:t(c),d.send(c)}var n=5e3;this.loadText=function(t){t&&t.onLoad instanceof Function&&e(t.type,t.url,t.async,function(e){t.onLoad(e.responseText)},t.onProgress,t.onTimeout,t.onError,t.timeout,t.data)},this.loadJSON=function(t){t&&t.onLoad instanceof Function&&e(t.type,t.url,t.async,function(e){var o;try{o=new Function("return "+e.responseText)()}catch(n){o=n}t.onLoad(o)},t.onProgress,t.onTimeout,t.onError,t.timeout,t.data)},this.uploadText=function(t){t&&t.onLoad instanceof Function&&o(t.type,t.url,t.async,function(e){t.onLoad(e.responseText)},t.onProgress,t.onTimeout,t.onError,t.timeout,t.data+"")}},soya2d.Loader=new function(){function t(e,o,n,i,s){var r=document.createElement("script");r.onload=function(){return this.onerror=null,this.onload=null,document.body.removeChild(this),n&&n.call&&n(this.src),o--,o?(t(e,o,n,i,s),void 0):(s&&s.call&&s(),void 0)},r.onerror=function(){return this.onerror=null,this.onload=null,document.body.removeChild(this),i&&i.call&&i(this.src),o--,o?(t(e,o,n,i,s),void 0):(s&&s.call&&s(),void 0)},r.src=e.shift(),document.body.appendChild(r)}function e(t,e,n,i,s,r){for(var a=["serif","sans-serif"],u="border:none;position:absolute;top:-999px;left:-999px;font-size:100px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:",l={},c={},h={},d=a.length;d--;){var f=document.createElement("div");f.style.cssText=u+"'"+a[d]+"'",f.innerHTML=e.family,document.body.appendChild(f),h[a[d]]=f,l[a[d]]=f.offsetWidth,c[a[d]]=f.offsetHeight}var p=document.createElement("style");p.id="FontLoader_"+(new Date).getTime(),p.innerHTML="@font-face {font-family: '"+e.family+"';src: url("+e.url+")}",document.head.appendChild(p);for(var d in h)h[d].style.fontFamily=e.family+","+h[d].style.fontFamily;var m=(new Date).getTime();setTimeout(function(){o(t,m,r,h,l,c,n,s,i,e.family)},100)}function o(t,e,i,s,r,a,u,l,c,h){setTimeout(function(){if((new Date).getTime()-e>i)return c&&c.call&&c(h),n--,!n&&l&&l.call&&l(),void 0;for(var d in s){s[d].style.left="-1000px";var f=s[d].offsetWidth,p=s[d].offsetHeight;if(f!==r[d]||p!==a[d]){var m;return u&&u.call&&(m=(new soya2d.Font).family(h),u(m,h)),t[n--]=m,!n&&l&&l.call&&l(t),void 0}}o(t,e,i,s,r,a,u,l,c,h)},20)}this.loadTextures=function(t){for(var e=t.urls.length,o=t.onLoad,n=t.onEnd,i=t.onError,s=(t.onTimeout,t.timeout||soya2d.TIMEOUT,t.crossOrigin),r=new Array(e),a=t.urls.length;a--;){var u=new Image;void 0!==s&&(u.crossOrigin=s),u.i=a,u.path=t.urls[a],u.onload=function(){var t=new soya2d.Texture.fromImage(this);r[this.i]=t,delete this.i,o&&o.call&&o(t,this.path),e--,!e&&n&&n.call&&n(r),this.onerror=null,this.onload=null},u.onerror=function(){i&&i.call&&i(this.src),e--,!e&&n&&n.call&&n(),this.onerror=null,this.onload=null},u.src=t.urls[a],u.complete&&u.onload()}return this},this.loadScripts=function(e){var o=e.urls.length,n=e.onLoad,i=e.onEnd,s=e.onError,r=document,a=document.body,u=e.mode||soya2d.LOADMODE_SEQU;if(u===soya2d.LOADMODE_SEQU)t(e.urls.concat(),o,n,s,i);else for(var l=e.urls.length;l--;){var c=r.createElement("script");c.async||(c.defer=!0),c.onload=function(){this.onerror=null,this.onload=null,document.body.removeChild(this),n&&n.call&&n(this.src),o--,!o&&i&&i.call&&i()},c.onerror=function(){this.onerror=null,this.onload=null,document.body.removeChild(this),s&&s.call&&s(this.src),o--,!o&&i&&i.call&&i()},c.src=e.urls[l],a.appendChild(c)}return this},this.loadSounds=function(t){for(var e=t.urls.length,o=t.onLoad,n=t.onEnd,i=t.onError,s=[],r=t.urls.length;r--;){var a=t.urls[r];new Howl({urls:a instanceof Array?a:[a],onload:function(){if(o&&o.call){var t=new soya2d.Sound;t.__handler=this,s.push(t),o(this._src,t)}e--,!e&&n&&n.call&&n(s)},onloaderror:function(t){if(i&&i.call){var o=soya2d.MEDIA_ERR_DECODE;t&&(o=t.type),i(this._src,o)}e--,!e&&n&&n.call&&n(s)}})}return this};var n=0;this.loadFonts=function(t){var o=t.urls.length,i=t.onLoad,s=t.onEnd,r=t.onTimeout,a=t.timeout||soya2d.TIMEOUT,u=new Array(o);n=o;for(var l=t.urls.length;l--;)e(u,t.urls[l],i,r,s,a)},this.loadTexAtlas=function(t){for(var e=t.urls.length,o=t.onLoad,n=t.onEnd,i=t.onError,s=[],r={},a=e;a--;)s.push(t.urls[a].image),r[t.urls[a].image]=t.urls[a].ssheet;var u=[];this.loadTextures({urls:s,onLoad:function(t,s){soya2d.AJAXLoader.loadJSON({url:r[s],onLoad:function(i){var a=new soya2d.TextureAtlas(t,i);o&&o(a,t,i,s,r[s]),u.push(a),0===--e&&n&&n(u)},onError:function(){e--,i&&i(s,r[s])}})},onError:function(t){e--,i&&i(t,r[t])}})}},soya2d.TIMEOUT=5e3,soya2d.MEDIA_ERR_UNCERTAIN=-1,soya2d.MEDIA_ERR_ABORTED=1,soya2d.MEDIA_ERR_NETWORK=2,soya2d.MEDIA_ERR_DECODE=3,soya2d.MEDIA_ERR_SRC_NOT_SUPPORTED=4,soya2d.MEDIA_ERR_SRC_NOT_FORTHCOMING=101,soya2d.LOADMODE_PARA=1,soya2d.LOADMODE_SEQU=2,soya2d.Game=function(t){function e(t,e,o,n,i){"use strict";for(var s={},r=o.length;r--;)s[o[r].image+"/"+o[r].ssheet]=o[r].id;e.loadTexAtlas({crossOrigin:t,urls:o,onLoad:function(t,e,o,i,r){h.textureManager._add(i,e);var a=s[i+"/"+r];h.texAtlasManager._add(a,t),n(t,e,o)},onError:function(t,e){n(t,e)},onEnd:function(){i()}})}function o(t,e,o,n,i){"use strict";e.loadScripts({crossOrigin:t,urls:o,onLoad:function(t){n(t)},onError:function(t){n(t)},onEnd:function(){i()}})}function n(t,e,o,n,i){"use strict";e.loadSounds({urls:o,onLoad:function(t,e){h.soundManager._add(t,e),n(t)},onError:function(t){n(t)},onEnd:function(t){i(t)}})}function i(t,e,o,n,i){"use strict";e.loadTextures({crossOrigin:t,urls:o,onLoad:function(t,e){h.textureManager._add(e,t),n()},onError:function(t){n(t)},onEnd:function(){i()}})}function s(t,e,o,n,i){"use strict";e.loadFonts({urls:o,timeout:1e3,onLoad:function(t,e){n(t,e)},onTimeout:function(t){n(t)},onEnd:function(){i()}})}function r(t){h.running&&(f=requestAFrame(function(e){0===p&&(p=e);var o=e-p;if(p=e,g>d){var n=Date.now();t&&t(n,o),g%=d}g+=o,r(t)}))}t=t||{};var a=t.container||document.body;"string"==typeof a&&(a=document.querySelector(a));var u=(t.rendererType||soya2d.RENDERER_TYPE_CANVAS,a.offsetWidth||100),l=a.offsetHeight||100,c=null;c=new soya2d.CanvasRenderer({smoothEnable:t.smoothEnable,autoClear:t.autoClear,container:a,sortEnable:!0,w:t.w||u,h:t.h||l}),soya2d.ext(this,t),this.scene=null,this.getRenderer=function(){return c},this.view=new soya2d.View(this),this.textureManager=new soya2d.TextureManager,this.texAtlasManager=new soya2d.TextureAtlasManager,this.loadRes=function(t){var r=t.textures||[],a=t.texAtlas||[],u=t.fonts||[],l=t.sounds||[],c=t.scripts||[],h=t.onLoad||function(){},d=t.onEnd||function(){},f=t.crossOrigin,p=soya2d.Loader,m=[];r.length>0&&m.push([i,r]),a.length>0&&m.push([e,a]),soya2d.Sound&&l.length>0&&m.push([n,l]),u.length>0&&m.push([s,u]),c.length>0&&m.push([o,c]);var y=m.length;y>0&&m[0][0](f,p,m[0][1],h,function(){y>1?m[1][0](f,p,m[1][1],h,function(){y>2?m[2][0](f,p,m[2][1],h,function(){y>3?m[3][0](f,p,m[3][1],h,function(){y>4?m[4][0](f,p,m[4][1],h,d):d()}):d()}):d()}):d()})};var h=this;this.w=c.w,this.h=c.h,this.running=!1,this.start=function(t){if(!this.running){this.running=!0,this.cutTo(t),soya2d.console.log("game starting..."),t.children.length<1&&soya2d.console.warn("empty scene be showing..."),this.view.scan(this.w,this.h,a,c),this.view.align(this.view.align());var e=soya2d.module._getAll(),o=[],n=[],i=[],s=[],u=[];for(var l in e)e[l].onStart&&e[l].onStart(this),e[l].onBeforeUpdate&&o.push(e[l].onBeforeUpdate),e[l].onUpdate&&n.push(e[l].onUpdate),e[l].onAfterUpdate&&i.push(e[l].onAfterUpdate),e[l].onBeforeRender&&s.push(e[l].onBeforeRender),e[l].onAfterRender&&u.push(e[l].onAfterRender);return d=1e3/y,r(function(t,e){o.forEach(function(o){o(h,t,e)}),n.length>0&&(t=Date.now(),n.forEach(function(o){o(h,t,e)})),h.scene.__update(h),i.length>0&&(t=Date.now(),i.forEach(function(o){o(h,t,e)})),s.length>0&&(t=Date.now(),s.forEach(function(o){o(h,t,e)})),c.render(h.scene),u.length>0&&(t=Date.now(),u.forEach(function(o){o(h,t,e)}))}),this}};var d,f,p=0,m=60,y=60,g=0;this.setFPS=function(t){return y=parseInt(t)||m,y=y>m?m:y,d=1e3/y,this},this.stop=function(){cancelAFrame(f),this.running=!1;var t=soya2d.module._getAll();for(var e in t)t[e].onStop&&t[e].onStop(this);return this},this.cutTo=function(t){if(t){var e=!1;if(this.scene&&(e=!0,this.scene.clear()),this.scene=t,this.scene.game=this,this.scene.onInit&&this.scene.onInit.call&&this.scene.onInit(this),e){var o=soya2d.module._getAll();for(var n in o)o[n].onSceneChange&&o[n].onSceneChange(this,t)}return this}};var v=soya2d.module._getAll(),b=0;for(var _ in v)v[_].onInit&&v[_].onInit(this),b++;var w="soya2d Game instance created...",E=b+" plugins loaded...";soya2d.console.log(w),soya2d.console.log(E)};var t1="soya2d is working...",t2="==== thank you for using soya2d, you'll love it! ====";soya2d.console.log(t1),soya2d.console.log(t2),soya2d.RENDERER_TYPE_AUTO=1,soya2d.RENDERER_TYPE_CANVAS=2,soya2d.RENDERER_TYPE_WEBGL=3,soya2d.LoaderScene=function(t){t=t||{},soya2d.Scene.call(this,t),soya2d.ext(this,t),this.nextScene=t.nextScene,this.nextScene instanceof soya2d.Scene||console.error("soya2d.LoaderScene: invalid param [nextScene], it must be a instance of soya2d.Scene"),this.textures=t.textures||[],this.texAtlas=t.texAtlas||[],this.sounds=t.sounds||[],this.scripts=t.scripts||[],this.fonts=t.fonts||[];var e=t.onStart,o=t.onProgress,n=t.onEnd;this.onInit=function(t){function i(){var e=soya2d.Texture.fromImage(this),i=new soya2d.Sprite({x:t.w/2-e.w/2,y:t.h/2-e.h/2-20,textures:e});a.add(i);var u=new soya2d.Font("normal 400 23px/normal Arial,Helvetica,sans-serif");a.tip=new soya2d.Text({x:i.x-70,y:i.y+e.h+10,font:u,text:"Loading... 0/0",w:200,fillStyle:a.fillStyle||"#fff"}),a.add(a.tip),t.loadRes({textures:a.textures,texAtlas:a.texAtlas,sounds:a.sounds,fonts:a.fonts,scripts:a.scripts,onLoad:function(){a.onProgress&&a.onProgress(t,r,++s),o instanceof Function&&o(t,r,s)},onEnd:function(){a.onComplete&&a.onComplete(t,r),n instanceof Function&&n(t,r),t.cutTo(a.nextScene)}})}var s=0,r=this.textures.length+this.sounds.length+this.fonts.length;this.onStart&&this.onStart(t,r),e instanceof Function&&e(t,r);var a=this,u=new Image;u.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAA8CAYAAACNQSFVAAAGeklEQVR42tWYC2xTVRjHr6yz79vec7t2YzCesq3dg/cUmLIg713Ccx0wxmNsaxsmIAoKG2CMSISoPAWFCDHy0EQjaBQyF3mM0YHxAUqC+AKiidIxooKLg+N3zz23vX23QEy8yT9tmvZ3vvP/vnPO18MwyT8PUHUBpYBSQWqQhslgdBO26POrPkOv1zbz5+4FqgI9SKAMowcZi9cY7Asaub2uVtRR28L77hWqE6H2GZqsOR+bN7ha0B9uL8LuVh7Hg8eF2oYx1tkfcMtrTqFfRaC71eJX7Sm+LRZUBqsUvopQA2NiOOcBc2VNM7okQWVZ/K+R4NGgWgJlGNOkHey46uPotPsMuq2MNFQ1zfz1eBWgpcliS9axRVVN/CGXl+90eyE6L48TgceqALZ4mcE+76h5F0BvxQNGgndRQGVfjdmjdV0rj6CXaltQm7sV4WTABH5KgquUvrLdGFT+nnlpTTN3hSTHq0yWJZnI2xl/tIhhnW+z5VAB52ER3CHRJgj1RINP3sMOnbTTXLLwOHdMqoDko4waecVh7rLLizqCa/U+wYXtxg7nQROuPolw+IKIPOWE4aXbjB2l241Y2GHEFYdN2OXl7ssM/gu4gcCJthnxlD0snv8pDEB2N3TXA5FFFARXqOwAC1/g/AN47hYuhICF7az0uhOsOmTGrtNJzgBmDevFFzVy2SZi1ZtgVSMXsZoCFSV/jjrnHUGnB1brShlBAQ+fQWAA2arqk1yUfQbhqibu+1HP6RfDLlUAq76fv1oiSQidhVxVxCqaDxio+gRqF7aymzRpzAiA9gflgnoTuBDNlhhWTd5txPOOcrhsn+l9S15KKcAeAQ0C5YEeAmXFjDzqTLYa8YiVepxXocFZI1NfhX11JMCKQANAdlAfUGZgESkUChMUtoxaZ8D9q7TYXi5Lg3OmqX/IKOqyJMiSYDgb0WsJbMBjXzbgIXU6AnPMDIbL6jdZ3WgpSBEUkYeXohI+YYsRD1+hw47ZACUQLcB1RHY6CHlPB8t1qm/2FdRvGNIZR5AtyoRNBJU8r8cF82WAMtoominNJL9Sg6e/Zb4alFB5gDEbDXiQW/piaLT+qKPAH3/RgJddsuB6n/XPIFsmbDbgYcvhx7NkmPSDUHD4IBpctFSHXS0cXt1uxWvabbjBZ/uLgbLqEG0YuVZPpkOi9E9RssOh8DYwqJTEQrDN+Y4J119Lk8A3bAC3QuS2m0zREu2NgbWKrEeZuiMoeRoCH/eKAT/1oyUAVaj+GsB7T0x128vVbVKJ6agNsoIHEj/LdWqgevTYcxaFAcPg8CBLHjO475QH9wLgb2Vy/BZQX8XFMxv2lQZfGpl6InATyArqbhucMil7qvoswO4o/XXM0mDhNRavuCL7GhtM4D4JbgTxoAxQT1BO5rBUd8509WUx2uJVelz3tUUBTQ4uNpxmOXpQX5Cj28Mp4ysOm681tFnjWhDLFh21Jk3cD4wZTM7U3exaOKaui/v10os8KbNkBwiDT9zCViw8hs5DW3dH2YSKlfH0T5I1SXk+ZpMhb/QGtmhBE/oIIr0d3k4Ezs1FX/D4mavB/q9ujxE59N8XoVe8ldjpzpOTffE3PF75G1h1I7pdJHL4wT+JN6GK0/8Mj5+EfDS0yQNYwyOX4JEAifQoCHs+h3z8rNwCrIrIvaHwxJr7QAMkBVL3FY+f/SUwi4ThiYk0RHjJtxa86vc0asv/Ax4YANYJfuKc5QLA0X2NHP4itk/ZZVqvtzH5EeGeZKGQVPF/lfMgt7/HcFUJ7V36+G3xxK2UaOXJ3678kDtROFdbBsACP1jcBO/OFsmCBU3cd8Wr2EW00xJ7xGxQL1A3kI3xtCaaUN5vgbhjCltN67XpzFCA5NNoxa26B6gr3WE5WKGJRo7Efxi3Zuwz7c8cohpFLbDTjrYnjTadHjwmcoUSXoqhFzMkWZ1zwFdHmXYa/KhQPExIcy81nN3pKSZFK51sOnLz4Y5oCx/wtZG78Fi9oU7haw5NWJbCAiRen9BTTUNvQFRREir6yvmEbcYXUllmSARfM+mxiPwWSLceanoRlEKuWgKei9Pnia/l76I9GQNUj9JIc6P4alZYIENVFCzdPEmRE3Dn3CPok8L5+rF06tk00l4xfZUtkKMNXGkxTG0zOrfwOPqydLNpOp1yTwrsEQKN7GskqPyM32geYO0FBS95mE6TlEHfp8X1NRKUPv8CGn7DXd3B5GwAAAAASUVORK5CYII=",u.complete?i.call(u):u.onload=i},this.onStart=function(){},this.onProgress=function(t,e,o){this.tip&&this.tip.setText("Loading... "+o+"/"+e)}},soya2d.inherits(soya2d.LoaderScene,soya2d.Scene),soya2d.Tween=function(t,e,o,n){this.__attr={},this.__attr_inverse={},this.__attriNames,this.attris=e,this.target=t,this.duration=o,n=n||{},this.easing=n.easing||soya2d.Tween.Linear,this.iteration=n.iteration||0,this.alternate=n.alternate||!1,this.onUpdate=n.onUpdate,this.onEnd=n.onEnd,this.cacheable=n.cacheable||!1,this.__loops=0},soya2d.Tween.prototype={__calc:function(t){for(var e=this.__attriNames=Object.getOwnPropertyNames(this.attris),o=e.length;o--;){var n=e[o],i=this.target[n];if(i!==t){var s=parseFloat(i||0),r=this.attris[n];("string"==typeof r||r instanceof String)&&(r=0===r.indexOf("-")?s-parseFloat(r.substring(1,r.length)):0===r.indexOf("+")?s+parseFloat(r.substring(1,r.length)):parseFloat(r));var a=r-s;this.__attr[n]={initVal:s,varVal:a,endVal:r};var u=s-r;if(this.__attr_inverse[n]={initVal:r,varVal:u,endVal:s},this.cacheable){this.__ratio={},this.__ratio_inverse={};for(var l=this.__attr[n].dVal={},c=this.__attr_inverse[n].dVal={},h=0;(h+=10)<this.duration;){var d=this.easing(h,0,1,this.duration);this.__ratio["p_"+h]=d,l["p_"+h]=s+a*d,d=this.easing(h,0,1,this.duration),this.__ratio_inverse["p_"+h]=d,c["p_"+h]=r+u*d}}}}},start:function(){return this.__calc(),this.__startTime=Date.now(),this.target.__tween instanceof soya2d.Tween&&this.target.__tween.stop(),this.target.__tween=this,soya2d.TweenManager.add(this),this},delay:function(t){var e=this;return this.stop(),setTimeout(function(){e.start()},t),this},stop:function(){return soya2d.TweenManager.remove(this),this},goTo:function(t,e,o){var n,i=this.__attriNames,s=this.__attr,r=t;if(this.cacheable){var a="p_"+10*(e/10>>0);n=this.__ratio[a],"p_0"===a&&(n=0),n===o&&(n=1);for(var u=i.length;u--;){var l=i[u];if(s[l]){var c=s[l].dVal[a];c===o&&(c=s[l].endVal),r[l]=c}}}else{n=this.easing(e,0,1,this.duration),e>this.duration&&(n=1);for(var u=i.length;u--;){var l=i[u];s[l]&&(r[l]=s[l].initVal+s[l].varVal*n)}}return n},update:function(t){var e=t-this.__startTime,o=this.target,n=this.goTo(o,e);if(e>=this.duration){if(this.onEnd&&this.onEnd(o),-1===this.iteration||this.iteration>0&&this.__loops++<this.iteration){if(this.__startTime=Date.now(),this.alternate){var i=this.__attr;this.__attr=this.__attr_inverse,this.__attr_inverse=i,i=this.__ratio,this.__ratio=this.__ratio_inverse,this.__ratio_inverse=i}return}return this.destroy(),soya2d.TweenManager.remove(this),void 0}this.onUpdate&&this.onUpdate(o,n)},destroy:function(){this.__attr=null,this.__ratio=null,this.attris=null,this.easing=null,this.target=null,this.onUpdate=null,this.onEnd=null}},soya2d.ext(soya2d.DisplayObject.prototype,{animate:function(t,e,o){var n=new soya2d.Tween(this,t,e,o).start();return n},stopAnimation:function(){return this.__tween&&(this.__tween.stop(),delete this.__tween),this},playTween:function(t,e,o){if(t.tweenTpl){var n=t.easing.split("-"),i="Linear"===t.easing?soya2d.Tween.Linear:soya2d.Tween[n[0]][n[1]],s={};for(var r in t.attr)s[r]=t.attr[r].symbol+t.attr[r].value;return new soya2d.Tween(this,s,t.duration,{easing:i,iteration:t.isRepeat?-1:0,alternate:t.alternate,onUpdate:e,onEnd:o}).start()}}}),soya2d.TweenManager=new function(){var t=[];this.add=function(e){var o=t.indexOf(e);return o>-1?this:(t.push(e),this)},this.remove=function(e){var o=t.indexOf(e);return o>-1&&t.splice(o,1),this},this.stop=function(){t=[]},this.update=function(e){for(var o=t.length;o--;)t[o].update(e)}},soya2d.Tween.Linear=function(t,e,o,n){return o*t/n+e},soya2d.Tween.Quad={In:function(t,e,o,n){return o*(t/=n)*t+e},Out:function(t,e,o,n){return-o*(t/=n)*(t-2)+e},InOut:function(t,e,o,n){return(t/=n/2)<1?o/2*t*t+e:-o/2*(--t*(t-2)-1)+e}},soya2d.Tween.Cubic={In:function(t,e,o,n){return o*(t/=n)*t*t+e},Out:function(t,e,o,n){return o*((t=t/n-1)*t*t+1)+e},InOut:function(t,e,o,n){return(t/=n/2)<1?o/2*t*t*t+e:o/2*((t-=2)*t*t+2)+e}},soya2d.Tween.Quart={In:function(t,e,o,n){return o*(t/=n)*t*t*t+e},Out:function(t,e,o,n){return-o*((t=t/n-1)*t*t*t-1)+e},InOut:function(t,e,o,n){return(t/=n/2)<1?o/2*t*t*t*t+e:-o/2*((t-=2)*t*t*t-2)+e}},soya2d.Tween.Quint={In:function(t,e,o,n){return o*(t/=n)*t*t*t*t+e},Out:function(t,e,o,n){return o*((t=t/n-1)*t*t*t*t+1)+e},InOut:function(t,e,o,n){return(t/=n/2)<1?o/2*t*t*t*t*t+e:o/2*((t-=2)*t*t*t*t+2)+e}},soya2d.Tween.Sine={In:function(t,e,o,n){return-o*Math.cos(t/n*(Math.PI/2))+o+e},Out:function(t,e,o,n){return o*Math.sin(t/n*(Math.PI/2))+e},InOut:function(t,e,o,n){return-o/2*(Math.cos(Math.PI*t/n)-1)+e}},soya2d.Tween.Expo={In:function(t,e,o,n){return 0===t?e:o*Math.pow(2,10*(t/n-1))+e},Out:function(t,e,o,n){return t===n?e+o:o*(-Math.pow(2,-10*t/n)+1)+e},InOut:function(t,e,o,n){return 0===t?e:t===n?e+o:(t/=n/2)<1?o/2*Math.pow(2,10*(t-1))+e:o/2*(-Math.pow(2,-10*--t)+2)+e}},soya2d.Tween.Circ={In:function(t,e,o,n){return-o*(Math.sqrt(1-(t/=n)*t)-1)+e},Out:function(t,e,o,n){return o*Math.sqrt(1-(t=t/n-1)*t)+e},InOut:function(t,e,o,n){return(t/=n/2)<1?-o/2*(Math.sqrt(1-t*t)-1)+e:o/2*(Math.sqrt(1-(t-=2)*t)+1)+e}},soya2d.Tween.Elastic={In:function(t,e,o,n,i,s){if(0===t)return e;if(1===(t/=n))return e+o;if(s||(s=.3*n),!i||i<Math.abs(o)){i=o;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(o/i);return-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-r)*Math.PI/s))+e},Out:function(t,e,o,n,i,s){if(0===t)return e;if(1===(t/=n))return e+o;if(s||(s=.3*n),!i||i<Math.abs(o)){i=o;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(o/i);return i*Math.pow(2,-10*t)*Math.sin(2*(t*n-r)*Math.PI/s)+o+e},InOut:function(t,e,o,n,i,s){if(0===t)return e;if(2===(t/=n/2))return e+o;if(s||(s=.3*n*1.5),!i||i<Math.abs(o)){i=o;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(o/i);return 1>t?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t*n-r)*Math.PI/s)+e:i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*n-r)*Math.PI/s)*.5+o+e}},soya2d.Tween.Back={In:function(t,e,o,n,i){return void 0===i&&(i=1.70158),o*(t/=n)*t*((i+1)*t-i)+e},Out:function(t,e,o,n,i){return void 0===i&&(i=.70158),o*((t=t/n-1)*t*((i+1)*t+i)+1)+e},InOut:function(t,e,o,n,i){return void 0===i&&(i=1.70158),(t/=n/2)<1?o/2*t*t*(((i*=1.525)+1)*t-i)+e:o/2*((t-=2)*t*(((i*=1.525)+1)*t+i)+2)+e}},soya2d.Tween.Bounce={In:function(t,e,o,n){return o-soya2d.Tween.Bounce.Out(n-t,0,o,n)+e},Out:function(t,e,o,n){return(t/=n)<1/2.75?7.5625*o*t*t+e:2/2.75>t?o*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?o*(7.5625*(t-=2.25/2.75)*t+.9375)+e:o*(7.5625*(t-=2.625/2.75)*t+.984375)+e},InOut:function(t,e,o,n){return n/2>t?.5*soya2d.Tween.Bounce.In(2*t,0,o,n)+e:.5*soya2d.Tween.Bounce.Out(2*t-n,0,o,n)+.5*o+e}},soya2d.module.install("tween",{onUpdate:function(t,e){soya2d.TweenManager.update(e)},onStop:function(){soya2d.TweenManager.stop()}}),soya2d.Arc=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.Arc,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Arc.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle);var e=(this.startAngle||0)*soya2d.Math.ONERAD,o=(this.endAngle||0)*soya2d.Math.ONERAD;t.arc(this.w/2,this.h/2,this.w/2,e,o),o-e!=0&&360!=Math.abs(this.startAngle||0-this.endAngle||0)&&t.lineTo(this.w/2,this.h/2),t.fill(),t.closePath(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.Ellipse=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.Ellipse,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Ellipse.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.ellipse(0,0,this.w,this.h),t.closePath(),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.Poly=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.bounds=new soya2d.Polygon(t.vtx),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.Poly,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Poly.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.polygon(this.vtx),t.closePath(),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.Rect=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.Rect,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Rect.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.rect(0,0,this.w,this.h),t.fill(),t.closePath(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.RPoly=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.RPoly,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.RPoly.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.regularPolygon(this.w/2,this.h/2,this.edgeCount,this.r1,this.r2),t.closePath(),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.RRect=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.RRect,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.RRect.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.roundRect(0,0,this.w,this.h,this.r),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke()),t.closePath()
}}),soya2d.EventHandler=function(){this.__eventMap={},this.addListener=function(t,e,o,n){this.__eventMap[t]||(this.__eventMap[t]=[]),this.__eventMap[t].push({fn:e,order:n||0,context:o})},this.removeListener=function(t,e,o){if(this.__eventMap[t])if(e){for(var n=-1,i=this.__eventMap[t].length;i--;)if(this.__eventMap[t].fn==e&&o==this.__eventMap[t].context){n=i;break}n>-1&&this.__eventMap[t].splice(n,1)}else this.__eventMap[t]=null,delete this.__eventMap[t]}},soya2d.Events=function(){var t=[];this.register=function(e,o){t.push([e,o])},this.scan=function(){for(var e=t.length;e--;)t[e][1].scan()},this.startListen=function(e){for(var o=t.length;o--;)t[o][1].startListen(e);return this},this.stopListen=function(e){for(var o=t.length;o--;)t[o][1].stopListen(e);return this},this.addListener=function(e,o,n,i){for(var s=e.split(" "),r=s.length;r--;)for(var a=s[r],u=t.length;u--;)if(t[u][0].indexOf(a)>-1){t[u][1].addListener(a,o,n,i);break}},this.removeListener=function(e,o,n){for(var i=e.split(" "),s=i.length;s--;)for(var r=i[s],a=t.length;a--;)if(t[a][0].indexOf(r)>-1){t[a][1].removeListener(r,o,n);break}}},soya2d.Keyboard=function(){function t(t,e){t.keyCode=e.keyCode||e.which,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.altKey=e.altKey,t.metaKey=e.metaKey,t.keyCodes=s,t.e=e}function e(e){var o=e.keyCode||e.which;s.indexOf(o)<0&&s.push(o),u=!0,t(r,e),c=!0,n(e,o)}function o(e){var o=e.keyCode||e.which,i=s.indexOf(o);i>-1&&(u=!1,s.splice(i,1)),l=!0,t(a,e),s.length<1&&(c=!1),n(e,o)}function n(t,e){var o=soya2d.Keyboard.preventKeys;o.indexOf(e)>-1&&(t.preventDefault?t.preventDefault():t.returnValue=!1);var n=soya2d.Keyboard.stopKeys;n.indexOf(e)>-1&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)}function i(t,e){if(t){t.sort(function(t,e){return t.order-e.order});for(var o=t.length;o--;)t[o].fn.call(t[o].context,e)}}var s=[],r={},a={},u=!1,l=!1,c=!1;this.scan=function(){var t,e;u&&(t=this.__eventMap.keydown,e=r,i(t,e)),c&&(t=this.__eventMap.keypress,e=r,i(t,e)),l&&(t=this.__eventMap.keyup,e=a,i(t,e),l=!1)},this.startListen=function(){return self.addEventListener("keydown",e,!1),self.addEventListener("keyup",o,!1),this},this.stopListen=function(){return self.removeEventListener("keydown",e,!1),self.removeEventListener("keyup",o,!1),this},soya2d.EventHandler.call(this)},soya2d.inherits(soya2d.Keyboard,soya2d.EventHandler),soya2d.Keyboard.preventKeys=[],soya2d.Keyboard.stopKeys=[],soya2d.KeyCode={DELETE:46,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"[":219,"]":221,"\\":220,"=":187,"-":189,",":188,".":190,"/":191,";":186,"'":222},soya2d.Mobile=function(){function t(t,e){e.orientation&&(l.orientation=u[t].orientation=e.orientation),e.alpha&&(l.tilt=u[t].tilt={z:e.alpha,x:e.beta,y:e.gamma,absolute:e.absolute}),e.acceleration&&(l.motion=u[t].motion={x:e.acceleration.x,y:e.acceleration.y,z:e.acceleration.z,interval:e.interval}),u[t].e=e,u[t].type=t,u[t].fire=!0}function e(e){t("tilt",e)}function o(e){t("motion",e)}function n(e){clearTimeout(a),a=setTimeout(function(){e.orientation=i(),t("hov",e)},510)}function i(){var t,e=window.innerWidth,o=window.innerHeight;return t=e>o?"landscape":"portrait"}function s(){for(var t in u){var e=u[t];e&&(e.fire=!1)}}function r(t,e){if(t){t.sort(function(t,e){return t.order-e.order});for(var o=t.length;o--;){var n=t[o].context;t[o].fn.call(n,e)}}}var a,u={tilt:{},motion:{},hov:{}},l=this;this.scan=function(){for(var t in u){var e=u[t];if(e&&e.fire){var o=this.__eventMap[t];r(o,e)}}s()},this.startListen=function(){return self.addEventListener("orientationchange",n,!1),self.addEventListener("deviceorientation",e,!1),self.addEventListener("devicemotion",o,!1),this},this.stopListen=function(){return self.removeEventListener("orientationchange",n,!1),self.removeEventListener("deviceorientation",e,!1),self.removeEventListener("devicemotion",o,!1),this},soya2d.EventHandler.call(this)},soya2d.inherits(soya2d.Mobile,soya2d.EventHandler),soya2d.Mouse=function(){function t(t,e,o){var n=l.getRenderer();h.x=c[t].x=(e.offsetX||e.layerX)/n.hr,h.y=c[t].y=(e.offsetY||e.layerY)/n.vr,h.lButton=c[t].lButton=0==e.button||1==e.button,h.rButton=c[t].rButton=2==e.button,h.wButton=c[t].wButton=4==e.button||2==e.which,c[t].e=e,c[t].type=t,c[t].fire=!0,c[t].__fireList&&c[t].__fireList.push(o)}function e(e){t("click",e)}function o(e){t("dblclick",e)}function n(e){t("mousedown",e)}function i(e){t("mousewheel",e)}function s(e){t("mousemove",e);var o=[],n=h.__eventMap.mouseover,i=h.__eventMap.mouseout;if(n&&n.forEach(function(t){o.push(t)}),i&&i.forEach(function(t){for(var e=o.length;e--;)if(o[e].context==t.context)return;o.push(t)}),o.length>0){var s=[];o.forEach(function(o){{var n=o.context;o.fn}n.hitTest(h.x,h.y)&&(s.push(n),d.indexOf(n)>-1||(d.push(n),t("mouseover",e,n)))});var r=[];if(d.forEach(function(t){s.indexOf(t)<0&&r.push(t)}),r.length<1)return;for(var a=r.length;a--;){var u=d.indexOf(r[a]);d.splice(u,1);var l=r[a];t("mouseout",e,l)}}}function r(e){t("mouseup",e)}function a(){for(var t in c){var e=c[t];e&&(e.fire=!1,e.__fireList&&(e.__fireList=[]))}}function u(t,e){if(t){t.sort(function(t,e){return t.order-e.order});for(var o=l.scene,n=t.length;n--;){var i=t[n].context;if(i instanceof soya2d.DisplayObject&&i!=o)if("mouseover"==e.type||"mouseout"==e.type){if(e.__fireList.indexOf(i)<0)continue}else if(!i.hitTest(h.x,h.y))continue;t[n].fn.call(i,e)}}}var l,c={click:{},dblclick:{},mousedown:{},mouseup:{},mousemove:{},mousewheel:{},mouseover:{__fireList:[]},mouseout:{__fireList:[]}},h=this,d=[];this.scan=function(){for(var t in c){var e=c[t];if(e&&e.fire){var o=this.__eventMap[t];u(o,e)}}a()},this.startListen=function(t){l=t;var a=t.getRenderer().getCanvas();return a.addEventListener("click",e,!1),a.addEventListener("dblclick",o,!1),a.addEventListener("mousedown",n,!1),a.addEventListener("mousewheel",i,!1),a.addEventListener("mousemove",s,!1),self.addEventListener("mouseup",r,!1),this},this.stopListen=function(t){var a=t.getRenderer().getCanvas();return a.removeEventListener("click",e,!1),a.removeEventListener("dblclick",o,!1),a.removeEventListener("mousedown",n,!1),a.removeEventListener("mousewheel",i,!1),a.removeEventListener("mousemove",s,!1),self.removeEventListener("mouseup",r,!1),this},soya2d.EventHandler.call(this)},soya2d.inherits(soya2d.Mouse,soya2d.EventHandler),soya2d.EVENT_CLICK="click",soya2d.EVENT_DBLCLICK="dblclick",soya2d.EVENT_MOUSEDOWN="mousedown",soya2d.EVENT_MOUSEWHEEL="mousewheel",soya2d.EVENT_MOUSEMOVE="mousemove",soya2d.EVENT_MOUSEUP="mouseup",soya2d.EVENT_MOUSEOVER="mouseover",soya2d.EVENT_MOUSEOUT="mouseout",soya2d.Touch=function(){function t(t,e,o){var n;if(o){var u=e.pointerId;if("touchstart"===t)a[u]={clientX:e.clientX,clientY:e.clientY};else if("touchmove"===t){if(!a[u]||a[u].clientX==e.clientX&&a[u].clientY==e.clientY)return;a[u]={clientX:e.clientX,clientY:e.clientY}}else"touchend"===t?delete a[u]:"touchcancel"===t&&delete a[u];n=[];for(var l in a){var c=a[l];n.push(c)}}else n=e.changedTouches;if(n&&n.length>0){for(var h=e.target||e.srcElement,d=h.offsetLeft,f=h.offsetTop;(h=h.offsetParent)&&"BODY"!=h.tagName;)d+=h.offsetLeft-h.scrollLeft,f+=h.offsetTop-h.scrollTop;for(var p=document.body.scrollTop||document.documentElement.scrollTop,m=document.body.scrollLeft||document.documentElement.scrollLeft,l=0;l<n.length;l++){var y=n[l];r.touchList[l]=y.clientX-d+m,r.touchList[l+1]=y.clientY-f+p}}var g=r.touchList,v=i.getRenderer(),b=v.getCanvas(),_=window.getComputedStyle(b,null).marginLeft;_=parseFloat(_)||0;var w=window.getComputedStyle(b,null).marginTop;w=parseFloat(w)||0;for(var l=0;l<g.length;l+=2){var E=g[l],A=g[l+1];switch(this.game.view.rotate()){case soya2d.ROTATEMODE_90:E=E+b.offsetLeft-w,A=A+b.offsetTop-_;var S=E;E=A,A=this.game.view.w-Math.abs(S);break;case soya2d.ROTATEMODE_270:E=E+b.offsetLeft-w,A=A+b.offsetTop-_;var S=A;A=E,E=this.game.view.h-Math.abs(S);break;case soya2d.ROTATEMODE_180:E=this.game.view.w-Math.abs(E),A=this.game.view.h-Math.abs(A)}E/=v.hr,A/=v.vr,g[l]=E,g[l+1]=A}s[t].touchList=g,s[t].e=e,s[t].type=t,s[t].fire=!0}function e(e){if(!e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH){e.preventManipulation?e.preventManipulation():e.preventDefault();var o=e.type;switch(o){case"MSPointerDown":case"pointerdown":t("touchstart",e,!0);break;case"touchstart":t("touchstart",e);break;case"MSPointerMove":case"pointermove":t("touchmove",e,!0);break;case"touchmove":t("touchmove",e);break;case"MSPointerUp":case"pointerup":t("touchend",e,!0);break;case"touchend":t("touchend",e);break;case"MSPointerCancel":case"pointercancel":t("touchcancel",e,!0);break;case"touchcancel":t("touchcancel",e)}}}function o(){for(var t in s){var e=s[t];e&&(e.fire=!1)}}function n(t,e){if(t){t.sort(function(t,e){return t.order-e.order});for(var o=game.scene,n=t.length;n--;){var i=t[n].context;if(i instanceof soya2d.DisplayObject&&i!=o){for(var s=r.touchList,a=!1,u=0;u<s.length;u+=2)if(x=s[u],y=s[u+1],i.hitTest(x,y)){a=!0;break}if(!a)continue}t[n].fn.call(i,e)}}}var i,s={touchstart:{},touchmove:{},touchend:{},touchcancel:{}},r=this;this.touchList=[];var a={};this.scan=function(){for(var t in s){var e=s[t];if(e&&e.fire){var i=this.__eventMap[t];n(i,e)}}o()},this.startListen=function(t){i=t;var o=t.getRenderer().getCanvas();return window.PointerEvent?(o.addEventListener("pointerdown",e,!1),o.addEventListener("pointermove",e,!1),self.addEventListener("pointerup",e,!1),self.addEventListener("pointercancel",e,!1)):window.MSPointerEvent?(o.addEventListener("MSPointerDown",e,!1),o.addEventListener("MSPointerMove",e,!1),self.addEventListener("MSPointerUp",e,!1),self.addEventListener("MSPointerCancel",e,!1)):(o.addEventListener("touchstart",e,!1),o.addEventListener("touchmove",e,!1),self.addEventListener("touchend",e,!1),self.addEventListener("touchcancel",e,!1)),this},this.stopListen=function(t){var o=t.getRenderer().getCanvas();return window.PointerEvent?(o.removeEventListener("pointerdown",e,!1),o.removeEventListener("pointermove",e,!1),self.removeEventListener("pointerup",e,!1),self.removeEventListener("pointercancel",e,!1)):window.MSPointerEvent?(o.removeEventListener("MSPointerDown",e,!1),o.removeEventListener("MSPointerMove",e,!1),self.removeEventListener("MSPointerUp",e,!1),self.removeEventListener("MSPointerCancel",e,!1)):(o.removeEventListener("touchstart",e,!1),o.removeEventListener("touchmove",e,!1),self.removeEventListener("touchend",e,!1),self.removeEventListener("touchcancel",e,!1)),this},soya2d.EventHandler.call(this)},soya2d.inherits(soya2d.Touch,soya2d.EventHandler),soya2d.EVENT_TOUCHSTART="touchstart",soya2d.EVENT_TOUCHMOVE="touchmove",soya2d.EVENT_TOUCHEND="touchend",soya2d.EVENT_TOUCHCANCEL="touchcancel",soya2d.module.install("event",{onInit:function(t){t.events=new soya2d.Events;var e=["keyup","keydown","keypress"],o=["click","dblclick","mousedown","mousewheel","mousemove","mouseup","mouseover","mouseout"],n=["touchstart","touchmove","touchend","touchcancel"],i=["hov","tilt","motion"];soya2d.Mouse&&t.events.register(o,new soya2d.Mouse),soya2d.Keyboard&&t.events.register(e,new soya2d.Keyboard),soya2d.Touch&&t.events.register(n,new soya2d.Touch),soya2d.Mobile&&t.events.register(i,new soya2d.Mobile)},onStart:function(t){t.events.startListen(t)},onStop:function(t){t.events.stopListen(t)},onUpdate:function(t){t.events.scan()}}),soya2d.ext(soya2d.DisplayObject.prototype,{on:function(t,e,o,n){return t.events.addListener(e,o,this,n),this},once:function(t,e,o,n){var i=this,s=function(){i.off(e,s),o.apply(i,arguments)};return t.events.addListener(e,s,this,n),this},off:function(t,e,o){return t.events.removeListener(e,o,this),this}}),soya2d.ext(soya2d.Game.prototype,{on:function(t,e,o){return this.events.addListener(t,e,this,o),this},once:function(t,e,o){var n=this,i=function(){n.off(t,i),e.apply(n,arguments)};return this.events.addListener(t,i,this,o),this},off:function(t,e){return this.events.removeListener(t,e,this),this}}),!function(){var t={},e=null,o=!0,n=!1;try{"undefined"!=typeof AudioContext?e=new AudioContext:"undefined"!=typeof webkitAudioContext?e=new webkitAudioContext:o=!1}catch(i){o=!1}if(!o)if("undefined"!=typeof Audio)try{new Audio}catch(i){n=!0}else n=!0;if(o){var s=void 0===e.createGain?e.createGainNode():e.createGain();s.gain.value=1,s.connect(e.destination)}var r=function(t){this._volume=1,this._muted=!1,this.usingWebAudio=o,this.ctx=e,this.noAudio=n,this._howls=[],this._codecs=t,this.iOSAutoEnable=!0};r.prototype={volume:function(t){var e=this;if(t=parseFloat(t),t>=0&&1>=t){e._volume=t,o&&(s.gain.value=t);for(var n in e._howls)if(e._howls.hasOwnProperty(n)&&e._howls[n]._webAudio===!1)for(var i=0;i<e._howls[n]._audioNode.length;i++)e._howls[n]._audioNode[i].volume=e._howls[n]._volume*e._volume;return e}return o?s.gain.value:e._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(t){var e=this;e._muted=t,o&&(s.gain.value=t?0:e._volume);for(var n in e._howls)if(e._howls.hasOwnProperty(n)&&e._howls[n]._webAudio===!1)for(var i=0;i<e._howls[n]._audioNode.length;i++)e._howls[n]._audioNode[i].muted=t},codecs:function(t){return this._codecs[t]},_enableiOSAudio:function(){var t=this;if(!e||!t._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){t._iOSEnabled=!1;var o=function(){var n=e.createBuffer(1,1,22050),i=e.createBufferSource();i.buffer=n,i.connect(e.destination),void 0===i.start?i.noteOn(0):i.start(0),setTimeout(function(){(i.playbackState===i.PLAYING_STATE||i.playbackState===i.FINISHED_STATE)&&(t._iOSEnabled=!0,t.iOSAutoEnable=!1,window.removeEventListener("touchstart",o,!1))},0)};return window.addEventListener("touchstart",o,!1),t}}};var a=null,u={};n||(a=new Audio,u={mp3:!!a.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!a.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(a.canPlayType("audio/x-mp4;")||a.canPlayType("audio/mp4;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var l=new r(u),c=function(t){var n=this;n._autoplay=t.autoplay||!1,n._buffer=t.buffer||!1,n._duration=t.duration||0,n._format=t.format||null,n._loop=t.loop||!1,n._loaded=!1,n._sprite=t.sprite||{},n._src=t.src||"",n._pos3d=t.pos3d||[0,0,-.5],n._volume=void 0!==t.volume?t.volume:1,n._urls=t.urls||[],n._rate=t.rate||1,n._model=t.model||null,n._onload=[t.onload||function(){}],n._onloaderror=[t.onloaderror||function(){}],n._onend=[t.onend||function(){}],n._onpause=[t.onpause||function(){}],n._onplay=[t.onplay||function(){}],n._onendTimer=[],n._webAudio=o&&!n._buffer,n._audioNode=[],n._webAudio&&n._setupAudioNode(),void 0!==e&&e&&l.iOSAutoEnable&&l._enableiOSAudio(),l._howls.push(n),n.load()};if(c.prototype={load:function(){var t=this,e=null;if(n)return void t.on("loaderror");for(var o=0;o<t._urls.length;o++){var i,s;if(t._format)i=t._format;else{if(s=t._urls[o],i=/^data:audio\/([^;,]+);/i.exec(s),i||(i=/\.([^.]+)$/.exec(s.split("?",1)[0])),!i)return void t.on("loaderror");i=i[1].toLowerCase()}if(u[i]){e=t._urls[o];break}}if(!e)return void t.on("loaderror");if(t._src=e,t._webAudio)h(t,e);else{var a=new Audio;a.addEventListener("error",function(){a.error&&4===a.error.code&&(r.noAudio=!0),t.on("loaderror",{type:a.error?a.error.code:0})},!1),t._audioNode.push(a),a.src=e,a._pos=0,a.preload="auto",a.volume=l._muted?0:t._volume*l.volume();var c=function(){t._duration=Math.ceil(10*a.duration)/10,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play(),a.removeEventListener("canplaythrough",c,!1)};a.addEventListener("canplaythrough",c,!1),a.load()}return t},urls:function(t){var e=this;return t?(e.stop(),e._urls="string"==typeof t?[t]:t,e._loaded=!1,e.load(),e):e._urls},play:function(t,o){var n=this;return"function"==typeof t&&(o=t),t&&"function"!=typeof t||(t="_default"),n._loaded?n._sprite[t]?(n._inactiveNode(function(i){i._sprite=t;var s=i._pos>0?i._pos:n._sprite[t][0]/1e3,r=0;n._webAudio?(r=n._sprite[t][1]/1e3-i._pos,i._pos>0&&(s=n._sprite[t][0]/1e3+s)):r=n._sprite[t][1]/1e3-(s-n._sprite[t][0]/1e3);var a,u=!(!n._loop&&!n._sprite[t][2]),c="string"==typeof o?o:Math.round(Date.now()*Math.random())+"";if(function(){var e={id:c,sprite:t,loop:u};a=setTimeout(function(){!n._webAudio&&u&&n.stop(e.id).play(t,e.id),n._webAudio&&!u&&(n._nodeById(e.id).paused=!0,n._nodeById(e.id)._pos=0,n._clearEndTimer(e.id)),n._webAudio||u||n.stop(e.id),n.on("end",c)},1e3*r),n._onendTimer.push({timer:a,id:e.id})}(),n._webAudio){var h=n._sprite[t][0]/1e3,d=n._sprite[t][1]/1e3;i.id=c,i.paused=!1,p(n,[u,h,d],c),n._playStart=e.currentTime,i.gain.value=n._volume,void 0===i.bufferSource.start?i.bufferSource.noteGrainOn(0,s,r):i.bufferSource.start(0,s,r)}else{if(4!==i.readyState&&(i.readyState||!navigator.isCocoonJS))return n._clearEndTimer(c),function(){var e=n,s=t,r=o,a=i,u=function(){e.play(s,r),a.removeEventListener("canplaythrough",u,!1)};a.addEventListener("canplaythrough",u,!1)}(),n;i.readyState=4,i.id=c,i.currentTime=s,i.muted=l._muted||i.muted,i.volume=n._volume*l.volume(),setTimeout(function(){i.play()},0)}return n.on("play"),"function"==typeof o&&o(c),n}),n):("function"==typeof o&&o(),n):(n.on("load",function(){n.play(t,o)}),n)},pause:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.pause(t)}),e;e._clearEndTimer(t);var o=t?e._nodeById(t):e._activeNode();if(o)if(o._pos=e.pos(null,t),e._webAudio){if(!o.bufferSource||o.paused)return e;o.paused=!0,void 0===o.bufferSource.stop?o.bufferSource.noteOff(0):o.bufferSource.stop(0)}else o.pause();return e.on("pause"),e},stop:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.stop(t)}),e;e._clearEndTimer(t);var o=t?e._nodeById(t):e._activeNode();if(o)if(o._pos=0,e._webAudio){if(!o.bufferSource||o.paused)return e;o.paused=!0,void 0===o.bufferSource.stop?o.bufferSource.noteOff(0):o.bufferSource.stop(0)}else isNaN(o.duration)||(o.pause(),o.currentTime=0);return e},mute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.mute(t)}),e;var o=t?e._nodeById(t):e._activeNode();return o&&(e._webAudio?o.gain.value=0:o.muted=!0),e},unmute:function(t){var e=this;if(!e._loaded)return e.on("play",function(){e.unmute(t)}),e;var o=t?e._nodeById(t):e._activeNode();return o&&(e._webAudio?o.gain.value=e._volume:o.muted=!1),e},volume:function(t,e){var o=this;if(t=parseFloat(t),t>=0&&1>=t){if(o._volume=t,!o._loaded)return o.on("play",function(){o.volume(t,e)}),o;var n=e?o._nodeById(e):o._activeNode();return n&&(o._webAudio?n.gain.value=t:n.volume=t*l.volume()),o}return o._volume},loop:function(t){var e=this;return"boolean"==typeof t?(e._loop=t,e):e._loop},sprite:function(t){var e=this;return"object"==typeof t?(e._sprite=t,e):e._sprite},pos:function(t,o){var n=this;if(!n._loaded)return n.on("load",function(){n.pos(t)}),"number"==typeof t?n:n._pos||0;t=parseFloat(t);var i=o?n._nodeById(o):n._activeNode();if(i)return t>=0?(n.pause(o),i._pos=t,n.play(i._sprite,o),n):n._webAudio?i._pos+(e.currentTime-n._playStart):i.currentTime;if(t>=0)return n;for(var s=0;s<n._audioNode.length;s++)if(n._audioNode[s].paused&&4===n._audioNode[s].readyState)return n._webAudio?n._audioNode[s]._pos:n._audioNode[s].currentTime},pos3d:function(t,e,o,n){var i=this;if(e=void 0!==e&&e?e:0,o=void 0!==o&&o?o:-.5,!i._loaded)return i.on("play",function(){i.pos3d(t,e,o,n)}),i;if(!(t>=0||0>t))return i._pos3d;if(i._webAudio){var s=n?i._nodeById(n):i._activeNode();s&&(i._pos3d=[t,e,o],s.panner.setPosition(t,e,o),s.panner.panningModel=i._model||"HRTF")}return i},fade:function(t,e,o,n,i){var s=this,r=Math.abs(t-e),a=t>e?"down":"up",u=r/.01,l=o/u;if(!s._loaded)return s.on("load",function(){s.fade(t,e,o,n,i)}),s;s.volume(t,i);for(var c=1;u>=c;c++)!function(){var t=s._volume+("up"===a?.01:-.01)*c,o=Math.round(1e3*t)/1e3,r=e;setTimeout(function(){s.volume(o,i),o===r&&n&&n()},l*c)}()},fadeIn:function(t,e,o){return this.volume(0).play().fade(0,t,e,o)},fadeOut:function(t,e,o,n){var i=this;return i.fade(i._volume,t,e,function(){o&&o(),i.pause(n),i.on("end")},n)},_nodeById:function(t){for(var e=this,o=e._audioNode[0],n=0;n<e._audioNode.length;n++)if(e._audioNode[n].id===t){o=e._audioNode[n];break}return o},_activeNode:function(){for(var t=this,e=null,o=0;o<t._audioNode.length;o++)if(!t._audioNode[o].paused){e=t._audioNode[o];break}return t._drainPool(),e},_inactiveNode:function(t){for(var e=this,o=null,n=0;n<e._audioNode.length;n++)if(e._audioNode[n].paused&&4===e._audioNode[n].readyState){t(e._audioNode[n]),o=!0;break}if(e._drainPool(),!o){var i;if(e._webAudio)i=e._setupAudioNode(),t(i);else{e.load(),i=e._audioNode[e._audioNode.length-1];var s=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",r=function(){i.removeEventListener(s,r,!1),t(i)};i.addEventListener(s,r,!1)}}},_drainPool:function(){var t,e=this,o=0;for(t=0;t<e._audioNode.length;t++)e._audioNode[t].paused&&o++;for(t=e._audioNode.length-1;t>=0&&!(5>=o);t--)e._audioNode[t].paused&&(e._webAudio&&e._audioNode[t].disconnect(0),o--,e._audioNode.splice(t,1))},_clearEndTimer:function(t){for(var e=this,o=0,n=0;n<e._onendTimer.length;n++)if(e._onendTimer[n].id===t){o=n;break}var i=e._onendTimer[o];i&&(clearTimeout(i.timer),e._onendTimer.splice(o,1))},_setupAudioNode:function(){var t=this,o=t._audioNode,n=t._audioNode.length;return o[n]=void 0===e.createGain?e.createGainNode():e.createGain(),o[n].gain.value=t._volume,o[n].paused=!0,o[n]._pos=0,o[n].readyState=4,o[n].connect(s),o[n].panner=e.createPanner(),o[n].panner.panningModel=t._model||"equalpower",o[n].panner.setPosition(t._pos3d[0],t._pos3d[1],t._pos3d[2]),o[n].panner.connect(o[n]),o[n]},on:function(t,e){var o=this,n=o["_on"+t];if("function"==typeof e)n.push(e);else for(var i=0;i<n.length;i++)e?n[i].call(o,e):n[i].call(o);return o},off:function(t,e){var o=this,n=o["_on"+t],i=e?""+e:null;if(i){for(var s=0;s<n.length;s++)if(i===""+n[s]){n.splice(s,1);break}}else o["_on"+t]=[];return o},unload:function(){for(var e=this,o=e._audioNode,n=0;n<e._audioNode.length;n++)o[n].paused||(e.stop(o[n].id),e.on("end",o[n].id)),e._webAudio?o[n].disconnect(0):o[n].src="";for(n=0;n<e._onendTimer.length;n++)clearTimeout(e._onendTimer[n].timer);var i=l._howls.indexOf(e);null!==i&&i>=0&&l._howls.splice(i,1),delete t[e._src],e=null}},o)var h=function(e,o){if(o in t)return e._duration=t[o].duration,void f(e);if(/^data:[^;]+;base64,/.test(o)){for(var n=atob(o.split(",")[1]),i=new Uint8Array(n.length),s=0;s<n.length;++s)i[s]=n.charCodeAt(s);d(i.buffer,e,o)}else{var r=new XMLHttpRequest;r.open("GET",o,!0),r.responseType="arraybuffer",r.onload=function(){d(r.response,e,o)},r.onerror=function(){e._webAudio&&(e._buffer=!0,e._webAudio=!1,e._audioNode=[],delete e._gainNode,delete t[o],e.load())};try{r.send()}catch(a){r.onerror()}}},d=function(o,n,i){e.decodeAudioData(o,function(e){e&&(t[i]=e,f(n,e))},function(){n.on("loaderror")})},f=function(t,e){t._duration=e?e.duration:t._duration,0===Object.getOwnPropertyNames(t._sprite).length&&(t._sprite={_default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t.on("load")),t._autoplay&&t.play()},p=function(o,n,i){var s=o._nodeById(i);s.bufferSource=e.createBufferSource(),s.bufferSource.buffer=t[o._src],s.bufferSource.connect(s.panner),s.bufferSource.loop=n[0],n[0]&&(s.bufferSource.loopStart=n[1],s.bufferSource.loopEnd=n[1]+n[2]),s.bufferSource.playbackRate.value=o._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:l,Howl:c}}),"undefined"!=typeof exports&&(exports.Howler=l,exports.Howl=c),"undefined"!=typeof window&&(window.Howler=l,window.Howl=c)}(),soya2d.Sound=function(t){t=t||{},this.__handler,this.src,this.__loop=t.loop||!1,this.__volume=t.volume||1,this.__muted=!1,this.__pos=0},soya2d.Sound.prototype={play:function(){return this.__handler.play(),this},pause:function(){return this.__handler.pause(),this},stop:function(){return this.__handler.stop(),this},mute:function(t){return void 0!=t?(this.__muted=t,t?this.__handler.mute():this.__handler.unmute(),this):this.__muted},loop:function(t){return void 0!=t?(this.__loop=t,this.__handler.loop(t),this):this.__loop},volume:function(t){return t?(this.__volume=t,this.__handler.volume(t),this):this.__volume},pos:function(t){return t?(this.__pos=t,this.__handler.pos(t),this):this.__pos},fade:function(t,e,o,n){return this.__handler.fade(t,e,o,n),this}},soya2d.SoundManager=function(){function t(t){var e=[];return t.forEach&&t.forEach(function(t){var o=t.split(".")[0];e.indexOf(o)<0&&e.push(o)}),e}soya2d.ResourceManager.call(this),this.create=function(e){if(!e)return null;if(!e.urls||e.urls.length<1)return null;var o=new Howl(e),n=new soya2d.Sound(e);n.__handler=o;var i=t(e.urls);return this.urlMap[i[0]]=n,n},this._add=function(e,o){"string"==typeof e&&(e=[e]);var n=t(e);this.urlMap[n[0]]=o},this.muteAll=function(t){for(var e in this.urlMap){var o=this.urlMap[e];o.mute(t)}},this.stopAll=function(){for(var t in this.urlMap){var e=this.urlMap[t];e.stop()}}},soya2d.inherits(soya2d.SoundManager,soya2d.ResourceManager),soya2d.module.install("sound",{onInit:function(t){t.soundManager=new soya2d.SoundManager},onStop:function(t){t.soundManager.stopAll()}}),soya2d.Emitter=function(t){var e=[],o=0;cfg=t||{},soya2d.ext(this,cfg),this.MSPE=cfg.MSPE||16,this.emissionCount=cfg.emissionCount,this.blendMode=cfg.blendMode||soya2d.BLEND_LIGHTER,this.x=cfg.x,this.xVar=cfg.xVar||0,this.y=cfg.y,this.yVar=cfg.yVar||0,this.template=soya2d.ParticleWrapper.wrap(cfg.template),this.lifeSpan=cfg.lifeSpan||1,this.lifeSpanVar=cfg.lifeSpanVar||0,this.speed=cfg.speed||0,this.speedVar=cfg.speedVar||0,this.radialAcc=cfg.radialAcc||0,this.radialAccVar=cfg.radialAccVar||0,this.tanAcc=cfg.tanAcc||0,this.tanAccVar=cfg.tanAccVar||0,this.angle=cfg.angle||0,this.angleVar=cfg.angleVar||0,this.startSpin=cfg.startSpin||0,this.startSpinVar=cfg.startSpinVar||0,this.endSpin=cfg.endSpin||0,this.endSpinVar=cfg.endSpinVar||0,this.onActive=cfg.onActive;for(var n=this.emissionCount;n--;){var i=new this.template(this);i.visible=!1,i.lifeSpan=0,i.deadRate=0,e.push(i)}this.running=!1,this.addTo=function(t){return soya2d.ParticleManager.add(this)?(t.add.apply(t,e),this):this},this.removeFrom=function(t){return soya2d.ParticleManager.remove(this),t.remove.apply(t,e),this},this.emit=function(){return this.running?this:(o=Date.now(),this.running=!0,this.stopping&&clearTimeout(this.stopping),this)},this.stop=function(t){if(!this.running)return this;if(t>0){var e=this;return this.stopping=setTimeout(function(){this.running=!1,e.stopping=0},t),void 0}return this.running=!1,this};var s=0;this.update=function(t){var n=t-o;o=t,s+=n;var i=0,r=e;if(s>=this.MSPE&&this.running&&(i=s/this.MSPE>>0,s=0),i>0&&this.running){i=i>this.emissionCount?this.emissionCount:i;for(var a=this.emissionCount;a--&&i;){var u=r[a];u.lifeSpan<=0&&(this.onActive instanceof Function&&this.onActive.call(u),u.resetParticle(this),i--)}}for(var a=r.length;a--;){var u=r[a];u.lifeSpan>0&&u.updateParticle(n)}}},soya2d.ParticleManager=new function(){var t=[];this.add=function(e){var o=t.indexOf(e);return o>-1?!1:(t.push(e),this)},this.remove=function(e){var o=t.indexOf(e);return o>-1&&t.splice(e,1),this},this.update=function(e){for(var o=t.length;o--;)t[o].update(e)},this.stop=function(e){if(e){var o=t.indexOf(e);o>-1&&e.stop()}else t.splice(0,t.length)}},soya2d.ParticleWrapper=new function(){function t(t){var e=(soya2d.Math,t/1e3);return this.lifeSpan-=e,this.lifeSpan<=0?(this.visible=!1,this.deadRate=0,void 0):(this.deadRate=this.lifeSpan/this.maxLifeSpan,this.speed.add(this.deltaSpeed).add(this.radialAcc),0!==this.tanAcc&&(this.tanDir.set(this.speed.e[0],this.speed.e[1]).rotate(this.tans),this.tans+=this.tanAcc,this.tans%=360,this.speed.set(this.tanDir.e[0],this.tanDir.e[1])),this.deltaSpin&&(this.startSpin+=this.deltaSpin*e),this.x=this.sx+this.speed.e[0],this.y=this.sy+this.speed.e[1],this.deltaSpin&&(this.rotation=this.startSpin),void 0)}function e(t){var e=soya2d.Math,o=this.lifeSpan=t.lifeSpan+t.lifeSpanVar*Math.random();this.maxLifeSpan=o,this.sx=t.x+t.xVar*Math.random(),this.sy=t.y+t.yVar*Math.random();var n=t.angle+t.angleVar*Math.random();n=e.floor(n%=360),this.angle=n;var i=t.speed+t.speedVar*Math.random(),s=new soya2d.Vector(e.COSTABLE[n],e.SINTABLE[n]);this.speed=s.clone().mul(i),this.deltaSpeed=new soya2d.Vector(this.speed.e[0]/o,this.speed.e[1]/o),this.radialAcc=s.mul(t.radialAcc+t.radialAccVar*Math.random()),this.tanAcc=t.tanAcc+t.tanAccVar*Math.random(),0!==this.tanAcc&&(this.tans=this.tanAcc,this.tanDir=new soya2d.Vector(0,0)),this.startSpin=t.startSpin+t.startSpinVar*Math.random();var r=t.endSpin+t.endSpinVar*Math.random();this.deltaSpin=(r-this.startSpin)/o,this.startSpin===r&&(this.deltaSpin=null)}function o(t){this.initParticle(t),this.visible=!0}this.wrap=function(n){return n.prototype.updateParticle=t,n.prototype.initParticle=e,n.prototype.resetParticle=o,n.prototype.destroyParticle=function(){this.parent.remove(this)},n}},soya2d.module.install("particle",{onUpdate:function(t,e){soya2d.ParticleManager.update(e)},onStop:function(){soya2d.ParticleManager.stop()}}),!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t()}}(function(){return function t(e,o,n){function i(r,a){if(!o[r]){if(!e[r]){var u="function"==typeof require&&require;if(!a&&u)return u(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var l=o[r]={exports:{}};e[r][0].call(l.exports,function(t){var o=e[r][1][t];return i(o?o:t)},l,l.exports,t,e,o,n)}return o[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}({1:[function(t,e,o){(function(e,n,i){function i(t,e,o){if(!(this instanceof i))return new i(t,e,o);var n=typeof t;if("base64"===e&&"string"===n)for(t=L(t);t.length%4!==0;)t+="=";var s;if("number"===n)s=I(t);else if("string"===n)s=i.byteLength(t,e);else{if("object"!==n)throw new Error("First argument needs to be a number, array or string.");s=I(t.length)}var r;i._useTypedArrays?r=M(new Uint8Array(s)):(r=this,r.length=s,r._isBuffer=!0);var a;if(i._useTypedArrays&&"function"==typeof Uint8Array&&t instanceof Uint8Array)r._set(t);else if(R(t))for(a=0;s>a;a++)r[a]=i.isBuffer(t)?t.readUInt8(a):t[a];else if("string"===n)r.write(t,0,e);else if("number"===n&&!i._useTypedArrays&&!o)for(a=0;s>a;a++)r[a]=0;return r}function s(t,e,o,n){o=Number(o)||0;var s=t.length-o;n?(n=Number(n),n>s&&(n=s)):n=s;var r=e.length;Y(r%2===0,"Invalid hex string"),n>r/2&&(n=r/2);for(var a=0;n>a;a++){var u=parseInt(e.substr(2*a,2),16);Y(!isNaN(u),"Invalid hex string"),t[o+a]=u}return i._charsWritten=2*a,a}function r(t,e,o,n){var s=i._charsWritten=k(N(e),t,o,n);return s}function a(t,e,o,n){var s=i._charsWritten=k(j(e),t,o,n);return s}function u(t,e,o,n){return a(t,e,o,n)}function l(t,e,o,n){var s=i._charsWritten=k(F(e),t,o,n);return s}function c(t,e,o,n){var s=i._charsWritten=k(U(e),t,o,n);return s}function h(t,e,o){return H.fromByteArray(0===e&&o===t.length?t:t.slice(e,o))}function d(t,e,o){var n="",i="";o=Math.min(t.length,o);for(var s=e;o>s;s++)t[s]<=127?(n+=D(i)+String.fromCharCode(t[s]),i=""):i+="%"+t[s].toString(16);return n+D(i)}function f(t,e,o){var n="";o=Math.min(t.length,o);for(var i=e;o>i;i++)n+=String.fromCharCode(t[i]);
return n}function p(t,e,o){return f(t,e,o)}function m(t,e,o){var n=t.length;(!e||0>e)&&(e=0),(!o||0>o||o>n)&&(o=n);for(var i="",s=e;o>s;s++)i+=q(t[s]);return i}function y(t,e,o){for(var n=t.slice(e,o),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function g(t,e,o,n){n||(Y("boolean"==typeof o,"missing or invalid endian"),Y(void 0!==e&&null!==e,"missing offset"),Y(e+1<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var s;return o?(s=t[e],i>e+1&&(s|=t[e+1]<<8)):(s=t[e]<<8,i>e+1&&(s|=t[e+1])),s}}function v(t,e,o,n){n||(Y("boolean"==typeof o,"missing or invalid endian"),Y(void 0!==e&&null!==e,"missing offset"),Y(e+3<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var s;return o?(i>e+2&&(s=t[e+2]<<16),i>e+1&&(s|=t[e+1]<<8),s|=t[e],i>e+3&&(s+=t[e+3]<<24>>>0)):(i>e+1&&(s=t[e+1]<<16),i>e+2&&(s|=t[e+2]<<8),i>e+3&&(s|=t[e+3]),s+=t[e]<<24>>>0),s}}function b(t,e,o,n){n||(Y("boolean"==typeof o,"missing or invalid endian"),Y(void 0!==e&&null!==e,"missing offset"),Y(e+1<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var s=g(t,e,o,!0),r=32768&s;return r?-1*(65535-s+1):s}}function _(t,e,o,n){n||(Y("boolean"==typeof o,"missing or invalid endian"),Y(void 0!==e&&null!==e,"missing offset"),Y(e+3<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var s=v(t,e,o,!0),r=2147483648&s;return r?-1*(4294967295-s+1):s}}function w(t,e,o,n){return n||(Y("boolean"==typeof o,"missing or invalid endian"),Y(e+3<t.length,"Trying to read beyond buffer length")),W.read(t,e,o,23,4)}function E(t,e,o,n){return n||(Y("boolean"==typeof o,"missing or invalid endian"),Y(e+7<t.length,"Trying to read beyond buffer length")),W.read(t,e,o,52,8)}function A(t,e,o,n,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof n,"missing or invalid endian"),Y(void 0!==o&&null!==o,"missing offset"),Y(o+1<t.length,"trying to write beyond buffer length"),V(e,65535));var s=t.length;if(!(o>=s))for(var r=0,a=Math.min(s-o,2);a>r;r++)t[o+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function S(t,e,o,n,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof n,"missing or invalid endian"),Y(void 0!==o&&null!==o,"missing offset"),Y(o+3<t.length,"trying to write beyond buffer length"),V(e,4294967295));var s=t.length;if(!(o>=s))for(var r=0,a=Math.min(s-o,4);a>r;r++)t[o+r]=e>>>8*(n?r:3-r)&255}function x(t,e,o,n,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof n,"missing or invalid endian"),Y(void 0!==o&&null!==o,"missing offset"),Y(o+1<t.length,"Trying to write beyond buffer length"),G(e,32767,-32768));var s=t.length;o>=s||(e>=0?A(t,e,o,n,i):A(t,65535+e+1,o,n,i))}function T(t,e,o,n,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof n,"missing or invalid endian"),Y(void 0!==o&&null!==o,"missing offset"),Y(o+3<t.length,"Trying to write beyond buffer length"),G(e,2147483647,-2147483648));var s=t.length;o>=s||(e>=0?S(t,e,o,n,i):S(t,4294967295+e+1,o,n,i))}function B(t,e,o,n,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof n,"missing or invalid endian"),Y(void 0!==o&&null!==o,"missing offset"),Y(o+3<t.length,"Trying to write beyond buffer length"),X(e,3.4028234663852886e38,-3.4028234663852886e38));var s=t.length;o>=s||W.write(t,e,o,n,23,4)}function C(t,e,o,n,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof n,"missing or invalid endian"),Y(void 0!==o&&null!==o,"missing offset"),Y(o+7<t.length,"Trying to write beyond buffer length"),X(e,1.7976931348623157e308,-1.7976931348623157e308));var s=t.length;o>=s||W.write(t,e,o,n,52,8)}function L(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function M(t){return t._isBuffer=!0,t._get=t.get,t._set=t.set,t.get=z.get,t.set=z.set,t.write=z.write,t.toString=z.toString,t.toLocaleString=z.toString,t.toJSON=z.toJSON,t.copy=z.copy,t.slice=z.slice,t.readUInt8=z.readUInt8,t.readUInt16LE=z.readUInt16LE,t.readUInt16BE=z.readUInt16BE,t.readUInt32LE=z.readUInt32LE,t.readUInt32BE=z.readUInt32BE,t.readInt8=z.readInt8,t.readInt16LE=z.readInt16LE,t.readInt16BE=z.readInt16BE,t.readInt32LE=z.readInt32LE,t.readInt32BE=z.readInt32BE,t.readFloatLE=z.readFloatLE,t.readFloatBE=z.readFloatBE,t.readDoubleLE=z.readDoubleLE,t.readDoubleBE=z.readDoubleBE,t.writeUInt8=z.writeUInt8,t.writeUInt16LE=z.writeUInt16LE,t.writeUInt16BE=z.writeUInt16BE,t.writeUInt32LE=z.writeUInt32LE,t.writeUInt32BE=z.writeUInt32BE,t.writeInt8=z.writeInt8,t.writeInt16LE=z.writeInt16LE,t.writeInt16BE=z.writeInt16BE,t.writeInt32LE=z.writeInt32LE,t.writeInt32BE=z.writeInt32BE,t.writeFloatLE=z.writeFloatLE,t.writeFloatBE=z.writeFloatBE,t.writeDoubleLE=z.writeDoubleLE,t.writeDoubleBE=z.writeDoubleBE,t.fill=z.fill,t.inspect=z.inspect,t.toArrayBuffer=z.toArrayBuffer,t}function P(t,e,o){return"number"!=typeof t?o:(t=~~t,t>=e?e:t>=0?t:(t+=e,t>=0?t:0))}function I(t){return t=~~Math.ceil(+t),0>t?0:t}function O(t){return(Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)})(t)}function R(t){return O(t)||i.isBuffer(t)||t&&"object"==typeof t&&"number"==typeof t.length}function q(t){return 16>t?"0"+t.toString(16):t.toString(16)}function N(t){for(var e=[],o=0;o<t.length;o++){var n=t.charCodeAt(o);if(127>=n)e.push(t.charCodeAt(o));else{var i=o;n>=55296&&57343>=n&&o++;for(var s=encodeURIComponent(t.slice(i,o+1)).substr(1).split("%"),r=0;r<s.length;r++)e.push(parseInt(s[r],16))}}return e}function j(t){for(var e=[],o=0;o<t.length;o++)e.push(255&t.charCodeAt(o));return e}function U(t){for(var e,o,n,i=[],s=0;s<t.length;s++)e=t.charCodeAt(s),o=e>>8,n=e%256,i.push(n),i.push(o);return i}function F(t){return H.toByteArray(t)}function k(t,e,o,n){for(var i=0;n>i&&!(i+o>=e.length||i>=t.length);i++)e[i+o]=t[i];return i}function D(t){try{return decodeURIComponent(t)}catch(e){return String.fromCharCode(65533)}}function V(t,e){Y("number"==typeof t,"cannot write a non-number as a number"),Y(t>=0,"specified a negative value for writing an unsigned value"),Y(e>=t,"value is larger than maximum value for type"),Y(Math.floor(t)===t,"value has a fractional component")}function G(t,e,o){Y("number"==typeof t,"cannot write a non-number as a number"),Y(e>=t,"value larger than maximum allowed value"),Y(t>=o,"value smaller than minimum allowed value"),Y(Math.floor(t)===t,"value has a fractional component")}function X(t,e,o){Y("number"==typeof t,"cannot write a non-number as a number"),Y(e>=t,"value larger than maximum allowed value"),Y(t>=o,"value smaller than minimum allowed value")}function Y(t,e){if(!t)throw new Error(e||"Failed assertion")}var H=t("base64-js"),W=t("ieee754");o.Buffer=i,o.SlowBuffer=i,o.INSPECT_MAX_BYTES=50,i.poolSize=8192,i._useTypedArrays=function(){if("function"!=typeof Uint8Array||"function"!=typeof ArrayBuffer)return!1;try{var t=new Uint8Array(0);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(e){return!1}}(),i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.isBuffer=function(t){return!(null===t||void 0===t||!t._isBuffer)},i.byteLength=function(t,e){var o;switch(t+="",e||"utf8"){case"hex":o=t.length/2;break;case"utf8":case"utf-8":o=N(t).length;break;case"ascii":case"binary":case"raw":o=t.length;break;case"base64":o=F(t).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":o=2*t.length;break;default:throw new Error("Unknown encoding")}return o},i.concat=function(t,e){if(Y(O(t),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===t.length)return new i(0);if(1===t.length)return t[0];var o;if("number"!=typeof e)for(e=0,o=0;o<t.length;o++)e+=t[o].length;var n=new i(e),s=0;for(o=0;o<t.length;o++){var r=t[o];r.copy(n,s),s+=r.length}return n},i.prototype.write=function(t,e,o,n){if(isFinite(e))isFinite(o)||(n=o,o=void 0);else{var i=n;n=e,e=o,o=i}e=Number(e)||0;var h=this.length-e;o?(o=Number(o),o>h&&(o=h)):o=h,n=String(n||"utf8").toLowerCase();var d;switch(n){case"hex":d=s(this,t,e,o);break;case"utf8":case"utf-8":d=r(this,t,e,o);break;case"ascii":d=a(this,t,e,o);break;case"binary":d=u(this,t,e,o);break;case"base64":d=l(this,t,e,o);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":d=c(this,t,e,o);break;default:throw new Error("Unknown encoding")}return d},i.prototype.toString=function(t,e,o){var n=this;if(t=String(t||"utf8").toLowerCase(),e=Number(e)||0,o=void 0!==o?Number(o):o=n.length,o===e)return"";var i;switch(t){case"hex":i=m(n,e,o);break;case"utf8":case"utf-8":i=d(n,e,o);break;case"ascii":i=f(n,e,o);break;case"binary":i=p(n,e,o);break;case"base64":i=h(n,e,o);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=y(n,e,o);break;default:throw new Error("Unknown encoding")}return i},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},i.prototype.copy=function(t,e,o,n){var i=this;if(o||(o=0),n||0===n||(n=this.length),e||(e=0),n!==o&&0!==t.length&&0!==i.length){Y(n>=o,"sourceEnd < sourceStart"),Y(e>=0&&e<t.length,"targetStart out of bounds"),Y(o>=0&&o<i.length,"sourceStart out of bounds"),Y(n>=0&&n<=i.length,"sourceEnd out of bounds"),n>this.length&&(n=this.length),t.length-e<n-o&&(n=t.length-e+o);for(var s=0;n-o>s;s++)t[s+e]=this[s+o]}},i.prototype.slice=function(t,e){var o=this.length;if(t=P(t,o,0),e=P(e,o,o),i._useTypedArrays)return M(this.subarray(t,e));for(var n=e-t,s=new i(n,void 0,!0),r=0;n>r;r++)s[r]=this[r+t];return s},i.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},i.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e)},i.prototype.readUInt8=function(t,e){return e||(Y(void 0!==t&&null!==t,"missing offset"),Y(t<this.length,"Trying to read beyond buffer length")),t>=this.length?void 0:this[t]},i.prototype.readUInt16LE=function(t,e){return g(this,t,!0,e)},i.prototype.readUInt16BE=function(t,e){return g(this,t,!1,e)},i.prototype.readUInt32LE=function(t,e){return v(this,t,!0,e)},i.prototype.readUInt32BE=function(t,e){return v(this,t,!1,e)},i.prototype.readInt8=function(t,e){if(e||(Y(void 0!==t&&null!==t,"missing offset"),Y(t<this.length,"Trying to read beyond buffer length")),!(t>=this.length)){var o=128&this[t];return o?-1*(255-this[t]+1):this[t]}},i.prototype.readInt16LE=function(t,e){return b(this,t,!0,e)},i.prototype.readInt16BE=function(t,e){return b(this,t,!1,e)},i.prototype.readInt32LE=function(t,e){return _(this,t,!0,e)},i.prototype.readInt32BE=function(t,e){return _(this,t,!1,e)},i.prototype.readFloatLE=function(t,e){return w(this,t,!0,e)},i.prototype.readFloatBE=function(t,e){return w(this,t,!1,e)},i.prototype.readDoubleLE=function(t,e){return E(this,t,!0,e)},i.prototype.readDoubleBE=function(t,e){return E(this,t,!1,e)},i.prototype.writeUInt8=function(t,e,o){o||(Y(void 0!==t&&null!==t,"missing value"),Y(void 0!==e&&null!==e,"missing offset"),Y(e<this.length,"trying to write beyond buffer length"),V(t,255)),e>=this.length||(this[e]=t)},i.prototype.writeUInt16LE=function(t,e,o){A(this,t,e,!0,o)},i.prototype.writeUInt16BE=function(t,e,o){A(this,t,e,!1,o)},i.prototype.writeUInt32LE=function(t,e,o){S(this,t,e,!0,o)},i.prototype.writeUInt32BE=function(t,e,o){S(this,t,e,!1,o)},i.prototype.writeInt8=function(t,e,o){o||(Y(void 0!==t&&null!==t,"missing value"),Y(void 0!==e&&null!==e,"missing offset"),Y(e<this.length,"Trying to write beyond buffer length"),G(t,127,-128)),e>=this.length||(t>=0?this.writeUInt8(t,e,o):this.writeUInt8(255+t+1,e,o))},i.prototype.writeInt16LE=function(t,e,o){x(this,t,e,!0,o)},i.prototype.writeInt16BE=function(t,e,o){x(this,t,e,!1,o)},i.prototype.writeInt32LE=function(t,e,o){T(this,t,e,!0,o)},i.prototype.writeInt32BE=function(t,e,o){T(this,t,e,!1,o)},i.prototype.writeFloatLE=function(t,e,o){B(this,t,e,!0,o)},i.prototype.writeFloatBE=function(t,e,o){B(this,t,e,!1,o)},i.prototype.writeDoubleLE=function(t,e,o){C(this,t,e,!0,o)},i.prototype.writeDoubleBE=function(t,e,o){C(this,t,e,!1,o)},i.prototype.fill=function(t,e,o){if(t||(t=0),e||(e=0),o||(o=this.length),"string"==typeof t&&(t=t.charCodeAt(0)),Y("number"==typeof t&&!isNaN(t),"value is not a number"),Y(o>=e,"end < start"),o!==e&&0!==this.length){Y(e>=0&&e<this.length,"start out of bounds"),Y(o>=0&&o<=this.length,"end out of bounds");for(var n=e;o>n;n++)this[n]=t}},i.prototype.inspect=function(){for(var t=[],e=this.length,n=0;e>n;n++)if(t[n]=q(this[n]),n===o.INSPECT_MAX_BYTES){t[n+1]="...";break}return"<Buffer "+t.join(" ")+">"},i.prototype.toArrayBuffer=function(){if("function"==typeof Uint8Array){if(i._useTypedArrays)return new i(this).buffer;for(var t=new Uint8Array(this.length),e=0,o=t.length;o>e;e+=1)t[e]=this[e];return t.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var z=i.prototype}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/index.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,"base64-js":2,buffer:1,ieee754:3}],2:[function(t,e){(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(){"use strict";function o(t){var e=t.charCodeAt(0);return e===r?62:e===a?63:u>e?-1:u+10>e?e-u+26+26:c+26>e?e-c:l+26>e?e-l+26:void 0}function n(t){function e(t){l[h++]=t}var n,i,r,a,u,l;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=t.length;u="="===t.charAt(c-2)?2:"="===t.charAt(c-1)?1:0,l=new s(3*t.length/4-u),r=u>0?t.length-4:t.length;var h=0;for(n=0,i=0;r>n;n+=4,i+=3)a=o(t.charAt(n))<<18|o(t.charAt(n+1))<<12|o(t.charAt(n+2))<<6|o(t.charAt(n+3)),e((16711680&a)>>16),e((65280&a)>>8),e(255&a);return 2===u?(a=o(t.charAt(n))<<2|o(t.charAt(n+1))>>4,e(255&a)):1===u&&(a=o(t.charAt(n))<<10|o(t.charAt(n+1))<<4|o(t.charAt(n+2))>>2,e(a>>8&255),e(255&a)),l}function i(e){function o(e){return t.charAt(e)}function n(t){return o(t>>18&63)+o(t>>12&63)+o(t>>6&63)+o(63&t)}var i,s,r,a=e.length%3,u="";for(i=0,r=e.length-a;r>i;i+=3)s=(e[i]<<16)+(e[i+1]<<8)+e[i+2],u+=n(s);switch(a){case 1:s=e[e.length-1],u+=o(s>>2),u+=o(s<<4&63),u+="==";break;case 2:s=(e[e.length-2]<<8)+e[e.length-1],u+=o(s>>10),u+=o(s>>4&63),u+=o(s<<2&63),u+="="}return u}var s="undefined"!=typeof Uint8Array?Uint8Array:Array,r=("0".charCodeAt(0),"+".charCodeAt(0)),a="/".charCodeAt(0),u="0".charCodeAt(0),l="a".charCodeAt(0),c="A".charCodeAt(0);e.exports.toByteArray=n,e.exports.fromByteArray=i}()}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib/b64.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],3:[function(t,e,o){(function(){o.read=function(t,e,o,n,i){var s,r,a=8*i-n-1,u=(1<<a)-1,l=u>>1,c=-7,h=o?i-1:0,d=o?-1:1,f=t[e+h];for(h+=d,s=f&(1<<-c)-1,f>>=-c,c+=a;c>0;s=256*s+t[e+h],h+=d,c-=8);for(r=s&(1<<-c)-1,s>>=-c,c+=n;c>0;r=256*r+t[e+h],h+=d,c-=8);if(0===s)s=1-l;else{if(s===u)return r?0/0:1/0*(f?-1:1);r+=Math.pow(2,n),s-=l}return(f?-1:1)*r*Math.pow(2,s-n)},o.write=function(t,e,o,n,i,s){var r,a,u,l=8*s-i-1,c=(1<<l)-1,h=c>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,p=n?1:-1,m=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(a=isNaN(e)?1:0,r=c):(r=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-r))<1&&(r--,u*=2),e+=r+h>=1?d/u:d*Math.pow(2,1-h),e*u>=2&&(r++,u/=2),r+h>=c?(a=0,r=c):r+h>=1?(a=(e*u-1)*Math.pow(2,i),r+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),r=0));i>=8;t[o+f]=255&a,f+=p,a/=256,i-=8);for(r=r<<i|a,l+=i;l>0;t[o+f]=255&r,f+=p,r/=256,l-=8);t[o+f-p]|=128*m}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/ieee754")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],4:[function(t,e){(function(t){function o(){}var t=e.exports={};t.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var o=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),o.length>0)){var n=o.shift();n()}},!0),function(t){o.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),t.title="browser",t.browser=!0,t.env={},t.argv=[],t.on=o,t.once=o,t.off=o,t.emit=o,t.binding=function(){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(){throw new Error("process.chdir is not supported")}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],5:[function(t,e){(function(){function o(){}var n=t("./Scalar");e.exports=o,o.lineInt=function(t,e,o){o=o||0;var i,s,r,a,u,l,c,h=[0,0];return i=t[1][1]-t[0][1],s=t[0][0]-t[1][0],r=i*t[0][0]+s*t[0][1],a=e[1][1]-e[0][1],u=e[0][0]-e[1][0],l=a*e[0][0]+u*e[0][1],c=i*u-a*s,n.eq(c,0,o)||(h[0]=(u*r-s*l)/c,h[1]=(i*l-a*r)/c),h},o.segmentsIntersect=function(t,e,o,n){var i=e[0]-t[0],s=e[1]-t[1],r=n[0]-o[0],a=n[1]-o[1];if(r*s-a*i==0)return!1;var u=(i*(o[1]-t[1])+s*(t[0]-o[0]))/(r*s-a*i),l=(r*(t[1]-o[1])+a*(o[0]-t[0]))/(a*i-r*s);return u>=0&&1>=u&&l>=0&&1>=l}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Line.js","/../node_modules/poly-decomp/src")},{"./Scalar":8,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],6:[function(t,e){(function(){function t(){}e.exports=t,t.area=function(t,e,o){return(e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1])},t.left=function(e,o,n){return t.area(e,o,n)>0},t.leftOn=function(e,o,n){return t.area(e,o,n)>=0},t.right=function(e,o,n){return t.area(e,o,n)<0},t.rightOn=function(e,o,n){return t.area(e,o,n)<=0};var o=[],n=[];t.collinear=function(e,i,s,r){if(r){var a=o,u=n;a[0]=i[0]-e[0],a[1]=i[1]-e[1],u[0]=s[0]-i[0],u[1]=s[1]-i[1];var l=a[0]*u[0]+a[1]*u[1],c=Math.sqrt(a[0]*a[0]+a[1]*a[1]),h=Math.sqrt(u[0]*u[0]+u[1]*u[1]),d=Math.acos(l/(c*h));return r>d}return 0==t.area(e,i,s)},t.sqdist=function(t,e){var o=e[0]-t[0],n=e[1]-t[1];return o*o+n*n}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Point.js","/../node_modules/poly-decomp/src")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],7:[function(t,e){(function(){function o(){this.vertices=[]}function n(t,e,o,n,i){i=i||0;var s=e[1]-t[1],a=t[0]-e[0],u=s*t[0]+a*t[1],l=n[1]-o[1],c=o[0]-n[0],h=l*o[0]+c*o[1],d=s*c-l*a;return r.eq(d,0,i)?[0,0]:[(c*u-a*h)/d,(s*h-l*u)/d]}var i=t("./Line"),s=t("./Point"),r=t("./Scalar");e.exports=o,o.prototype.at=function(t){var e=this.vertices,o=e.length;return e[0>t?t%o+o:t%o]},o.prototype.first=function(){return this.vertices[0]},o.prototype.last=function(){return this.vertices[this.vertices.length-1]},o.prototype.clear=function(){this.vertices.length=0},o.prototype.append=function(t,e,o){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof o)throw new Error("To is not given!");if(e>o-1)throw new Error("lol1");if(o>t.vertices.length)throw new Error("lol2");if(0>e)throw new Error("lol3");for(var n=e;o>n;n++)this.vertices.push(t.vertices[n])},o.prototype.makeCCW=function(){for(var t=0,e=this.vertices,o=1;o<this.vertices.length;++o)(e[o][1]<e[t][1]||e[o][1]==e[t][1]&&e[o][0]>e[t][0])&&(t=o);s.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},o.prototype.reverse=function(){for(var t=[],e=0,o=this.vertices.length;e!==o;e++)t.push(this.vertices.pop());this.vertices=t},o.prototype.isReflex=function(t){return s.right(this.at(t-1),this.at(t),this.at(t+1))};var a=[],u=[];o.prototype.canSee=function(t,e){var o,n,r=a,l=u;if(s.leftOn(this.at(t+1),this.at(t),this.at(e))&&s.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;n=s.sqdist(this.at(t),this.at(e));for(var c=0;c!==this.vertices.length;++c)if((c+1)%this.vertices.length!==t&&c!==t&&s.leftOn(this.at(t),this.at(e),this.at(c+1))&&s.rightOn(this.at(t),this.at(e),this.at(c))&&(r[0]=this.at(t),r[1]=this.at(e),l[0]=this.at(c),l[1]=this.at(c+1),o=i.lineInt(r,l),s.sqdist(this.at(t),o)<n))return!1;return!0},o.prototype.copy=function(t,e,n){var i=n||new o;if(i.clear(),e>t)for(var s=t;e>=s;s++)i.vertices.push(this.vertices[s]);else{for(var s=0;e>=s;s++)i.vertices.push(this.vertices[s]);for(var s=t;s<this.vertices.length;s++)i.vertices.push(this.vertices[s])}return i},o.prototype.getCutEdges=function(){for(var t=[],e=[],n=[],i=new o,s=Number.MAX_VALUE,r=0;r<this.vertices.length;++r)if(this.isReflex(r))for(var a=0;a<this.vertices.length;++a)if(this.canSee(r,a)){e=this.copy(r,a,i).getCutEdges(),n=this.copy(a,r,i).getCutEdges();for(var u=0;u<n.length;u++)e.push(n[u]);e.length<s&&(t=e,s=e.length,t.push([this.at(r),this.at(a)]))}return t},o.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},o.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],o=0;o<t.length;o++)for(var n=t[o],i=0;i<e.length;i++){var s=e[i],r=s.slice(n);if(r){e.splice(i,1),e.push(r[0],r[1]);break}}return e}var n=t,o=this.vertices.indexOf(n[0]),i=this.vertices.indexOf(n[1]);return-1!=o&&-1!=i?[this.copy(o,i),this.copy(i,o)]:!1},o.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var o=0;e-1>o;o++)if(i.segmentsIntersect(t[e],t[e+1],t[o],t[o+1]))return!1;for(var e=1;e<t.length-2;e++)if(i.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},o.prototype.quickDecomp=function(t,e,i,r,a,u){a=a||100,u=u||0,r=r||25,t="undefined"!=typeof t?t:[],e=e||[],i=i||[];var l=[0,0],c=[0,0],h=[0,0],d=0,f=0,p=0,m=0,y=0,g=0,v=0,b=new o,_=new o,w=this,E=this.vertices;if(E.length<3)return t;if(u++,u>a)return console.warn("quickDecomp: max level ("+a+") reached."),t;for(var A=0;A<this.vertices.length;++A)if(w.isReflex(A)){e.push(w.vertices[A]),d=f=Number.MAX_VALUE;for(var S=0;S<this.vertices.length;++S)s.left(w.at(A-1),w.at(A),w.at(S))&&s.rightOn(w.at(A-1),w.at(A),w.at(S-1))&&(h=n(w.at(A-1),w.at(A),w.at(S),w.at(S-1)),s.right(w.at(A+1),w.at(A),h)&&(p=s.sqdist(w.vertices[A],h),f>p&&(f=p,c=h,g=S))),s.left(w.at(A+1),w.at(A),w.at(S+1))&&s.rightOn(w.at(A+1),w.at(A),w.at(S))&&(h=n(w.at(A+1),w.at(A),w.at(S),w.at(S+1)),s.left(w.at(A-1),w.at(A),h)&&(p=s.sqdist(w.vertices[A],h),d>p&&(d=p,l=h,y=S)));if(g==(y+1)%this.vertices.length)h[0]=(c[0]+l[0])/2,h[1]=(c[1]+l[1])/2,i.push(h),y>A?(b.append(w,A,y+1),b.vertices.push(h),_.vertices.push(h),0!=g&&_.append(w,g,w.vertices.length),_.append(w,0,A+1)):(0!=A&&b.append(w,A,w.vertices.length),b.append(w,0,y+1),b.vertices.push(h),_.vertices.push(h),_.append(w,g,A+1));else{if(g>y&&(y+=this.vertices.length),m=Number.MAX_VALUE,g>y)return t;for(var S=g;y>=S;++S)s.leftOn(w.at(A-1),w.at(A),w.at(S))&&s.rightOn(w.at(A+1),w.at(A),w.at(S))&&(p=s.sqdist(w.at(A),w.at(S)),m>p&&(m=p,v=S%this.vertices.length));v>A?(b.append(w,A,v+1),0!=v&&_.append(w,v,E.length),_.append(w,0,A+1)):(0!=A&&b.append(w,A,E.length),b.append(w,0,v+1),_.append(w,v,A+1))}return b.vertices.length<_.vertices.length?(b.quickDecomp(t,e,i,r,a,u),_.quickDecomp(t,e,i,r,a,u)):(_.quickDecomp(t,e,i,r,a,u),b.quickDecomp(t,e,i,r,a,u)),t}return t.push(this),t},o.prototype.removeCollinearPoints=function(t){for(var e=0,o=this.vertices.length-1;this.vertices.length>3&&o>=0;--o)s.collinear(this.at(o-1),this.at(o),this.at(o+1),t)&&(this.vertices.splice(o%this.vertices.length,1),o--,e++);return e}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Polygon.js","/../node_modules/poly-decomp/src")},{"./Line":5,"./Point":6,"./Scalar":8,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],8:[function(t,e){(function(){function t(){}e.exports=t,t.eq=function(t,e,o){return o=o||0,Math.abs(t-e)<o}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Scalar.js","/../node_modules/poly-decomp/src")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],9:[function(t,e){(function(){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/index.js","/../node_modules/poly-decomp/src")},{"./Point":6,"./Polygon":7,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],10:[function(t,e){e.exports={name:"p2",version:"0.6.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],11:[function(t,e){(function(){function o(t){this.lowerBound=n.create(),t&&t.lowerBound&&n.copy(this.lowerBound,t.lowerBound),this.upperBound=n.create(),t&&t.upperBound&&n.copy(this.upperBound,t.upperBound)}var n=t("../math/vec2");t("../utils/Utils"),e.exports=o;var i=n.create();o.prototype.setFromPoints=function(t,e,o,s){var r=this.lowerBound,a=this.upperBound;"number"!=typeof o&&(o=0),0!==o?n.rotate(r,t[0],o):n.copy(r,t[0]),n.copy(a,r);for(var u=Math.cos(o),l=Math.sin(o),c=1;c<t.length;c++){var h=t[c];if(0!==o){var d=h[0],f=h[1];i[0]=u*d-l*f,i[1]=l*d+u*f,h=i}for(var p=0;2>p;p++)h[p]>a[p]&&(a[p]=h[p]),h[p]<r[p]&&(r[p]=h[p])}e&&(n.add(this.lowerBound,this.lowerBound,e),n.add(this.upperBound,this.upperBound,e)),s&&(this.lowerBound[0]-=s,this.lowerBound[1]-=s,this.upperBound[0]+=s,this.upperBound[1]+=s)},o.prototype.copy=function(t){n.copy(this.lowerBound,t.lowerBound),n.copy(this.upperBound,t.upperBound)},o.prototype.extend=function(t){for(var e=2;e--;){var o=t.lowerBound[e];this.lowerBound[e]>o&&(this.lowerBound[e]=o);var n=t.upperBound[e];this.upperBound[e]<n&&(this.upperBound[e]=n)}},o.prototype.overlaps=function(t){var e=this.lowerBound,o=this.upperBound,n=t.lowerBound,i=t.upperBound;return(n[0]<=o[0]&&o[0]<=i[0]||e[0]<=i[0]&&i[0]<=o[0])&&(n[1]<=o[1]&&o[1]<=i[1]||e[1]<=i[1]&&i[1]<=o[1])}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/AABB.js","/collision")},{"../math/vec2":33,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],12:[function(t,e){(function(){function o(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}var n=t("../math/vec2"),i=t("../objects/Body");e.exports=o,o.AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(t){this.world=t},o.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!")};var s=n.create();o.boundingRadiusCheck=function(t,e){n.sub(s,t.position,e.position);var o=n.squaredLength(s),i=t.boundingRadius+e.boundingRadius;return i*i>=o},o.aabbCheck=function(t,e){return t.aabbNeedsUpdate&&t.updateAABB(),e.aabbNeedsUpdate&&e.updateAABB(),t.aabb.overlaps(e.aabb)},o.prototype.boundingVolumeCheck=function(t,e){var n;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:n=o.boundingRadiusCheck(t,e);break;case o.AABB:n=o.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return n},o.canCollide=function(t,e){return t.type===i.STATIC&&e.type===i.STATIC?!1:t.type===i.KINEMATIC&&e.type===i.STATIC||t.type===i.STATIC&&e.type===i.KINEMATIC?!1:t.type===i.KINEMATIC&&e.type===i.KINEMATIC?!1:t.sleepState===i.SLEEPING&&e.sleepState===i.SLEEPING?!1:t.sleepState===i.SLEEPING&&e.type===i.STATIC||e.sleepState===i.SLEEPING&&t.type===i.STATIC?!1:!0},o.NAIVE=1,o.SAP=2}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/Broadphase.js","/collision")
},{"../math/vec2":33,"../objects/Body":34,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],13:[function(t,e){(function(){function o(t){n.apply(this),t=i.defaults(t,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10}),this.xmin=t.xmin,this.ymin=t.ymin,this.xmax=t.xmax,this.ymax=t.ymax,this.nx=t.nx,this.ny=t.ny,this.binsizeX=(this.xmax-this.xmin)/this.nx,this.binsizeY=(this.ymax-this.ymin)/this.ny}var n=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Particle"),t("../collision/Broadphase")),i=(t("../math/vec2"),t("../utils/Utils"));e.exports=o,o.prototype=new n,o.prototype.getCollisionPairs=function(t){for(var e=[],o=t.bodies,i=o.length,s=(this.binsizeX,this.binsizeY,this.nx),r=this.ny,a=this.xmin,u=this.ymin,l=this.xmax,c=this.ymax,h=[],d=s*r,f=0;d>f;f++)h.push([]);for(var p=s/(l-a),m=r/(c-u),f=0;f!==i;f++)for(var y=o[f],g=y.aabb,v=Math.max(g.lowerBound[0],a),b=Math.max(g.lowerBound[1],u),_=Math.min(g.upperBound[0],l),w=Math.min(g.upperBound[1],c),E=Math.floor(p*(v-a)),A=Math.floor(m*(b-u)),S=Math.floor(p*(_-a)),x=Math.floor(m*(w-u)),T=E;S>=T;T++)for(var B=A;x>=B;B++){var C=T,L=B,M=C*(r-1)+L;M>=0&&d>M&&h[M].push(y)}for(var f=0;f!==d;f++)for(var P=h[f],T=0,I=P.length;T!==I;T++)for(var y=P[T],B=0;B!==T;B++){var O=P[B];n.canCollide(y,O)&&this.boundingVolumeCheck(y,O)&&e.push(y,O)}return e}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/GridBroadphase.js","/collision")},{"../collision/Broadphase":12,"../math/vec2":33,"../shapes/Circle":40,"../shapes/Particle":44,"../shapes/Plane":45,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],14:[function(t,e){(function(){function o(){n.call(this,n.NAIVE)}var n=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2"),e.exports=o,o.prototype=new n,o.prototype.getCollisionPairs=function(t){var e=t.bodies,o=this.result;o.length=0;for(var i=0,s=e.length;i!==s;i++)for(var r=e[i],a=0;i>a;a++){var u=e[a];n.canCollide(r,u)&&this.boundingVolumeCheck(r,u)&&o.push(r,u)}return o}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/NaiveBroadphase.js","/collision")},{"../collision/Broadphase":12,"../math/vec2":33,"../shapes/Circle":40,"../shapes/Particle":44,"../shapes/Plane":45,"../shapes/Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],15:[function(t,e){(function(){function o(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.reuseObjects=!0,this.reusableContactEquations=[],this.reusableFrictionEquations=[],this.restitution=0,this.stiffness=h.DEFAULT_STIFFNESS,this.relaxation=h.DEFAULT_RELAXATION,this.frictionStiffness=h.DEFAULT_STIFFNESS,this.frictionRelaxation=h.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new c,this.contactSkinSize=.01}function n(t,e){s.set(t.vertices[0],.5*-e.length,-e.radius),s.set(t.vertices[1],.5*e.length,-e.radius),s.set(t.vertices[2],.5*e.length,e.radius),s.set(t.vertices[3],.5*-e.length,e.radius)}function i(t,e,o,n){for(var i=G,u=X,l=Y,c=H,h=t,d=e.vertices,f=null,p=0;p!==d.length+1;p++){var m=d[p%d.length],y=d[(p+1)%d.length];s.rotate(i,m,n),s.rotate(u,y,n),a(i,i,o),a(u,u,o),r(l,i,h),r(c,u,h);var g=s.crossLength(l,c);if(null===f&&(f=g),0>=g*f)return!1;f=g}return!0}var s=t("../math/vec2"),r=s.sub,a=s.add,u=s.dot,l=t("../utils/Utils"),c=t("../utils/TupleDictionary"),h=t("../equations/Equation"),d=t("../equations/ContactEquation"),f=t("../equations/FrictionEquation"),p=t("../shapes/Circle"),m=t("../shapes/Convex"),y=t("../shapes/Shape"),g=(t("../objects/Body"),t("../shapes/Rectangle"));e.exports=o;var v=s.fromValues(0,1),b=s.fromValues(0,0),_=s.fromValues(0,0),w=s.fromValues(0,0),E=s.fromValues(0,0),A=s.fromValues(0,0),S=s.fromValues(0,0),x=s.fromValues(0,0),T=s.fromValues(0,0),B=s.fromValues(0,0),C=s.fromValues(0,0),L=s.fromValues(0,0),M=s.fromValues(0,0),P=s.fromValues(0,0),I=s.fromValues(0,0),O=s.fromValues(0,0),R=s.fromValues(0,0),q=s.fromValues(0,0),N=s.fromValues(0,0),j=[];o.prototype.collidedLastStep=function(t,e){var o=0|t.id,n=0|e.id;return!!this.collidingBodiesLastStep.get(o,n)},o.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var o=t[e],n=o.bodyA.id,i=o.bodyB.id;this.collidingBodiesLastStep.set(n,i,!0)}if(this.reuseObjects){var s=this.contactEquations,r=this.frictionEquations,a=this.reusableFrictionEquations,u=this.reusableContactEquations;l.appendArray(u,s),l.appendArray(a,r)}this.contactEquations.length=this.frictionEquations.length=0},o.prototype.createContactEquation=function(t,e,o,n){var i=this.reusableContactEquations.length?this.reusableContactEquations.pop():new d(t,e);return i.bodyA=t,i.bodyB=e,i.shapeA=o,i.shapeB=n,i.restitution=this.restitution,i.firstImpact=!this.collidedLastStep(t,e),i.stiffness=this.stiffness,i.relaxation=this.relaxation,i.needsUpdate=!0,i.enabled=!0,i.offset=this.contactSkinSize,i},o.prototype.createFrictionEquation=function(t,e,o,n){var i=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new f(t,e);return i.bodyA=t,i.bodyB=e,i.shapeA=o,i.shapeB=n,i.setSlipForce(this.slipForce),i.frictionCoefficient=this.frictionCoefficient,i.relativeVelocity=this.surfaceVelocity,i.enabled=!0,i.needsUpdate=!0,i.stiffness=this.frictionStiffness,i.relaxation=this.frictionRelaxation,i.contactEquations.length=0,i},o.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return s.copy(e.contactPointA,t.contactPointA),s.copy(e.contactPointB,t.contactPointB),s.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},o.prototype.createFrictionFromAverage=function(t){if(!t)throw new Error("numContacts == 0!");var e=this.contactEquations[this.contactEquations.length-1],o=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),n=e.bodyA;e.bodyB,s.set(o.contactPointA,0,0),s.set(o.contactPointB,0,0),s.set(o.t,0,0);for(var i=0;i!==t;i++)e=this.contactEquations[this.contactEquations.length-1-i],e.bodyA===n?(s.add(o.t,o.t,e.normalA),s.add(o.contactPointA,o.contactPointA,e.contactPointA),s.add(o.contactPointB,o.contactPointB,e.contactPointB)):(s.sub(o.t,o.t,e.normalA),s.add(o.contactPointA,o.contactPointA,e.contactPointB),s.add(o.contactPointB,o.contactPointB,e.contactPointA)),o.contactEquations.push(e);var r=1/t;return s.scale(o.contactPointA,o.contactPointA,r),s.scale(o.contactPointB,o.contactPointB,r),s.normalize(o.t,o.t),s.rotate90cw(o.t,o.t),o},o.prototype[y.LINE|y.CONVEX]=o.prototype.convexLine=function(t,e,o,n,i,s,r,a,u){return u?!1:0},o.prototype[y.LINE|y.RECTANGLE]=o.prototype.lineRectangle=function(t,e,o,n,i,s,r,a,u){return u?!1:0};var U=new g(1,1),F=s.create();o.prototype[y.CAPSULE|y.CONVEX]=o.prototype[y.CAPSULE|y.RECTANGLE]=o.prototype.convexCapsule=function(t,e,o,i,r,a,u,l,c){var h=F;s.set(h,a.length/2,0),s.rotate(h,h,l),s.add(h,h,u);var d=this.circleConvex(r,a,h,l,t,e,o,i,c,a.radius);s.set(h,-a.length/2,0),s.rotate(h,h,l),s.add(h,h,u);var f=this.circleConvex(r,a,h,l,t,e,o,i,c,a.radius);if(c&&(d||f))return!0;var p=U;n(p,a);var m=this.convexConvex(t,e,o,i,r,p,u,l,c);return m+d+f},o.prototype[y.CAPSULE|y.LINE]=o.prototype.lineCapsule=function(t,e,o,n,i,s,r,a,u){return u?!1:0};var k=s.create(),D=s.create(),V=new g(1,1);o.prototype[y.CAPSULE|y.CAPSULE]=o.prototype.capsuleCapsule=function(t,e,o,i,r,a,u,l,c){for(var h,d=k,f=D,p=0,m=0;2>m;m++){s.set(d,(0===m?-1:1)*e.length/2,0),s.rotate(d,d,i),s.add(d,d,o);for(var y=0;2>y;y++){s.set(f,(0===y?-1:1)*a.length/2,0),s.rotate(f,f,l),s.add(f,f,u),this.enableFrictionReduction&&(h=this.enableFriction,this.enableFriction=!1);var g=this.circleCircle(t,e,d,i,r,a,f,l,c,e.radius,a.radius);if(this.enableFrictionReduction&&(this.enableFriction=h),c&&g)return!0;p+=g}}this.enableFrictionReduction&&(h=this.enableFriction,this.enableFriction=!1);var v=V;n(v,e);var b=this.convexCapsule(t,v,o,i,r,a,u,l,c);if(this.enableFrictionReduction&&(this.enableFriction=h),c&&b)return!0;if(p+=b,this.enableFrictionReduction){var h=this.enableFriction;this.enableFriction=!1}n(v,a);var _=this.convexCapsule(r,v,u,l,t,e,o,i,c);return this.enableFrictionReduction&&(this.enableFriction=h),c&&_?!0:(p+=_,this.enableFrictionReduction&&p&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(p)),p)},o.prototype[y.LINE|y.LINE]=o.prototype.lineLine=function(t,e,o,n,i,s,r,a,u){return u?!1:0},o.prototype[y.PLANE|y.LINE]=o.prototype.planeLine=function(t,e,o,n,i,l,c,h,d){var f=b,p=_,m=w,y=E,g=A,C=S,L=x,M=T,P=B,I=j,O=0;s.set(f,-l.length/2,0),s.set(p,l.length/2,0),s.rotate(m,f,h),s.rotate(y,p,h),a(m,m,c),a(y,y,c),s.copy(f,m),s.copy(p,y),r(g,p,f),s.normalize(C,g),s.rotate90cw(P,C),s.rotate(M,v,n),I[0]=f,I[1]=p;for(var R=0;R<I.length;R++){var q=I[R];r(L,q,o);var N=u(L,M);if(0>N){if(d)return!0;var U=this.createContactEquation(t,i,e,l);O++,s.copy(U.normalA,M),s.normalize(U.normalA,U.normalA),s.scale(L,M,N),r(U.contactPointA,q,L),r(U.contactPointA,U.contactPointA,t.position),r(U.contactPointB,q,c),a(U.contactPointB,U.contactPointB,c),r(U.contactPointB,U.contactPointB,i.position),this.contactEquations.push(U),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(U))}}return d?!1:(this.enableFrictionReduction||O&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(O)),O)},o.prototype[y.PARTICLE|y.CAPSULE]=o.prototype.particleCapsule=function(t,e,o,n,i,s,r,a,u){return this.circleLine(t,e,o,n,i,s,r,a,u,s.radius,0)},o.prototype[y.CIRCLE|y.LINE]=o.prototype.circleLine=function(t,e,o,n,i,l,c,h,d,f,p){var f=f||0,p="undefined"!=typeof p?p:e.radius,m=b,y=_,g=w,v=E,O=A,R=S,q=x,N=T,U=B,F=C,k=L,D=M,V=P,G=I,X=j;s.set(N,-l.length/2,0),s.set(U,l.length/2,0),s.rotate(F,N,h),s.rotate(k,U,h),a(F,F,c),a(k,k,c),s.copy(N,F),s.copy(U,k),r(R,U,N),s.normalize(q,R),s.rotate90cw(O,q),r(D,o,N);var Y=u(D,O);r(v,N,c),r(V,o,c);var H=p+f;if(Math.abs(Y)<H){s.scale(m,O,Y),r(g,o,m),s.scale(y,O,u(O,V)),s.normalize(y,y),s.scale(y,y,f),a(g,g,y);var W=u(q,g),z=u(q,N),K=u(q,U);if(W>z&&K>W){if(d)return!0;var Q=this.createContactEquation(t,i,e,l);return s.scale(Q.normalA,m,-1),s.normalize(Q.normalA,Q.normalA),s.scale(Q.contactPointA,Q.normalA,p),a(Q.contactPointA,Q.contactPointA,o),r(Q.contactPointA,Q.contactPointA,t.position),r(Q.contactPointB,g,c),a(Q.contactPointB,Q.contactPointB,c),r(Q.contactPointB,Q.contactPointB,i.position),this.contactEquations.push(Q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Q)),1}}X[0]=N,X[1]=U;for(var J=0;J<X.length;J++){var Z=X[J];if(r(D,Z,o),s.squaredLength(D)<Math.pow(H,2)){if(d)return!0;var Q=this.createContactEquation(t,i,e,l);return s.copy(Q.normalA,D),s.normalize(Q.normalA,Q.normalA),s.scale(Q.contactPointA,Q.normalA,p),a(Q.contactPointA,Q.contactPointA,o),r(Q.contactPointA,Q.contactPointA,t.position),r(Q.contactPointB,Z,c),s.scale(G,Q.normalA,-f),a(Q.contactPointB,Q.contactPointB,G),a(Q.contactPointB,Q.contactPointB,c),r(Q.contactPointB,Q.contactPointB,i.position),this.contactEquations.push(Q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Q)),1}}return 0},o.prototype[y.CIRCLE|y.CAPSULE]=o.prototype.circleCapsule=function(t,e,o,n,i,s,r,a,u){return this.circleLine(t,e,o,n,i,s,r,a,u,s.radius)},o.prototype[y.CIRCLE|y.CONVEX]=o.prototype[y.CIRCLE|y.RECTANGLE]=o.prototype.circleConvex=function(t,e,o,n,u,l,c,h,d,f){for(var f="number"==typeof f?f:e.radius,p=b,m=_,y=w,g=E,v=A,S=C,x=L,T=P,B=I,M=O,q=R,N=!1,j=Number.MAX_VALUE,U=l.vertices,F=0;F!==U.length+1;F++){var k=U[F%U.length],D=U[(F+1)%U.length];if(s.rotate(p,k,h),s.rotate(m,D,h),a(p,p,c),a(m,m,c),r(y,m,p),s.normalize(g,y),s.rotate90cw(v,g),s.scale(B,v,-e.radius),a(B,B,o),i(B,l,c,h)){s.sub(M,p,B);var V=Math.abs(s.dot(M,v));j>V&&(s.copy(q,B),j=V,s.scale(T,v,V),s.add(T,T,B),N=!0)}}if(N){if(d)return!0;var G=this.createContactEquation(t,u,e,l);return s.sub(G.normalA,q,o),s.normalize(G.normalA,G.normalA),s.scale(G.contactPointA,G.normalA,f),a(G.contactPointA,G.contactPointA,o),r(G.contactPointA,G.contactPointA,t.position),r(G.contactPointB,T,c),a(G.contactPointB,G.contactPointB,c),r(G.contactPointB,G.contactPointB,u.position),this.contactEquations.push(G),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(G)),1}if(f>0)for(var F=0;F<U.length;F++){var X=U[F];if(s.rotate(x,X,h),a(x,x,c),r(S,x,o),s.squaredLength(S)<Math.pow(f,2)){if(d)return!0;var G=this.createContactEquation(t,u,e,l);return s.copy(G.normalA,S),s.normalize(G.normalA,G.normalA),s.scale(G.contactPointA,G.normalA,f),a(G.contactPointA,G.contactPointA,o),r(G.contactPointA,G.contactPointA,t.position),r(G.contactPointB,x,c),a(G.contactPointB,G.contactPointB,c),r(G.contactPointB,G.contactPointB,u.position),this.contactEquations.push(G),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(G)),1}}return 0};var G=s.create(),X=s.create(),Y=s.create(),H=s.create();o.prototype[y.PARTICLE|y.CONVEX]=o.prototype[y.PARTICLE|y.RECTANGLE]=o.prototype.particleConvex=function(t,e,o,n,l,c,h,d,f){var p=b,m=_,y=w,g=E,v=A,T=S,B=x,L=C,M=P,I=q,O=N,R=Number.MAX_VALUE,j=!1,U=c.vertices;if(!i(o,c,h,d))return 0;if(f)return!0;for(var F=0;F!==U.length+1;F++){var k=U[F%U.length],D=U[(F+1)%U.length];s.rotate(p,k,d),s.rotate(m,D,d),a(p,p,h),a(m,m,h),r(y,m,p),s.normalize(g,y),s.rotate90cw(v,g),r(L,o,p),u(L,v),r(T,p,h),r(B,o,h),s.sub(I,p,o);var V=Math.abs(s.dot(I,v));R>V&&(R=V,s.scale(M,v,V),s.add(M,M,o),s.copy(O,v),j=!0)}if(j){var G=this.createContactEquation(t,l,e,c);return s.scale(G.normalA,O,-1),s.normalize(G.normalA,G.normalA),s.set(G.contactPointA,0,0),a(G.contactPointA,G.contactPointA,o),r(G.contactPointA,G.contactPointA,t.position),r(G.contactPointB,M,h),a(G.contactPointB,G.contactPointB,h),r(G.contactPointB,G.contactPointB,l.position),this.contactEquations.push(G),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(G)),1}return 0},o.prototype[y.CIRCLE]=o.prototype.circleCircle=function(t,e,o,n,i,u,l,c,h,d,f){var p=b,d=d||e.radius,f=f||u.radius;r(p,o,l);var m=d+f;if(s.squaredLength(p)>Math.pow(m,2))return 0;if(h)return!0;var y=this.createContactEquation(t,i,e,u);return r(y.normalA,l,o),s.normalize(y.normalA,y.normalA),s.scale(y.contactPointA,y.normalA,d),s.scale(y.contactPointB,y.normalA,-f),a(y.contactPointA,y.contactPointA,o),r(y.contactPointA,y.contactPointA,t.position),a(y.contactPointB,y.contactPointB,l),r(y.contactPointB,y.contactPointB,i.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1},o.prototype[y.PLANE|y.CONVEX]=o.prototype[y.PLANE|y.RECTANGLE]=o.prototype.planeConvex=function(t,e,o,n,i,l,c,h,d){var f=b,p=_,m=w,y=0;s.rotate(p,v,n);for(var g=0;g!==l.vertices.length;g++){var E=l.vertices[g];if(s.rotate(f,E,h),a(f,f,c),r(m,f,o),u(m,p)<=0){if(d)return!0;y++;var A=this.createContactEquation(t,i,e,l);r(m,f,o),s.copy(A.normalA,p);var S=u(m,A.normalA);s.scale(m,A.normalA,S),r(A.contactPointB,f,i.position),r(A.contactPointA,f,m),r(A.contactPointA,A.contactPointA,t.position),this.contactEquations.push(A),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A))}}return this.enableFrictionReduction&&this.enableFriction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},o.prototype[y.PARTICLE|y.PLANE]=o.prototype.particlePlane=function(t,e,o,n,i,a,l,c,h){var d=b,f=_;c=c||0,r(d,o,l),s.rotate(f,v,c);var p=u(d,f);if(p>0)return 0;if(h)return!0;var m=this.createContactEquation(i,t,a,e);return s.copy(m.normalA,f),s.scale(d,m.normalA,p),r(m.contactPointA,o,d),r(m.contactPointA,m.contactPointA,i.position),r(m.contactPointB,o,t.position),this.contactEquations.push(m),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(m)),1},o.prototype[y.CIRCLE|y.PARTICLE]=o.prototype.circleParticle=function(t,e,o,n,i,u,l,c,h){var d=b;if(r(d,l,o),s.squaredLength(d)>Math.pow(e.radius,2))return 0;if(h)return!0;var f=this.createContactEquation(t,i,e,u);return s.copy(f.normalA,d),s.normalize(f.normalA,f.normalA),s.scale(f.contactPointA,f.normalA,e.radius),a(f.contactPointA,f.contactPointA,o),r(f.contactPointA,f.contactPointA,t.position),r(f.contactPointB,l,i.position),this.contactEquations.push(f),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(f)),1};var W=new p(1),z=s.create(),K=s.create();s.create(),o.prototype[y.PLANE|y.CAPSULE]=o.prototype.planeCapsule=function(t,e,o,n,i,r,u,l,c){var h=z,d=K,f=W;s.set(h,-r.length/2,0),s.rotate(h,h,l),a(h,h,u),s.set(d,r.length/2,0),s.rotate(d,d,l),a(d,d,u),f.radius=r.radius;var p;this.enableFrictionReduction&&(p=this.enableFriction,this.enableFriction=!1);var m=this.circlePlane(i,f,h,0,t,e,o,n,c),y=this.circlePlane(i,f,d,0,t,e,o,n,c);if(this.enableFrictionReduction&&(this.enableFriction=p),c)return m||y;var g=m+y;return this.enableFrictionReduction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g},o.prototype[y.CIRCLE|y.PLANE]=o.prototype.circlePlane=function(t,e,o,n,i,l,c,h,d){var f=t,p=e,m=o,y=i,g=c,E=h;E=E||0;var A=b,S=_,x=w;r(A,m,g),s.rotate(S,v,E);var T=u(S,A);if(T>p.radius)return 0;if(d)return!0;var B=this.createContactEquation(y,f,l,e);return s.copy(B.normalA,S),s.scale(B.contactPointB,B.normalA,-p.radius),a(B.contactPointB,B.contactPointB,m),r(B.contactPointB,B.contactPointB,f.position),s.scale(x,B.normalA,T),r(B.contactPointA,A,x),a(B.contactPointA,B.contactPointA,g),r(B.contactPointA,B.contactPointA,y.position),this.contactEquations.push(B),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(B)),1},o.prototype[y.CONVEX]=o.prototype[y.CONVEX|y.RECTANGLE]=o.prototype[y.RECTANGLE]=o.prototype.convexConvex=function(t,e,n,i,l,c,h,d,f,p){var m=b,y=_,g=w,v=E,S=A,C=x,L=T,M=B,P=0,p="number"==typeof p?p:0,I=o.findSeparatingAxis(e,n,i,c,h,d,m);if(!I)return 0;r(L,h,n),u(m,L)>0&&s.scale(m,m,-1);var O=o.getClosestEdge(e,i,m,!0),R=o.getClosestEdge(c,d,m);if(-1===O||-1===R)return 0;for(var q=0;2>q;q++){var N=O,j=R,U=e,F=c,k=n,D=h,V=i,G=d,X=t,Y=l;if(0===q){var H;H=N,N=j,j=H,H=U,U=F,F=H,H=k,k=D,D=H,H=V,V=G,G=H,H=X,X=Y,Y=H}for(var W=j;j+2>W;W++){var z=F.vertices[(W+F.vertices.length)%F.vertices.length];s.rotate(y,z,G),a(y,y,D);for(var K=0,Q=N-1;N+2>Q;Q++){var J=U.vertices[(Q+U.vertices.length)%U.vertices.length],Z=U.vertices[(Q+1+U.vertices.length)%U.vertices.length];s.rotate(g,J,V),s.rotate(v,Z,V),a(g,g,k),a(v,v,k),r(S,v,g),s.rotate90cw(M,S),s.normalize(M,M),r(L,y,g);var $=u(M,L);(Q===N&&p>=$||Q!==N&&0>=$)&&K++}if(K>=3){if(f)return!0;var te=this.createContactEquation(X,Y,U,F);P++;var J=U.vertices[N%U.vertices.length],Z=U.vertices[(N+1)%U.vertices.length];s.rotate(g,J,V),s.rotate(v,Z,V),a(g,g,k),a(v,v,k),r(S,v,g),s.rotate90cw(te.normalA,S),s.normalize(te.normalA,te.normalA),r(L,y,g);var $=u(te.normalA,L);s.scale(C,te.normalA,$),r(te.contactPointA,y,k),r(te.contactPointA,te.contactPointA,C),a(te.contactPointA,te.contactPointA,k),r(te.contactPointA,te.contactPointA,X.position),r(te.contactPointB,y,D),a(te.contactPointB,te.contactPointB,D),r(te.contactPointB,te.contactPointB,Y.position),this.contactEquations.push(te),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(te))}}}return this.enableFrictionReduction&&this.enableFriction&&P&&this.frictionEquations.push(this.createFrictionFromAverage(P)),P};var Q=s.fromValues(0,0);o.projectConvexOntoAxis=function(t,e,o,n,i){var r,a,l=null,c=null,h=Q;s.rotate(h,n,-o);for(var d=0;d<t.vertices.length;d++)r=t.vertices[d],a=u(r,h),(null===l||a>l)&&(l=a),(null===c||c>a)&&(c=a);if(c>l){var f=c;c=l,l=f}var p=u(e,n);s.set(i,c+p,l+p)};var J=s.fromValues(0,0),Z=s.fromValues(0,0),$=s.fromValues(0,0),te=s.fromValues(0,0),ee=s.fromValues(0,0),oe=s.fromValues(0,0);o.findSeparatingAxis=function(t,e,n,i,a,u,l){var c=null,h=!1,d=!1,f=J,p=Z,m=$,y=te,v=ee,b=oe;if(t instanceof g&&i instanceof g)for(var _=0;2!==_;_++){var w=t,E=n;1===_&&(w=i,E=u);for(var A=0;2!==A;A++){0===A?s.set(y,0,1):1===A&&s.set(y,1,0),0!==E&&s.rotate(y,y,E),o.projectConvexOntoAxis(t,e,n,y,v),o.projectConvexOntoAxis(i,a,u,y,b);var S=v,x=b,T=!1;v[0]>b[0]&&(x=v,S=b,T=!0);var B=x[0]-S[1];h=0>=B,(null===c||B>c)&&(s.copy(l,y),c=B,d=h)}}else for(var _=0;2!==_;_++){var w=t,E=n;1===_&&(w=i,E=u);for(var A=0;A!==w.vertices.length;A++){s.rotate(p,w.vertices[A],E),s.rotate(m,w.vertices[(A+1)%w.vertices.length],E),r(f,m,p),s.rotate90cw(y,f),s.normalize(y,y),o.projectConvexOntoAxis(t,e,n,y,v),o.projectConvexOntoAxis(i,a,u,y,b);var S=v,x=b,T=!1;v[0]>b[0]&&(x=v,S=b,T=!0);var B=x[0]-S[1];h=0>=B,(null===c||B>c)&&(s.copy(l,y),c=B,d=h)}}return d};var ne=s.fromValues(0,0),ie=s.fromValues(0,0),se=s.fromValues(0,0);o.getClosestEdge=function(t,e,o,n){var i=ne,a=ie,l=se;s.rotate(i,o,-e),n&&s.scale(i,i,-1);for(var c=-1,h=t.vertices.length,d=-1,f=0;f!==h;f++){r(a,t.vertices[(f+1)%h],t.vertices[f%h]),s.rotate90cw(l,a),s.normalize(l,l);var p=u(l,i);(-1===c||p>d)&&(c=f%h,d=p)}return c};var re=s.create(),ae=s.create(),ue=s.create(),le=s.create(),ce=s.create(),he=s.create(),de=s.create();o.prototype[y.CIRCLE|y.HEIGHTFIELD]=o.prototype.circleHeightfield=function(t,e,o,n,i,u,l,c,h,d){var f=u.data,d=d||e.radius,p=u.elementWidth,m=ae,y=re,g=ce,v=de,b=he,_=ue,w=le,E=Math.floor((o[0]-d-l[0])/p),A=Math.ceil((o[0]+d-l[0])/p);0>E&&(E=0),A>=f.length&&(A=f.length-1);for(var S=f[E],x=f[A],T=E;A>T;T++)f[T]<x&&(x=f[T]),f[T]>S&&(S=f[T]);if(o[1]-d>S)return h?!1:0;o[1]+d<x;for(var B=!1,T=E;A>T;T++){s.set(_,T*p,f[T]),s.set(w,(T+1)*p,f[T+1]),s.add(_,_,l),s.add(w,w,l),s.sub(b,w,_),s.rotate(b,b,Math.PI/2),s.normalize(b,b),s.scale(y,b,-d),s.add(y,y,o),s.sub(m,y,_);var C=s.dot(m,b);if(y[0]>=_[0]&&y[0]<w[0]&&0>=C){if(h)return!0;B=!0,s.scale(m,b,-C),s.add(g,y,m),s.copy(v,b);var L=this.createContactEquation(i,t,u,e);s.copy(L.normalA,v),s.scale(L.contactPointB,L.normalA,-d),a(L.contactPointB,L.contactPointB,o),r(L.contactPointB,L.contactPointB,t.position),s.copy(L.contactPointA,g),s.sub(L.contactPointA,L.contactPointA,i.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L))}}if(B=!1,d>0)for(var T=E;A>=T;T++)if(s.set(_,T*p,f[T]),s.add(_,_,l),s.sub(m,o,_),s.squaredLength(m)<Math.pow(d,2)){if(h)return!0;B=!0;var L=this.createContactEquation(i,t,u,e);s.copy(L.normalA,m),s.normalize(L.normalA,L.normalA),s.scale(L.contactPointB,L.normalA,-d),a(L.contactPointB,L.contactPointB,o),r(L.contactPointB,L.contactPointB,t.position),r(L.contactPointA,_,l),a(L.contactPointA,L.contactPointA,l),r(L.contactPointA,L.contactPointA,i.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L))}return B?1:0};var fe=s.create(),pe=s.create(),me=s.create(),ye=new m([s.create(),s.create(),s.create(),s.create()]);o.prototype[y.RECTANGLE|y.HEIGHTFIELD]=o.prototype[y.CONVEX|y.HEIGHTFIELD]=o.prototype.convexHeightfield=function(t,e,o,n,i,r,a,u,l){var c=r.data,h=r.elementWidth,d=fe,f=pe,p=me,m=ye,y=Math.floor((t.aabb.lowerBound[0]-a[0])/h),g=Math.ceil((t.aabb.upperBound[0]-a[0])/h);0>y&&(y=0),g>=c.length&&(g=c.length-1);for(var v=c[y],b=c[g],_=y;g>_;_++)c[_]<b&&(b=c[_]),c[_]>v&&(v=c[_]);if(t.aabb.lowerBound[1]>v)return l?!1:0;for(var w=0,_=y;g>_;_++){s.set(d,_*h,c[_]),s.set(f,(_+1)*h,c[_+1]),s.add(d,d,a),s.add(f,f,a);var E=100;s.set(p,.5*(f[0]+d[0]),.5*(f[1]+d[1]-E)),s.sub(m.vertices[0],f,p),s.sub(m.vertices[1],d,p),s.copy(m.vertices[2],m.vertices[1]),s.copy(m.vertices[3],m.vertices[0]),m.vertices[2][1]-=E,m.vertices[3][1]-=E,w+=this.convexConvex(t,e,o,n,i,m,p,0,l)}return w}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/Narrowphase.js","/collision")},{"../equations/ContactEquation":24,"../equations/Equation":25,"../equations/FrictionEquation":26,"../math/vec2":33,"../objects/Body":34,"../shapes/Circle":40,"../shapes/Convex":41,"../shapes/Rectangle":46,"../shapes/Shape":47,"../utils/TupleDictionary":51,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],16:[function(t,e){(function(){function o(){i.call(this,i.SAP),this.axisList=[],this.world=null,this.axisIndex=0;var t=this.axisList;this._addBodyHandler=function(e){t.push(e.body)},this._removeBodyHandler=function(e){var o=t.indexOf(e.body);-1!==o&&t.splice(o,1)}}var n=t("../utils/Utils"),i=t("../collision/Broadphase");e.exports=o,o.prototype=new i,o.prototype.setWorld=function(t){this.axisList.length=0,n.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},o.sortAxisList=function(t,e){e=0|e;for(var o=1,n=t.length;n>o;o++){for(var i=t[o],s=o-1;s>=0&&!(t[s].aabb.lowerBound[e]<=i.aabb.lowerBound[e]);s--)t[s+1]=t[s];t[s+1]=i}return t},o.prototype.getCollisionPairs=function(){var t=this.axisList,e=this.result,n=this.axisIndex;e.length=0;for(var s=t.length;s--;){var r=t[s];r.aabbNeedsUpdate&&r.updateAABB()}o.sortAxisList(t,n);for(var a=0,u=0|t.length;a!==u;a++)for(var l=t[a],c=a+1;u>c;c++){var h=t[c],d=h.aabb.lowerBound[n]<=l.aabb.upperBound[n];if(!d)break;i.canCollide(l,h)&&this.boundingVolumeCheck(l,h)&&e.push(l,h)}return e}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/SAPBroadphase.js","/collision")},{"../collision/Broadphase":12,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],17:[function(t,e){(function(){function o(t,e,o,i){this.type=o,i=n.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=o;var n=t("../utils/Utils");o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.DISTANCE=1,o.GEAR=2,o.LOCK=3,o.PRISMATIC=4,o.REVOLUTE=5,o.prototype.setStiffness=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var n=e[o];n.stiffness=t,n.needsUpdate=!0}},o.prototype.setRelaxation=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var n=e[o];n.relaxation=t,n.needsUpdate=!0}}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/Constraint.js","/constraints")},{"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],18:[function(t,e){(function(){function o(t,e,o){o=r.defaults(o,{localAnchorA:[0,0],localAnchorB:[0,0]}),n.call(this,t,e,n.DISTANCE,o),this.localAnchorA=s.fromValues(o.localAnchorA[0],o.localAnchorA[1]),this.localAnchorB=s.fromValues(o.localAnchorB[0],o.localAnchorB[1]);var a=this.localAnchorA,u=this.localAnchorB;if(this.distance=0,"number"==typeof o.distance)this.distance=o.distance;else{var l=s.create(),c=s.create(),h=s.create();s.rotate(l,a,t.angle),s.rotate(c,u,e.angle),s.add(h,e.position,c),s.sub(h,h,l),s.sub(h,h,t.position),this.distance=s.length(h)}var d;d="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce;var f=new i(t,e,-d,d);this.equations=[f],this.maxForce=d;var h=s.create(),p=s.create(),m=s.create(),y=this;f.computeGq=function(){var t=this.bodyA,e=this.bodyB,o=t.position,n=e.position;return s.rotate(p,a,t.angle),s.rotate(m,u,e.angle),s.add(h,n,m),s.sub(h,h,p),s.sub(h,h,o),s.length(h)-y.distance},this.setMaxForce(d),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var n=t("./Constraint"),i=t("../equations/Equation"),s=t("../math/vec2"),r=t("../utils/Utils");e.exports=o,o.prototype=new n;var a=s.create(),u=s.create(),l=s.create();o.prototype.update=function(){var t=this.equations[0],e=this.bodyA,o=this.bodyB,n=(this.distance,e.position),i=o.position,r=this.equations[0],c=t.G;s.rotate(u,this.localAnchorA,e.angle),s.rotate(l,this.localAnchorB,o.angle),s.add(a,i,l),s.sub(a,a,u),s.sub(a,a,n),this.position=s.length(a);var h=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(r.maxForce=0,r.minForce=-this.maxForce,this.distance=this.upperLimit,h=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(r.maxForce=this.maxForce,r.minForce=0,this.distance=this.lowerLimit,h=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!h)return void(r.enabled=!1);r.enabled=!0,s.normalize(a,a);var d=s.crossLength(u,a),f=s.crossLength(l,a);c[0]=-a[0],c[1]=-a[1],c[2]=-d,c[3]=a[0],c[4]=a[1],c[5]=f},o.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},o.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/DistanceConstraint.js","/constraints")},{"../equations/Equation":25,"../math/vec2":33,"../utils/Utils":52,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],19:[function(t,e){(function(){function o(t,e,o){o=o||{},n.call(this,t,e,n.GEAR,o),this.ratio="number"==typeof o.ratio?o.ratio:1,this.angle="number"==typeof o.angle?o.angle:e.angle-this.ratio*t.angle,o.angle=this.angle,o.ratio=this.ratio,this.equations=[new i(t,e,o)],"number"==typeof o.maxTorque&&this.setMaxTorque(o.maxTorque)}var n=t("./Constraint"),i=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2"),e.exports=o,o.prototype=new n,o.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},o.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},o.prototype.getMaxTorque=function(){return this.equations[0].maxForce}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/GearConstraint.js","/constraints")
},{"../equations/AngleLockEquation":23,"../equations/Equation":25,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],20:[function(t,e){(function(){function o(t,e,o){o=o||{},n.call(this,t,e,n.LOCK,o);var r="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce,a=(o.localAngleB||0,new s(t,e,-r,r)),u=new s(t,e,-r,r),l=new s(t,e,-r,r),c=i.create(),h=i.create(),d=this;a.computeGq=function(){return i.rotate(c,d.localOffsetB,t.angle),i.sub(h,e.position,t.position),i.sub(h,h,c),h[0]},u.computeGq=function(){return i.rotate(c,d.localOffsetB,t.angle),i.sub(h,e.position,t.position),i.sub(h,h,c),h[1]};var f=i.create(),p=i.create();l.computeGq=function(){return i.rotate(f,d.localOffsetB,e.angle-d.localAngleB),i.scale(f,f,-1),i.sub(h,t.position,e.position),i.add(h,h,f),i.rotate(p,f,-Math.PI/2),i.normalize(p,p),i.dot(h,p)},this.localOffsetB=i.create(),o.localOffsetB?i.copy(this.localOffsetB,o.localOffsetB):(i.sub(this.localOffsetB,e.position,t.position),i.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,this.localAngleB="number"==typeof o.localAngleB?o.localAngleB:e.angle-t.angle,this.equations.push(a,u,l),this.setMaxForce(r)}var n=t("./Constraint"),i=t("../math/vec2"),s=t("../equations/Equation");e.exports=o,o.prototype=new n,o.prototype.setMaxForce=function(t){for(var e=this.equations,o=0;o<this.equations.length;o++)e[o].maxForce=t,e[o].minForce=-t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var r=i.create(),a=i.create(),u=i.create(),l=i.fromValues(1,0),c=i.fromValues(0,1);o.prototype.update=function(){var t=this.equations[0],e=this.equations[1],o=this.equations[2],n=this.bodyA,s=this.bodyB;i.rotate(r,this.localOffsetB,n.angle),i.rotate(a,this.localOffsetB,s.angle-this.localAngleB),i.scale(a,a,-1),i.rotate(u,a,Math.PI/2),i.normalize(u,u),t.G[0]=-1,t.G[1]=0,t.G[2]=-i.crossLength(r,l),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-i.crossLength(r,c),e.G[4]=1,o.G[0]=-u[0],o.G[1]=-u[1],o.G[3]=u[0],o.G[4]=u[1],o.G[5]=i.crossLength(a,u)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/LockConstraint.js","/constraints")},{"../equations/Equation":25,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],21:[function(t,e){(function(){function o(t,e,o){o=o||{},n.call(this,t,e,n.PRISMATIC,o);var u=r.fromValues(0,0),l=r.fromValues(1,0),c=r.fromValues(0,0);o.localAnchorA&&r.copy(u,o.localAnchorA),o.localAxisA&&r.copy(l,o.localAxisA),o.localAnchorB&&r.copy(c,o.localAnchorB),this.localAnchorA=u,this.localAnchorB=c,this.localAxisA=l;var h=this.maxForce="undefined"!=typeof o.maxForce?o.maxForce:Number.MAX_VALUE,d=new s(t,e,-h,h),f=new r.create,p=new r.create,m=new r.create,y=new r.create;if(d.computeGq=function(){return r.dot(m,y)},d.updateJacobian=function(){var o=this.G,n=t.position,i=e.position;r.rotate(f,u,t.angle),r.rotate(p,c,e.angle),r.add(m,i,p),r.sub(m,m,n),r.sub(m,m,f),r.rotate(y,l,t.angle+Math.PI/2),o[0]=-y[0],o[1]=-y[1],o[2]=-r.crossLength(f,y)+r.crossLength(y,m),o[3]=y[0],o[4]=y[1],o[5]=r.crossLength(p,y)},this.equations.push(d),!o.disableRotationalLock){var g=new a(t,e,-h,h);this.equations.push(g)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof o.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof o.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof o.lowerLimit?o.lowerLimit:0,this.upperLimit="undefined"!=typeof o.upperLimit?o.upperLimit:1,this.upperLimitEquation=new i(t,e),this.lowerLimitEquation=new i(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=h,this.motorEquation=new s(t,e),this.motorEnabled=!1,this.motorSpeed=0;var v=this,b=this.motorEquation;b.computeGW,b.computeGq=function(){return 0},b.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,n=e.velocity,i=o.velocity,s=e.angularVelocity,r=o.angularVelocity;return this.gmult(t,n,s,i,r)+v.motorSpeed}}var n=t("./Constraint"),i=t("../equations/ContactEquation"),s=t("../equations/Equation"),r=t("../math/vec2"),a=t("../equations/RotationalLockEquation");e.exports=o,o.prototype=new n;var u=r.create(),l=r.create(),c=r.create(),h=r.create(),d=r.create(),f=r.create();o.prototype.update=function(){var t=this.equations,e=t[0],o=this.upperLimit,n=this.lowerLimit,i=this.upperLimitEquation,s=this.lowerLimitEquation,a=this.bodyA,p=this.bodyB,m=this.localAxisA,y=this.localAnchorA,g=this.localAnchorB;e.updateJacobian(),r.rotate(u,m,a.angle),r.rotate(h,y,a.angle),r.add(l,h,a.position),r.rotate(d,g,p.angle),r.add(c,d,p.position);var v=this.position=r.dot(c,u)-r.dot(l,u);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=u[0],b[1]=u[1],b[2]=r.crossLength(u,d),b[3]=-u[0],b[4]=-u[1],b[5]=-r.crossLength(u,h)}if(this.upperLimitEnabled&&v>o)r.scale(i.normalA,u,-1),r.sub(i.contactPointA,l,a.position),r.sub(i.contactPointB,c,p.position),r.scale(f,u,o),r.add(i.contactPointA,i.contactPointA,f),-1===t.indexOf(i)&&t.push(i);else{var _=t.indexOf(i);-1!==_&&t.splice(_,1)}if(this.lowerLimitEnabled&&n>v)r.scale(s.normalA,u,1),r.sub(s.contactPointA,l,a.position),r.sub(s.contactPointB,c,p.position),r.scale(f,u,n),r.sub(s.contactPointB,s.contactPointB,f),-1===t.indexOf(s)&&t.push(s);else{var _=t.indexOf(s);-1!==_&&t.splice(_,1)}},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/PrismaticConstraint.js","/constraints")},{"../equations/ContactEquation":24,"../equations/Equation":25,"../equations/RotationalLockEquation":27,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],22:[function(t,e){(function(){function o(t,e,o){o=o||{},n.call(this,t,e,n.REVOLUTE,o);var f=this.maxForce="undefined"!=typeof o.maxForce?o.maxForce:Number.MAX_VALUE;this.pivotA=a.create(),this.pivotB=a.create(),o.worldPivot?(a.sub(this.pivotA,o.worldPivot,t.position),a.sub(this.pivotB,o.worldPivot,e.position),a.rotate(this.pivotA,this.pivotA,-t.angle),a.rotate(this.pivotB,this.pivotB,-e.angle)):(a.copy(this.pivotA,o.localPivotA),a.copy(this.pivotB,o.localPivotB));var p=this.equations=[new i(t,e,-f,f),new i(t,e,-f,f)],m=p[0],y=p[1],g=this;m.computeGq=function(){return a.rotate(u,g.pivotA,t.angle),a.rotate(l,g.pivotB,e.angle),a.add(d,e.position,l),a.sub(d,d,t.position),a.sub(d,d,u),a.dot(d,c)},y.computeGq=function(){return a.rotate(u,g.pivotA,t.angle),a.rotate(l,g.pivotB,e.angle),a.add(d,e.position,l),a.sub(d,d,t.position),a.sub(d,d,u),a.dot(d,h)},y.minForce=m.minForce=-f,y.maxForce=m.maxForce=f,this.motorEquation=new s(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new r(t,e),this.lowerLimitEquation=new r(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var n=t("./Constraint"),i=t("../equations/Equation"),s=t("../equations/RotationalVelocityEquation"),r=t("../equations/RotationalLockEquation"),a=t("../math/vec2");e.exports=o;var u=a.create(),l=a.create(),c=a.fromValues(1,0),h=a.fromValues(0,1),d=a.create();o.prototype=new n,o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},o.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=this.pivotA,n=this.pivotB,i=this.equations,s=(i[0],i[1],i[0]),r=i[1],d=this.upperLimit,f=this.lowerLimit,p=this.upperLimitEquation,m=this.lowerLimitEquation,y=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&y>d)p.angle=d,-1===i.indexOf(p)&&i.push(p);else{var g=i.indexOf(p);-1!==g&&i.splice(g,1)}if(this.lowerLimitEnabled&&f>y)m.angle=f,-1===i.indexOf(m)&&i.push(m);else{var g=i.indexOf(m);-1!==g&&i.splice(g,1)}a.rotate(u,o,t.angle),a.rotate(l,n,e.angle),s.G[0]=-1,s.G[1]=0,s.G[2]=-a.crossLength(u,c),s.G[3]=1,s.G[4]=0,s.G[5]=a.crossLength(l,c),r.G[0]=0,r.G[1]=-1,r.G[2]=-a.crossLength(u,h),r.G[3]=0,r.G[4]=1,r.G[5]=a.crossLength(l,h)},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.motorIsEnabled=function(){return!!this.motorEnabled},o.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},o.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/RevoluteConstraint.js","/constraints")},{"../equations/Equation":25,"../equations/RotationalLockEquation":27,"../equations/RotationalVelocityEquation":28,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],23:[function(t,e){(function(){function o(t,e,o){o=o||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0,this.ratio="number"==typeof o.ratio?o.ratio:1,this.setRatio(this.ratio)}var n=t("./Equation");t("../math/vec2"),e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},o.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},o.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/AngleLockEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],24:[function(t,e){(function(){function o(t,e){n.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=i.create(),this.penetrationVec=i.create(),this.contactPointB=i.create(),this.normalA=i.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var n=t("./Equation"),i=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeB=function(t,e,o){var n=this.bodyA,s=this.bodyB,r=this.contactPointA,a=this.contactPointB,u=n.position,l=s.position,c=this.penetrationVec,h=this.normalA,d=this.G,f=i.crossLength(r,h),p=i.crossLength(a,h);d[0]=-h[0],d[1]=-h[1],d[2]=-f,d[3]=h[0],d[4]=h[1],d[5]=p,i.add(c,l,a),i.sub(c,c,u),i.sub(c,c,r);var m,y;this.firstImpact&&0!==this.restitution?(y=0,m=1/e*(1+this.restitution)*this.computeGW()):(y=i.dot(h,c)+this.offset,m=this.computeGW());var g=this.computeGiMf(),v=-y*t-m*e-o*g;return v}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/ContactEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],25:[function(t,e){(function(){function o(t,e,n,s){this.minForce="undefined"==typeof n?-Number.MAX_VALUE:n,this.maxForce="undefined"==typeof s?Number.MAX_VALUE:s,this.bodyA=t,this.bodyB=e,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.G=new i.ARRAY_TYPE(6);for(var r=0;6>r;r++)this.G[r]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=o;var n=t("../math/vec2"),i=t("../utils/Utils");t("../objects/Body"),o.prototype.constructor=o,o.DEFAULT_STIFFNESS=1e6,o.DEFAULT_RELAXATION=4,o.prototype.update=function(){var t=this.stiffness,e=this.relaxation,o=this.timeStep;this.a=4/(o*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(o*o*t*(1+4*e)),this.needsUpdate=!1},o.prototype.gmult=function(t,e,o,n,i){return t[0]*e[0]+t[1]*e[1]+t[2]*o+t[3]*n[0]+t[4]*n[1]+t[5]*i},o.prototype.computeB=function(t,e,o){var n=this.computeGW(),i=this.computeGq(),s=this.computeGiMf();return-i*t-n*e-s*o};var s=n.create(),r=n.create();o.prototype.computeGq=function(){var t=this.G,e=this.bodyA,o=this.bodyB,n=(e.position,o.position,e.angle),i=o.angle;return this.gmult(t,s,n,r,i)+this.offset},o.prototype.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,n=e.velocity,i=o.velocity,s=e.angularVelocity,r=o.angularVelocity;return this.gmult(t,n,s,i,r)+this.relativeVelocity},o.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,o=this.bodyB,n=e.vlambda,i=o.vlambda,s=e.wlambda,r=o.wlambda;return this.gmult(t,n,s,i,r)};var a=n.create(),u=n.create();o.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,o=t.force,i=t.angularForce,s=e.force,r=e.angularForce,l=t.invMassSolve,c=e.invMassSolve,h=t.invInertiaSolve,d=e.invInertiaSolve,f=this.G;return n.scale(a,o,l),n.scale(u,s,c),this.gmult(f,a,i*h,u,r*d)},o.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,o=t.invMassSolve,n=e.invMassSolve,i=t.invInertiaSolve,s=e.invInertiaSolve,r=this.G;return r[0]*r[0]*o+r[1]*r[1]*o+r[2]*r[2]*i+r[3]*r[3]*n+r[4]*r[4]*n+r[5]*r[5]*s};var l=n.create(),c=n.create(),h=n.create();n.create(),n.create(),n.create(),o.prototype.addToWlambda=function(t){var e=this.bodyA,o=this.bodyB,i=l,s=c,r=h,a=e.invMassSolve,u=o.invMassSolve,d=e.invInertiaSolve,f=o.invInertiaSolve,p=this.G;s[0]=p[0],s[1]=p[1],r[0]=p[3],r[1]=p[4],n.scale(i,s,a*t),n.add(e.vlambda,e.vlambda,i),e.wlambda+=d*p[2]*t,n.scale(i,r,u*t),n.add(o.vlambda,o.vlambda,i),o.wlambda+=f*p[5]*t},o.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/Equation.js","/equations")},{"../math/vec2":33,"../objects/Body":34,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],26:[function(t,e){(function(){function o(t,e,o){i.call(this,t,e,-o,o),this.contactPointA=n.create(),this.contactPointB=n.create(),this.t=n.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var n=t("../math/vec2"),i=t("./Equation");t("../utils/Utils"),e.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(t,e,o){var i=(this.bodyA,this.bodyB,this.contactPointA),s=this.contactPointB,r=this.t,a=this.G;a[0]=-r[0],a[1]=-r[1],a[2]=-n.crossLength(i,r),a[3]=r[0],a[4]=r[1],a[5]=n.crossLength(s,r);var u=this.computeGW(),l=this.computeGiMf(),c=-u*e-o*l;return c}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/FrictionEquation.js","/equations")},{"../math/vec2":33,"../utils/Utils":52,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],27:[function(t,e){(function(){function o(t,e,o){o=o||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0;var i=this.G;i[2]=1,i[5]=-1}var n=t("./Equation"),i=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.constructor=o;var s=i.create(),r=i.create(),a=i.fromValues(1,0),u=i.fromValues(0,1);o.prototype.computeGq=function(){return i.rotate(s,a,this.bodyA.angle+this.angle),i.rotate(r,u,this.bodyB.angle),i.dot(s,r)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/RotationalLockEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],28:[function(t,e){(function(){function o(t,e){n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var n=t("./Equation");t("../math/vec2"),e.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeB=function(t,e,o){var n=this.G;n[2]=-1,n[5]=this.ratio;var i=this.computeGiMf(),s=this.computeGW(),r=-s*e-o*i;return r}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/RotationalVelocityEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],29:[function(t,e){(function(){var t=function(){};e.exports=t,t.prototype={constructor:t,on:function(t,e,o){e.context=o||this,void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var o=this._listeners;if(e){if(void 0!==o[t]&&-1!==o[t].indexOf(e))return!0}else if(void 0!==o[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var o=this._listeners,n=o[t].indexOf(e);return-1!==n&&o[t].splice(n,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,o=e[t.type];if(void 0!==o){t.target=this;for(var n=0,i=o.length;i>n;n++){var s=o[n];s.call(s.context,t)}}return this}}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/events/EventEmitter.js","/events")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],30:[function(t,e){(function(){function o(t,e,s){if(s=s||{},!(t instanceof n&&e instanceof n))throw new Error("First two arguments must be Material instances.");this.id=o.idCounter++,this.materialA=t,this.materialB=e,this.friction="undefined"!=typeof s.friction?Number(s.friction):.3,this.restitution="undefined"!=typeof s.restitution?Number(s.restitution):0,this.stiffness="undefined"!=typeof s.stiffness?Number(s.stiffness):i.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof s.relaxation?Number(s.relaxation):i.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof s.frictionStiffness?Number(s.frictionStiffness):i.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof s.frictionRelaxation?Number(s.frictionRelaxation):i.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof s.surfaceVelocity?Number(s.surfaceVelocity):0,this.contactSkinSize=.005}var n=t("./Material"),i=t("../equations/Equation");e.exports=o,o.idCounter=0}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/material/ContactMaterial.js","/material")},{"../equations/Equation":25,"./Material":31,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],31:[function(t,e){(function(){function t(e){this.id=e||t.idCounter++}e.exports=t,t.idCounter=0}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/material/Material.js","/material")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],32:[function(t,e){(function(){var t={};t.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,o=0,n=0;e>n;n+=2)o+=(t[n+2]-t[n])*(t[n+1]+t[n+3]);return o+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-o},t.Triangulate=function(e){var o=e.length>>1;if(3>o)return[];for(var n=[],i=[],s=0;o>s;s++)i.push(s);for(var s=0,r=o;r>3;){var a=i[(s+0)%r],u=i[(s+1)%r],l=i[(s+2)%r],c=e[2*a],h=e[2*a+1],d=e[2*u],f=e[2*u+1],p=e[2*l],m=e[2*l+1],y=!1;if(t._convex(c,h,d,f,p,m)){y=!0;for(var g=0;r>g;g++){var v=i[g];if(v!=a&&v!=u&&v!=l&&t._PointInTriangle(e[2*v],e[2*v+1],c,h,d,f,p,m)){y=!1;break}}}if(y)n.push(a,u,l),i.splice((s+1)%r,1),r--,s=0;else if(s++>3*r)break}return n.push(i[0],i[1],i[2]),n},t._PointInTriangle=function(t,e,o,n,i,s,r,a){var u=r-o,l=a-n,c=i-o,h=s-n,d=t-o,f=e-n,p=u*u+l*l,m=u*c+l*h,y=u*d+l*f,g=c*c+h*h,v=c*d+h*f,b=1/(p*g-m*m),_=(g*y-m*v)*b,w=(p*v-m*y)*b;return _>=0&&w>=0&&1>_+w},t._convex=function(t,e,o,n,i,s){return(e-n)*(i-o)+(o-t)*(s-n)>=0},e.exports=t}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/math/polyk.js","/math")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],33:[function(t,e){(function(){var o=e.exports={},n=t("../utils/Utils");o.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},o.crossVZ=function(t,e,n){return o.rotate(t,e,-Math.PI/2),o.scale(t,t,n),t},o.crossZV=function(t,e,n){return o.rotate(t,n,Math.PI/2),o.scale(t,t,e),t},o.rotate=function(t,e,o){if(0!==o){var n=Math.cos(o),i=Math.sin(o),s=e[0],r=e[1];t[0]=n*s-i*r,t[1]=i*s+n*r}else t[0]=e[0],t[1]=e[1]},o.rotate90cw=function(t,e){var o=e[0],n=e[1];t[0]=n,t[1]=-o},o.toLocalFrame=function(t,e,n,i){o.copy(t,e),o.sub(t,t,n),o.rotate(t,t,-i)},o.toGlobalFrame=function(t,e,n,i){o.copy(t,e),o.rotate(t,t,i),o.add(t,t,n)},o.centroid=function(t,e,n,i){return o.add(t,e,n),o.add(t,t,i),o.scale(t,t,1/3),t},o.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},o.fromValues=function(t,e){var o=new n.ARRAY_TYPE(2);return o[0]=t,o[1]=e,o},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},o.set=function(t,e,o){return t[0]=e,t[1]=o,t},o.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t},o.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t},o.sub=o.subtract,o.multiply=function(t,e,o){return t[0]=e[0]*o[0],t[1]=e[1]*o[1],t},o.mul=o.multiply,o.divide=function(t,e,o){return t[0]=e[0]/o[0],t[1]=e[1]/o[1],t},o.div=o.divide,o.scale=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t},o.distance=function(t,e){var o=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(o*o+n*n)},o.dist=o.distance,o.squaredDistance=function(t,e){var o=e[0]-t[0],n=e[1]-t[1];return o*o+n*n},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],o=t[1];return Math.sqrt(e*e+o*o)},o.len=o.length,o.squaredLength=function(t){var e=t[0],o=t[1];return e*e+o*o},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},o.normalize=function(t,e){var o=e[0],n=e[1],i=o*o+n*n;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/math/vec2.js","/math")},{"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],34:[function(t,e){(function(){function o(t){t=t||{},a.call(this),this.id=++o._idCounter,this.world=null,this.shapes=[],this.shapeOffsets=[],this.shapeAngles=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation||!1,this.position=n.fromValues(0,0),t.position&&n.copy(this.position,t.position),this.interpolatedPosition=n.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=n.fromValues(0,0),this.previousAngle=0,this.velocity=n.fromValues(0,0),t.velocity&&n.copy(this.velocity,t.velocity),this.vlambda=n.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=n.create(),t.force&&n.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=o.STATIC,this.type="undefined"!=typeof t.type?t.type:t.mass?o.DYNAMIC:o.STATIC,this.boundingRadius=0,this.aabb=new r,this.aabbNeedsUpdate=!0,this.allowSleep=!0,this.wantsToSleep=!1,this.sleepState=o.AWAKE,this.sleepSpeedLimit=.2,this.sleepTimeLimit=1,this.gravityScale=1,this.timeLastSleepy=0,this.concavePath=null,this.lastDampingScale=1,this.lastAngularDampingScale=1,this.lastDampingTimeStep=-1,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var n=t("../math/vec2"),i=t("poly-decomp"),s=t("../shapes/Convex"),r=t("../collision/AABB"),a=t("../events/EventEmitter");e.exports=o,o.prototype=new a,o._idCounter=0,o.prototype.updateSolveMassProperties=function(){this.sleepState===o.SLEEPING||this.type===o.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},o.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},o.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},o.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var u=new r,l=n.create();o.prototype.updateAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,o=this.shapeAngles,i=t.length,s=l,r=this.angle,a=0;a!==i;a++){var c=t[a],h=o[a]+r;n.rotate(s,e[a],r),n.add(s,s,this.position),c.computeAABB(u,s,h),0===a?this.aabb.copy(u):this.aabb.extend(u)}this.aabbNeedsUpdate=!1},o.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,o=t.length,i=0,s=0;s!==o;s++){var r=t[s],a=n.length(e[s]),u=r.boundingRadius;a+u>i&&(i=a+u)}this.boundingRadius=i},o.prototype.addShape=function(t,e,o){o=o||0,e=e?n.fromValues(e[0],e[1]):n.fromValues(0,0),this.shapes.push(t),this.shapeOffsets.push(e),this.shapeAngles.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},o.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e?(this.shapes.splice(e,1),this.shapeOffsets.splice(e,1),this.shapeAngles.splice(e,1),this.aabbNeedsUpdate=!0,!0):!1},o.prototype.updateMassProperties=function(){if(this.type===o.STATIC||this.type===o.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,s=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var r=0;e>r;r++){var a=t[r],u=n.squaredLength(this.shapeOffsets[r]),l=a.computeMomentOfInertia(i);s+=l+i*u}this.inertia=s,this.invInertia=s>0?1/s:0}this.invMass=1/this.mass}};var c=n.create();o.prototype.applyForce=function(t,e){var o=c;n.sub(o,e,this.position),n.add(this.force,this.force,t);var i=n.crossLength(o,t);this.angularForce+=i},o.prototype.toLocalFrame=function(t,e){n.toLocalFrame(t,e,this.position,this.angle)},o.prototype.toWorldFrame=function(t,e){n.toGlobalFrame(t,e,this.position,this.angle)},o.prototype.fromPolygon=function(t,e){e=e||{};for(var o=this.shapes.length;o>=0;--o)this.removeShape(this.shapes[o]);var r=new i.Polygon;if(r.vertices=t,r.makeCCW(),"number"==typeof e.removeCollinearPoints&&r.removeCollinearPoints(e.removeCollinearPoints),"undefined"==typeof e.skipSimpleCheck&&!r.isSimple())return!1;this.concavePath=r.vertices.slice(0);for(var o=0;o<this.concavePath.length;o++){var a=[0,0];n.copy(a,this.concavePath[o]),this.concavePath[o]=a}var u;u=e.optimalDecomp?r.decomp():r.quickDecomp();for(var l=n.create(),o=0;o!==u.length;o++){for(var c=new s(u[o].vertices),h=0;h!==c.vertices.length;h++){var a=c.vertices[h];n.sub(a,a,c.centerOfMass)}n.scale(l,c.centerOfMass,1),c.updateTriangles(),c.updateCenterOfMass(),c.updateBoundingRadius(),this.addShape(c,l)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var h=(n.fromValues(0,0),n.fromValues(0,0)),d=n.fromValues(0,0),f=n.fromValues(0,0);o.prototype.adjustCenterOfMass=function(){var t=h,e=d,o=f,i=0;n.set(e,0,0);for(var s=0;s!==this.shapes.length;s++){var r=this.shapes[s],a=this.shapeOffsets[s];n.scale(t,a,r.area),n.add(e,e,t),i+=r.area}n.scale(o,e,1/i);for(var s=0;s!==this.shapes.length;s++){var r=this.shapes[s],a=this.shapeOffsets[s];a||(a=this.shapeOffsets[s]=n.create()),n.sub(a,a,o)
}n.add(this.position,this.position,o);for(var s=0;this.concavePath&&s<this.concavePath.length;s++)n.sub(this.concavePath[s],this.concavePath[s],o);this.updateMassProperties(),this.updateBoundingRadius()},o.prototype.setZeroForce=function(){n.set(this.force,0,0),this.angularForce=0},o.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;n.set(e,0,0),t.wlambda=0},o.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;n.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},o.prototype.applyDamping=function(t){if(this.type===o.DYNAMIC){t!==this.lastDampingTimeStep&&(this.lastDampingScale=Math.pow(1-this.damping,t),this.lastAngularDampingScale=Math.pow(1-this.angularDamping,t),this.lastDampingTimeStep=t);var e=this.velocity;n.scale(e,e,this.lastDampingScale),this.angularVelocity*=this.lastAngularDampingScale}},o.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=o.AWAKE,this.idleTime=0,t!==o.AWAKE&&this.emit(o.wakeUpEvent)},o.prototype.sleep=function(){this.sleepState=o.SLEEPING,this.angularVelocity=0,this.angularForce=0,n.set(this.velocity,0,0),n.set(this.force,0,0),this.emit(o.sleepEvent)},o.prototype.sleepTick=function(t,e,i){if(this.allowSleep&&this.type!==o.SLEEPING){this.wantsToSleep=!1;var s=(this.sleepState,n.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),r=Math.pow(this.sleepSpeedLimit,2);s>=r?(this.idleTime=0,this.sleepState=o.AWAKE):(this.idleTime+=i,this.sleepState=o.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},o.prototype.getVelocityFromPosition=function(t,e){return t=t||n.create(),n.sub(t,this.position,this.previousPosition),n.scale(t,t,1/e),t},o.prototype.getAngularVelocityFromPosition=function(t){return(this.angle-this.previousAngle)/t},o.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)},o.sleepyEvent={type:"sleepy"},o.sleepEvent={type:"sleep"},o.wakeUpEvent={type:"wakeup"},o.DYNAMIC=1,o.STATIC=2,o.KINEMATIC=4,o.AWAKE=0,o.SLEEPY=1,o.SLEEPING=2}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/Body.js","/objects")},{"../collision/AABB":11,"../events/EventEmitter":29,"../math/vec2":33,"../shapes/Convex":41,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1,"poly-decomp":9}],35:[function(t,e){(function(){function o(t,e,o){o=o||{},i.call(this,t,e,o),this.localAnchorA=n.fromValues(0,0),this.localAnchorB=n.fromValues(0,0),o.localAnchorA&&n.copy(this.localAnchorA,o.localAnchorA),o.localAnchorB&&n.copy(this.localAnchorB,o.localAnchorB),o.worldAnchorA&&this.setWorldAnchorA(o.worldAnchorA),o.worldAnchorB&&this.setWorldAnchorB(o.worldAnchorB);var s=n.create(),r=n.create();this.getWorldAnchorA(s),this.getWorldAnchorB(r);var a=n.distance(s,r);this.restLength="number"==typeof o.restLength?o.restLength:a}var n=t("../math/vec2"),i=t("./Spring");t("../utils/Utils"),e.exports=o,o.prototype=new i,o.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},o.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},o.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},o.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var s=n.create(),r=n.create(),a=n.create(),u=n.create(),l=n.create(),c=n.create(),h=n.create(),d=n.create(),f=n.create();o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restLength,i=this.bodyA,p=this.bodyB,m=s,y=r,g=a,v=u,b=f,_=l,w=c,E=h,A=d;this.getWorldAnchorA(_),this.getWorldAnchorB(w),n.sub(E,_,i.position),n.sub(A,w,p.position),n.sub(m,w,_);var S=n.len(m);n.normalize(y,m),n.sub(g,p.velocity,i.velocity),n.crossZV(b,p.angularVelocity,A),n.add(g,g,b),n.crossZV(b,i.angularVelocity,E),n.sub(g,g,b),n.scale(v,y,-t*(S-o)-e*n.dot(g,y)),n.sub(i.force,i.force,v),n.add(p.force,p.force,v);var x=n.crossLength(E,v),T=n.crossLength(A,v);i.angularForce-=x,p.angularForce+=T}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/LinearSpring.js","/objects")},{"../math/vec2":33,"../utils/Utils":52,"./Spring":37,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],36:[function(t,e){(function(){function o(t,e,o){o=o||{},n.call(this,t,e,o),this.restAngle="number"==typeof o.restAngle?o.restAngle:e.angle-t.angle}var n=(t("../math/vec2"),t("./Spring"));e.exports=o,o.prototype=new n,o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restAngle,n=this.bodyA,i=this.bodyB,s=i.angle-n.angle,r=i.angularVelocity-n.angularVelocity,a=-t*(s-o)-e*r*0;n.angularForce-=a,i.angularForce+=a}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/RotationalSpring.js","/objects")},{"../math/vec2":33,"./Spring":37,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],37:[function(t,e){(function(){function o(t,e,o){o=n.defaults(o,{stiffness:100,damping:1}),this.stiffness=o.stiffness,this.damping=o.damping,this.bodyA=t,this.bodyB=e}var n=(t("../math/vec2"),t("../utils/Utils"));e.exports=o,o.prototype.applyForce=function(){}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/Spring.js","/objects")},{"../math/vec2":33,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],38:[function(t,e){(function(){e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),GearConstraint:t("./constraints/GearConstraint"),GridBroadphase:t("./collision/GridBroadphase"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Rectangle:t("./shapes/Rectangle"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/p2.js","/")},{"../package.json":10,"./collision/AABB":11,"./collision/Broadphase":12,"./collision/GridBroadphase":13,"./collision/NaiveBroadphase":14,"./collision/Narrowphase":15,"./collision/SAPBroadphase":16,"./constraints/Constraint":17,"./constraints/DistanceConstraint":18,"./constraints/GearConstraint":19,"./constraints/LockConstraint":20,"./constraints/PrismaticConstraint":21,"./constraints/RevoluteConstraint":22,"./equations/AngleLockEquation":23,"./equations/ContactEquation":24,"./equations/Equation":25,"./equations/FrictionEquation":26,"./equations/RotationalVelocityEquation":28,"./events/EventEmitter":29,"./material/ContactMaterial":30,"./material/Material":31,"./math/vec2":33,"./objects/Body":34,"./objects/LinearSpring":35,"./objects/RotationalSpring":36,"./objects/Spring":37,"./shapes/Capsule":39,"./shapes/Circle":40,"./shapes/Convex":41,"./shapes/Heightfield":42,"./shapes/Line":43,"./shapes/Particle":44,"./shapes/Plane":45,"./shapes/Rectangle":46,"./shapes/Shape":47,"./solver/GSSolver":48,"./solver/Solver":49,"./utils/Utils":52,"./world/World":56,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],39:[function(t,e){(function(){function o(t,e){this.length=t||1,this.radius=e||1,n.call(this,n.CAPSULE)}var n=t("./Shape"),i=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.computeMomentOfInertia=function(t){var e=this.radius,o=this.length+e,n=2*e;return t*(n*n+o*o)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var s=i.create();o.prototype.computeAABB=function(t,e,o){var n=this.radius;i.set(s,this.length/2,0),0!==o&&i.rotate(s,s,o),i.set(t.upperBound,Math.max(s[0]+n,-s[0]+n),Math.max(s[1]+n,-s[1]+n)),i.set(t.lowerBound,Math.min(s[0]-n,-s[0]-n),Math.min(s[1]-n,-s[1]-n)),i.add(t.lowerBound,t.lowerBound,e),i.add(t.upperBound,t.upperBound,e)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Capsule.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],40:[function(t,e){(function(){function o(t){this.radius=t||1,n.call(this,n.CIRCLE)}var n=t("./Shape"),i=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},o.prototype.computeAABB=function(t,e){var o=this.radius;i.set(t.upperBound,o,o),i.set(t.lowerBound,-o,-o),e&&(i.add(t.lowerBound,t.lowerBound,e),i.add(t.upperBound,t.upperBound,e))}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Circle.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],41:[function(t,e){(function(){function o(t,e){this.vertices=[],this.axes=[];for(var o=0;o<t.length;o++){var s=i.create();i.copy(s,t[o]),this.vertices.push(s)}if(e)for(var o=0;o<e.length;o++){var r=i.create();i.copy(r,e[o]),this.axes.push(r)}else for(var o=0;o<t.length;o++){var a=t[o],u=t[(o+1)%t.length],l=i.create();i.sub(l,u,a),i.rotate90cw(l,l),i.normalize(l,l),this.axes.push(l)}if(this.centerOfMass=i.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,n.call(this,n.CONVEX),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var n=t("./Shape"),i=t("../math/vec2"),s=t("../math/polyk");t("poly-decomp"),e.exports=o,o.prototype=new n;var r=i.create(),a=i.create();o.prototype.projectOntoLocalAxis=function(t,e){for(var o,n,s=null,a=null,t=r,u=0;u<this.vertices.length;u++)o=this.vertices[u],n=i.dot(o,t),(null===s||n>s)&&(s=n),(null===a||a>n)&&(a=n);if(a>s){var l=a;a=s,s=l}i.set(e,a,s)},o.prototype.projectOntoWorldAxis=function(t,e,o,n){var s=a;this.projectOntoLocalAxis(t,n),0!==o?i.rotate(s,t,o):s=t;var r=i.dot(e,s);i.set(n,n[0]+r,n[1]+r)},o.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var o=this.vertices[e];t.push(o[0],o[1])}for(var n=s.Triangulate(t),e=0;e<n.length;e+=3){var i=n[e],r=n[e+1],a=n[e+2];this.triangles.push([i,r,a])}};var u=i.create(),l=i.create(),c=i.create(),h=i.create(),d=i.create();i.create(),i.create(),i.create(),i.create(),o.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,n=this.centerOfMass,s=u,r=c,a=h,f=d,p=l;i.set(n,0,0);for(var m=0,y=0;y!==t.length;y++){var g=t[y],r=e[g[0]],a=e[g[1]],f=e[g[2]];i.centroid(s,r,a,f);var v=o.triangleArea(r,a,f);m+=v,i.scale(p,s,v),i.add(n,n,p)}i.scale(n,n,1/m)},o.prototype.computeMomentOfInertia=function(t){for(var e=0,o=0,n=this.vertices.length,s=n-1,r=0;n>r;s=r,r++){var a=this.vertices[s],u=this.vertices[r],l=Math.abs(i.crossLength(a,u)),c=i.dot(u,u)+i.dot(u,a)+i.dot(a,a);e+=l*c,o+=l}return t/6*(e/o)},o.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,o=0;o!==t.length;o++){var n=i.squaredLength(t[o]);n>e&&(e=n)}this.boundingRadius=Math.sqrt(e)},o.triangleArea=function(t,e,o){return.5*((e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1]))},o.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,n=0;n!==t.length;n++){var i=t[n],s=e[i[0]],r=e[i[1]],a=e[i[2]],u=o.triangleArea(s,r,a);this.area+=u}},o.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Convex.js","/shapes")},{"../math/polyk":32,"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1,"poly-decomp":9}],42:[function(t,e){(function(){function o(t,e){if(e=i.defaults(e,{maxValue:null,minValue:null,elementWidth:.1}),null===e.minValue||null===e.maxValue){e.maxValue=t[0],e.minValue=t[0];for(var o=0;o!==t.length;o++){var s=t[o];s>e.maxValue&&(e.maxValue=s),s<e.minValue&&(e.minValue=s)}}this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementWidth=e.elementWidth,n.call(this,n.HEIGHTFIELD)}var n=t("./Shape"),i=(t("../math/vec2"),t("../utils/Utils"));e.exports=o,o.prototype=new n,o.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){for(var t=this.data,e=0,o=0;o<t.length-1;o++)e+=(t[o]+t[o+1])/2*this.elementWidth;this.area=e},o.prototype.computeAABB=function(t,e){t.upperBound[0]=this.elementWidth*this.data.length+e[0],t.upperBound[1]=this.maxValue+e[1],t.lowerBound[0]=e[0],t.lowerBound[1]=-Number.MAX_VALUE}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Heightfield.js","/shapes")},{"../math/vec2":33,"../utils/Utils":52,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],43:[function(t,e){(function(){function o(t){this.length=t||1,n.call(this,n.LINE)}var n=t("./Shape"),i=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var s=[i.create(),i.create()];o.prototype.computeAABB=function(t,e,o){var n=this.length/2;i.set(s[0],-n,0),i.set(s[1],n,0),t.setFromPoints(s,e,o,0)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Line.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],44:[function(t,e){(function(){function o(){n.call(this,n.PARTICLE)}var n=t("./Shape"),i=t("../math/vec2");e.exports=o,o.prototype=new n,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=0},o.prototype.computeAABB=function(t,e){i.copy(t.lowerBound,e),i.copy(t.upperBound,e)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Particle.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],45:[function(t,e){(function(){function o(){n.call(this,n.PLANE)}var n=t("./Shape"),i=t("../math/vec2");t("../utils/Utils"),e.exports=o,o.prototype=new n,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(t,e,o){var n=0,s=i.set;"number"==typeof o&&(n=o%(2*Math.PI)),0===n?(s(t.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),s(t.upperBound,Number.MAX_VALUE,0)):n===Math.PI/2?(s(t.lowerBound,0,-Number.MAX_VALUE),s(t.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):n===Math.PI?(s(t.lowerBound,-Number.MAX_VALUE,0),s(t.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):n===3*Math.PI/2?(s(t.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),s(t.upperBound,0,Number.MAX_VALUE)):(s(t.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),s(t.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)),i.add(t.lowerBound,t.lowerBound,e),i.add(t.upperBound,t.upperBound,e)},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Plane.js","/shapes")},{"../math/vec2":33,"../utils/Utils":52,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],46:[function(t,e){(function(){function o(t,e){this.width=t||1,this.height=e||1;var o=[n.fromValues(-t/2,-e/2),n.fromValues(t/2,-e/2),n.fromValues(t/2,e/2),n.fromValues(-t/2,e/2)],r=[n.fromValues(1,0),n.fromValues(0,1)];s.call(this,o,r),this.type=i.RECTANGLE}var n=t("../math/vec2"),i=t("./Shape"),s=t("./Convex");e.exports=o,o.prototype=new s([]),o.prototype.computeMomentOfInertia=function(t){var e=this.width,o=this.height;return t*(o*o+e*e)/12},o.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},n.create(),n.create(),n.create(),n.create(),o.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)},o.prototype.updateArea=function(){this.area=this.width*this.height}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Rectangle.js","/shapes")},{"../math/vec2":33,"./Convex":41,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],47:[function(t,e){(function(){function t(e){this.type=e,this.id=t.idCounter++,this.boundingRadius=0,this.collisionGroup=1,this.collisionMask=1,e&&this.updateBoundingRadius(),this.material=null,this.area=0,this.sensor=!1,this.updateArea()}e.exports=t,t.idCounter=0,t.CIRCLE=1,t.PARTICLE=2,t.PLANE=4,t.CONVEX=8,t.LINE=16,t.RECTANGLE=32,t.CAPSULE=64,t.HEIGHTFIELD=128,t.prototype.computeMomentOfInertia=function(){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")},t.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")},t.prototype.updateArea=function(){},t.prototype.computeAABB=function(){}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Shape.js","/shapes")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],48:[function(t,e){(function(){function o(t){s.call(this,t,s.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-10,this.arrayStep=30,this.lambda=new r.ARRAY_TYPE(this.arrayStep),this.Bs=new r.ARRAY_TYPE(this.arrayStep),this.invCs=new r.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function n(t){for(var e=t.length;e--;)t[e]=0}var i=t("../math/vec2"),s=t("./Solver"),r=t("../utils/Utils"),a=t("../equations/FrictionEquation");e.exports=o,o.prototype=new s,o.prototype.solve=function(t,e){this.sortEquations();var s=0,u=this.iterations,l=this.frictionIterations,c=this.equations,h=c.length,d=Math.pow(this.tolerance*h,2),f=e.bodies,p=e.bodies.length,m=(i.add,i.set,this.useZeroRHS),y=this.lambda;if(this.usedIterations=0,h)for(var g=0;g!==p;g++){var v=f[g];v.updateSolveMassProperties()}y.length<h&&(y=this.lambda=new r.ARRAY_TYPE(h+this.arrayStep),this.Bs=new r.ARRAY_TYPE(h+this.arrayStep),this.invCs=new r.ARRAY_TYPE(h+this.arrayStep)),n(y);for(var b=this.invCs,_=this.Bs,y=this.lambda,g=0;g!==c.length;g++){var w=c[g];(w.timeStep!==t||w.needsUpdate)&&(w.timeStep=t,w.update()),_[g]=w.computeB(w.a,w.b,t),b[g]=w.computeInvC(w.epsilon)}var w,E,g,A;if(0!==h){for(g=0;g!==p;g++){var v=f[g];v.resetConstraintVelocity()}if(l){for(s=0;s!==l;s++){for(E=0,A=0;A!==h;A++){w=c[A];var S=o.iterateEquation(A,w,w.epsilon,_,b,y,m,t,s);E+=Math.abs(S)}if(this.usedIterations++,d>=E*E)break}for(o.updateMultipliers(c,y,1/t),A=0;A!==h;A++){var x=c[A];if(x instanceof a){for(var T=0,B=0;B!==x.contactEquations.length;B++)T+=x.contactEquations[B].multiplier;T*=x.frictionCoefficient/x.contactEquations.length,x.maxForce=T,x.minForce=-T}}}for(s=0;s!==u;s++){for(E=0,A=0;A!==h;A++){w=c[A];var S=o.iterateEquation(A,w,w.epsilon,_,b,y,m,t,s);E+=Math.abs(S)}if(this.usedIterations++,d>=E*E)break}for(g=0;g!==p;g++)f[g].addConstraintVelocity();o.updateMultipliers(c,y,1/t)}},o.updateMultipliers=function(t,e,o){for(var n=t.length;n--;)t[n].multiplier=e[n]*o},o.iterateEquation=function(t,e,o,n,i,s,r,a){var u=n[t],l=i[t],c=s[t],h=e.computeGWlambda(),d=e.maxForce,f=e.minForce;r&&(u=0);var p=l*(u-h-o*c),m=c+p;return f*a>m?p=f*a-c:m>d*a&&(p=d*a-c),s[t]+=p,e.addToWlambda(p),p}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/solver/GSSolver.js","/solver")},{"../equations/FrictionEquation":26,"../math/vec2":33,"../utils/Utils":52,"./Solver":49,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],49:[function(t,e){(function(){function o(t,e){t=t||{},n.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var n=(t("../utils/Utils"),t("../events/EventEmitter"));e.exports=o,o.prototype=new n,o.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var i={bodies:[]};o.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),i.bodies.length=0,e.getBodies(i.bodies),i.bodies.length&&this.solve(t,i))},o.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},o.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},o.prototype.addEquations=function(t){for(var e=0,o=t.length;e!==o;e++){var n=t[e];n.enabled&&this.equations.push(n)}},o.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},o.prototype.removeAllEquations=function(){this.equations.length=0},o.GS=1,o.ISLAND=2}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/solver/Solver.js","/solver")},{"../events/EventEmitter":29,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],50:[function(t,e){(function(){function o(){this.overlappingShapesLastState=new i,this.overlappingShapesCurrentState=new i,this.recordPool=[],this.tmpDict=new i,this.tmpArray1=[]}function n(t,e,o,n){this.shapeA=e,this.shapeB=n,this.bodyA=t,this.bodyB=o}var i=t("./TupleDictionary");t("./Utils"),e.exports=o,o.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,o=t.keys.length;o--;){var n=t.keys[o],i=t.getByKey(n),s=e.getByKey(n);i&&!s&&this.recordPool.push(i)}t.reset(),t.copy(e),e.reset()},o.prototype.setOverlapping=function(t,e,o,i){var s=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!s.get(e.id,i.id)){var r;this.recordPool.length?(r=this.recordPool.pop(),r.set(t,e,o,i)):r=new n(t,e,o,i),s.set(e.id,i.id,r)}},o.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},o.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},o.prototype.bodiesAreOverlapping=function(t,e){for(var o=this.overlappingShapesCurrentState,n=o.keys.length;n--;){var i=o.keys[n],s=o.data[i];if(s.bodyA===t&&s.bodyB===e||s.bodyA===e&&s.bodyB===t)return!0}return!1},o.prototype.getDiff=function(t,e,o){var o=o||[],n=t,i=e;o.length=0;for(var s=i.keys.length;s--;){var r=i.keys[s],a=i.data[r];if(!a)throw new Error("Key "+r+" had no data!");var u=n.data[r];u||o.push(a)}return o},o.prototype.isNewOverlap=function(t,e){var o=0|t.id,n=0|e.id,i=this.overlappingShapesLastState,s=this.overlappingShapesCurrentState;return!i.get(o,n)&&!!s.get(o,n)},o.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getBodyDiff=function(t,e){e=e||[];for(var o=this.tmpDict,n=t.length;n--;){var i=t[n];o.set(0|i.bodyA.id,0|i.bodyB.id,i)}for(n=o.keys.length;n--;){var i=o.getByKey(o.keys[n]);i&&e.push(i.bodyA,i.bodyB)}return o.reset(),e},n.prototype.set=function(t,e,o,i){n.call(this,t,e,o,i)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/utils/OverlapKeeper.js","/utils")},{"./TupleDictionary":51,"./Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],51:[function(t,e){(function(){function o(){this.data={},this.keys=[]}var n=t("./Utils");e.exports=o,o.prototype.getKey=function(t,e){return t=0|t,e=0|e,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},o.prototype.getByKey=function(t){return t=0|t,this.data[t]},o.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},o.prototype.set=function(t,e,o){if(!o)throw new Error("No data!");var n=this.getKey(t,e);return this.data[n]||this.keys.push(n),this.data[n]=o,n},o.prototype.reset=function(){for(var t=this.data,e=this.keys,o=e.length;o--;)delete t[e[o]];e.length=0},o.prototype.copy=function(t){this.reset(),n.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var o=t.keys[e];this.data[o]=t.data[o]}}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/utils/TupleDictionary.js","/utils")},{"./Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],52:[function(t,e){(function(){function t(){}e.exports=t,t.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var o=0,n=e.length;o!==n;++o)t.push(e[o])},t.splice=function(t,e,o){o=o||1;for(var n=e,i=t.length-o;i>n;n++)t[n]=t[n+o];t.length=i},t.ARRAY_TYPE="undefined"!=typeof P2_ARRAY_TYPE?P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?Float32Array:Array,t.extend=function(t,e){for(var o in e)t[o]=e[o]},t.defaults=function(t,e){t=t||{};for(var o in e)o in t||(t[o]=e[o]);return t}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/utils/Utils.js","/utils")
},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],53:[function(t,e){(function(){function o(){this.equations=[],this.bodies=[]}var n=t("../objects/Body");e.exports=o,o.prototype.reset=function(){this.equations.length=this.bodies.length=0};var i=[];o.prototype.getBodies=function(t){var e=t||[],o=this.equations;i.length=0;for(var n=0;n!==o.length;n++){var s=o[n];-1===i.indexOf(s.bodyA.id)&&(e.push(s.bodyA),i.push(s.bodyA.id)),-1===i.indexOf(s.bodyB.id)&&(e.push(s.bodyB),i.push(s.bodyB.id))}return e},o.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===n.DYNAMIC&&!e.wantsToSleep)return!1}return!0},o.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return!0}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/Island.js","/world")},{"../objects/Body":34,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],54:[function(t,e){(function(){function o(){this._nodePool=[],this._islandPool=[],this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var n=(t("../math/vec2"),t("./Island")),i=t("./IslandNode"),s=t("../objects/Body");e.exports=o,o.getUnvisitedNode=function(t){for(var e=t.length,o=0;o!==e;o++){var n=t[o];if(!n.visited&&n.body.type===s.DYNAMIC)return n}return!1},o.prototype.visit=function(t,e,o){e.push(t.body);for(var n=t.equations.length,i=0;i!==n;i++){var s=t.equations[i];-1===o.indexOf(s)&&o.push(s)}},o.prototype.bfs=function(t,e,n){var i=this.queue;for(i.length=0,i.push(t),t.visited=!0,this.visit(t,e,n);i.length;)for(var r,a=i.pop();r=o.getUnvisitedNode(a.neighbors);)r.visited=!0,this.visit(r,e,n),r.body.type===s.DYNAMIC&&i.push(r)},o.prototype.split=function(t){for(var e=t.bodies,s=this.nodes,r=this.equations;s.length;)this._nodePool.push(s.pop());for(var a=0;a!==e.length;a++)if(this._nodePool.length){var u=this._nodePool.pop();u.reset(),u.body=e[a],s.push(u)}else s.push(new i(e[a]));for(var l=0;l!==r.length;l++){var c=r[l],a=e.indexOf(c.bodyA),h=e.indexOf(c.bodyB),d=s[a],f=s[h];d.neighbors.push(f),f.neighbors.push(d),d.equations.push(c),f.equations.push(c)}for(var p=this.islands;p.length;){var m=p.pop();m.reset(),this._islandPool.push(m)}for(var y;y=o.getUnvisitedNode(s);){var m=this._islandPool.length?this._islandPool.pop():new n;this.bfs(y,m.bodies,m.equations),p.push(m)}return p}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/IslandManager.js","/world")},{"../math/vec2":33,"../objects/Body":34,"./Island":53,"./IslandNode":55,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],55:[function(t,e){(function(){function t(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=t,t.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/IslandNode.js","/world")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],56:[function(t,e){(function(){function o(t){h.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new n,this.narrowphase=new m(this),this.islandManager=new v,this.gravity=s.fromValues(0,-9.78),t.gravity&&s.copy(this.gravity,t.gravity),this.frictionGravity=s.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.doProfiling=t.doProfiling||!1,this.lastStepTime=0,this.broadphase=t.broadphase||new i,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new f,this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.fixedStepTime=0,this.islandSplit="undefined"!=typeof t.islandSplit?!!t.islandSplit:!1,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=o.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new g}var n=t("../solver/GSSolver"),i=(t("../solver/Solver"),t("../collision/NaiveBroadphase")),s=t("../math/vec2"),r=t("../shapes/Circle"),a=(t("../shapes/Rectangle"),t("../shapes/Convex")),u=(t("../shapes/Line"),t("../shapes/Plane")),l=t("../shapes/Capsule"),c=t("../shapes/Particle"),h=t("../events/EventEmitter"),d=t("../objects/Body"),f=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),p=t("../material/ContactMaterial"),m=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/SAPBroadphase"),t("../collision/Narrowphase")),y=t("../utils/Utils"),g=t("../utils/OverlapKeeper"),v=t("./IslandManager");if(t("../objects/RotationalSpring"),e.exports=o,"undefined"==typeof performance&&(performance={}),!performance.now){var b=Date.now();performance.timing&&performance.timing.navigationStart&&(b=performance.timing.navigationStart),performance.now=function(){return Date.now()-b}}o.prototype=new Object(h.prototype),o.NO_SLEEPING=1,o.BODY_SLEEPING=2,o.ISLAND_SLEEPING=4,o.prototype.addConstraint=function(t){this.constraints.push(t)},o.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},o.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&y.splice(this.contactMaterials,e,1)},o.prototype.getContactMaterial=function(t,e){for(var o=this.contactMaterials,n=0,i=o.length;n!==i;n++){var s=o[n];if(s.materialA.id===t.id&&s.materialB.id===e.id||s.materialA.id===e.id&&s.materialB.id===t.id)return s}return!1},o.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&y.splice(this.constraints,e,1)};var _=(s.create(),s.create(),s.create(),s.create(),s.create(),s.create(),s.create()),w=s.fromValues(0,0),E=s.fromValues(0,0),A=(s.fromValues(0,0),s.fromValues(0,0));o.prototype.step=function(t,e,o){if(o=o||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{var n=Math.floor((this.time+e)/t)-Math.floor(this.time/t);n=Math.min(n,o);for(var i=performance.now(),r=0;r!==n&&(this.internalStep(t),!(performance.now()-i>1e3*t));r++);this.time+=e;for(var a=this.time%t,u=a/t,l=0;l!==this.bodies.length;l++){var c=this.bodies[l];c.type!==d.STATIC&&c.sleepState!==d.SLEEPING?(s.sub(A,c.position,c.previousPosition),s.scale(A,A,u),s.add(c.interpolatedPosition,c.position,A),c.interpolatedAngle=c.angle+(c.angle-c.previousAngle)*u):(s.copy(c.interpolatedPosition,c.position),c.interpolatedAngle=c.angle)}}};var S=[];o.prototype.internalStep=function(t){this.stepping=!0;var e,n,i=this,r=this.doProfiling,a=this.springs.length,u=this.springs,l=this.bodies,c=this.gravity,h=this.solver,f=this.bodies.length,p=this.broadphase,m=this.narrowphase,g=this.constraints,v=_,b=(s.scale,s.add),w=(s.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,r&&(e=performance.now()),this.useWorldGravityAsFrictionGravity){var E=s.length(this.gravity);0===E&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=E)}if(this.applyGravity)for(var A=0;A!==f;A++){var x=l[A],T=x.force;x.type===d.DYNAMIC&&x.sleepState!==d.SLEEPING&&(s.scale(v,c,x.mass*x.gravityScale),b(T,T,v))}if(this.applySpringForces)for(var A=0;A!==a;A++){var B=u[A];B.applyForce()}if(this.applyDamping)for(var A=0;A!==f;A++){var x=l[A];x.type===d.DYNAMIC&&x.applyDamping(t)}for(var C=p.getCollisionPairs(this),L=this.disabledBodyCollisionPairs,A=L.length-2;A>=0;A-=2)for(var M=C.length-2;M>=0;M-=2)(L[A]===C[M]&&L[A+1]===C[M+1]||L[A+1]===C[M]&&L[A]===C[M+1])&&C.splice(M,2);var P=g.length;for(A=0;A!==P;A++){var I=g[A];if(!I.collideConnected)for(var M=C.length-2;M>=0;M-=2)(I.bodyA===C[M]&&I.bodyB===C[M+1]||I.bodyB===C[M]&&I.bodyA===C[M+1])&&C.splice(M,2)}this.postBroadphaseEvent.pairs=C,this.emit(this.postBroadphaseEvent),m.reset(this);for(var A=0,O=C.length;A!==O;A+=2)for(var R=C[A],q=C[A+1],N=0,j=R.shapes.length;N!==j;N++)for(var U=R.shapes[N],F=R.shapeOffsets[N],k=R.shapeAngles[N],D=0,V=q.shapes.length;D!==V;D++){var G=q.shapes[D],X=q.shapeOffsets[D],Y=q.shapeAngles[D],H=this.defaultContactMaterial;if(U.material&&G.material){var W=this.getContactMaterial(U.material,G.material);W&&(H=W)}this.runNarrowphase(m,R,U,F,k,q,G,X,Y,H,this.frictionGravity)}for(var A=0;A!==f;A++){var z=l[A];z._wakeUpAfterNarrowphase&&(z.wakeUp(),z._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(S);for(var K=this.endContactEvent,D=S.length;D--;){var Q=S[D];K.shapeA=Q.shapeA,K.shapeB=Q.shapeB,K.bodyA=Q.bodyA,K.bodyB=Q.bodyA,this.emit(K)}}var J=this.preSolveEvent;J.contactEquations=m.contactEquations,J.frictionEquations=m.frictionEquations,this.emit(J);var P=g.length;for(A=0;A!==P;A++)g[A].update();if(m.contactEquations.length||m.frictionEquations.length||g.length)if(this.islandSplit){for(w.equations.length=0,y.appendArray(w.equations,m.contactEquations),y.appendArray(w.equations,m.frictionEquations),A=0;A!==P;A++)y.appendArray(w.equations,g[A].equations);w.split(this);for(var A=0;A!==w.islands.length;A++){var Z=w.islands[A];Z.equations.length&&h.solveIsland(t,Z)}}else{for(h.addEquations(m.contactEquations),h.addEquations(m.frictionEquations),A=0;A!==P;A++)h.addEquations(g[A].equations);this.solveConstraints&&h.solve(t,this),h.removeAllEquations()}for(var A=0;A!==f;A++){var z=l[A];z.sleepState!==d.SLEEPING&&z.type!==d.STATIC&&o.integrateBody(z,t)}for(var A=0;A!==f;A++)l[A].setZeroForce();if(r&&(n=performance.now(),i.lastStepTime=n-e),this.emitImpactEvent&&this.has("impact"))for(var $=this.impactEvent,A=0;A!==m.contactEquations.length;A++){var te=m.contactEquations[A];te.firstImpact&&($.bodyA=te.bodyA,$.bodyB=te.bodyB,$.shapeA=te.shapeA,$.shapeB=te.shapeB,$.contactEquation=te,this.emit($))}if(this.sleepMode===o.BODY_SLEEPING)for(A=0;A!==f;A++)l[A].sleepTick(this.time,!1,t);else if(this.sleepMode===o.ISLAND_SLEEPING&&this.islandSplit){for(A=0;A!==f;A++)l[A].sleepTick(this.time,!0,t);for(var A=0;A<this.islandManager.islands.length;A++){var Z=this.islandManager.islands[A];Z.wantsToSleep()&&Z.sleep()}}if(this.stepping=!1,this.bodiesToBeRemoved.length){for(var A=0;A!==this.bodiesToBeRemoved.length;A++)this.removeBody(this.bodiesToBeRemoved[A]);this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};var x=s.create(),T=s.create();o.integrateBody=function(t,e){var o=t.invMass,n=t.force,i=t.position,r=t.velocity;s.copy(t.previousPosition,t.position),t.previousAngle=t.angle,t.fixedRotation||(t.angularVelocity+=t.angularForce*t.invInertia*e,t.angle+=t.angularVelocity*e),s.scale(x,n,e*o),s.add(r,x,r),s.scale(T,r,e),s.add(i,i,T),t.aabbNeedsUpdate=!0},o.prototype.runNarrowphase=function(t,e,o,n,i,r,a,u,l,c,h){if(0!==(o.collisionGroup&a.collisionMask)&&0!==(a.collisionGroup&o.collisionMask)){s.rotate(w,n,e.angle),s.rotate(E,u,r.angle),s.add(w,w,e.position),s.add(E,E,r.position);var f=i+e.angle,p=l+r.angle;t.enableFriction=c.friction>0,t.frictionCoefficient=c.friction;var m;m=e.type===d.STATIC||e.type===d.KINEMATIC?r.mass:r.type===d.STATIC||r.type===d.KINEMATIC?e.mass:e.mass*r.mass/(e.mass+r.mass),t.slipForce=c.friction*h*m,t.restitution=c.restitution,t.surfaceVelocity=c.surfaceVelocity,t.frictionStiffness=c.frictionStiffness,t.frictionRelaxation=c.frictionRelaxation,t.stiffness=c.stiffness,t.relaxation=c.relaxation,t.contactSkinSize=c.contactSkinSize;var y=t[o.type|a.type],g=0;if(y){var v=o.sensor||a.sensor,b=t.frictionEquations.length;g=o.type<a.type?y.call(t,e,o,w,f,r,a,E,p,v):y.call(t,r,a,E,p,e,o,w,f,v);var _=t.frictionEquations.length-b;if(g){if(e.allowSleep&&e.type===d.DYNAMIC&&e.sleepState===d.SLEEPING&&r.sleepState===d.AWAKE&&r.type!==d.STATIC){var A=s.squaredLength(r.velocity)+Math.pow(r.angularVelocity,2),S=Math.pow(r.sleepSpeedLimit,2);A>=2*S&&(e._wakeUpAfterNarrowphase=!0)}if(r.allowSleep&&r.type===d.DYNAMIC&&r.sleepState===d.SLEEPING&&e.sleepState===d.AWAKE&&e.type!==d.STATIC){var x=s.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2),T=Math.pow(e.sleepSpeedLimit,2);x>=2*T&&(r._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,o,r,a),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(o,a)){var B=this.beginContactEvent;if(B.shapeA=o,B.shapeB=a,B.bodyA=e,B.bodyB=r,B.contactEquations.length=0,"number"==typeof g)for(var C=t.contactEquations.length-g;C<t.contactEquations.length;C++)B.contactEquations.push(t.contactEquations[C]);this.emit(B)}if("number"==typeof g&&_>1)for(var C=t.frictionEquations.length-_;C<t.frictionEquations.length;C++){var L=t.frictionEquations[C];L.setSlipForce(L.getSlipForce()/_)}}}}},o.prototype.addSpring=function(t){this.springs.push(t),this.addSpringEvent.spring=t,this.emit(this.addSpringEvent)},o.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&y.splice(this.springs,e,1)},o.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(this.bodies.push(t),t.world=this,this.addBodyEvent.body=t,this.emit(this.addBodyEvent))},o.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(y.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent))}},o.prototype.getBodyById=function(t){for(var e=this.bodies,o=0;o<e.length;o++){var n=e[o];if(n.id===t)return n}return!1},o.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},o.prototype.enableBodyCollision=function(t,e){for(var o=this.disabledBodyCollisionPairs,n=0;n<o.length;n+=2)if(o[n]===t&&o[n+1]===e||o[n+1]===t&&o[n]===e)return void o.splice(n,2)},o.prototype.clear=function(){this.time=0,this.fixedStepTime=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);for(var n=this.bodies,e=n.length-1;e>=0;e--)this.removeBody(n[e]);for(var i=this.springs,e=i.length-1;e>=0;e--)this.removeSpring(i[e]);for(var s=this.contactMaterials,e=s.length-1;e>=0;e--)this.removeContactMaterial(s[e]);o.apply(this)},o.prototype.clone=function(){var t=new o;return t.fromJSON(this.toJSON()),t};var B=s.create(),C=s.fromValues(0,0),L=s.fromValues(0,0);o.prototype.hitTest=function(t,e,o){o=o||0;var n=new d({position:t}),i=new c,h=t,f=0,p=B,m=C,y=L;n.addShape(i);for(var g=this.narrowphase,v=[],b=0,_=e.length;b!==_;b++)for(var w=e[b],E=0,A=w.shapes.length;E!==A;E++){var S=w.shapes[E],x=w.shapeOffsets[E]||m,T=w.shapeAngles[E]||0;s.rotate(p,x,w.angle),s.add(p,p,w.position);var M=T+w.angle;(S instanceof r&&g.circleParticle(w,S,p,M,n,i,h,f,!0)||S instanceof a&&g.particleConvex(n,i,h,f,w,S,p,M,!0)||S instanceof u&&g.particlePlane(n,i,h,f,w,S,p,M,!0)||S instanceof l&&g.particleCapsule(n,i,h,f,w,S,p,M,!0)||S instanceof c&&s.squaredLength(s.sub(y,p,t))<o*o)&&v.push(w)}return v},o.prototype.setGlobalEquationParameters=function(t){t=t||{};for(var e=0;e!==this.constraints.length;e++)for(var o=this.constraints[e],n=0;n!==o.equations.length;n++){var i=o.equations[n];"undefined"!=typeof t.stiffness&&(i.stiffness=t.stiffness),"undefined"!=typeof t.relaxation&&(i.relaxation=t.relaxation),i.needsUpdate=!0}for(var e=0;e!==this.contactMaterials.length;e++){var o=this.contactMaterials[e];"undefined"!=typeof t.stiffness&&(o.stiffness=t.stiffness,o.frictionStiffness=t.stiffness),"undefined"!=typeof t.relaxation&&(o.relaxation=t.relaxation,o.frictionRelaxation=t.relaxation)}var o=this.defaultContactMaterial;"undefined"!=typeof t.stiffness&&(o.stiffness=t.stiffness,o.frictionStiffness=t.stiffness),"undefined"!=typeof t.relaxation&&(o.relaxation=t.relaxation,o.frictionRelaxation=t.relaxation)},o.prototype.setGlobalStiffness=function(t){this.setGlobalEquationParameters({stiffness:t})},o.prototype.setGlobalRelaxation=function(t){this.setGlobalEquationParameters({relaxation:t})}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/World.js","/world")},{"../../package.json":10,"../collision/Broadphase":12,"../collision/NaiveBroadphase":14,"../collision/Narrowphase":15,"../collision/SAPBroadphase":16,"../constraints/Constraint":17,"../constraints/DistanceConstraint":18,"../constraints/GearConstraint":19,"../constraints/LockConstraint":20,"../constraints/PrismaticConstraint":21,"../constraints/RevoluteConstraint":22,"../events/EventEmitter":29,"../material/ContactMaterial":30,"../material/Material":31,"../math/vec2":33,"../objects/Body":34,"../objects/LinearSpring":35,"../objects/RotationalSpring":36,"../shapes/Capsule":39,"../shapes/Circle":40,"../shapes/Convex":41,"../shapes/Line":43,"../shapes/Particle":44,"../shapes/Plane":45,"../shapes/Rectangle":46,"../shapes/Shape":47,"../solver/GSSolver":48,"../solver/Solver":49,"../utils/OverlapKeeper":50,"../utils/Utils":52,"./IslandManager":54,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}]},{},[38])(38)}),soya2d.Physics=function(t){function e(){i=[],s=[]}function o(t,e){if(t){t.sort(function(t,e){return t.order-e.order});for(var o=n.scene,a=t.length;a--;){var u=t[a].context,l=null,c=null;if(u instanceof soya2d.DisplayObject&&u!=o&&("contactstart"==e||"contactend"==e)){for(var l="contactstart"==e?i:s,h=!1,d=l.length;d--;){var f=l[d];if(f.a==u||f.b==u){h=!0,c=f.a==u?f.b:f.a;break}}if(!h)continue}r.collisionPairs=l,r.otherCollider=c,t[a].fn.call(u,r)}}}t=t||{},t.gravity=t.gravity||[0,9.8],t.friction=t.friction||1,t.bounce=t.bounce||.5,t.stiffness=t.stiffness||1e5,t.relaxation=t.relaxation||20,t.tolerance=t.tolerance||.01,this.world=new p2.World(t),this.world.defaultContactMaterial.friction=1,this.world.defaultContactMaterial.restitution=t.bounce,this.world.defaultContactMaterial.stiffness=t.stiffness,this.world.defaultContactMaterial.relaxation=t.relaxation,this.world.solver.tolerance=t.tolerance;var n,i=[],s=[];this.startListen=function(t){return n=t,this.world.on("beginContact",function(t){i.push({a:t.bodyA.ro,b:t.bodyB.ro})},this),this.world.on("endContact",function(t){s.push({a:t.bodyA.ro,b:t.bodyB.ro})},this),this},this.stopListen=function(){return this},this.scan=function(){if(i.length>0){var t=this.__eventMap.contactstart;o(t,"contactstart")}if(s.length>0){var t=this.__eventMap.contactend;o(t,"contactend")}e()};var r={collisionPairs:null,otherCollider:null};this.bind=function(t,e){e=e||{};var o,n=0,i=0;if(n=t.w/2,i=t.h/2,t.bounds instanceof soya2d.Rectangle)o=new p2.Rectangle(t.w,t.h);else if(t.bounds instanceof soya2d.Circle)o=new p2.Circle(t.bounds.r);else if(t.bounds instanceof soya2d.Polygon){for(var s=t.bounds.vtx,r=[],a=0;a<s.length;a+=2)r.push([s[a]-n,s[a+1]-i]);o=new p2.Convex(r)}switch(e.mass=0===e.mass?0:e.mass||1,e.sensor=e.sensor||!1,e.position=[t.x+n,t.y+i],e.angularVelocity=e.angularVelocity||0,e.fixedRotation=e.fixedRotation||!1,e.type){case soya2d.PHY_STATIC:e.type=p2.Body.STATIC;break;case soya2d.PHY_DYNAMIC:default:0==e.mass&&(e.type=p2.Body.KINEMATIC)}var u=new p2.Body(e);o.sensor=e.sensor,u.addShape(o),this.world.addBody(u),t.body=u,u.ro=t},this.unbind=function(t){this.world.removeBody(t.body),t.body=null,delete t.body},this.update=function(t){this.world.step(t);for(var e=this.world.bodies.length;e--;){var o=this.world.bodies[e],n=o.ro;if(n&&!isNaN(o.position[0])){var i=0,s=0;i=n.w/2,s=n.h/2,n.x=o.position[0]-i,n.y=o.position[1]-s,n.rotation=180*o.angle/Math.PI}}},soya2d.EventHandler.call(this)},soya2d.inherits(soya2d.Physics,soya2d.EventHandler),soya2d.PHY_STATIC=1,soya2d.PHY_DYNAMIC=2,soya2d.EVENT_CONTACTSTART="contactstart",soya2d.EVENT_CONTACTEND="contactend",soya2d.module.install("physics",{onInit:function(t){t.startPhysics=function(e){if(!t.physics){t.physics=new soya2d.Physics(e);var o=["contactstart","contactend"];return t.events.register(o,t.physics),t.physics.startListen(t),t.physics}},t.stopPhysics=function(){t.physics=null}},onUpdate:function(t){t.physics&&t.physics.update(1/60)}}),!function(){"use strict";function t(){var t=1,e=[],o={};this.scheduleTask=function(t,n){n._taskKey&&console.error("a trigger can only bind one task simultaneously"),o[t.key]=t,n._taskKey=t.key,e.push(n)},this.unscheduleTask=function(t){delete o[t];for(var n=0;n<e.length&&e[n]._taskKey!=t;n++);e.length<1||(e[n]._reset(),e.splice(n,1))},this.clear=function(){o={};for(var t=0;t<e.length;t++)e[t]._reset();e=[]},this.triggerTask=function(t){o[t].cbk&&o[t].cbk()},this.isRunning=function(){return 1===t?!0:!1},this.pause=function(){t=2},this.resume=function(){t=1};var n=1e3;this._scanTasks=function(i){if(2!==t){for(var s=[],r=e.length;r--;){var a=e[r],u=o[a._taskKey],l=!1;if(a.milliseconds+=i,a.type===soya2d.TRIGGER_TYPE_FRAME)a._frameCount++,a.canTrigger()&&(l=!0,1===a._frameInfo.canTriggerTimes&&s.push(u.key));else if(a.type===soya2d.TRIGGER_TYPE_TIME){var c=a.milliseconds-a._lastTriggerMilliseconds;a.canTrigger()&&c>=n&&(l=!0,a._lastTriggerMilliseconds=a.milliseconds),a._canUnload()&&s.push(u.key)}l&&u.cbk&&(a.times++,u.cbk(a.key,a.milliseconds,a.times,a._frameCount||a._t))}for(var r=s.length;r--;)this.unscheduleTask(s[r])}}}var e=new t;soya2d.getScheduler=function(){return e}}(),soya2d.TRIGGER_TYPE_FRAME=1,soya2d.TRIGGER_TYPE_TIME=2,soya2d.Task=function(t,e){this.key=t,this.cbk=e},!function(){function t(t){var e,o,n,i,s;if("*"==t)e=-1,o=0,n=-1;else if((o=parseInt(t))==t)n=1,e=0;else if(2===(s=t.split("/")).length){e=parseInt(s[1]);var r;if(2===(r=s[0].split("-")).length){i=[];for(var a=r[0]>>0,u=r[1]>>0;u>=a;a++)i.push(a);i.sort(function(t,e){return t-e}),n=i.length}else(o=parseInt(s[0]))||(o=0),n=-1}else if((s=t.split(",")).length>1){i=[];for(var e=s.length;e--;)i.push(s[e]>>0);i.sort(function(t,e){return t-e}),n=s.length}else if(2===(s=t.split("-")).length){i=[];for(var a=s[0]>>0,u=s[1]>>0;u>=a;a++)i.push(a);i.sort(function(t,e){return t-e}),n=i.length}return[e,o,n,i]}function e(t,e){if(-1===t.canTriggerTimes){if(-1===t.interval)return!0;var o=e-t.startOff;if(0===o)return!1;if(!(o%t.interval))return!0}else if(1===t.canTriggerTimes&&e===t.startOff)return!0;return!1}function o(t){var e=t.milliseconds/1e3,o=t._t[0]=e%60>>0,i=t._t[1]=e/60%60>>0,s=t._t[2]=e/60/60>>0;return n(t._timeInfo.hour,s)?n(t._timeInfo.min,i)?n(t._timeInfo.sec,o)?!0:!1:!1:!1}function n(t,e){if(1===t[2]){if(t[0]!==e)return!1}else if(-1===t[2]&&-1===t[0]);else if(t[3]&&!t[0]){if(t[3].indexOf(e)<0)return!1}else if(-1===t[2]&&t[0]>0||t[0]>0&&t[3]){if(t[3]&&t[3].indexOf(e)<0)return!1;var o=e-t[1];if(0>=o&&0!=t[1])return!1;if(o%t[0])return!1}return!0}soya2d.Trigger=function(n,i,s){switch(this.type=s||soya2d.TRIGGER_TYPE_FRAME,this.exp=i,this.key=n,this.times=0,this.priority=0,this.milliseconds=0,this._taskKey,this._frameCount=0,this._lastTriggerMilliseconds=-1e3,this._t=[],this._reset=function(){this.times=0,this._taskKey=null,this._frameCount=0,this.milliseconds=0,this._lastTriggerMilliseconds=-1e3,this._t=[],delete this._frameInfo,delete this._timeInfo},this._canUnload=function(){var t=this._timeInfo.hour;if(1===t[2]){if(this._t[2]>t[0])return!0}else if(t[2]>1&&this._t[2]>t[3][t[3].length-1])return!0},this.canTrigger=function(){switch(this.type){case soya2d.TRIGGER_TYPE_FRAME:return e(this._frameInfo,this._frameCount);case soya2d.TRIGGER_TYPE_TIME:return o(this)}},this.type){case soya2d.TRIGGER_TYPE_FRAME:/^(\*|(?:(?:[0-9]+|\*)\/[0-9]+)|[0-9]+)$/.test(i)||console.error("invalid trigger expression -- "+i);var r=t(RegExp.$1);this._frameInfo={canTriggerTimes:r[2],startOff:r[1],interval:r[0]};break;case soya2d.TRIGGER_TYPE_TIME:/^(\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+)) (\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+)) (\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+))$/.test(i)||console.error("invalid trigger expression -- "+i);var a=t(RegExp.$1),u=t(RegExp.$2),l=t(RegExp.$3);this._timeInfo={sec:a,min:u,hour:l}}}}(),soya2d.module.install("task",{onInit:function(t){t.addTask=function(t,e,o){var n="soya_task_"+Date.now()+999*Math.random(),i=soya2d.getScheduler(),s=this,r=new soya2d.Task(n,function(o,n,i,r){t&&t.call&&t(s,e||"*",n,i,r)}),a=new soya2d.Trigger(n+"_trigger",e||"*",o);return i.scheduleTask(r,a),n},t.removeTask=function(t){var e=soya2d.getScheduler();e.unscheduleTask(t)}},onUpdate:function(t,e,o){var n=soya2d.getScheduler();n._scanTasks(0>o?-o:o)}});