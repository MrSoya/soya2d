var soya2d=new function(){this.__roIndex=0,this.version={v:[1,4,0],state:"",toString:function(){return soya2d.version.v.join(".")+" "+soya2d.version.state}},this.website="http://soya2d.com",this.ext=function(t,e,n){for(var o=Object.keys(e),i=o.length;i--;){var s=o[i];(!t.hasOwnProperty(s)||n)&&(t[s]=e[s])}},this.inherits=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype},this.module=new function(){var t={};this.install=function(e,n){t[e]=n},this._getAll=function(){return t}}},soya=soya2d;self.Int8Array=self.Int8Array||Array,self.Uint8Array=self.Uint8Array||Array,self.Int16Array=self.Int16Array||Array,self.Uint16Array=self.Uint16Array||Array,self.Int32Array=self.Int32Array||Array,self.Uint32Array=self.Uint32Array||Array,self.Float32Array=self.Float32Array||Array,self.console=self.console||new function(){this.log=function(){},this.info=function(){},this.debug=function(){},this.error=function(){},this.warn=function(){}},soya2d.console=new function(){var t=1;this.level=function(e){t=0==e?0:e||1},this.debug=function(e,n){1==t&&(soya2d.Device.ie?console.debug(e):console.debug("%c"+e,n||"padding:1px 50px;font-size:14px;color:#fff;background:#0069D6;"))},this.info=function(e,n){1>t||t>2||(soya2d.Device.ie?console.log(e):console.log("%c"+e,n||"padding:1px 50px;font-size:14px;color:#fff;background:#2DB008;"))},this.warn=function(e,n){1>t||t>3||(soya2d.Device.ie?console.warn(e):console.warn("%c"+e,n||"padding:1px 50px;font-size:14px;color:#fff;background:#FFB502;"))},this.error=function(e,n){1>t||(soya2d.Device.ie?console.error(e):console.error("%c"+e,n||"padding:1px 50px;font-size:14px;color:#fff;background:#ff0000;"))}},self.cancelAFrame=function(t){return t.cancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.clearTimeout}(self),self.requestAFrame=function(t){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||function(e){return t.setTimeout(function(){e(Date.now())},16.7)}}(self),soya2d.BLEND_NORMAL="source-over",soya2d.BLEND_LIGHTER="lighter",soya2d.BLEND_MASK="destination-in",soya2d.BLEND_CLEAR="destination-out",soya2d.LINECAP_BUTT="butt",soya2d.LINECAP_ROUND="round",soya2d.LINECAP_SQUARE="square",soya2d.LINEJOIN_BEVEL="bevel",soya2d.LINEJOIN_ROUND="round",soya2d.LINEJOIN_MITER="miter",soya2d.TEXTALIGN_LEFT="left",soya2d.TEXTALIGN_CENTER="center",soya2d.TEXTALIGN_RIGHT="right",soya2d.TEXTVALIGN_TOP="hanging",soya2d.TEXTVALIGN_MIDDLE="middle",soya2d.TEXTVALIGN_BOTTOM="alphabetic",soya2d.TEXTDIR_LTR="ltr",soya2d.TEXTDIR_RTL="rtl",soya2d.REPEAT="repeat",soya2d.NOREPEAT="no-repeat",soya2d.REPEAT_X="repeat-x",soya2d.REPEAT_Y="repeat-y",soya2d.GRADIENTTYPE_LINEAR=1,soya2d.GRADIENTTYPE_RADIAL=2,soya2d.HITTEST_PATH=1,soya2d.HITTEST_PIXEL=2,soya2d.Math={PI:3.141592654,PIM2:6.283185307,PID2:1.570796327,PID4:.785398163,ONERAD:.017453292,ONEANG:57.295779513,toRadian:function(t){return t*this.ONERAD},toAngle:function(t){return t*this.ONEANG},randomf:function(t,e){return t+Math.random()*(e-t)},randomi:function(t,e){return t+Math.random()*(e-t)>>0},round:function(t){return.5+t>>0},floor:function(t){return 0|t},len2D:function(t,e,n,o){return Math.sqrt((o-e)*(o-e)+(n-t)*(n-t))},len2Df:function(t,e){t=Math.abs(t),e=Math.abs(e);var n=Math.min(t,e);return t+e-(n>>1)-(n>>2)+(n>>4)},SINTABLE:function(){for(var t=new Float32Array(361),e=.017453292,n=0;360>=n;n++){var o=n*e,i=Math.sin(o);t[n]=i}return t}(),COSTABLE:function(){for(var t=new Float32Array(361),e=.017453292,n=0;360>=n;n++){var o=n*e,i=Math.cos(o);t[n]=i}return t}()},soya2d.ResourceManager=function(){this.urlMap={}},soya2d.ResourceManager.prototype={find:function(t){if(!t)return null;if("string"==typeof t){var e=t;t={},t.urls=[e]}else t.urls=[t.url];var n=this.findAll(t);return 0==n.length?null:n[0]},findAll:function(t){var e=Object.keys(this.urlMap);if("string"==typeof t){var n=t;t={},t.urls=[n]}var o=t?t.fuzzy||!0:!0,i=[];if(t)for(var s=t.urls.length;s--;){var n=t.urls[s];if(o)for(var r=e.length;r--;)e[r].indexOf(n)>-1&&i.push(e[r]);else for(var r=e.length;r--;)e[r]==n&&i.push(e[r])}else i=e;for(var a=[],r=i.length;r--;)a.push(this.urlMap[i[r]]);return a}},soya2d.Circle=function(t,e,n){this.x=t||0,this.y=e||0,this.r=n||0},soya2d.Circle.prototype={toString:function(){return"{x:"+this.x+",y:"+this.y+",r:"+this.r+"}"},clone:function(){return new soya2d.Circle(this.x,this.y,this.r)}},soya2d.Polygon=function(t){this.vtx=t},soya2d.Polygon.prototype={toString:function(){return this.vtx},clone:function(){return new soya2d.Polygon(this.vtx.concat())}},soya2d.Rectangle=function(t,e,n,o){this.x=t||0,this.y=e||0,this.w=n||0,this.h=o||0},soya2d.Rectangle.prototype={toString:function(){return"{x:"+this.x+",y:"+this.y+",w:"+this.w+",h:"+this.h+"}"},clone:function(){return new soya2d.Rectangle(this.x,this.y,this.w,this.h)},getRight:function(){return this.x+this.w},getBottom:function(){return this.y+this.h},contains:function(t,e){return t<this.x||t>this.x+this.w?!1:e<this.y||e>this.y+this.h?!1:!0}},soya2d.Matrix2x2=function(){this.e=new Float32Array(4),this.identity()},soya2d.Matrix2x2.prototype={toString:function(){return"["+this.e[0]+","+this.e[1]+","+this.e[2]+","+this.e[3]+"]"},set:function(t,e,n,o){var i=this.e;return i[0]=t||1,i[1]=e||0,i[2]=n||0,i[3]=o||1,this},clone:function(){return(new soya2d.Matrix2x2).set(this.e[0],this.e[1],this.e[2],this.e[3])},identity:function(){return this.set(1,0,0,1),this},mul:function(t){var e=this.e[0],n=this.e[1],o=this.e[2],i=this.e[3],s=t.e;return this.e[0]=s[0]*e+s[2]*n,this.e[1]=s[1]*e+s[3]*n,this.e[2]=s[0]*o+s[2]*i,this.e[3]=s[1]*o+s[3]*i,this},scale:function(t,e){return this.e[0]*=t,this.e[1]*=e,this.e[2]*=t,this.e[3]*=e,this},rotate:function(t){if(!t)return this;var e=soya2d.Math;t=0>t?360+t%360:t,t>360&&(t%=360);var n=this.e[0],o=this.e[1],i=this.e[2],s=this.e[3],r=e.SINTABLE[t],a=e.COSTABLE[t];return void 0===r&&(r=Math.sin(t*e.ONERAD),a=Math.cos(t*e.ONERAD)),this.e[0]=n*a+o*-r,this.e[1]=n*r+o*a,this.e[2]=i*a+s*-r,this.e[3]=i*r+s*a,this},skew:function(t,e){var n=this.e[0],o=this.e[1],i=this.e[2],s=this.e[3];if(t){var r;this.skewX===t&&this.sx?r=this.sx:(r=Math.tan(.017453292*t),this.sx=r),this.e[0]+=o*r,this.e[2]+=s*r}if(e){var a;this.skewY===t&&this.sy?a=this.sy:(a=Math.tan(.017453292*e),this.sy=a),this.e[1]+=n*a,this.e[3]+=i*a}return this}},soya2d.Vector=function(t,e){this.e=new Float32Array(2),this.e[0]=t||0,this.e[1]=e||0},soya2d.Vector.prototype={toString:function(){return"{x:"+this.e[0]+",y:"+this.e[1]+"}"},clone:function(){return new soya2d.Vector(this.e[0],this.e[1])},set:function(t,e){return this.e[0]=t||0,this.e[1]=e||0,this},dot:function(t){return this.e[0]*t.e[0]+this.e[1]*t.e[1]},negate:function(){return this.e[0]*=-1,this.e[1]*=-1,this},add:function(t){return this.e[0]+=t.e[0],this.e[1]+=t.e[1],this},sub:function(t){return this.e[0]-=t.e[0],this.e[1]-=t.e[1],this},mul:function(t){return this.e[0]*=t,this.e[1]*=t,this},div:function(t){return t?(this.e[0]/=t,this.e[1]/=t):(this.e[0]=0,this.e[1]=0),this},getAngle:function(){return Math.atan2(this.e[1],this.e[0])},getAngleBetween:function(t){var e=this.dot(t),n=e/(this.length()*t.length());return Math.acos(n)},rotate:function(t){var e=soya2d.Math,n=e.SINTABLE[t],o=e.COSTABLE[t];void 0===n&&(n=Math.sin(t*e.ONERAD),o=Math.cos(t*e.ONERAD));var i=this.e[0],s=this.e[1];return this.e[0]=i*o-s*n,this.e[1]=i*n+s*o,this},lengthSq:function(){return this.e[0]*this.e[0]+this.e[1]*this.e[1]},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.div(this.length())}},soya2d.DisplayObject=function(t){if(t=t||{},this.__seq=soya2d.__roIndex++,this.roid="roid_"+this.__seq,this.name=t.name||this.roid,this.visible=t.visible===!1?!1:t.visible||!0,this.__opacity=0===t.opacity?0:t.opacity||1,this.__x=t.x||0,this.__y=t.y||0,this.__w=t.w||0,this.__h=t.h||0,this.__originX=0===t.originX?0:t.originX||"50%",this.__originY=0===t.originY?0:t.originY||"50%",this.__rotation=t.rotation||0,this.__scaleX=t.scaleX||1,this.__scaleY=t.scaleY||1,this.__skewX=t.skewX||0,this.__skewY=t.skewY||0,Object.defineProperties(this,{opacity:{set:function(t){t=0==t?0:parseFloat(t)||1,this.__opacity=0>t?0:t>1?1:t},get:function(){return this.__opacity},enumerable:!0},x:{set:function(t){this.__x=t||0,this.__localChange=!0},get:function(){return this.__x},enumerable:!0},y:{set:function(t){this.__y=t||0,this.__localChange=!0},get:function(){return this.__y},enumerable:!0},w:{set:function(t){this.__w=t,this.__originChange=!0},get:function(){return this.__w},enumerable:!0},h:{set:function(t){this.__h=t,this.__originChange=!0},get:function(){return this.__h},enumerable:!0},originX:{set:function(t){this.__originX=t,this.__originChange=!0},get:function(){return this.__originX},enumerable:!0},originY:{set:function(t){this.__originY=t,this.__originChange=!0},get:function(){return this.__originY},enumerable:!0},rotation:{set:function(t){this.__rotation=t,this.__localChange=!0},get:function(){return this.__rotation},enumerable:!0},scaleX:{set:function(t){this.__scaleX=t,this.__localChange=!0},get:function(){return this.__scaleX},enumerable:!0},scaleY:{set:function(t){this.__scaleY=t,this.__localChange=!0},get:function(){return this.__scaleY},enumerable:!0},skewX:{set:function(t){this.__skewX=t,this.__localChange=!0},get:function(){return this.__skewX},enumerable:!0},skewY:{set:function(t){this.__skewY=t,this.__localChange=!0},get:function(){return this.__skewY},enumerable:!0}}),this.z=t.z||0,this.__localChange=!0,this.__originChange=!0,this.__localTransform=new soya2d.Matrix2x2,this.__worldTransform=new soya2d.Matrix2x2,this.__worldPosition=new soya2d.Vector,this.__originPosition=new soya2d.Vector,this.blendMode=t.blendMode||"source-over",this.__mask=t.mask||null,Object.defineProperties(this,{mask:{set:function(t){t&&(t.__masker&&(t.__masker.__mask=null),this.__mask=t,t.__masker=this)},get:function(){return this.__mask},enumerable:!0}}),this.__masker=null,this.bounds=t.bounds||new soya2d.Rectangle(0,0,this.__w,this.__h),this.__boundRect=new soya2d.Rectangle(0,0,1,1),this.body=null,this.game=t.game||soya2d.games[0],this.imageCache=null,this.__updateCache=!1,!this.game)throw new Error("soya2d.DisplayObject: invalid param [game]; "+this.game)},soya2d.ext(soya2d.DisplayObject.prototype,{toString:function(){return'{roid:"'+this.roid+'";name:"'+this.name+'"}'},updateTransform:function(){var t=this.__x,e=this.__y;this.__localChange&&(this.__localTransform.identity(),this.__localTransform.scale(this.__scaleX,this.__scaleY).rotate(this.__rotation).skew(this.__skewX,this.__skewY));var n=this.__localTransform,o=this.__worldTransform,i=this.__originPosition,s=n.e,r=i.e,a=r[0],u=r[1];if(this.__originChange&&(a=this.__originX,u=this.__originY,a="number"==typeof a?a:parseFloat(a)/100*this.__w,u="number"==typeof u?u:parseFloat(u)/100*this.__h,i.set(a,u)),t+=a,e+=u,o.set(s[0],s[1],s[2],s[3]),this.parent){var l=this.parent.__worldTransform,h=l.e,c=this.parent.__worldPosition.e,d=this.parent.__originPosition.e,f=d[0]*h[0]+d[1]*h[2],p=d[0]*h[1]+d[1]*h[3],m=t*h[0]+e*h[2],y=t*h[1]+e*h[3];t=m+c[0]-f,e=y+c[1]-p,o.mul(l)}this.__worldPosition.set(t,e),this.__localChange=this.__originChange=!1},isRendered:function(){if(!this.visible||0===this.opacity)return!1;for(var t=this.parent;t;){if(!t.visible||0===t.opacity)return!1;t=t.parent}return!0},clone:function(t,e){e=e||new this.constructor;for(var n=Object.keys(this),o=n.length;o--;){var i=n[o];if("parent"!==i&&"__seq"!==i&&"roid"!==i&&"__localTransform"!==i&&"__worldTransform"!==i&&"__worldPosition"!==i&&"__originPosition"!==i&&(t||"children"!==i))if(t&&"children"===i&&this[i]&&this[i].length>0){e[i]=[];for(var s=0;s<this[i].length;s++){var r=this[i][s],a=r.clone(t);a.parent=e,e[i].push(a)}}else e[i]=this[i]instanceof Array?this[i].slice(0):this[i]}return e},moveBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.x+=t,this.y+=e,this},moveTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.x=t,this.y=e,this},opacifyTo:function(t){return this.opacity=t>1?1:0>t?0:t,this},opacifyBy:function(t){return this.opacity+=t,this.opacity>1&&(this.opacity=1),this.opacity<0&&(this.opacity=0),this},resizeTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.w=t,this.h=e,this},scaleBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.scaleX+=t,this.scaleY+=e,this},scaleTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.scaleX=t,this.scaleY=e,this},skewBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.skewX+=t,this.skewY+=e,this},skewTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.skewX=t,this.skewY=e,this},rotateBy:function(t){return this.angle+=t,this},rotateTo:function(t){return this.angle=t,this},originBy:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.originX+=t,this.originY+=e,this},originTo:function(){var t=arguments[0]||0,e=0===arguments[1]?0:arguments[1]||t;return this.originX=t,this.originY=e,this},getBoundingPoints:function(){var t=this.__worldTransform.e,e=this.__worldPosition.e,n=this.__originPosition.e,o=e[0],i=e[1],s=t[0],r=t[1],a=t[2],u=t[3],l=n[0],h=n[1],c=-l,d=-h,f=this.w-l,p=-h,m=-l,y=this.h-h,g=this.w-l,v=this.h-h;return[c*s+d*a+o,c*r+d*u+i,f*s+p*a+o,f*r+p*u+i,g*s+v*a+o,g*r+v*u+i,m*s+y*a+o,m*r+y*u+i]},getBoundingBox:function(){var t,e,n,o,i=this.getBoundingPoints();n=i[0],t=i[0],o=i[1],e=i[1];for(var s=i.length;s--;)s%2===0?(i[s]>n&&(n=i[s]),i[s]<t&&(t=i[s])):(i[s]>o&&(o=i[s]),i[s]<e&&(e=i[s]));return sx=t,sy=e,sw=n-t,sh=o-e,this.__boundRect.x=sx,this.__boundRect.y=sy,this.__boundRect.w=sw,this.__boundRect.h=sh,this.__boundRect},hitTest:function(t,e){var n=this.__worldPosition.e;if(this.bounds instanceof soya2d.Circle){var o=Math.abs(soya2d.Math.len2D(n[0],n[1],t,e));if(o<=this.bounds.r)return!0}else if(this.bounds instanceof soya2d.Rectangle||this.bounds instanceof soya2d.Polygon){var i;if(this.bounds.vtx){var s=this.__worldTransform.e,r=this.__originPosition.e,a=n[0],u=n[1],l=s[0],h=s[1],c=s[2],d=s[3],f=r[0],p=r[1],m=-f,y=-p;i=[];for(var g=0;g<this.bounds.vtx.length;g+=2){var v=this.bounds.vtx[g]+m,_=this.bounds.vtx[g+1]+y;i.push(v*l+_*c+a,v*h+_*d+u)}}else i=this.getBoundingPoints();for(var b=!1,g=0;g<i.length;g+=2){var v=i[g],_=i[g+1],w=i[g+2]||i[0],E=i[g+3]||i[1];if(v===t&&_===e||w===t&&E===e)return!0;if(e>_&&E>=e||_>=e&&e>E){var A=(e-_)/(E-_)*(w-v)+v;if(A===t)return!0;A>t&&(b=!b)}}return b}return!1},getAnchorPosition:function(){var t=this.__worldTransform.e,e=this.__worldPosition.e,n=this.__originPosition.e,o=e[0],i=e[1],s=t[0],r=t[1],a=t[2],u=t[3],l=n[0],h=n[1],c=-l,d=-h,f=this.w*parseInt(this.originX)/100,p=this.h*parseInt(this.originY)/100,m=Math.sqrt(p*p+f*f),y=Math.atan2(p,f);return f=Math.cos(y)*m+c,p=Math.sin(y)*m+d,[f*s+p*a+o,f*r+p*u+i]},cache:function(){if(!(this.__w>1024||this.__h>1024)){this.imageCache||(this.imageCache=document.createElement("canvas")),this.imageCache.width=this.__w,this.imageCache.height=this.__h,this.updateTransform(),this.__updateCache=!0;var t=this.imageCache.getContext("2d"),e=new soya2d.CanvasGraphics(t);this.game.getRenderer().renderDO(t,this,e,!0),this.__updateCache=!1}}}),soya2d.DisplayObjectContainer=function(t){t=t||{},soya2d.DisplayObject.call(this,t),this.children=[],this.parent=null},soya2d.inherits(soya2d.DisplayObjectContainer,soya2d.DisplayObject),soya2d.ext(soya2d.DisplayObjectContainer.prototype,{add:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];e.parent||(this.children.push(e),e.parent=this)}return this},remove:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t],n=this.children.indexOf(e);0>n||(this.children.splice(n,1),e.parent=null)}return this},clear:function(){for(var t=this.children.length;t--;)this.children[t].parent=null;var e=this.children;return this.children=[],e},find:function(t,e){if(this.children.length<1)return[];var n;return e?(n=[],!function(e){for(var o=e.children.length;o--;){var i=e.children[o];t(i)&&n.push(i),i.children&&i.children.length>0&&arguments.callee(i)}}(this)):n=this.children.filter(t),n}}),soya2d.Scene=function(t){function e(t,n){if(t.updateTransform(),t.children)for(var o=t.children.length;o--;){var i=t.children[o];i.opacity>0&&i.visible&&(n.push(i),e(i,n))}}function n(t,e){for(var o=t.length;o--;){var i=t[o];i._onUpdate&&i._onUpdate(e),i.onUpdate&&i.onUpdate(e),i.children&&n(i.children,e)}}t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.__updateMatrix=function(){this.__renderQueue=[],e(this,this.__renderQueue)},this.__update=function(t){this.children&&n(this.children,t)},this.findVisible=function(t){return this.__renderQueue?this.__renderQueue.filter(t):[]}},soya2d.inherits(soya2d.Scene,soya2d.DisplayObjectContainer),soya2d.ScrollSprite=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.scope=t.scope,this.freezone=t.freezone,this.__boundContainer=new soya2d.DisplayObjectContainer,this.children.push(this.__boundContainer)},soya2d.inherits(soya2d.ScrollSprite,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.ScrollSprite.prototype,{add:function(){return this.__boundContainer.add.apply(this.__boundContainer,arguments),this},remove:function(){return this.__boundContainer.remove.apply(this.__boundContainer,arguments),this},clear:function(){return this.__boundContainer.clear()},find:function(t,e){return this.__boundContainer.find(t,e)},follow:function(t){var e=this.__boundContainer.find(function(e){return t.roid===e.roid?!0:void 0},!0);return e.length<0&&soya2d.console.error("soya2d.ScrollSprite: "+t.toString()+" must be a child node of soya2d.ScrollSprite"),this.target=t,this._onUpdate(),this},unfollow:function(){this.target=null},scrollTo:function(t,e){this.target||(this.__boundContainer.x=t,this.__boundContainer.y=e,this.__checkBounds())},scrollBy:function(t,e){this.target||(this.__boundContainer.x+=t,this.__boundContainer.y+=e,this.__checkBounds())},__checkBounds:function(){if(this.scope){var t=this.scope.x,e=this.scope.y,n=this.scope.w,o=this.scope.h,i=this.__boundContainer.x;i>t&&(this.__boundContainer.x=t),n>0&&i<this.w-n&&(this.__boundContainer.x=this.w-n);var s=this.__boundContainer.y;s>e&&(this.__boundContainer.y=e),o>0&&s<this.h-o&&(this.__boundContainer.y=this.h-o)}},setScope:function(t){t&&(this.scope=t,this.__boundContainer.w=t.w,this.__boundContainer.h=t.h)},_onUpdate:function(){if(this.target){var t,e;this.target.updateTransform();var n=this.target.__worldPosition.e;t=n[0],e=n[1];var o,i,s=this.target.w,r=this.target.h,a=this.__boundContainer.getBoundingPoints(),u=a[0],l=a[1],h=t-u,c=e-l;if(this.freezone){var d=-1*this.__boundContainer.x,f=-1*this.__boundContainer.y,p=h-d,m=c-f,y=s/2,g=r/2,v=this.freezone.x,_=this.freezone.y,b=this.freezone.w,w=this.freezone.h;if(v>p-y?o=h-y-v:p+y>v+b&&(o=h+y-v-b),_>m-g?i=c-g-_:m+g>_+w&&(i=c+g-_-w),!o&&!i)return}else o=h-this.w/2,i=c-this.h/2;o&&(this.__boundContainer.x=-o),i&&(this.__boundContainer.y=-i),this.__checkBounds()}},onRender:function(t){t.beginPath(),t.rect(0,0,this.w,this.h),t.clip()}}),soya2d.Shape=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t)},soya2d.inherits(soya2d.Shape,soya2d.DisplayObjectContainer),soya2d.Sprite=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t);var e=t.textures;this.setTextures(e),this.w=t.w||this.textures[0].w,this.h=t.h||this.textures[0].h,this.multiFrame=this.textures.length>1?!0:!1,this.frameIndex=0,this.__currTex,this.__lastUpdateTime=0,this.frameRate=t.frameRate||10,this.loop=t.loop===!1?!1:t.loop||!0,this.autoplay=t.autoplay||!1},soya2d.inherits(soya2d.Sprite,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Sprite.prototype,{clone:function(t){var e=new this.constructor({textures:this.textures.concat()});return soya2d.DisplayObject.prototype.clone.call(this,t,e)},onRender:function(t){if(this.multiFrame){if(this.__lastUpdateTime||(this.__lastUpdateTime=(new Date).getTime()),this.autoplay){var e=(new Date).getTime(),n=e-this.__lastUpdateTime,o=n/(16.7*this.frameRate)>>0;o>0&&(this.frameIndex+=o,this.frameIndex>=this.textures.length&&(this.frameIndex=this.loop?0:this.textures.length-1),this.__lastUpdateTime=e)}this.__currTex=this.textures[this.frameIndex],t.map(this.__currTex,0,0,this.w,this.h)}else t.map(this.textures[0],0,0,this.w,this.h)},nextFrame:function(){this.frameIndex++,this.frameIndex>=this.textures.length&&(this.frameIndex=this.loop?0:this.textures.length-1)},prevFrame:function(){this.frameIndex--,this.frameIndex<0&&(this.frameIndex=this.loop?this.textures.length-1:0)},setTextures:function(t){this.textures=t instanceof soya2d.Texture?[t]:t instanceof self.Image?[soya2d.Texture.fromImage(t)]:t instanceof Array?t:[],this.textures[0]||console.error("soya2d.Sprite: invalid param [textures]; "+this.textures[0])}}),soya2d.TileSprite=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.sprite=null,t.sprite instanceof soya2d.Texture||t.sprite instanceof self.Image?this.sprite=new soya2d.Sprite({textures:t.sprite}):t.sprite instanceof soya2d.Sprite&&(this.sprite=t.sprite),this.w=t.w||this.sprite.w,this.h=t.h||this.sprite.h,this.autoScroll=t.autoScroll||!1,this.speed=t.speed||1,this.angle=t.angle||0,this.__tileOffx=0,this.__tileOffy=0},soya2d.inherits(soya2d.TileSprite,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.TileSprite.prototype,{scroll:function(t,e){if(t||e)this.__tileOffx+=t||0,this.__tileOffy+=e||0;else{var n=(this.angle>>0)%360;this.__tileOffx+=soya2d.Math.COSTABLE[n]*this.speed,this.__tileOffy+=soya2d.Math.SINTABLE[n]*this.speed}},clone:function(t){var e=new this.constructor({sprite:this.sprite});return soya2d.DisplayObject.prototype.clone.call(this,t,e),e},_onUpdate:function(){if(this.autoScroll){var t=(this.angle>>0)%360;this.__tileOffx+=soya2d.Math.COSTABLE[t]*this.speed,this.__tileOffy+=soya2d.Math.SINTABLE[t]*this.speed}},onRender:function(t){t.beginPath(),t.push(),t.rect(0,0,this.w,this.h),t.clip();var e=this.sprite,n=e.w,o=e.h,i=n*e.scaleX,s=o*e.scaleY;i=0>i?-1*i:i,s=0>s?-1*s:s;var r=(this.w/i>>0)+2,a=(this.h/s>>0)+2,u=this.__tileOffx%i,l=this.__tileOffy%s;this.__tileOffx>0&&(u-=i),this.__tileOffy>0&&(l-=s);for(var h=this.sprite.textures[0],c=a;c--;)for(var d=r;d--;){var f=d*i,p=c*s;t.map(h,f+u,p+l,i,s,0,0,n,o)}t.pop()}}),soya2d.CanvasGraphics=function(t){this.ctx=t,this.opacity=function(t){return 0===t||t?(this.ctx.globalAlpha=t,this):this.ctx.globalAlpha},this.closePath=function(){return this.ctx.closePath(),this},this.moveTo=function(t,e){return this.ctx.moveTo(t,e),this},this.lineTo=function(t,e){return this.ctx.lineTo(t,e),this},this.quadraticCurveTo=function(t,e,n,o){return this.ctx.quadraticCurveTo(t,e,n,o),this},this.bezierCurveTo=function(t,e,n,o,i,s){return this.ctx.bezierCurveTo(t,e,n,o,i,s),this},this.arcTo=function(t,e,n,o,i){return this.ctx.arcTo(t,e,n,o,i),this},this.arc=function(t,e,n,o,i){return this.ctx.arc(t,e,n,o||0,i||soya2d.Math.PIM2),this},this.eArc=function(e,n,o,i,s,r){s=(s||0)>>0,r=(r||360)>>0;var a=soya2d.Math,u=e+o*a.COSTABLE[s],l=n+i*a.SINTABLE[s];t.moveTo(u,l);var h=0;h=s>r?360-s+r:r-s;for(var c=1;h>=c;c++){var d=(s+c)%360;u=e+o*a.COSTABLE[d],l=n+i*a.SINTABLE[d],t.lineTo(u,l)}return this},this.rect=function(t,e,n,o){return this.ctx.rect(t,e,n,o),this},this.polygon=function(t){var e=this.ctx,n=t.length-1;e.moveTo(t[0],t[1]);for(var o=2;n>o;o+=2)e.lineTo(t[o],t[o+1]);return this},this.ellipse=function(t,e,n,o){var i=.5522848,s=n/2*i,r=o/2*i,a=t+n,u=e+o,l=t+n/2,h=e+o/2,c=this.ctx;return c.moveTo(t,h),c.bezierCurveTo(t,h-r,l-s,e,l,e),c.bezierCurveTo(l+s,e,a,h-r,a,h),c.bezierCurveTo(a,h+r,l+s,u,l,u),c.bezierCurveTo(l-s,u,t,h+r,t,h),this},this.roundRect=function(t,e,n,o,i){var s=this.ctx;return s.moveTo(t+i,e),s.lineTo(t+(n-(i<<1)),e),s.arc(t+n-i,e+i,i,3*Math.PI/2,0),s.lineTo(t+n,e+o-i),s.arc(t+n-i,e+o-i,i,0,soya2d.Math.PID2),s.lineTo(t+i,e+o),s.arc(t+i,e+o-i,i,soya2d.Math.PID2,Math.PI),s.lineTo(t,e+i),s.arc(t+i,e+i,i,Math.PI,3*Math.PI/2),this},this.regularPolygon=function(t,e,n,o,i){t=t||0,e=e||0,n=3>n?3:n;for(var s=soya2d.Math,r=[],a=360/n,u=0,l=0;360>u;u+=a,l++){var h=o;i&&(h=l%2!==0?o:i),s.COSTABLE[u]?r.push(t+h*s.COSTABLE[u],e+h*s.SINTABLE[u]):r.push(t+h*s.COSTABLE[Math.round(u)],e+h*s.SINTABLE[Math.round(u)])}return this.polygon(r),this},this.blendMode=function(t){return t?(this.ctx.globalCompositeOperation=t,this):this.ctx.globalCompositeOperation},this.strokeStyle=function(t){return t?(this.ctx.strokeStyle=t,this):this.ctx.strokeStyle},this.fillStyle=function(t){return t?(this.ctx.fillStyle=t,this):this.ctx.fillStyle},this.shadow=function(t,e,n,o){return this.ctx.shadowBlur=t,this.ctx.shadowColor=e,this.ctx.shadowOffsetX=n,this.ctx.shadowOffsetY=o,this},this.lineStyle=function(t,e,n,o){var i=this.ctx;return i.lineWidth=t,i.lineCap=e||i.lineCap,i.lineJoin=n||i.lineJoin,i.miterLimit=o||i.miterLimit,this},this.font=function(t){var e=this.ctx;return e.font=t.getDesc(),this},this.clip=function(){return this.ctx.clip(),this},this.push=function(){return this.ctx.save(),this},this.pop=function(){return this.ctx.restore(),this},this.beginPath=function(){return this.ctx.beginPath(),this},this.closePath=function(){return this.ctx.closePath(),this},this.fill=function(){return this.ctx.fill(),this},this.stroke=function(){return this.ctx.stroke(),this},this.path=function(t){t._insQ.forEach(function(t){var e=t[0].toLowerCase();switch(e){case"m":this.ctx.moveTo(t[1][0],t[1][1]);break;case"l":var n=t[1];if(n.length>2)for(var o=0;o<n.length;o+=2)this.ctx.lineTo(n[o],n[o+1]);else this.ctx.lineTo(n[0],n[1]);break;case"c":var n=t[1];if(n.length>6)for(var o=0;o<n.length;o+=6)this.ctx.bezierCurveTo(n[o],n[o+1],n[o+2],n[o+3],n[o+4],n[o+5]);else this.ctx.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5]);break;case"q":var n=t[1];if(n.length>4)for(var o=0;o<n.length;o+=4)this.ctx.quadraticCurveTo(n[o],n[o+1],n[o+2],n[o+3]);else this.ctx.quadraticCurveTo(n[0],n[1],n[2],n[3]);break;case"z":this.ctx.closePath()}},this)},this.fillRect=function(t,e,n,o){return this.ctx.fillRect(t,e,n,o),this},this.strokeRect=function(t,e,n,o){return this.ctx.strokeRect(t,e,n,o),this},this.clearRect=function(t,e,n,o){return this.ctx.clearRect(t,e,n,o),this},this.map=function(t,e,n,o,i,s,r,a,u){return s=s||0,r=r||0,a=a||t.w,u=u||t.h,0!==a&&0!==u&&0!==i&&0!==i?(this.ctx.drawImage(t.__data,s>>0,r>>0,a>>0,u>>0,e>>0,n>>0,o>>0,i>>0),this):void 0},this.fillText=function(t,e,n,o){return o?this.ctx.fillText(t,e||0,n||0,o):this.ctx.fillText(t,e||0,n||0),this},this.strokeText=function(t,e,n,o){return o?this.ctx.strokeText(t,e||0,n||0,o):this.ctx.strokeText(t,e||0,n||0),this}},soya2d.CanvasRenderer=function(t){function e(t){t.stroke=function(){},t.fill=function(){},t.fillRect=function(e,n,o,i){t.rect(e,n,o,i)},t.strokeRect=function(e,n,o,i){t.rect(e,n,o,i)},t.drawImage=function(e,n,o,i,s,r,a,u,l){3===arguments.length?t.rect(n,o,e.width,e.height):5===arguments.length?t.rect(n,o,i,s):9===arguments.length&&t.rect(r,a,u,l)},t.fillText=function(){},t.strokeText=function(){},t.beginPath=function(){},t.closePath=function(){}}function n(t){t.stroke=f.stroke,t.fill=f.fill,t.fillRect=f.fillRect,t.strokeRect=f.strokeRect,t.drawImage=f.drawImage,t.fillText=f.fillText,t.strokeText=f.strokeText,t.beginPath=f.beginPath,t.closePath=f.closePath}function o(t,e){if(e.onRender){var n=e.__worldTransform.e,i=e.__worldPosition.e;t.setTransform(n[0],n[1],n[2],n[3],i[0],i[1]);var s=e.__originPosition.e;t.translate(-s[0],-s[1]),e.onRender(c)}if(e.children&&e.children.length>0)for(var r=e.children,a=0;a<r.length;a++)o(t,r[a])}function i(t,s,r,a,u){if(0!==s.opacity&&s.visible&&!s.__masker){if(s.mask instanceof soya2d.DisplayObject&&(t.save(),t.beginPath(),e(t),o(t,s.mask),t.clip(),n(t),t.closePath()),s instanceof soya2d.ScrollSprite&&t.save(),s.onRender){var l=s.__worldTransform.e,h=s.__worldPosition.e,c=s.__originPosition.e;s.__updateCache?t.setTransform(1,0,0,1,c[0]<<1,c[1]<<1):t.setTransform(l[0],l[1],l[2],l[3],h[0],h[1]),u&&s.opacity<=1&&s.opacity!==u.opacity&&(u.opacity=s.opacity,t.globalAlpha=s.opacity),u&&u.blendMode!==s.blendMode&&(u.blendMode=s.blendMode,t.globalCompositeOperation=s.blendMode),t.translate(-c[0],-c[1]),s.imageCache&&!s.__updateCache?t.drawImage(s.imageCache,0,0):s.onRender(r)}if(s.children&&s.children.length>0){var d=s.children;a&&d.sort(function(t,e){return t.z===e.z?t.__seq-e.__seq:t.z-e.z});for(var f=0;f<d.length;f++)i(t,d[f],r,a,u)}s instanceof soya2d.ScrollSprite&&t.restore(),s.mask instanceof soya2d.DisplayObject&&t.restore()}}t=t||{};var s=t.container;this.w=t.w||(s?s.clientWidth:0),this.h=t.h||(s?s.clientHeight:0),this.autoClear=void 0===t.autoClear?!0:t.autoClear,this.sortEnable=t.sortEnable||!1;var r=t.smoothEnable===!1?!1:t.smoothEnable||!0,a=t.crispEnable||!1,u=document.createElement("canvas");u.style.position="absolute";var l=window.getComputedStyle(t.container,null).position;"absolute"!==l&&"relative"!==l&&(s.style.position="relative"),l=null,s.appendChild(u),s=null;var h=u.getContext("2d"),c=new soya2d.CanvasGraphics(h);u.width=this.w,u.height=this.h,this.ctx=h,h.textBaseline=soya2d.TEXTVALIGN_TOP;var d={opacity:1,blendMode:"source-over"};this.getCanvas=function(){return u},this.render=function(t){!t instanceof soya2d.Scene||(t.__updateMatrix(),h.setTransform(1,0,0,1,0,0),this.autoClear&&h.clearRect(0,0,this.w,this.h),i(h,t,c,this.sortEnable,d))};var f={stroke:h.stroke,fill:h.fill,fillRect:h.fillRect,strokeRect:h.strokeRect,drawImage:h.drawImage,fillText:h.fillText,strokeText:h.strokeText,beginPath:h.beginPath,closePath:h.closePath};this.renderDO=i,this.resize=function(t,e){var n=u.width,o=u.height;this.hr=t/n,this.vr=e/o,u.style.width=t+"px",u.style.height=e+"px"},this.hr=1,this.vr=1,this.smooth=function(t){return void 0!==t?(h.imageSmoothingEnabled=h.webkitImageSmoothingEnabled=h.mozImageSmoothingEnabled=h.oImageSmoothingEnabled=h.msImageSmoothingEnabled=t,r=t,this):r},this.smooth(r),this.crisp=function(t){t?(u.style["image-rendering"]="optimizeSpeed",u.style["image-rendering"]="crisp-edges",u.style["image-rendering"]="-moz-crisp-edges",u.style["image-rendering"]="-webkit-optimize-contrast",u.style["image-rendering"]="optimize-contrast",u.style["image-rendering"]="pixelated",u.style.msInterpolationMode="nearest-neighbor"):(u.style["image-rendering"]="auto",u.style.msInterpolationMode="bicubic")},this.crisp(a),this.getImageData=function(t,e,n,o){return t=t||0,e=e||0,n=n||this.w,o=o||this.h,h.getImageData(t,e,n,o)},this.toDataURL=function(t){return u.toDataURL(t||"image/png")},this.getHitTester=function(t){switch(t){case 2:return this.__pixelTester;case 1:default:return this.__pathTester}},this.__pixelTester=new soya2d.__HitPixelTester(this.w,this.h),this.__pathTester=new soya2d.__HitPathTester(this.w,this.h),this.createPattern=function(t,e){return h.createPattern(t,e||"repeat")},this.createGradient=function(t,e,n,o){var i=0,s=0,r=0,a=soya2d.GRADIENTTYPE_LINEAR,u=0,l=0;o&&(i=o.angle||0,s=o.x||0,r=o.y||0,a=o.type||soya2d.GRADIENTTYPE_LINEAR,u=o.focalRatio||0,l=o.focalRadius||0);var c,d=soya2d.Math;switch(i=Math.abs((i||0)>>0),a){case soya2d.GRADIENTTYPE_LINEAR:c=h.createLinearGradient(s,r,s+n*d.COSTABLE[i],r+n*d.SINTABLE[i]);for(var f=0,p=t.length;p>f;f++)c.addColorStop(t[f],e[f]||"RGBA(0,0,0,0)");break;case soya2d.GRADIENTTYPE_RADIAL:var m=n*u;c=h.createRadialGradient(s,r,l,s+m*d.COSTABLE[i],r+m*d.SINTABLE[i],n);for(var f=0,p=t.length;p>f;f++)c.addColorStop(t[f],e[f]||"RGBA(0,0,0,0)")}return c}},soya2d.CanvasRenderer.prototype.getImageFrom=function(t,e,n){var o=document.createElement("canvas");o.width=e||t.w,o.height=n||t.h;var i=o.getContext("2d"),s=new soya2d.CanvasGraphics(i),r=new Image;return r.src=o.toDataURL("image/png"),s=null,o=null,r},soya2d.__HitPathTester=function(t,e){function n(t){t.stroke=function(){},t.fill=function(){},t.fillRect=function(e,n,o,i){t.rect(e,n,o,i)
},t.strokeRect=function(e,n,o,i){t.rect(e,n,o,i)},t.drawImage=function(e,n,o,i,s,r,a,u,l){3===arguments.length?t.rect(n,o,e.width,e.height):5===arguments.length?t.rect(n,o,i,s):9===arguments.length&&t.rect(r,a,u,l)},t.fillText=function(){},t.strokeText=function(){}}function o(t,e,n){var o=t.__worldTransform.e,i=t.__worldPosition.e;if(e.setTransform(o[0],o[1],o[2],o[3],i[0],i[1]),t.onRender){e.beginPath();var s=t.__originPosition.e;e.translate(-s[0],-s[1]),t.onRender(n)}}var i=document.createElement("canvas");i.width=t,i.height=e;var s=i.getContext("2d"),r=new soya2d.CanvasGraphics(s);n(s),this.test=function(t,e,n){return o(t,s,r),s.isPointInPath(e,n)}},soya2d.__HitPixelTester=function(t,e){function n(t,e,n){var o=t.__worldTransform.e,i=t.__worldPosition.e;if(e.setTransform(o[0],o[1],o[2],o[3],i[0],i[1]),t.onRender){e.beginPath();var s=t.__originPosition.e;e.translate(-s[0],-s[1]),t.onRender(n)}}var t,e,o=document.createElement("canvas");o.width=t,o.height=e;var i=o.getContext("2d"),s=new soya2d.CanvasGraphics(i);this.test=function(o,r,a){n(o,i,s);var u=i.getImageData(0,0,t,e).data;return!!u[4*(t*a+r)+3]}},soya2d.HitTester=function(){soya2d.HitTester.prototype.test=function(){}},soya2d.Device=new function(){var t=this.userAgent=self.navigator.userAgent.toLowerCase(),e=t.indexOf("windows")>0?!0:!1,n=t.indexOf("linux")>0?!0:!1,o=t.indexOf("mac os")>0?!0:!1,i=t.indexOf("android")>0?!0:!1,s=t.indexOf("iphone")>0?!0:!1,r=t.indexOf("ipad")>0?!0:!1,a=t.indexOf("windows phone")>0?!0:!1;this.iphone=s,this.ipad=r,this.ios=s||r,this.android=i,this.wp=a,this.mobile=this.ios||i||a,this.windows=e,this.linux=n,this.mac=o;var u={Firefox:t.indexOf("firefox")+1,Opera:t.indexOf("opera")+1,Chrome:t.indexOf("chrome")+1,Safari:t.indexOf("safari")>-1&&t.indexOf("chrome")<0};this.ie=/msie|trident.*rv:/.test(t.toLowerCase()),this.ff=u.Firefox?!0:!1,this.opera=u.Opera?!0:!1,this.chrome=u.Chrome?!0:!1,this.safari=u.Safari?!0:!1},!function(){function t(t,e,n,o,i,s,r,a){n=r&&n>r?r:n,o=a&&o>a?a:o;var u=Math.max(n/t,o/e),l=t*u,h=e*u;return[l,h]}function e(t,e,n,o,i,s,r,a){n=r&&n>r?r:n,o=a&&o>a?a:o;var u=Math.min(n/t,o/e),l=t*u,h=e*u;return[l,h]}function n(t,e,n,o,i,s,r,a){var u,l;return u=i&&i>n?i:r&&n>r?r:n,l=s&&s>o?s:a&&o>a?a:o,[u,l]}soya2d.View=function(o){function i(){var t,e=window.innerWidth,n=window.innerHeight;return t=e>n?"landscape":"portrait"}function s(t,e,n,o){switch(e){case soya2d.ROTATEMODE_90:rs="rotate(90deg)";break;case soya2d.ROTATEMODE_180:rs="rotate(180deg)";break;case soya2d.ROTATEMODE_270:rs="rotate(270deg)";break;case soya2d.ROTATEMODE_0:default:rs="rotate(0deg)",u=soya2d.ROTATEMODE_0}if(n.style.transform=n.style.webkitTransform=n.style.mozTransform=n.style.msTransform=n.style.oTransform=rs,n.style.left=n.style.top=0,e===soya2d.ROTATEMODE_90||e===soya2d.ROTATEMODE_270){var i=n.offsetWidth,s=n.offsetHeight;if(t===soya2d.SCALEMODE_NOBORDER){var r=this.game.w,a=this.game.h;i=i>a?a:i,s=s>r?r:s}if(o.resize(s,i),t===soya2d.SCALEMODE_EXACTFIT){var l=(i-s)/2;l=s%2===0?l:Math.floor(l);var h=(s-i)/2;h=i%2===0?h:Math.floor(h),n.style.left=l+"px",n.style.top=h+"px"}}}this.game=o,this.scaleMode=soya2d.SCALEMODE_SHOWALL,this.minWidth=0,this.minHeight=0,this.maxWidth=0,this.maxHeight=0,this.autoScale=!0,this.scan=function(){if(this.game){var o,i=this.game.w,r=this.game.h;switch(this.scaleMode){case soya2d.SCALEMODE_NOSCALE:break;case soya2d.SCALEMODE_NOBORDER:o=t;break;case soya2d.SCALEMODE_EXACTFIT:o=n;break;case soya2d.SCALEMODE_SHOWALL:default:o=e}if(o){var a=this.game.getRenderer(),l=a.getCanvas().parentNode,h=l.clientWidth,c=l.clientHeight;"BODY"===l.tagName&&(c=window.innerHeight);var d=o(i,r,h,c,this.minWidth,this.minHeight,this.maxWidth,this.maxHeight);a.resize(d[0],d[1]),this.w=d[0],this.h=d[1],s(this.scaleMode,u,a.getCanvas(),a)}}},this.orientation=i();var r,a=this;window.addEventListener("orientationchange",function(){clearTimeout(r),r=setTimeout(function(){a.orientation=i()},500),a.autoScale&&a.scan()},!1),window.addEventListener("resize",function(){a.orientation=i(),a.autoScale&&a.scan()},!1);var u=soya2d.ROTATEMODE_0;this.rotate=function(t){return this.game?t?(u=t,this.scan(),this):u:void 0};var l=soya2d.ALIGNMODE_CENTER;this.align=function(t){if(this.game){if(t&&this.scaleMode===soya2d.SCALEMODE_SHOWALL){var e=this.game.getRenderer().getCanvas();switch(l=t,t){case soya2d.ALIGNMODE_LEFT:e.style.left=0,e.style.right="auto";break;case soya2d.ALIGNMODE_RIGHT:e.style.left="auto",e.style.right=0;break;case soya2d.ALIGNMODE_CENTER:default:e.style.left=0,e.style.right=0,l=soya2d.ALIGNMODE_CENTER}return e.style.margin="auto",this}return l}}},soya2d.SCALEMODE_NOSCALE=0,soya2d.SCALEMODE_SHOWALL=1,soya2d.SCALEMODE_NOBORDER=2,soya2d.SCALEMODE_EXACTFIT=3,soya2d.ALIGNMODE_LEFT=1,soya2d.ALIGNMODE_CENTER=2,soya2d.ALIGNMODE_RIGHT=3,soya2d.ROTATEMODE_0=1,soya2d.ROTATEMODE_90=2,soya2d.ROTATEMODE_180=3,soya2d.ROTATEMODE_270=4}(),soya2d.Font=function(t){var e=document.createElement("span");e.style.cssText="position:absolute;top:-9999px;left:-9999px;white-space:nowrap;font:"+(t||"normal 400 13px/normal sans-serif"),this.fontString=e.style.font,this.fontSize=parseInt(e.style.fontSize)||13,this.__renderText=function(t){if(t.font(this.font),this.__lines){t.fillStyle(this.fillStyle);for(var e=0,n=this.__lines.length;n>e;e++){var o=this.__lines[e];if(this.letterSpacing>0)for(var i=0,s=0,r=o.length;r>s;s++)t.fillText(o[s],i,(this.__lh+this.lineSpacing)*e),i+=this.letterSpacing+this.__uw;else t.fillText(o,0,(this.__lh+this.lineSpacing)*e)}}},this.clone=function(){return new soya2d.Font(this.getDesc())},this.getDesc=function(){return e.style.font},this.style=function(t){return arguments.length>0?(e.style.fontStyle=t,this.fontString=e.style.font,this):e.style.fontStyle},this.weight=function(t){return arguments.length>0?(e.style.fontWeight=t,this.fontString=e.style.font,this):e.style.fontWeight},this.size=function(t){return arguments.length>0?(e.style.fontSize=t+"px",this.fontString=e.style.font,this.fontSize=t,this):e.style.fontSize},this.family=function(t){return arguments.length>0?(t&&(e.style.fontFamily=t,this.fontString=e.style.font),this):e.style.fontFamily},this.getBounds=function(t,e){var n=e.ctx;n.font=this.getDesc();var o=n.measureText(t).width;return{w:o,h:this.fontSize}}},soya2d.ImageFont=function(t){this.__fontMap=t;var e=t.texs[Object.keys(t.texs)[0]].h;this.fontSize=e;var n=t.texs[Object.keys(t.texs)[0]].w,o=1;this.__renderText=function(t){if(this.__lines)for(var e=0,n=0,i=0,s=this.__lines.length;s>i;i++){for(var r=this.__lines[i],a=0,u=0,l=r.length;l>u;u++){var h=r[u],c=this.font.__fontMap.getTexture(h);if(c){var d=c.w*o,f=c.h*o;n=d,t.map(c,a,e,d,f,0,0,c.w,c.h)}a+=n+this.letterSpacing}e+=this.font.fontSize+this.lineSpacing}},this.clone=function(){return new soya2d.ImageFont(this.__fontMap)},this.size=function(t){return arguments.length>0?(this.fontSize=parseInt(t)||e,o=this.fontSize/e,this):this.fontSize},this.getBounds=function(t){var e=t.length;return{w:e*n*o,h:this.fontSize}}},soya2d.Text=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.text=t.text||"",this.letterSpacing=t.letterSpacing||0,this.lineSpacing=t.lineSpacing||0,this.font=t.font,"string"==typeof this.font&&(this.font=new soya2d.Font(this.font));var e=this.font||new soya2d.Font;this.font=e,this.__changed=!0,this.__lines,this.__renderer=this.font.__renderText},soya2d.inherits(soya2d.Text,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Text.prototype,{onRender:function(t){this.__renderer(t)},refresh:function(){this.__changed=!0},setFont:function(t){t&&(this.font=t,this.__renderer=this.font.__renderText)},setText:function(t){this.text=t+"",this.refresh()},_onUpdate:function(t){if(!this.__lh){var e=this.font.getBounds("s",t.getRenderer()),n=this.font.getBounds("豆",t.getRenderer());this.__lh=(e.h+n.h)/2>>0,this.__uw=(e.w+n.w)/2>>0}this.__changed&&(this.__lines=this.__calc(t.getRenderer()),this.__changed=!1)},__calc:function(t){var e=this.letterSpacing,n=this.w/(this.__uw+e)>>0;1>n&&(this.w=1.5*this.__uw,n=1);for(var o=this.font,i=this.text.split("\n"),s=[],r=0,a=i.length;a>r;r++){var u=i[r];if(u)for(var l=u.length,h=0;l>h;){var c=u.substr(h,n+1),d=o.getBounds(c,t).w+c.length*e;if(d>this.w){for(var f=n+1;f--;)if(c=c.substr(0,c.length-1),d=o.getBounds(c,t).w+c.length*e,d<=this.w){if(0===d)return;s.push(c),h+=c.length;break}}else{for(var p=h,f=1;l-h>f;f++){if(c=u.substr(h,n+1+f),d=o.getBounds(c,t).w+c.length*e,d>this.w){s.push(c.substr(0,c.length-1)),h+=c.length-1;break}if(c===u){n=u.length-1;break}}if(h===p){c=u.substr(h,n+1),s.push(c);break}}}else s.push("")}return s}}),soya2d.Texture=function(t,e,n){this.__data=t,this.w=parseInt(e)||t.width,this.h=parseInt(n)||t.height},soya2d.ext(soya2d.Texture,{fromImage:function(t){return new soya2d.Texture(t,t.width,t.height)},fromColor:function(t,e,n){var o=document.createElement("canvas");o.width=t,o.height=e;var i=o.getContext("2d");if(n instanceof Array){for(var s=soya2d.RGBColor.parse(n[0]||"#000000"),r=soya2d.RGBColor.parse(n[1]||"#000000"),a=soya2d.RGBColor.parse(n[2]||"#000000"),u=soya2d.RGBColor.parse(n[3]||"#000000"),l=new soya2d.HSLColor(s[0],s[1],s[2]),h=l.l,c=new soya2d.HSLColor(r[0],r[1],r[2]),d=c.l,f=new soya2d.HSLColor(a[0],a[1],a[2]),p=f.l,m=new soya2d.HSLColor(u[0],u[1],u[2]),y=m.l,g=i.createImageData(t,e),v=g.data,_=0,b=v.length;b>_;_+=4){var w=_/4%t,E=_/4/t>>0,A=(t-w)/t,S=(e-E)/e,x=A*S;l.lighteness(x*h);var T=l.getRGB();A=w/t,S=(e-E)/e,x=A*S,c.lighteness(x*d);var B=c.getRGB();A=(t-w)/t,S=E/e,x=A*S,f.lighteness(x*p);var C=f.getRGB();A=w/t,S=E/e,x=A*S,m.lighteness(x*y);var L=m.getRGB();v[_]=T[0]+B[0]+C[0]+L[0],v[_+1]=T[1]+B[1]+C[1]+L[1],v[_+2]=T[2]+B[2]+C[2]+L[2],v[_+3]=255}i.putImageData(g,0,0)}else i.fillStyle=n,i.fillRect(0,0,t,e);return new soya2d.Texture(o,t,e)}}),soya2d.Texture.prototype={dispose:function(){this.__data=null}},soya2d.TextureAtlas=function(t,e){this.texs={},e.forEach(function(e){var n=document.createElement("canvas");n.width=e.w,n.height=e.h;var o=n.getContext("2d");o.translate(e.w/2,e.h/2),o.rotate((e.r||0)*Math.PI/180);var i=e.w>>0,s=e.h>>0;return 0===i||0===s?(console.error("soya2d.TextureAtlas: invalid ssheet unit，w/h must be a positive;[w:"+i+",h:"+s+"] "),void 0):(o.drawImage(t.__data,e.x>>0,e.y>>0,i,s,-i/2>>0,-s/2>>0,i,s),this.texs[e.n]=new soya2d.Texture(n,i,s),void 0)},this)},soya2d.TextureAtlas.prototype={getTextures:function(t){var e=[];for(var n in this.texs)0===n.indexOf(t)&&e.push(this.texs[n]);return e},getTexture:function(t){return this.texs[t]},dispose:function(){for(var t in this.texs)this.texs[t].dispose();this.texs=null}},soya2d.TextureAtlasManager=function(){soya2d.ResourceManager.call(this),this._add=function(t,e){this.urlMap[t]=e}},soya2d.inherits(soya2d.TextureAtlasManager,soya2d.ResourceManager),soya2d.TextureManager=function(){soya2d.ResourceManager.call(this),this._add=function(t,e){this.urlMap[t]=e}},soya2d.inherits(soya2d.TextureManager,soya2d.ResourceManager),soya2d.AJAXLoader=new function(){function t(t){var e="";for(var n in t)e+="&"+n+"="+escape(t[n]);return e.substr(1)}function e(e,n,i,s,r,a,u,l,h,c){var d=new XMLHttpRequest;e=e||"get","get"===e&&(h="string"==typeof h?h:t(h),n.indexOf("?")>-1?(n=n.replace(/&$/,""),n+="&"+h.replace(/^&/,"")):n+="?"+h.replace(/^&/,""),h=null),d.open(e,n,i===!1?!1:!0),i&&(d.timeout=l||o),d.ontimeout=a,d.onerror=u,null===d.onload?(d.onload=function(){(0===d.status||d.status>=200&&d.status<300||304===d.status)&&s(d)},d.onprogress=function(t){r&&t.lengthComputable&&r(d,t.loaded,t.total)}):d.onreadystatechange=function(){(0===d.status||(d.status>=200&&d.status<300||304===d.status)&&4===d.readyState)&&s(d)},"post"===e&&(h="string"==typeof h?h:t(h),d.setRequestHeader("Content-Type",c||"application/x-www-form-urlencoded")),d.send(h)}function n(e,n,i,s,r,a,u,l,h,c){var d=new XMLHttpRequest;d.open("post",n,i===!1?!1:!0),i&&(d.timeout=l||o),d.ontimeout=a,d.upload&&(d.upload.addEventListener("progress",function(t){if(r&&t.lengthComputable){{t.loaded/t.total}r(d,t.loaded,t.total)}},!1),d.upload.addEventListener("error",u,!1)),null===d.onload?d.onload=function(){(0===d.status||d.status>=200&&d.status<300||304===d.status)&&s(d)}:d.onreadystatechange=function(){(0===d.status||(d.status>=200&&d.status<300||304===d.status)&&4===d.readyState)&&s(d)},d.setRequestHeader("Content-Type",c||"application/x-www-form-urlencoded"),h="string"==typeof h?h:t(h),d.send(h)}var o=5e3;this.loadText=function(t){t&&t.onLoad instanceof Function&&e(t.type,t.url,t.async,function(e){t.onLoad(e.responseText)},t.onProgress,t.onTimeout,t.onError,t.timeout,t.data)},this.loadJSON=function(t){t&&t.onLoad instanceof Function&&e(t.type,t.url,t.async,function(e){var n;try{n=new Function("return "+e.responseText)()}catch(o){n=o}t.onLoad(n)},t.onProgress,t.onTimeout,t.onError,t.timeout,t.data)},this.uploadText=function(t){t&&t.onLoad instanceof Function&&n(t.type,t.url,t.async,function(e){t.onLoad(e.responseText)},t.onProgress,t.onTimeout,t.onError,t.timeout,t.data+"")}},soya2d.Loader=new function(){function t(e,n,o,i,s){var r=document.createElement("script");r.onload=function(){return this.onerror=null,this.onload=null,document.body.removeChild(this),o&&o.call&&o(this.src),n--,n?(t(e,n,o,i,s),void 0):(s&&s.call&&s(),void 0)},r.onerror=function(){return this.onerror=null,this.onload=null,document.body.removeChild(this),i&&i.call&&i(this.src),n--,n?(t(e,n,o,i,s),void 0):(s&&s.call&&s(),void 0)},r.src=e.shift(),document.body.appendChild(r)}function e(t,e,o,i,s,r){for(var a=["serif","sans-serif"],u="border:none;position:absolute;top:-999px;left:-999px;font-size:100px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:",l={},h={},c={},d=a.length;d--;){var f=document.createElement("div");f.style.cssText=u+"'"+a[d]+"'",f.innerHTML=e.family,document.body.appendChild(f),c[a[d]]=f,l[a[d]]=f.offsetWidth,h[a[d]]=f.offsetHeight}var p=document.createElement("style");p.id="FontLoader_"+(new Date).getTime(),p.innerHTML="@font-face {font-family: '"+e.family+"';src: url("+e.url+")}",document.head.appendChild(p);for(var d in c)c[d].style.fontFamily=e.family+","+c[d].style.fontFamily;var m=(new Date).getTime();setTimeout(function(){n(t,m,r,c,l,h,o,s,i,e.family)},100)}function n(t,e,i,s,r,a,u,l,h,c){setTimeout(function(){if((new Date).getTime()-e>i)return h&&h.call&&h(c),o--,!o&&l&&l.call&&l(),void 0;for(var d in s){s[d].style.left="-1000px";var f=s[d].offsetWidth,p=s[d].offsetHeight;if(f!==r[d]||p!==a[d]){var m;return u&&u.call&&(m=(new soya2d.Font).family(c),u(m,c)),t[o--]=m,!o&&l&&l.call&&l(t),void 0}}n(t,e,i,s,r,a,u,l,h,c)},20)}this.loadTextures=function(t){for(var e=t.urls.length,n=t.onLoad,o=t.onEnd,i=t.onError,s=(t.onTimeout,t.timeout||soya2d.TIMEOUT,t.crossOrigin),r=new Array(e),a=t.urls.length;a--;){var u=new Image;void 0!==s&&(u.crossOrigin=s),u.i=a,u.path=t.urls[a],u.onload=function(){var t=new soya2d.Texture.fromImage(this);r[this.i]=t,delete this.i,n&&n.call&&n(t,this.path),e--,!e&&o&&o.call&&o(r),this.onerror=null,this.onload=null},u.onerror=function(){i&&i.call&&i(this.src),e--,!e&&o&&o.call&&o(),this.onerror=null,this.onload=null},u.src=t.urls[a],u.complete&&u.onload()}return this},this.loadScripts=function(e){var n=e.urls.length,o=e.onLoad,i=e.onEnd,s=e.onError,r=document,a=document.body,u=e.mode||soya2d.LOADMODE_SEQU;if(u===soya2d.LOADMODE_SEQU)t(e.urls.concat(),n,o,s,i);else for(var l=e.urls.length;l--;){var h=r.createElement("script");h.async||(h.defer=!0),h.onload=function(){this.onerror=null,this.onload=null,document.body.removeChild(this),o&&o.call&&o(this.src),n--,!n&&i&&i.call&&i()},h.onerror=function(){this.onerror=null,this.onload=null,document.body.removeChild(this),s&&s.call&&s(this.src),n--,!n&&i&&i.call&&i()},h.src=e.urls[l],a.appendChild(h)}return this},this.loadSounds=function(t){for(var e=t.urls.length,n=t.onLoad,o=t.onEnd,i=t.onError,s=[],r=t.urls.length;r--;){var a=t.urls[r];new Howl({src:a instanceof Array?a:[a],onload:function(){if(n&&n.call){var t=new soya2d.Sound;t.__handler=this,s.push(t),n(t,this._src)}e--,!e&&o&&o.call&&o(s)},onloaderror:function(t){if(i&&i.call){var n=soya2d.MEDIA_ERR_DECODE;t&&(n=t.type),i(n,this._src)}e--,!e&&o&&o.call&&o(s)}})}return this};var o=0;this.loadFonts=function(t){var n=t.urls.length,i=t.onLoad,s=t.onEnd,r=t.onTimeout,a=t.timeout||soya2d.TIMEOUT,u=new Array(n);o=n;for(var l=t.urls.length;l--;)e(u,t.urls[l],i,r,s,a)},this.loadTexAtlas=function(t){for(var e=t.urls.length,n=t.onLoad,o=t.onEnd,i=t.onError,s=[],r={},a=e;a--;)s.push(t.urls[a].image),r[t.urls[a].image]=t.urls[a].ssheet;var u=[];this.loadTextures({urls:s,onLoad:function(t,s){soya2d.AJAXLoader.loadJSON({url:r[s],onLoad:function(i){var a=new soya2d.TextureAtlas(t,i);n&&n(a,t,i,s,r[s]),u.push(a),0===--e&&o&&o(u)},onError:function(){e--,i&&i(s,r[s])}})},onError:function(t){e--,i&&i(t,r[t])}})}},soya2d.TIMEOUT=5e3,soya2d.MEDIA_ERR_UNCERTAIN=-1,soya2d.MEDIA_ERR_ABORTED=1,soya2d.MEDIA_ERR_NETWORK=2,soya2d.MEDIA_ERR_DECODE=3,soya2d.MEDIA_ERR_SRC_NOT_SUPPORTED=4,soya2d.MEDIA_ERR_SRC_NOT_FORTHCOMING=101,soya2d.LOADMODE_PARA=1,soya2d.LOADMODE_SEQU=2,soya2d.Game=function(t){function e(t,e,n,o,i){"use strict";for(var s={},r=n.length;r--;)s[n[r].image+"/"+n[r].ssheet]=n[r].id;e.loadTexAtlas({crossOrigin:t,urls:n,onLoad:function(t,e,n,i,r){c.textureManager._add(i,e);var a=s[i+"/"+r];c.texAtlasManager._add(a,t),o(t,e,n)},onError:function(t,e){o(t,e)},onEnd:function(){i()}})}function n(t,e,n,o,i){"use strict";e.loadScripts({crossOrigin:t,urls:n,onLoad:function(t){o(t)},onError:function(t){o(t)},onEnd:function(){i()}})}function o(t,e,n,o,i){"use strict";e.loadSounds({urls:n,onLoad:function(t,e){c.soundManager._add(e,t),o(e)},onError:function(t,e){o(e)},onEnd:function(t){i(t)}})}function i(t,e,n,o,i){"use strict";e.loadTextures({crossOrigin:t,urls:n,onLoad:function(t,e){c.textureManager._add(e,t),o()},onError:function(t){o(t)},onEnd:function(){i()}})}function s(t,e,n,o,i){"use strict";e.loadFonts({urls:n,timeout:1e3,onLoad:function(t,e){o(t,e)},onTimeout:function(t){o(t)},onEnd:function(){i()}})}function r(t){c.running&&(f=requestAFrame(function(e){0===p&&(p=e);var n=e-p;if(p=e,g>d){var o=Date.now();t&&t(o,n),g%=d}g+=n,r(t)}))}t=t||{};var a=t.container||document.body;"string"==typeof a&&(a=document.querySelector(a));var u=(t.rendererType||soya2d.RENDERER_TYPE_CANVAS,a.offsetWidth||100),l=a.offsetHeight||100,h=null;h=new soya2d.CanvasRenderer({smoothEnable:t.smoothEnable,autoClear:t.autoClear,container:a,sortEnable:!0,w:t.w||u,h:t.h||l}),soya2d.ext(this,t),this.scene=null,this.getRenderer=function(){return h},this.view=new soya2d.View(this),this.textureManager=new soya2d.TextureManager,this.texAtlasManager=new soya2d.TextureAtlasManager,this.loadRes=function(t){var r=t.textures||[],a=t.texAtlas||[],u=t.fonts||[],l=t.sounds||[],h=t.scripts||[],c=t.onLoad||function(){},d=t.onEnd||function(){},f=t.crossOrigin,p=soya2d.Loader,m=[];r.length>0&&m.push([i,r]),a.length>0&&m.push([e,a]),soya2d.Sound&&l.length>0&&m.push([o,l]),u.length>0&&m.push([s,u]),h.length>0&&m.push([n,h]);var y=m.length;y>0?m[0][0](f,p,m[0][1],c,function(){y>1?m[1][0](f,p,m[1][1],c,function(){y>2?m[2][0](f,p,m[2][1],c,function(){y>3?m[3][0](f,p,m[3][1],c,function(){y>4?m[4][0](f,p,m[4][1],c,d):d()}):d()}):d()}):d()}):(soya2d.console.warn("empty resources be loaded..."),d())};var c=this;this.w=h.w,this.h=h.h,this.running=!1,this.start=function(t){if(!this.running){this.running=!0,this.scene||this.cutTo(t),soya2d.console.info("game starting..."),t.children.length<1&&soya2d.console.warn("empty scene be showing..."),this.view.scan(this.w,this.h,a,h),this.view.align(this.view.align());var e=soya2d.module._getAll(),n=[],o=[],i=[],s=[],u=[];for(var l in e)e[l].onStart&&e[l].onStart(this),e[l].onBeforeUpdate&&n.push(e[l].onBeforeUpdate),e[l].onUpdate&&o.push(e[l].onUpdate),e[l].onAfterUpdate&&i.push(e[l].onAfterUpdate),e[l].onBeforeRender&&s.push(e[l].onBeforeRender),e[l].onAfterRender&&u.push(e[l].onAfterRender);return d=1e3/y,r(function(t,e){n.forEach(function(n){n(c,t,e)}),o.length>0&&(t=Date.now(),o.forEach(function(n){n(c,t,e)})),c.scene.__update(c),i.length>0&&(t=Date.now(),i.forEach(function(n){n(c,t,e)})),s.length>0&&(t=Date.now(),s.forEach(function(n){n(c,t,e)})),h.render(c.scene),u.length>0&&(t=Date.now(),u.forEach(function(n){n(c,t,e)}))}),this}};var d,f,p=0,m=60,y=60,g=0;this.setFPS=function(t){return y=parseInt(t)||m,y=y>m?m:y,d=1e3/y,this},this.stop=function(){cancelAFrame(f),this.running=!1;var t=soya2d.module._getAll();for(var e in t)t[e].onStop&&t[e].onStop(this);return this},this.cutTo=function(t){if(t){var e=!1;if(this.scene&&(e=!0,this.scene.clear()),this.scene=t,this.scene.game=this,this.scene.onInit&&this.scene.onInit.call&&this.scene.onInit(this),e){var n=soya2d.module._getAll();for(var o in n)n[o].onSceneChange&&n[o].onSceneChange(this,t)}return this}};var v=soya2d.module._getAll(),_=0;for(var b in v)v[b].onInit&&v[b].onInit(this),_++;var w="soya2d Game instance created...",E=_+" plugins loaded...";soya2d.console.info(w),soya2d.console.info(E),soya2d.games.push(this)},soya2d.games=[];var t1="soya2d "+soya2d.version.toString()+" is working...",t2="==== thank you for using soya2d, you'll love it! ====";soya2d.console.info(t1),soya2d.console.info(t2),soya2d.RENDERER_TYPE_AUTO=1,soya2d.RENDERER_TYPE_CANVAS=2,soya2d.RENDERER_TYPE_WEBGL=3,soya2d.LoaderScene=function(t){t=t||{},soya2d.Scene.call(this,t),soya2d.ext(this,t),this.nextScene=t.nextScene,this.textures=t.textures||[],this.texAtlas=t.texAtlas||[],this.sounds=t.sounds||[],this.scripts=t.scripts||[],this.fonts=t.fonts||[];var e=t.onStart,n=t.onProgress,o=t.onEnd;this.onInit=function(t){var i=0,s=this.textures.length+this.texAtlas.length+this.sounds.length+this.scripts.length+this.fonts.length;if(1>s)return soya2d.console.warn("empty resources be loaded..."),this.onEnd&&this.onEnd(t,s),o instanceof Function&&o.call(this,t,s),this.nextScene&&t.cutTo(this.nextScene),void 0;this.onStart&&this.onStart(t,s),e instanceof Function&&e.call(this,t,s);var r=this;t.loadRes({textures:this.textures,texAtlas:this.texAtlas,sounds:this.sounds,fonts:this.fonts,scripts:this.scripts,onLoad:function(){r.onProgress&&r.onProgress(t,s,++i),n instanceof Function&&n.call(r,t,s,i)},onEnd:function(){r.onEnd&&r.onEnd(t,s),o instanceof Function&&o.call(r,t,s),r.nextScene&&t.cutTo(r.nextScene)}})},this.onStart=function(t){var e=new soya2d.Shape({x:t.w/2-11,y:t.h/2-30-20}),n=new soya2d.Shape({w:23,h:20,skewY:-30,fillStyle:"#69CA14",onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.rect(0,0,this.w,this.h),t.fill(),t.closePath()}}),o=new soya2d.Shape({w:23,h:20,skewY:30,y:13,opacity:.9,fillStyle:"#2A5909",onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.rect(0,0,this.w,this.h),t.fill(),t.closePath()}}),i=new soya2d.Shape({w:23,h:20,skewY:-30,y:28,blendMode:soya2d.BLEND_LIGHTER,fillStyle:"#69CA14",onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.rect(0,0,this.w,this.h),t.fill(),t.closePath()}});e.add(n,o,i),this.add(e);var s=new soya2d.Font("normal 400 23px/normal Arial,Helvetica,sans-serif");this.tip=new soya2d.Text({x:e.x-70,y:e.y+60+10,font:s,text:"Loading... 0/0",w:200,fillStyle:this.fillStyle||"#fff"}),this.add(this.tip)},this.onProgress=function(t,e,n){this.tip&&this.tip.setText("Loading... "+n+"/"+e)},this.onEnd=function(){}},soya2d.inherits(soya2d.LoaderScene,soya2d.Scene),soya2d.Tween=function(t,e,n,o){this.__attr={},this.__attr_inverse={},this.__attriNames,this.attris=e,this.target=t,this.duration=n,o=o||{},this.easing=o.easing||soya2d.Tween.Linear,this.iteration=o.iteration||0,this.alternate=o.alternate||!1,this.onUpdate=o.onUpdate,this.onEnd=o.onEnd,this.cacheable=o.cacheable||!1,this.__loops=0,this.__delay=0},soya2d.Tween.prototype={__calc:function(t){for(var e=this.__attriNames=Object.getOwnPropertyNames(this.attris),n=e.length;n--;){var o=e[n],i=this.target[o];if(i!==t){var s=parseFloat(i||0),r=this.attris[o];("string"==typeof r||r instanceof String)&&(r=0===r.indexOf("-")?s-parseFloat(r.substring(1,r.length)):0===r.indexOf("+")?s+parseFloat(r.substring(1,r.length)):parseFloat(r));var a=r-s;this.__attr[o]={initVal:s,varVal:a,endVal:r};var u=s-r;if(this.__attr_inverse[o]={initVal:r,varVal:u,endVal:s},this.cacheable){this.__ratio={},this.__ratio_inverse={};for(var l=this.__attr[o].dVal={},h=this.__attr_inverse[o].dVal={},c=0;(c+=10)<this.duration;){var d=this.easing(c,0,1,this.duration);this.__ratio["p_"+c]=d,l["p_"+c]=s+a*d,d=this.easing(c,0,1,this.duration),this.__ratio_inverse["p_"+c]=d,h["p_"+c]=r+u*d}}}}},start:function(){return this.__calc(),this.__startTime=Date.now(),this.target.__soya__tween instanceof soya2d.Tween&&this.target.__soya__tween.stop(),this.target.__soya__tween=this,soya2d.TweenManager.add(this),this},delay:function(t){return this.__delay=t,this},stop:function(){return delete this.target.__soya__tween,soya2d.TweenManager.remove(this),this},goTo:function(t,e,n){var o,i=this.__attriNames,s=this.__attr,r=t;if(this.cacheable){var a="p_"+10*(e/10>>0);o=this.__ratio[a],"p_0"===a&&(o=0),o===n&&(o=1);for(var u=i.length;u--;){var l=i[u];if(s[l]){var h=s[l].dVal[a];h===n&&(h=s[l].endVal),r[l]=h}}}else{o=this.easing(e,0,1,this.duration),e>this.duration&&(o=1);for(var u=i.length;u--;){var l=i[u];s[l]&&(r[l]=s[l].initVal+s[l].varVal*o)}}return o},update:function(t,e){var n=t-this.__startTime;if(this.__delay>0)return this.__delay-=e,this.__delay<=0&&(this.__startTime=Date.now()),void 0;var o=this.target,i=this.goTo(o,n);if(n>=this.duration){if(this.onEnd&&this.onEnd(o),-1===this.iteration||this.iteration>0&&this.__loops++<this.iteration){if(this.__startTime=Date.now(),this.alternate){var s=this.__attr;this.__attr=this.__attr_inverse,this.__attr_inverse=s,s=this.__ratio,this.__ratio=this.__ratio_inverse,this.__ratio_inverse=s}return}return this.destroy(),soya2d.TweenManager.remove(this),this.__next&&this.__next.start(),void 0}this.onUpdate&&this.onUpdate(o,i)},destroy:function(){this.__attr=null,this.__ratio=null,this.attris=null,this.easing=null,delete this.target.__soya__tween,this.target=null,this.onUpdate=null,this.onEnd=null},next:function(t){return this.__next=t,-1===this.iteration&&soya2d.console.warn("invalid [next] setting on infinite loop instance..."),this}},soya2d.ext(soya2d.DisplayObject.prototype,{animate:function(t,e,n,o){var i=new soya2d.Tween(this,t,e,n);return o=o===!1?!1:o||!0,o&&i.start(),i},stopAnimation:function(){return this.__soya__tween&&this.__soya__tween.stop(),this}}),soya2d.Path=function(t){this.d=t||"",this.cmd=["m","l","c","q","z"],this._insQ=[],this.__parse()},soya2d.ext(soya2d.Path.prototype,{__parse:function(){var t=new RegExp("["+this.cmd.join("")+"]([^"+this.cmd.join("")+"]+|$)","img"),e=this.d.replace(/^\s+|\s+$/,"").match(t);e.forEach(function(t){t=t.replace(/^\s+|\s+$/,"");var e=t[0].toLowerCase();if(this.cmd.indexOf(e)>-1){var n=t.substr(1).replace(/^\s/gm,"").split(/\n|,|\s/gm);this._insQ.push([e,n])}},this)},setData:function(t){this.d=t,this.__parse()}}),soya2d.PathTween=function(t,e,n,o){this.__pps=[],this.__pps_inverse=[],this.path=e,this.target=t,this.duration=n,o=o||{},this.easing=o.easing||soya2d.Tween.Linear,this.iteration=o.iteration||0,this.alternate=o.alternate||!1,this.onUpdate=o.onUpdate,this.onEnd=o.onEnd,this.__loops=0,this.__radian},soya2d.PathTween.prototype={__calc:function(){var t=0,e=0,n=0,o=0;this.path._insQ.forEach(function(i){var s=i[0].toLowerCase();switch(s){case"m":n=t=parseFloat(i[1][0]),o=e=parseFloat(i[1][1]);break;case"l":for(var r=i[1],a=0;a<r.length;a+=2){for(var u=Math.atan2(r[a+1]-e,r[a]-t),h=soya2d.Math.len2D(t,e,r[a],r[a+1]),c=0;h>c;c++){var d=c*Math.cos(u)+t,f=c*Math.sin(u)+e;this.__pps.push(d,f)}t=parseFloat(r[a]),e=parseFloat(r[a+1])}break;case"c":for(var p=[],r=i[1],a=0;a<r.length;a+=6){for(var m=0;1>m;m+=.01){var y=m*m,g=y*m,d=t*(1-3*m+3*y-g)+3*r[a]*m*(1-2*m+y)+3*r[a+2]*y*(1-m)+r[a+4]*g,f=e*(1-3*m+3*y-g)+3*r[a+1]*m*(1-2*m+y)+3*r[a+3]*y*(1-m)+r[a+5]*g;p.push(d,f)}t=parseFloat(r[a+4]),e=parseFloat(r[a+5])}(p[p.length-2]!=r[r.length-2]||p[p.length-1]!=r[r.length-1])&&p.push(r[r.length-2],r[r.length-1]);for(var v=0,_={},a=0;a<p.length-2;a+=2){var h=soya2d.Math.len2D(p[a],p[a+1],p[a+2],p[a+3]),u=Math.atan2(p[a+3]-p[a+1],p[a+2]-p[a]);_[v]=[u,p[a],p[a+1],h],v+=h}for(var b=[p[0],p[1]],a=1;v>a;a++){for(var w,E,A,u=0,S=Object.keys(_),x=S.length;x--;)if(A=parseFloat(S[x]),a>=A){u=_[A][0],w=_[A][1],E=_[A][2],l=_[A][3];break}if(0!==u){var d=(a-A)*Math.cos(u)+w,f=(a-A)*Math.sin(u)+E;b.push(d,f)}}this.__pps=this.__pps.concat(b);break;case"q":for(var p=[],r=i[1],a=0;a<r.length;a+=4){for(var m=0;1>m;m+=.01){var y=m*m,g=y*m,d=t*(1-2*m+y)+2*r[a]*m*(1-m)+r[a+2]*y,f=e*(1-2*m+y)+2*r[a+1]*m*(1-m)+r[a+3]*y;p.push(d,f)}t=parseFloat(r[a+2]),e=parseFloat(r[a+3])}(p[p.length-2]!=r[r.length-2]||p[p.length-1]!=r[r.length-1])&&p.push(r[r.length-2],r[r.length-1]);for(var v=0,_={},a=0;a<p.length-2;a+=2){var h=soya2d.Math.len2D(p[a],p[a+1],p[a+2],p[a+3]),u=Math.atan2(p[a+3]-p[a+1],p[a+2]-p[a]);_[v]=[u,p[a],p[a+1],h],v+=h}for(var b=[p[0],p[1]],a=1;v>a;a++){for(var w,E,A,u=0,S=Object.keys(_),x=S.length;x--;)if(A=parseFloat(S[x]),a>=A){u=_[A][0],w=_[A][1],E=_[A][2],l=_[A][3];break}if(0!==u){var d=(a-A)*Math.cos(u)+w,f=(a-A)*Math.sin(u)+E;b.push(d,f)}}this.__pps=this.__pps.concat(b);break;case"z":for(var u=Math.atan2(o-e,n-t),h=soya2d.Math.len2D(t,e,n,o),c=0;h>c;c++){var d=c*Math.cos(u)+t,f=c*Math.sin(u)+e;this.__pps.push(d,f)}}},this);for(var i=this.__pps.length-2;i>0;i-=2)this.__pps_inverse.push(this.__pps[i],this.__pps[i+1])},start:function(){return this.__calc(),this.__startTime=Date.now(),this.target.__pt instanceof soya2d.PathTween&&this.target.__pt.stop(),this.target.__pt=this,soya2d.TweenManager.add(this),this},delay:function(t){return this.__delay=t,this},stop:function(){return soya2d.TweenManager.remove(this),this},goTo:function(t,e){var n,o=this.__pps,i=t;n=this.easing(e,0,1,this.duration),e>this.duration&&(n=1);var s=(o.length-2)*n>>0;s>o.length-2&&(s=o.length-2),0>s&&(s*=-1),s%2!=0&&s++,i.x=o[s],i.y=o[s+1];var r,a;return 1>s?(r=o[s+2],a=o[s+3],this.__radian=Math.atan2(a-i.y,r-i.x)):(r=o[s-2],a=o[s-1],this.__radian=Math.atan2(i.y-a,i.x-r)),n},update:function(t,e){var n=t-this.__startTime;if(this.__delay>0)return this.__delay-=e,this.__delay<=0&&(this.__startTime=Date.now()),void 0;var o=this.target,i=this.goTo(o,n);if(n>=this.duration){if(this.onEnd&&this.onEnd(o),-1===this.iteration||this.iteration>0&&this.__loops++<this.iteration){if(this.__startTime=Date.now(),this.alternate){var s=this.__pps;this.__pps=this.__pps_inverse,this.__pps_inverse=s}return}return this.destroy(),soya2d.TweenManager.remove(this),this.__next&&this.__next.start(),void 0}this.onUpdate&&this.onUpdate(o,i,this.__radian*soya2d.Math.ONEANG)},destroy:function(){this.__pps=null,this.__pps_inverse=null,this.easing=null,this.target=null,this.onUpdate=null,this.onEnd=null},next:function(t){return this.__next=t,-1===this.iteration&&soya2d.console.warn("invalid [next] setting on infinite loop instance..."),this}},soya2d.ext(soya2d.DisplayObject.prototype,{pathAnimate:function(t,e,n,o){var i=new soya2d.PathTween(this,t,e,n);return o=o===!1?!1:o||!0,o&&i.start(),i},stopPathAnimation:function(){return this.__pt&&(this.__pt.stop(),delete this.__pt),this}}),soya2d.TweenManager=new function(){var t=[];this.add=function(e){var n=t.indexOf(e);return n>-1?this:(t.push(e),this)},this.remove=function(e){var n=t.indexOf(e);return n>-1&&t.splice(n,1),this},this.stop=function(){t=[]},this.update=function(e,n){for(var o=t.length;o--;)t[o].update(e,n)}},soya2d.Tween.Linear=function(t,e,n,o){return n*t/o+e},soya2d.Tween.Quad={In:function(t,e,n,o){return n*(t/=o)*t+e},Out:function(t,e,n,o){return-n*(t/=o)*(t-2)+e},InOut:function(t,e,n,o){return(t/=o/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e}},soya2d.Tween.Cubic={In:function(t,e,n,o){return n*(t/=o)*t*t+e},Out:function(t,e,n,o){return n*((t=t/o-1)*t*t+1)+e},InOut:function(t,e,n,o){return(t/=o/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e}},soya2d.Tween.Quart={In:function(t,e,n,o){return n*(t/=o)*t*t*t+e
},Out:function(t,e,n,o){return-n*((t=t/o-1)*t*t*t-1)+e},InOut:function(t,e,n,o){return(t/=o/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e}},soya2d.Tween.Quint={In:function(t,e,n,o){return n*(t/=o)*t*t*t*t+e},Out:function(t,e,n,o){return n*((t=t/o-1)*t*t*t*t+1)+e},InOut:function(t,e,n,o){return(t/=o/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e}},soya2d.Tween.Sine={In:function(t,e,n,o){return-n*Math.cos(t/o*(Math.PI/2))+n+e},Out:function(t,e,n,o){return n*Math.sin(t/o*(Math.PI/2))+e},InOut:function(t,e,n,o){return-n/2*(Math.cos(Math.PI*t/o)-1)+e}},soya2d.Tween.Expo={In:function(t,e,n,o){return 0===t?e:n*Math.pow(2,10*(t/o-1))+e},Out:function(t,e,n,o){return t===o?e+n:n*(-Math.pow(2,-10*t/o)+1)+e},InOut:function(t,e,n,o){return 0===t?e:t===o?e+n:(t/=o/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(-Math.pow(2,-10*--t)+2)+e}},soya2d.Tween.Circ={In:function(t,e,n,o){return-n*(Math.sqrt(1-(t/=o)*t)-1)+e},Out:function(t,e,n,o){return n*Math.sqrt(1-(t=t/o-1)*t)+e},InOut:function(t,e,n,o){return(t/=o/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e}},soya2d.Tween.Elastic={In:function(t,e,n,o,i,s){if(0===t)return e;if(1===(t/=o))return e+n;if(s||(s=.3*o),!i||i<Math.abs(n)){i=n;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(n/i);return-(i*Math.pow(2,10*(t-=1))*Math.sin(2*(t*o-r)*Math.PI/s))+e},Out:function(t,e,n,o,i,s){if(0===t)return e;if(1===(t/=o))return e+n;if(s||(s=.3*o),!i||i<Math.abs(n)){i=n;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(n/i);return i*Math.pow(2,-10*t)*Math.sin(2*(t*o-r)*Math.PI/s)+n+e},InOut:function(t,e,n,o,i,s){if(0===t)return e;if(2===(t/=o/2))return e+n;if(s||(s=.3*o*1.5),!i||i<Math.abs(n)){i=n;var r=s/4}else var r=s/(2*Math.PI)*Math.asin(n/i);return 1>t?-.5*i*Math.pow(2,10*(t-=1))*Math.sin(2*(t*o-r)*Math.PI/s)+e:i*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*o-r)*Math.PI/s)*.5+n+e}},soya2d.Tween.Back={In:function(t,e,n,o,i){return void 0===i&&(i=1.70158),n*(t/=o)*t*((i+1)*t-i)+e},Out:function(t,e,n,o,i){return void 0===i&&(i=.70158),n*((t=t/o-1)*t*((i+1)*t+i)+1)+e},InOut:function(t,e,n,o,i){return void 0===i&&(i=1.70158),(t/=o/2)<1?n/2*t*t*(((i*=1.525)+1)*t-i)+e:n/2*((t-=2)*t*(((i*=1.525)+1)*t+i)+2)+e}},soya2d.Tween.Bounce={In:function(t,e,n,o){return n-soya2d.Tween.Bounce.Out(o-t,0,n,o)+e},Out:function(t,e,n,o){return(t/=o)<1/2.75?7.5625*n*t*t+e:2/2.75>t?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},InOut:function(t,e,n,o){return o/2>t?.5*soya2d.Tween.Bounce.In(2*t,0,n,o)+e:.5*soya2d.Tween.Bounce.Out(2*t-o,0,n,o)+.5*n+e}},soya2d.module.install("tween",{onUpdate:function(t,e,n){soya2d.TweenManager.update(e,n)},onStop:function(){soya2d.TweenManager.stop()}}),soya2d.Arc=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.Arc,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Arc.prototype,{onRender:function(t){t.beginPath();var e=this.w/2,n=this.h/2;t.fillStyle(this.fillStyle);var o=(this.startAngle||0)*soya2d.Math.ONERAD,i=(this.endAngle||0)*soya2d.Math.ONERAD;t.arc(e,n,this.w/2,o,i),i-o!=0&&360!=Math.abs(this.startAngle||0-this.endAngle||0)&&t.lineTo(e,n),t.fill(),t.closePath(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke()),t.moveTo(e,n)}}),soya2d.Ellipse=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.Ellipse,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Ellipse.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.ellipse(0,0,this.w,this.h),t.closePath(),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.Poly=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.bounds=new soya2d.Polygon(t.vtx),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.Poly,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Poly.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.polygon(this.vtx),t.closePath(),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.Rect=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.Rect,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.Rect.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.rect(0,0,this.w,this.h),t.fill(),t.closePath(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.RPoly=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.RPoly,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.RPoly.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle),t.regularPolygon(this.w/2,this.h/2,this.edgeCount,this.r||this.w/2,this.w/2),t.closePath(),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.RRect=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent",this.r=t.r||0},soya2d.inherits(soya2d.RRect,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.RRect.prototype,{onRender:function(t){t.beginPath(),t.moveTo(0,0),t.fillStyle(this.fillStyle),t.roundRect(0,0,this.w,this.h,this.r),t.fill(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke()),t.closePath()}}),soya2d.EArc=function(t){t=t||{},soya2d.DisplayObjectContainer.call(this,t),soya2d.ext(this,t),this.fillStyle=t.fillStyle||"transparent"},soya2d.inherits(soya2d.EArc,soya2d.DisplayObjectContainer),soya2d.ext(soya2d.EArc.prototype,{onRender:function(t){t.beginPath(),t.fillStyle(this.fillStyle);var e=this.startAngle||0,n=this.endAngle||0;t.eArc(this.w/2,this.h/2,this.w/2,this.h/2,e,n),n-e!=0&&360!=Math.abs(e-n)&&t.lineTo(this.w/2,this.h/2),t.fill(),t.closePath(),this.lineWidth>0&&(t.lineStyle(this.lineWidth),t.strokeStyle(this.strokeStyle),t.stroke())}}),soya2d.EventHandler=function(){this.__eventMap={},this.addListener=function(t,e,n,o){this.__eventMap[t]||(this.__eventMap[t]=[]),this.__eventMap[t].push({fn:e,order:o||0,context:n})},this.removeListener=function(t,e,n){if(this.__eventMap[t]){for(var o=-1,i=this.__eventMap[t].length;i--;)if(n==this.__eventMap[t].context&&(e?this.__eventMap[t].fn==e:!0)){o=i;break}o>-1&&this.__eventMap[t].splice(o,1)}},this.clearListener=function(t){t?(this.__eventMap[t]=null,delete this.__eventMap[t]):this.__eventMap={}}},soya2d.Events=function(){var t=[];this.register=function(e,n){t.push([e,n])},this.scan=function(){for(var e=t.length;e--;)t[e][1].scan()},this.startListen=function(e){for(var n=t.length;n--;)t[n][1].startListen(e);return this},this.stopListen=function(e){for(var n=t.length;n--;)t[n][1].stopListen(e);return this},this.addListener=function(e,n,o,i){for(var s=e.split(" "),r=s.length;r--;)for(var a=s[r],u=t.length;u--;)if(t[u][0].indexOf(a)>-1){t[u][1].addListener(a,n,o,i);break}},this.removeListener=function(e,n,o){for(var i=e.split(" "),s=i.length;s--;)for(var r=i[s],a=t.length;a--;)if(t[a][0].indexOf(r)>-1){t[a][1].removeListener(r,n,o);break}},this.clearListener=function(e,n){if(e){for(var o=t.length;o--;)if(t[o][1]instanceof e)return t[o][1].clearListener(n),void 0}else for(var o=t.length;o--;)t[o][1].clearListener()}},soya2d.Keyboard=function(){function t(t,e){t.keyCode=e.keyCode||e.which,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.altKey=e.altKey,t.metaKey=e.metaKey,t.keyCodes=r,t.e=e}function e(e){var n=e.keyCode||e.which;r.indexOf(n)<0&&r.push(n),l=!0,t(a,e),c=!0,i(e,n)}function n(e){var n=e.keyCode||e.which,o=r.indexOf(n);o>-1&&r.splice(o,1),h=!0,t(u,e),r.length<1&&(c=!1),i(e,n)}function o(){l=h=c=!1,r=[]}function i(t,e){var n=soya2d.Keyboard.preventKeys;n.indexOf(e)>-1&&(t.preventDefault?t.preventDefault():t.returnValue=!1);var o=soya2d.Keyboard.stopKeys;o.indexOf(e)>-1&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0)}function s(t,e){if(t){t.sort(function(t,e){return t.order-e.order});for(var n=t.length;n--;)t[n].fn.call(t[n].context,e)}}var r=[],a={},u={},l=!1,h=!1,c=!1;this.scan=function(){var t,e;l&&(t=this.__eventMap.keydown,e=a,s(t,e),l=!1),c&&(t=this.__eventMap.keypress,e=a,s(t,e)),h&&(t=this.__eventMap.keyup,e=u,s(t,e),h=!1)},this.startListen=function(){return self.addEventListener("keydown",e,!1),self.addEventListener("keyup",n,!1),self.addEventListener("blur",o,!1),this},this.stopListen=function(){return self.removeEventListener("keydown",e,!1),self.removeEventListener("keyup",n,!1),self.removeEventListener("blur",o,!1),this},soya2d.EventHandler.call(this)},soya2d.inherits(soya2d.Keyboard,soya2d.EventHandler),soya2d.Keyboard.preventKeys=[],soya2d.Keyboard.stopKeys=[],soya2d.KeyCode={DELETE:46,BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"[":219,"]":221,"\\":220,"=":187,"-":189,",":188,".":190,"/":191,";":186,"'":222},soya2d.Mobile=function(){function t(t,e){e.orientation&&(l.orientation=u[t].orientation=e.orientation),e.alpha&&(l.tilt=u[t].tilt={z:e.alpha,x:e.beta,y:e.gamma,absolute:e.absolute}),e.acceleration&&(l.motion=u[t].motion={x:e.acceleration.x,y:e.acceleration.y,z:e.acceleration.z,interval:e.interval}),u[t].e=e,u[t].type=t,u[t].fire=!0}function e(e){t("tilt",e)}function n(e){t("motion",e)}function o(e){clearTimeout(a),a=setTimeout(function(){e.orientation=i(),t("hov",e)},510)}function i(){var t,e=window.innerWidth,n=window.innerHeight;return t=e>n?"landscape":"portrait"}function s(){for(var t in u){var e=u[t];e&&(e.fire=!1)}}function r(t,e){if(t){t.sort(function(t,e){return t.order-e.order});for(var n=t.length;n--;){var o=t[n].context;t[n].fn.call(o,e)}}}var a,u={tilt:{},motion:{},hov:{}},l=this;this.scan=function(){for(var t in u){var e=u[t];if(e&&e.fire){var n=this.__eventMap[t];r(n,e)}}s()},this.startListen=function(){return self.addEventListener("orientationchange",o,!1),self.addEventListener("deviceorientation",e,!1),self.addEventListener("devicemotion",n,!1),this},this.stopListen=function(){return self.removeEventListener("orientationchange",o,!1),self.removeEventListener("deviceorientation",e,!1),self.removeEventListener("devicemotion",n,!1),this},soya2d.EventHandler.call(this)},soya2d.inherits(soya2d.Mobile,soya2d.EventHandler),soya2d.Mouse=function(){function t(t,n,o){var i=c.getRenderer();f.x=d[t].x=(n.offsetX||n.layerX)/i.hr,f.y=d[t].y=(n.offsetY||n.layerY)/i.vr,f.lButton=d[t].lButton=0==n.button||1==n.button,f.rButton=d[t].rButton=2==n.button,f.wButton=d[t].wButton=4==n.button||2==n.which,d[t].e=n,d[t].__propagate=!0,d[t].stopPropagation=e,d[t].type=t,d[t].fire=!0,d[t].__fireList&&d[t].__fireList.push(o)}function e(){this.__propagate=!1}function n(e){t("click",e)}function o(e){t("dblclick",e)}function i(e){t("mousedown",e)}function s(e){t("mousewheel",e)}function r(e){t("mousemove",e);var n=[],o=f.__eventMap.mouseover,i=f.__eventMap.mouseout;if(o&&o.forEach(function(t){n.push(t)}),i&&i.forEach(function(t){for(var e=n.length;e--;)if(n[e].context==t.context)return;n.push(t)}),n.length>0){var s=[];n.forEach(function(n){{var o=n.context;n.fn}o.hitTest&&o.hitTest(f.x,f.y)&&(s.push(o),p.indexOf(o)>-1||(p.push(o),t("mouseover",e,o)))});var r=[];if(p.forEach(function(t){s.indexOf(t)<0&&r.push(t)}),r.length<1)return;for(var a=r.length;a--;){var u=p.indexOf(r[a]);p.splice(u,1);var l=r[a];t("mouseout",e,l)}}}function a(e){t("mouseup",e)}function u(){for(var t in d){var e=d[t];e&&(e.fire=!1,e.__fireList&&(e.__fireList=[]))}}function l(t,e){if(t){for(var n=[],o=!1,i=null,s=t.length;s--;){var r=t[s].context;r!=c?r instanceof soya2d.Scene?i=r:(("mouseover"==e.type||"mouseout"==e.type)&&e.__fireList.indexOf(r)>=0&&n.push(r),n.indexOf(r)<0&&r.hitTest(f.x,f.y)&&n.push(r)):o=!0}if(n.sort(function(t,e){return e.z-t.z}),i&&n.push(i),o&&n.push(c),!(n.length<1)){var r=n[0],e=h(r,t,e);if(e.__propagate){for(var a=r.parent;a;){if(e=h(a,t,e),!e.__propagate)return;a=a.parent}o&&r!=c&&h(c,t,e)}}}}function h(t,e,n){var o=[];e.forEach(function(e){e.context==t&&o.push(e)}),o.sort(function(t,e){return t.order-e.order});for(var i=o.length;i--;)o[i].fn.call(t,n);return n}var c,d={click:{},dblclick:{},mousedown:{},mouseup:{},mousemove:{},mousewheel:{},mouseover:{__fireList:[]},mouseout:{__fireList:[]}},f=this,p=[];this.scan=function(){for(var t in d){var e=d[t];if(e&&e.fire){var n=this.__eventMap[t];l(n,e)}}u()},this.startListen=function(t){c=t;var e=t.getRenderer().getCanvas();return e.addEventListener("click",n,!1),e.addEventListener("dblclick",o,!1),e.addEventListener("mousedown",i,!1),e.addEventListener("mousewheel",s,!1),e.addEventListener("mousemove",r,!1),self.addEventListener("mouseup",a,!1),this},this.stopListen=function(t){var e=t.getRenderer().getCanvas();return e.removeEventListener("click",n,!1),e.removeEventListener("dblclick",o,!1),e.removeEventListener("mousedown",i,!1),e.removeEventListener("mousewheel",s,!1),e.removeEventListener("mousemove",r,!1),self.removeEventListener("mouseup",a,!1),this},soya2d.EventHandler.call(this)},soya2d.inherits(soya2d.Mouse,soya2d.EventHandler),soya2d.EVENT_CLICK="click",soya2d.EVENT_DBLCLICK="dblclick",soya2d.EVENT_MOUSEDOWN="mousedown",soya2d.EVENT_MOUSEWHEEL="mousewheel",soya2d.EVENT_MOUSEMOVE="mousemove",soya2d.EVENT_MOUSEUP="mouseup",soya2d.EVENT_MOUSEOVER="mouseover",soya2d.EVENT_MOUSEOUT="mouseout",soya2d.Touch=function(){function t(t,n,o){var i;if(o){var s=n.pointerId;if("touchstart"===t)l[s]={clientX:n.clientX,clientY:n.clientY};else if("touchmove"===t){if(!l[s]||l[s].clientX==n.clientX&&l[s].clientY==n.clientY)return;l[s]={clientX:n.clientX,clientY:n.clientY}}else"touchend"===t?delete l[s]:"touchcancel"===t&&delete l[s];i=[];for(var h in l){var c=l[h];i.push(c)}}else i=n.changedTouches;if(i&&i.length>0){for(var d=n.target||n.srcElement,f=d.offsetLeft,p=d.offsetTop;(d=d.offsetParent)&&"BODY"!=d.tagName;)f+=d.offsetLeft-d.scrollLeft,p+=d.offsetTop-d.scrollTop;for(var m=document.body.scrollTop||document.documentElement.scrollTop,y=document.body.scrollLeft||document.documentElement.scrollLeft,h=0;h<i.length;h++){var g=i[h];u.touchList[h]=g.clientX-f+y,u.touchList[h+1]=g.clientY-p+m}}var v=u.touchList,_=r.getRenderer(),b=_.getCanvas(),w=window.getComputedStyle(b,null).marginLeft;w=parseFloat(w)||0;var E=window.getComputedStyle(b,null).marginTop;E=parseFloat(E)||0;for(var h=0;h<v.length;h+=2){var A=v[h],S=v[h+1];switch(r.view.rotate()){case soya2d.ROTATEMODE_90:A=A+b.offsetLeft-E,S=S+b.offsetTop-w;var x=A;A=S,S=r.view.w-Math.abs(x);break;case soya2d.ROTATEMODE_270:A=A+b.offsetLeft-E,S=S+b.offsetTop-w;var x=S;S=A,A=r.view.h-Math.abs(x);break;case soya2d.ROTATEMODE_180:A=r.view.w-Math.abs(A),S=r.view.h-Math.abs(S)}A/=_.hr,S/=_.vr,v[h]=A,v[h+1]=S}a[t].touchList=v,a[t].e=n,a[t].__propagate=!0,a[t].stopPropagation=e,a[t].type=t,a[t].fire=!0}function e(){this.__propagate=!1}function n(e){if(!e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH){e.preventManipulation?e.preventManipulation():e.preventDefault();var n=e.type;switch(n){case"MSPointerDown":case"pointerdown":t("touchstart",e,!0);break;case"touchstart":t("touchstart",e);break;case"MSPointerMove":case"pointermove":t("touchmove",e,!0);break;case"touchmove":t("touchmove",e);break;case"MSPointerUp":case"pointerup":t("touchend",e,!0);break;case"touchend":t("touchend",e);break;case"MSPointerCancel":case"pointercancel":t("touchcancel",e,!0);break;case"touchcancel":t("touchcancel",e)}}}function o(){for(var t in a){var e=a[t];e&&(e.fire=!1)}}function i(t,e){if(t){for(var n=[],o=!1,i=null,a=u.touchList,l=t.length;l--;){var h=t[l].context;if(h!=r){if(h instanceof soya2d.Scene)i=h;else for(var c=0;c<a.length;c+=2)if(x=a[c],y=a[c+1],h.hitTest(x,y)){n.indexOf(h)<0&&n.push(h);break}}else o=!0}if(n.sort(function(t,e){return e.z-t.z}),i&&n.push(i),o&&n.push(r),!(n.length<1)){var h=n[0],e=s(h,t,e);if(e.__propagate){for(var d=h.parent;d;){if(e=s(d,t,e),!e.__propagate)return;d=d.parent}o&&h!=r&&s(r,t,e)}}}}function s(t,e,n){var o=[];e.forEach(function(e){e.context==t&&o.push(e)}),o.sort(function(t,e){return t.order-e.order});for(var i=o.length;i--;)o[i].fn.call(t,n);return n}var r,a={touchstart:{},touchmove:{},touchend:{},touchcancel:{}},u=this;this.touchList=[];var l={};this.scan=function(){for(var t in a){var e=a[t];if(e&&e.fire){var n=this.__eventMap[t];i(n,e)}}o()},this.startListen=function(t){r=t;var e=t.getRenderer().getCanvas();return window.PointerEvent?(e.addEventListener("pointerdown",n,!1),e.addEventListener("pointermove",n,!1),self.addEventListener("pointerup",n,!1),self.addEventListener("pointercancel",n,!1)):window.MSPointerEvent?(e.addEventListener("MSPointerDown",n,!1),e.addEventListener("MSPointerMove",n,!1),self.addEventListener("MSPointerUp",n,!1),self.addEventListener("MSPointerCancel",n,!1)):(e.addEventListener("touchstart",n,!1),e.addEventListener("touchmove",n,!1),self.addEventListener("touchend",n,!1),self.addEventListener("touchcancel",n,!1)),this},this.stopListen=function(t){var e=t.getRenderer().getCanvas();return window.PointerEvent?(e.removeEventListener("pointerdown",n,!1),e.removeEventListener("pointermove",n,!1),self.removeEventListener("pointerup",n,!1),self.removeEventListener("pointercancel",n,!1)):window.MSPointerEvent?(e.removeEventListener("MSPointerDown",n,!1),e.removeEventListener("MSPointerMove",n,!1),self.removeEventListener("MSPointerUp",n,!1),self.removeEventListener("MSPointerCancel",n,!1)):(e.removeEventListener("touchstart",n,!1),e.removeEventListener("touchmove",n,!1),self.removeEventListener("touchend",n,!1),self.removeEventListener("touchcancel",n,!1)),this},soya2d.EventHandler.call(this)},soya2d.inherits(soya2d.Touch,soya2d.EventHandler),soya2d.EVENT_TOUCHSTART="touchstart",soya2d.EVENT_TOUCHMOVE="touchmove",soya2d.EVENT_TOUCHEND="touchend",soya2d.EVENT_TOUCHCANCEL="touchcancel",soya2d.module.install("event",{onInit:function(t){t.events=new soya2d.Events;var e=["keyup","keydown","keypress"],n=["click","dblclick","mousedown","mousewheel","mousemove","mouseup","mouseover","mouseout"],o=["touchstart","touchmove","touchend","touchcancel"],i=["hov","tilt","motion"];soya2d.Mouse&&t.events.register(n,new soya2d.Mouse),soya2d.Keyboard&&t.events.register(e,new soya2d.Keyboard),soya2d.Touch&&t.events.register(o,new soya2d.Touch),soya2d.Mobile&&t.events.register(i,new soya2d.Mobile)},onStart:function(t){t.events.startListen(t)},onStop:function(t){t.events.stopListen(t)},onUpdate:function(t){t.events.scan()}}),soya2d.ext(soya2d.DisplayObject.prototype,{on:function(t,e,n){return this.game.events.addListener(t,e,this,n),this},once:function(t,e,n){var o=this,i=function(){o.off(t,i),e.apply(o,arguments)};return this.game.events.addListener(t,i,this,n),this},off:function(t,e){return this.game.events.removeListener(t,e,this),this}}),soya2d.ext(soya2d.Game.prototype,{on:function(t,e,n){return this.events.addListener(t,e,this,n),this},once:function(t,e,n){var o=this,i=function(){o.off(t,i),e.apply(o,arguments)};return this.events.addListener(t,i,this,n),this},off:function(t,e){return this.events.removeListener(t,e,this),this}}),!function(){"use strict";function t(){try{"undefined"!=typeof AudioContext?e=new AudioContext:"undefined"!=typeof webkitAudioContext?e=new webkitAudioContext:n=!1}catch(t){n=!1}if(!n)if("undefined"!=typeof Audio)try{new Audio}catch(t){o=!0}else o=!0}var e=null,n=!0,o=!1;if(t(),n){var i="undefined"==typeof e.createGain?e.createGainNode():e.createGain();i.gain.value=1,i.connect(e.destination)}var s=function(){this.init()};s.prototype={init:function(){var t=this||r;return t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t.iOSAutoEnable=!0,t.noAudio=o,t.usingWebAudio=n,t.ctx=e,o||t._setupCodecs(),t},volume:function(t){var e=this||r;if(t=parseFloat(t),"undefined"!=typeof t&&t>=0&&1>=t){e._volume=t,n&&(i.gain.value=t);for(var o=0;o<e._howls.length;o++)if(!e._howls[o]._webAudio)for(var s=e._howls[o]._getSoundIds(),a=0;a<s.length;a++){var u=e._howls[o]._soundById(s[a]);u&&u._node&&(u._node.volume=u._volume*t)}return e}return e._volume},mute:function(t){var e=this||r;e._muted=t,n&&(i.gain.value=t?0:e._volume);for(var o=0;o<e._howls.length;o++)if(!e._howls[o]._webAudio)for(var s=e._howls[o]._getSoundIds(),a=0;a<s.length;a++){var u=e._howls[o]._soundById(s[a]);u&&u._node&&(u._node.muted=t?!0:u._muted)}return e},codecs:function(t){return(this||r)._codecs[t]},_setupCodecs:function(){var t=this||r,e=new Audio,n=e.canPlayType("audio/mpeg;").replace(/^no$/,"");return t._codecs={mp3:!(!n&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")},t},_enableiOSAudio:function(){var t=this||r;if(!e||!t._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){t._iOSEnabled=!1;var n=function(){var o=e.createBuffer(1,1,22050),i=e.createBufferSource();i.buffer=o,i.connect(e.destination),"undefined"==typeof i.start?i.noteOn(0):i.start(0),setTimeout(function(){(i.playbackState===i.PLAYING_STATE||i.playbackState===i.FINISHED_STATE)&&(t._iOSEnabled=!0,t.iOSAutoEnable=!1,window.removeEventListener("touchstart",n,!1))},0)};return window.addEventListener("touchstart",n,!1),t}}};var r=new s,a=function(t){var e=this;return t.src&&0!==t.src.length?void e.init(t):void console.error("An array of source files must be passed with any new Howl.")};a.prototype={init:function(t){var o=this;return o._autoplay=t.autoplay||!1,o._ext=t.ext||null,o._html5=t.html5||!1,o._muted=t.mute||!1,o._loop=t.loop||!1,o._pool=t.pool||5,o._preload="boolean"==typeof t.preload?t.preload:!0,o._rate=t.rate||1,o._sprite=t.sprite||{},o._src="string"!=typeof t.src?t.src:[t.src],o._volume=void 0!==t.volume?t.volume:1,o._duration=0,o._loaded=!1,o._sounds=[],o._endTimers={},o._onend=t.onend?[{fn:t.onend}]:[],o._onfaded=t.onfaded?[{fn:t.onfaded}]:[],o._onload=t.onload?[{fn:t.onload}]:[],o._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],o._onpause=t.onpause?[{fn:t.onpause}]:[],o._onplay=t.onplay?[{fn:t.onplay}]:[],o._webAudio=n&&!o._html5,"undefined"!=typeof e&&e&&r.iOSAutoEnable&&r._enableiOSAudio(),r._howls.push(o),o._preload&&o.load(),o},load:function(){var t=this,e=null;if(o)return void t._emit("loaderror");"string"==typeof t._src&&(t._src=[t._src]);for(var n=0;n<t._src.length;n++){var i,s;if(t._ext&&t._ext[n]?i=t._ext[n]:(s=t._src[n],i=/^data:audio\/([^;,]+);/i.exec(s),i||(i=/\.([^.]+)$/.exec(s.split("?",1)[0])),i&&(i=i[1].toLowerCase())),r.codecs(i)){e=t._src[n];break}}return e?(t._src=e,new u(t),t._webAudio&&h(t),t):void t._emit("loaderror")},play:function(t){var n=this,o=arguments,i=null;if("number"==typeof t)i=t,t=null;else if("undefined"==typeof t){t="__default";for(var s=0,a=0;a<n._sounds.length;a++)n._sounds[a]._paused&&!n._sounds[a]._ended&&(s++,i=n._sounds[a]._id);1===s?t=null:i=null}var u=i?n._soundById(i):n._inactiveSound();if(!u)return null;if(i&&!t&&(t=u._sprite||"__default"),!n._loaded&&!n._sprite[t])return n.once("load",function(){n.play(n._soundById(u._id)?u._id:void 0)}),u._id;if(i&&!u._paused)return u._id;var l=u._seek>0?u._seek:n._sprite[t][0]/1e3,h=(n._sprite[t][0]+n._sprite[t][1])/1e3-l,c=function(){var o=!(!u._loop&&!n._sprite[t][2]);n._emit("end",u._id),!n._webAudio&&o&&n.stop(u._id).play(u._id),n._webAudio&&o&&(n._emit("play",u._id),u._seek=u._start||0,u._playStart=e.currentTime,n._endTimers[u._id]=setTimeout(c,1e3*(u._stop-u._start)/Math.abs(n._rate))),n._webAudio&&!o&&(u._paused=!0,u._ended=!0,u._seek=u._start||0,n._clearTimer(u._id),u._node.bufferSource=null),n._webAudio||o||n.stop(u._id)};n._endTimers[u._id]=setTimeout(c,1e3*h/Math.abs(n._rate)),u._paused=!1,u._ended=!1,u._sprite=t,u._seek=l,u._start=n._sprite[t][0]/1e3,u._stop=(n._sprite[t][0]+n._sprite[t][1])/1e3,u._loop=!(!u._loop&&!n._sprite[t][2]);var d=u._node;if(n._webAudio){var f=function(){n._refreshBuffer(u);var t=u._muted||n._muted?0:u._volume*r.volume();d.gain.setValueAtTime(t,e.currentTime),u._playStart=e.currentTime,"undefined"==typeof d.bufferSource.start?u._loop?d.bufferSource.noteGrainOn(0,l,86400):d.bufferSource.noteGrainOn(0,l,h):u._loop?d.bufferSource.start(0,l,86400):d.bufferSource.start(0,l,h),n._endTimers[u._id]||(n._endTimers[u._id]=setTimeout(c,1e3*h/Math.abs(n._rate))),o[1]||setTimeout(function(){n._emit("play",u._id)},0)};n._loaded?f():(n.once("load",f),n._clearTimer(u._id))}else{var p=function(){d.currentTime=l,d.muted=u._muted||n._muted||r._muted||d.muted,d.volume=u._volume*r.volume(),d.playbackRate=n._rate,setTimeout(function(){d.play(),o[1]||n._emit("play",u._id)},0)};if(4===d.readyState||!d.readyState&&navigator.isCocoonJS)p();else{var m=function(){n._endTimers[u._id]=setTimeout(c,1e3*h/Math.abs(n._rate)),p(),d.removeEventListener("canplaythrough",m,!1)};d.addEventListener("canplaythrough",m,!1),n._clearTimer(u._id)}}return u._id},pause:function(t){var e=this;if(!e._loaded)return e.once("play",function(){e.pause(t)}),e;for(var n=e._getSoundIds(t),o=0;o<n.length;o++){e._clearTimer(n[o]);var i=e._soundById(n[o]);if(i&&!i._paused){if(i._seek=e.seek(n[o]),i._paused=!0,e._webAudio){if(!i._node.bufferSource)return e;"undefined"==typeof i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),i._node.bufferSource=null}else isNaN(i._node.duration)||i._node.pause();arguments[1]||e._emit("pause",i._id)}}return e},stop:function(t){var e=this;if(!e._loaded)return"undefined"!=typeof e._sounds[0]._sprite&&e.once("play",function(){e.stop(t)}),e;for(var n=e._getSoundIds(t),o=0;o<n.length;o++){e._clearTimer(n[o]);var i=e._soundById(n[o]);if(i&&!i._paused)if(i._seek=i._start||0,i._paused=!0,i._ended=!0,e._webAudio&&i._node){if(!i._node.bufferSource)return e;"undefined"==typeof i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),i._node.bufferSource=null}else i._node&&!isNaN(i._node.duration)&&(i._node.pause(),i._node.currentTime=i._start||0)}return e},mute:function(t,n){var o=this;if(!o._loaded)return o.once("play",function(){o.mute(t,n)}),o;if("undefined"==typeof n){if("boolean"!=typeof t)return o._muted;o._muted=t}for(var i=o._getSoundIds(n),s=0;s<i.length;s++){var a=o._soundById(i[s]);a&&(a._muted=t,o._webAudio&&a._node?a._node.gain.setValueAtTime(t?0:a._volume*r.volume(),e.currentTime):a._node&&(a._node.muted=r._muted?!0:t))}return o},volume:function(){var t,n,o=this,i=arguments;if(0===i.length)return o._volume;if(1===i.length){var s=o._getSoundIds(),a=s.indexOf(i[0]);a>=0?n=parseInt(i[0],10):t=parseFloat(i[0])}else 2===i.length&&(t=parseFloat(i[0]),n=parseInt(i[1],10));var u;if(!("undefined"!=typeof t&&t>=0&&1>=t))return u=n?o._soundById(n):o._sounds[0],u?u._volume:0;if(!o._loaded)return o.once("play",function(){o.volume.apply(o,i)}),o;"undefined"==typeof n&&(o._volume=t),n=o._getSoundIds(n);for(var l=0;l<n.length;l++)u=o._soundById(n[l]),u&&(u._volume=t,o._webAudio&&u._node?u._node.gain.setValueAtTime(t*r.volume(),e.currentTime):u._node&&(u._node.volume=t*r.volume()));return o},fade:function(t,n,o,i){var s=this;if(!s._loaded)return s.once("play",function(){s.fade(t,n,o,i)}),s;s.volume(t,i);for(var r=s._getSoundIds(i),a=0;a<r.length;a++){var u=s._soundById(r[a]);if(u)if(s._webAudio){var l=e.currentTime,h=l+o/1e3;u._volume=t,u._node.gain.setValueAtTime(t,l),u._node.gain.linearRampToValueAtTime(n,h),setTimeout(function(t,o){setTimeout(function(){o._volume=n,s._emit("faded",t)},h-e.currentTime>0?Math.ceil(1e3*(h-e.currentTime)):0)}.bind(s,r[a],u),o)}else{var c=Math.abs(t-n),d=t>n?"out":"in",f=c/.01,p=o/f;!function(){var e=t,o=setInterval(function(t){e+="in"===d?.01:-.01,e=Math.max(0,e),e=Math.min(1,e),e=Math.round(100*e)/100,s.volume(e,t),e===n&&(clearInterval(o),s._emit("faded",t))}.bind(s,r[a]),p)}()}}return s},loop:function(){var t,e,n,o=this,i=arguments;if(0===i.length)return o._loop;if(1===i.length){if("boolean"!=typeof i[0])return n=o._soundById(parseInt(i[0],10)),n?n._loop:!1;t=i[0],o._loop=t}else 2===i.length&&(t=i[0],e=parseInt(i[1],10));for(var s=o._getSoundIds(e),r=0;r<s.length;r++)n=o._soundById(s[r]),n&&(n._loop=t,o._webAudio&&n._node&&(n._node.bufferSource.loop=t));return o},seek:function(){var t,n,o=this,i=arguments;if(0===i.length)n=o._sounds[0]._id;else if(1===i.length){var s=o._getSoundIds(),r=s.indexOf(i[0]);r>=0?n=parseInt(i[0],10):(n=o._sounds[0]._id,t=parseFloat(i[0]))}else 2===i.length&&(t=parseFloat(i[0]),n=parseInt(i[1],10));if("undefined"==typeof n)return o;if(!o._loaded)return o.once("load",function(){o.seek.apply(o,i)}),o;var a=o._soundById(n);if(a){if(!(t>=0))return o._webAudio?a._seek+o.playing(n)?e.currentTime-a._playStart:0:a._node.currentTime;var u=o.playing(n);u&&o.pause(n,!0),a._seek=t,o._clearTimer(n),u&&o.play(n,!0)}return o},playing:function(t){var e=this,n=e._soundById(t)||e._sounds[0];return n?!n._paused:!1},duration:function(){return this._duration},unload:function(){for(var t=this,e=t._sounds,n=0;n<e.length;n++){e[n]._paused||(t.stop(e[n]._id),t._emit("end",e[n]._id)),t._webAudio||(e[n]._node.src="",e[n]._node.removeEventListener("error",e[n]._errorFn,!1),e[n]._node.removeEventListener("canplaythrough",e[n]._loadFn,!1)),delete e[n]._node,t._clearTimer(e[n]._id);var o=r._howls.indexOf(t);o>=0&&r._howls.splice(o,1)}return l&&delete l[t._src],t=null,null},on:function(t,e,n){var o=this,i=o["_on"+t];return"function"==typeof e&&i.push({id:n,fn:e}),o},off:function(t,e,n){var o=this,i=o["_on"+t];if(e){for(var s=0;s<i.length;s++)if(e===i[s].fn&&n===i[s].id){i.splice(s,1);break}}else i=[];return o},once:function(t,e,n){var o=this,i=function(){e.apply(o,arguments),o.off(t,i,n)};return o.on(t,i,n),o},_emit:function(t,e,n){for(var o=this,i=o["_on"+t],s=0;s<i.length;s++)i[s].id&&i[s].id!==e||setTimeout(function(t){t.call(this,e,n)}.bind(o,i[s].fn),0);return o},_clearTimer:function(t){var e=this;return e._endTimers[t]&&(clearTimeout(e._endTimers[t]),delete e._endTimers[t]),e},_soundById:function(t){for(var e=this,n=0;n<e._sounds.length;n++)if(t===e._sounds[n]._id)return e._sounds[n];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new u(t)},_drain:function(){var t=this,e=t._pool,n=0,o=0;if(!(t._sounds.length<e)){for(o=0;o<t._sounds.length;o++)t._sounds[o]._ended&&n++;for(o=t._sounds.length-1;o>=0;o--){if(e>=n)return;t._sounds[o]._ended&&(t._webAudio&&t._sounds[o]._node&&t._sounds[o]._node.disconnect(0),t._sounds.splice(o,1),n--)}}},_getSoundIds:function(t){var e=this;if("undefined"==typeof t){for(var n=[],o=0;o<e._sounds.length;o++)n.push(e._sounds[o]._id);return n}return[t]},_refreshBuffer:function(t){var n=this;return t._node.bufferSource=e.createBufferSource(),t._node.bufferSource.buffer=l[n._src],t._node.bufferSource.connect(t._panner?t._panner:t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop),t._node.bufferSource.playbackRate.value=n._rate,n}};var u=function(t){this._parent=t,this.init()};if(u.prototype={init:function(){var t=this,e=t._parent;
return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._muted=e._muted,t._seek=0,t._paused=!0,t._ended=!0,t._id=Math.round(Date.now()*Math.random()),e._sounds.push(t),t.create(),t},create:function(){var t=this,n=t._parent,o=r._muted||t._muted||t._parent._muted?0:t._volume*r.volume();return n._webAudio?(t._node="undefined"==typeof e.createGain?e.createGainNode():e.createGain(),t._node.gain.setValueAtTime(o,e.currentTime),t._node.paused=!0,t._node.connect(i)):(t._node=new Audio,t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener("canplaythrough",t._loadFn,!1),t._node.src=n._src,t._node.preload="auto",t._node.volume=o,t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._muted=e._muted,t._seek=0,t._paused=!0,t._ended=!0,t._sprite=null,t._id=Math.round(Date.now()*Math.random()),t},_errorListener:function(){var t=this;t._node.error&&4===t._node.error.code&&(r.noAudio=!0),t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorListener,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e._emit("load")),e._autoplay&&e.play(),t._node.removeEventListener("canplaythrough",t._loadFn,!1)}},n)var l={},h=function(t){var e=t._src;if(l[e])return t._duration=l[e].duration,void f(t);if(/^data:[^;]+;base64,/.test(e)){window.atob=window.atob||function(t){for(var e,n,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=String(t).replace(/=+$/,""),s=0,r=0,a="";n=i.charAt(r++);~n&&(e=s%4?64*e+n:n,s++%4)?a+=String.fromCharCode(255&e>>(-2*s&6)):0)n=o.indexOf(n);return a};for(var n=atob(e.split(",")[1]),o=new Uint8Array(n.length),i=0;i<n.length;++i)o[i]=n.charCodeAt(i);d(o.buffer,t)}else{var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(){d(s.response,t)},s.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete l[e],t.load())},c(s)}},c=function(t){try{t.send()}catch(e){t.onerror()}},d=function(t,n){e.decodeAudioData(t,function(t){t&&(l[n._src]=t,f(n,t))},function(){n._emit("loaderror")})},f=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),t._loaded||(t._loaded=!0,t._emit("load")),t._autoplay&&t.play()};"function"==typeof define&&define.amd&&define("howler",function(){return{Howler:r,Howl:a}}),"undefined"!=typeof exports&&(exports.Howler=r,exports.Howl=a),"undefined"!=typeof window&&(window.HowlerGlobal=s,window.Howler=r,window.Howl=a,window.Sound=u)}(),soya2d.Sound=function(t){t=t||{},this.__handler,this.src,this.__loop=t.loop||!1,this.__volume=t.volume||1,this.__muted=!1,this.__pos=0},soya2d.Sound.prototype={play:function(){return this.__handler.play(),this},pause:function(){return this.__handler.pause(),this},stop:function(){return this.__handler.stop(),this},mute:function(t){return void 0!=t?(this.__muted=t,t?this.__handler.mute():this.__handler.unmute(),this):this.__muted},loop:function(t){return void 0!=t?(this.__loop=t,this.__handler._loop=t,this):this.__loop},volume:function(t){return t?(this.__volume=t,this.__handler.volume(t),this):this.__volume},pos:function(t){return t?(this.__pos=t,this.__handler.pos(t),this):this.__pos},fade:function(t,e,n){return this.__handler.fade(t,e,n),this},on:function(t,e){return this.__handler.on(t,e),this},once:function(t,e){return this.__handler.once(t,e),this},off:function(t,e){return this.__handler.off(t,e),this}},soya2d.SoundManager=function(){function t(t){var e=[];return t.forEach&&t.forEach(function(t){var n=t.split(".")[0];e.indexOf(n)<0&&e.push(n)}),e}soya2d.ResourceManager.call(this),this.create=function(e){if(!e)return null;if(!e.urls||e.urls.length<1)return null;var n=new Howl(e),o=new soya2d.Sound(e);o.__handler=n;var i=t(e.urls);return this.urlMap[i[0]]=o,o},this._add=function(e,n){"string"==typeof e&&(e=[e]);var o=t(e);this.urlMap[o[0]]=n},this.muteAll=function(t){for(var e in this.urlMap){var n=this.urlMap[e];n.mute(t)}},this.stopAll=function(){for(var t in this.urlMap){var e=this.urlMap[t];e.stop()}}},soya2d.inherits(soya2d.SoundManager,soya2d.ResourceManager),soya2d.module.install("sound",{onInit:function(t){t.soundManager=new soya2d.SoundManager},onStop:function(t){t.soundManager.stopAll()}}),soya2d.Emitter=function(t){var e=[],n=0;cfg=t||{},soya2d.ext(this,cfg),this.MSPE=cfg.MSPE||16,this.emissionCount=cfg.emissionCount,this.blendMode=cfg.blendMode||soya2d.BLEND_LIGHTER,this.x=cfg.x,this.xVar=cfg.xVar||0,this.y=cfg.y,this.yVar=cfg.yVar||0,this.template=soya2d.ParticleWrapper.wrap(cfg.template),this.lifeSpan=cfg.lifeSpan||1,this.lifeSpanVar=cfg.lifeSpanVar||0,this.speed=cfg.speed||0,this.speedVar=cfg.speedVar||0,this.radialAcc=cfg.radialAcc||0,this.radialAccVar=cfg.radialAccVar||0,this.tanAcc=cfg.tanAcc||0,this.tanAccVar=cfg.tanAccVar||0,this.angle=cfg.angle||0,this.angleVar=cfg.angleVar||0,this.startSpin=cfg.startSpin||0,this.startSpinVar=cfg.startSpinVar||0,this.endSpin=cfg.endSpin||0,this.endSpinVar=cfg.endSpinVar||0,this.onActive=cfg.onActive;for(var o=this.emissionCount;o--;){var i=new this.template(this);i.visible=!1,i.lifeSpan=0,i.deadRate=0,e.push(i)}this.running=!1,this.addTo=function(t){return soya2d.ParticleManager.add(this)?(t.add.apply(t,e),this):this},this.removeFrom=function(t){return soya2d.ParticleManager.remove(this),t.remove.apply(t,e),this},this.emit=function(){return this.running?this:(n=Date.now(),this.running=!0,this.stopping&&clearTimeout(this.stopping),this)},this.stop=function(t){if(!this.running)return this;if(t>0){var e=this;return this.stopping=setTimeout(function(){this.running=!1,e.stopping=0},t),void 0}return this.running=!1,this};var s=0;this.update=function(t){var o=t-n;n=t,s+=o;var i=0,r=e;if(s>=this.MSPE&&this.running&&(i=s/this.MSPE>>0,s=0),i>0&&this.running){i=i>this.emissionCount?this.emissionCount:i;for(var a=this.emissionCount;a--&&i;){var u=r[a];u.lifeSpan<=0&&(this.onActive instanceof Function&&this.onActive.call(u),u.resetParticle(this),i--)}}for(var a=r.length;a--;){var u=r[a];u.lifeSpan>0&&u.updateParticle(o)}}},soya2d.ParticleManager=new function(){var t=[];this.add=function(e){var n=t.indexOf(e);return n>-1?!1:(t.push(e),this)},this.remove=function(e){var n=t.indexOf(e);return n>-1&&t.splice(e,1),this},this.update=function(e){for(var n=t.length;n--;)t[n].update(e)},this.stop=function(e){if(e){var n=t.indexOf(e);n>-1&&e.stop()}else t.splice(0,t.length)}},soya2d.ParticleWrapper=new function(){function t(t){var e=(soya2d.Math,t/1e3);return this.lifeSpan-=e,this.lifeSpan<=0?(this.visible=!1,this.deadRate=0,void 0):(this.deadRate=this.lifeSpan/this.maxLifeSpan,this.speed.add(this.deltaSpeed).add(this.radialAcc),0!==this.tanAcc&&(this.tanDir.set(this.speed.e[0],this.speed.e[1]).rotate(this.tans),this.tans+=this.tanAcc,this.tans%=360,this.speed.set(this.tanDir.e[0],this.tanDir.e[1])),this.deltaSpin&&(this.startSpin+=this.deltaSpin*e),this.x=this.sx+this.speed.e[0],this.y=this.sy+this.speed.e[1],this.deltaSpin&&(this.rotation=this.startSpin),void 0)}function e(t){var e=soya2d.Math,n=this.lifeSpan=t.lifeSpan+t.lifeSpanVar*Math.random();this.maxLifeSpan=n,this.sx=t.x+t.xVar*Math.random(),this.sy=t.y+t.yVar*Math.random();var o=t.angle+t.angleVar*Math.random();o=e.floor(o%=360),this.angle=o;var i=t.speed+t.speedVar*Math.random(),s=new soya2d.Vector(e.COSTABLE[o],e.SINTABLE[o]);this.speed=s.clone().mul(i),this.deltaSpeed=new soya2d.Vector(this.speed.e[0]/n,this.speed.e[1]/n),this.radialAcc=s.mul(t.radialAcc+t.radialAccVar*Math.random()),this.tanAcc=t.tanAcc+t.tanAccVar*Math.random(),0!==this.tanAcc&&(this.tans=this.tanAcc,this.tanDir=new soya2d.Vector(0,0)),this.startSpin=t.startSpin+t.startSpinVar*Math.random();var r=t.endSpin+t.endSpinVar*Math.random();this.deltaSpin=(r-this.startSpin)/n,this.startSpin===r&&(this.deltaSpin=null)}function n(t){this.initParticle(t),this.visible=!0}this.wrap=function(o){return o.prototype.updateParticle=t,o.prototype.initParticle=e,o.prototype.resetParticle=n,o.prototype.destroyParticle=function(){this.parent.remove(this)},o}},soya2d.module.install("particle",{onUpdate:function(t,e){soya2d.ParticleManager.update(e)},onStop:function(){soya2d.ParticleManager.stop()}}),!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.p2=t()}}(function(){return function t(e,n,o){function i(r,a){if(!n[r]){if(!e[r]){var u="function"==typeof require&&require;if(!a&&u)return u(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var l=n[r]={exports:{}};e[r][0].call(l.exports,function(t){var n=e[r][1][t];return i(n?n:t)},l,l.exports,t,e,n,o)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(t,e,n){(function(e,o,i){function i(t,e,n){if(!(this instanceof i))return new i(t,e,n);var o=typeof t;if("base64"===e&&"string"===o)for(t=L(t);t.length%4!==0;)t+="=";var s;if("number"===o)s=I(t);else if("string"===o)s=i.byteLength(t,e);else{if("object"!==o)throw new Error("First argument needs to be a number, array or string.");s=I(t.length)}var r;i._useTypedArrays?r=M(new Uint8Array(s)):(r=this,r.length=s,r._isBuffer=!0);var a;if(i._useTypedArrays&&"function"==typeof Uint8Array&&t instanceof Uint8Array)r._set(t);else if(O(t))for(a=0;s>a;a++)r[a]=i.isBuffer(t)?t.readUInt8(a):t[a];else if("string"===o)r.write(t,0,e);else if("number"===o&&!i._useTypedArrays&&!n)for(a=0;s>a;a++)r[a]=0;return r}function s(t,e,n,o){n=Number(n)||0;var s=t.length-n;o?(o=Number(o),o>s&&(o=s)):o=s;var r=e.length;Y(r%2===0,"Invalid hex string"),o>r/2&&(o=r/2);for(var a=0;o>a;a++){var u=parseInt(e.substr(2*a,2),16);Y(!isNaN(u),"Invalid hex string"),t[n+a]=u}return i._charsWritten=2*a,a}function r(t,e,n,o){var s=i._charsWritten=N(j(e),t,n,o);return s}function a(t,e,n,o){var s=i._charsWritten=N(U(e),t,n,o);return s}function u(t,e,n,o){return a(t,e,n,o)}function l(t,e,n,o){var s=i._charsWritten=N(k(e),t,n,o);return s}function h(t,e,n,o){var s=i._charsWritten=N(F(e),t,n,o);return s}function c(t,e,n){return H.fromByteArray(0===e&&n===t.length?t:t.slice(e,n))}function d(t,e,n){var o="",i="";n=Math.min(t.length,n);for(var s=e;n>s;s++)t[s]<=127?(o+=D(i)+String.fromCharCode(t[s]),i=""):i+="%"+t[s].toString(16);return o+D(i)}function f(t,e,n){var o="";n=Math.min(t.length,n);for(var i=e;n>i;i++)o+=String.fromCharCode(t[i]);return o}function p(t,e,n){return f(t,e,n)}function m(t,e,n){var o=t.length;(!e||0>e)&&(e=0),(!n||0>n||n>o)&&(n=o);for(var i="",s=e;n>s;s++)i+=q(t[s]);return i}function y(t,e,n){for(var o=t.slice(e,n),i="",s=0;s<o.length;s+=2)i+=String.fromCharCode(o[s]+256*o[s+1]);return i}function g(t,e,n,o){o||(Y("boolean"==typeof n,"missing or invalid endian"),Y(void 0!==e&&null!==e,"missing offset"),Y(e+1<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var s;return n?(s=t[e],i>e+1&&(s|=t[e+1]<<8)):(s=t[e]<<8,i>e+1&&(s|=t[e+1])),s}}function v(t,e,n,o){o||(Y("boolean"==typeof n,"missing or invalid endian"),Y(void 0!==e&&null!==e,"missing offset"),Y(e+3<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var s;return n?(i>e+2&&(s=t[e+2]<<16),i>e+1&&(s|=t[e+1]<<8),s|=t[e],i>e+3&&(s+=t[e+3]<<24>>>0)):(i>e+1&&(s=t[e+1]<<16),i>e+2&&(s|=t[e+2]<<8),i>e+3&&(s|=t[e+3]),s+=t[e]<<24>>>0),s}}function _(t,e,n,o){o||(Y("boolean"==typeof n,"missing or invalid endian"),Y(void 0!==e&&null!==e,"missing offset"),Y(e+1<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var s=g(t,e,n,!0),r=32768&s;return r?-1*(65535-s+1):s}}function b(t,e,n,o){o||(Y("boolean"==typeof n,"missing or invalid endian"),Y(void 0!==e&&null!==e,"missing offset"),Y(e+3<t.length,"Trying to read beyond buffer length"));var i=t.length;if(!(e>=i)){var s=v(t,e,n,!0),r=2147483648&s;return r?-1*(4294967295-s+1):s}}function w(t,e,n,o){return o||(Y("boolean"==typeof n,"missing or invalid endian"),Y(e+3<t.length,"Trying to read beyond buffer length")),z.read(t,e,n,23,4)}function E(t,e,n,o){return o||(Y("boolean"==typeof n,"missing or invalid endian"),Y(e+7<t.length,"Trying to read beyond buffer length")),z.read(t,e,n,52,8)}function A(t,e,n,o,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof o,"missing or invalid endian"),Y(void 0!==n&&null!==n,"missing offset"),Y(n+1<t.length,"trying to write beyond buffer length"),V(e,65535));var s=t.length;if(!(n>=s))for(var r=0,a=Math.min(s-n,2);a>r;r++)t[n+r]=(e&255<<8*(o?r:1-r))>>>8*(o?r:1-r)}function S(t,e,n,o,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof o,"missing or invalid endian"),Y(void 0!==n&&null!==n,"missing offset"),Y(n+3<t.length,"trying to write beyond buffer length"),V(e,4294967295));var s=t.length;if(!(n>=s))for(var r=0,a=Math.min(s-n,4);a>r;r++)t[n+r]=e>>>8*(o?r:3-r)&255}function x(t,e,n,o,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof o,"missing or invalid endian"),Y(void 0!==n&&null!==n,"missing offset"),Y(n+1<t.length,"Trying to write beyond buffer length"),G(e,32767,-32768));var s=t.length;n>=s||(e>=0?A(t,e,n,o,i):A(t,65535+e+1,n,o,i))}function T(t,e,n,o,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof o,"missing or invalid endian"),Y(void 0!==n&&null!==n,"missing offset"),Y(n+3<t.length,"Trying to write beyond buffer length"),G(e,2147483647,-2147483648));var s=t.length;n>=s||(e>=0?S(t,e,n,o,i):S(t,4294967295+e+1,n,o,i))}function B(t,e,n,o,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof o,"missing or invalid endian"),Y(void 0!==n&&null!==n,"missing offset"),Y(n+3<t.length,"Trying to write beyond buffer length"),X(e,3.4028234663852886e38,-3.4028234663852886e38));var s=t.length;n>=s||z.write(t,e,n,o,23,4)}function C(t,e,n,o,i){i||(Y(void 0!==e&&null!==e,"missing value"),Y("boolean"==typeof o,"missing or invalid endian"),Y(void 0!==n&&null!==n,"missing offset"),Y(n+7<t.length,"Trying to write beyond buffer length"),X(e,1.7976931348623157e308,-1.7976931348623157e308));var s=t.length;n>=s||z.write(t,e,n,o,52,8)}function L(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function M(t){return t._isBuffer=!0,t._get=t.get,t._set=t.set,t.get=W.get,t.set=W.set,t.write=W.write,t.toString=W.toString,t.toLocaleString=W.toString,t.toJSON=W.toJSON,t.copy=W.copy,t.slice=W.slice,t.readUInt8=W.readUInt8,t.readUInt16LE=W.readUInt16LE,t.readUInt16BE=W.readUInt16BE,t.readUInt32LE=W.readUInt32LE,t.readUInt32BE=W.readUInt32BE,t.readInt8=W.readInt8,t.readInt16LE=W.readInt16LE,t.readInt16BE=W.readInt16BE,t.readInt32LE=W.readInt32LE,t.readInt32BE=W.readInt32BE,t.readFloatLE=W.readFloatLE,t.readFloatBE=W.readFloatBE,t.readDoubleLE=W.readDoubleLE,t.readDoubleBE=W.readDoubleBE,t.writeUInt8=W.writeUInt8,t.writeUInt16LE=W.writeUInt16LE,t.writeUInt16BE=W.writeUInt16BE,t.writeUInt32LE=W.writeUInt32LE,t.writeUInt32BE=W.writeUInt32BE,t.writeInt8=W.writeInt8,t.writeInt16LE=W.writeInt16LE,t.writeInt16BE=W.writeInt16BE,t.writeInt32LE=W.writeInt32LE,t.writeInt32BE=W.writeInt32BE,t.writeFloatLE=W.writeFloatLE,t.writeFloatBE=W.writeFloatBE,t.writeDoubleLE=W.writeDoubleLE,t.writeDoubleBE=W.writeDoubleBE,t.fill=W.fill,t.inspect=W.inspect,t.toArrayBuffer=W.toArrayBuffer,t}function P(t,e,n){return"number"!=typeof t?n:(t=~~t,t>=e?e:t>=0?t:(t+=e,t>=0?t:0))}function I(t){return t=~~Math.ceil(+t),0>t?0:t}function R(t){return(Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)})(t)}function O(t){return R(t)||i.isBuffer(t)||t&&"object"==typeof t&&"number"==typeof t.length}function q(t){return 16>t?"0"+t.toString(16):t.toString(16)}function j(t){for(var e=[],n=0;n<t.length;n++){var o=t.charCodeAt(n);if(127>=o)e.push(t.charCodeAt(n));else{var i=n;o>=55296&&57343>=o&&n++;for(var s=encodeURIComponent(t.slice(i,n+1)).substr(1).split("%"),r=0;r<s.length;r++)e.push(parseInt(s[r],16))}}return e}function U(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e}function F(t){for(var e,n,o,i=[],s=0;s<t.length;s++)e=t.charCodeAt(s),n=e>>8,o=e%256,i.push(o),i.push(n);return i}function k(t){return H.toByteArray(t)}function N(t,e,n,o){for(var i=0;o>i&&!(i+n>=e.length||i>=t.length);i++)e[i+n]=t[i];return i}function D(t){try{return decodeURIComponent(t)}catch(e){return String.fromCharCode(65533)}}function V(t,e){Y("number"==typeof t,"cannot write a non-number as a number"),Y(t>=0,"specified a negative value for writing an unsigned value"),Y(e>=t,"value is larger than maximum value for type"),Y(Math.floor(t)===t,"value has a fractional component")}function G(t,e,n){Y("number"==typeof t,"cannot write a non-number as a number"),Y(e>=t,"value larger than maximum allowed value"),Y(t>=n,"value smaller than minimum allowed value"),Y(Math.floor(t)===t,"value has a fractional component")}function X(t,e,n){Y("number"==typeof t,"cannot write a non-number as a number"),Y(e>=t,"value larger than maximum allowed value"),Y(t>=n,"value smaller than minimum allowed value")}function Y(t,e){if(!t)throw new Error(e||"Failed assertion")}var H=t("base64-js"),z=t("ieee754");n.Buffer=i,n.SlowBuffer=i,n.INSPECT_MAX_BYTES=50,i.poolSize=8192,i._useTypedArrays=function(){if("function"!=typeof Uint8Array||"function"!=typeof ArrayBuffer)return!1;try{var t=new Uint8Array(0);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(e){return!1}}(),i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.isBuffer=function(t){return!(null===t||void 0===t||!t._isBuffer)},i.byteLength=function(t,e){var n;switch(t+="",e||"utf8"){case"hex":n=t.length/2;break;case"utf8":case"utf-8":n=j(t).length;break;case"ascii":case"binary":case"raw":n=t.length;break;case"base64":n=k(t).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*t.length;break;default:throw new Error("Unknown encoding")}return n},i.concat=function(t,e){if(Y(R(t),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===t.length)return new i(0);if(1===t.length)return t[0];var n;if("number"!=typeof e)for(e=0,n=0;n<t.length;n++)e+=t[n].length;var o=new i(e),s=0;for(n=0;n<t.length;n++){var r=t[n];r.copy(o,s),s+=r.length}return o},i.prototype.write=function(t,e,n,o){if(isFinite(e))isFinite(n)||(o=n,n=void 0);else{var i=o;o=e,e=n,n=i}e=Number(e)||0;var c=this.length-e;n?(n=Number(n),n>c&&(n=c)):n=c,o=String(o||"utf8").toLowerCase();var d;switch(o){case"hex":d=s(this,t,e,n);break;case"utf8":case"utf-8":d=r(this,t,e,n);break;case"ascii":d=a(this,t,e,n);break;case"binary":d=u(this,t,e,n);break;case"base64":d=l(this,t,e,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":d=h(this,t,e,n);break;default:throw new Error("Unknown encoding")}return d},i.prototype.toString=function(t,e,n){var o=this;if(t=String(t||"utf8").toLowerCase(),e=Number(e)||0,n=void 0!==n?Number(n):n=o.length,n===e)return"";var i;switch(t){case"hex":i=m(o,e,n);break;case"utf8":case"utf-8":i=d(o,e,n);break;case"ascii":i=f(o,e,n);break;case"binary":i=p(o,e,n);break;case"base64":i=c(o,e,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=y(o,e,n);break;default:throw new Error("Unknown encoding")}return i},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},i.prototype.copy=function(t,e,n,o){var i=this;if(n||(n=0),o||0===o||(o=this.length),e||(e=0),o!==n&&0!==t.length&&0!==i.length){Y(o>=n,"sourceEnd < sourceStart"),Y(e>=0&&e<t.length,"targetStart out of bounds"),Y(n>=0&&n<i.length,"sourceStart out of bounds"),Y(o>=0&&o<=i.length,"sourceEnd out of bounds"),o>this.length&&(o=this.length),t.length-e<o-n&&(o=t.length-e+n);for(var s=0;o-n>s;s++)t[s+e]=this[s+n]}},i.prototype.slice=function(t,e){var n=this.length;if(t=P(t,n,0),e=P(e,n,n),i._useTypedArrays)return M(this.subarray(t,e));for(var o=e-t,s=new i(o,void 0,!0),r=0;o>r;r++)s[r]=this[r+t];return s},i.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t)},i.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e)},i.prototype.readUInt8=function(t,e){return e||(Y(void 0!==t&&null!==t,"missing offset"),Y(t<this.length,"Trying to read beyond buffer length")),t>=this.length?void 0:this[t]},i.prototype.readUInt16LE=function(t,e){return g(this,t,!0,e)},i.prototype.readUInt16BE=function(t,e){return g(this,t,!1,e)},i.prototype.readUInt32LE=function(t,e){return v(this,t,!0,e)},i.prototype.readUInt32BE=function(t,e){return v(this,t,!1,e)},i.prototype.readInt8=function(t,e){if(e||(Y(void 0!==t&&null!==t,"missing offset"),Y(t<this.length,"Trying to read beyond buffer length")),!(t>=this.length)){var n=128&this[t];return n?-1*(255-this[t]+1):this[t]}},i.prototype.readInt16LE=function(t,e){return _(this,t,!0,e)},i.prototype.readInt16BE=function(t,e){return _(this,t,!1,e)},i.prototype.readInt32LE=function(t,e){return b(this,t,!0,e)},i.prototype.readInt32BE=function(t,e){return b(this,t,!1,e)},i.prototype.readFloatLE=function(t,e){return w(this,t,!0,e)},i.prototype.readFloatBE=function(t,e){return w(this,t,!1,e)},i.prototype.readDoubleLE=function(t,e){return E(this,t,!0,e)},i.prototype.readDoubleBE=function(t,e){return E(this,t,!1,e)},i.prototype.writeUInt8=function(t,e,n){n||(Y(void 0!==t&&null!==t,"missing value"),Y(void 0!==e&&null!==e,"missing offset"),Y(e<this.length,"trying to write beyond buffer length"),V(t,255)),e>=this.length||(this[e]=t)},i.prototype.writeUInt16LE=function(t,e,n){A(this,t,e,!0,n)},i.prototype.writeUInt16BE=function(t,e,n){A(this,t,e,!1,n)},i.prototype.writeUInt32LE=function(t,e,n){S(this,t,e,!0,n)},i.prototype.writeUInt32BE=function(t,e,n){S(this,t,e,!1,n)},i.prototype.writeInt8=function(t,e,n){n||(Y(void 0!==t&&null!==t,"missing value"),Y(void 0!==e&&null!==e,"missing offset"),Y(e<this.length,"Trying to write beyond buffer length"),G(t,127,-128)),e>=this.length||(t>=0?this.writeUInt8(t,e,n):this.writeUInt8(255+t+1,e,n))},i.prototype.writeInt16LE=function(t,e,n){x(this,t,e,!0,n)},i.prototype.writeInt16BE=function(t,e,n){x(this,t,e,!1,n)},i.prototype.writeInt32LE=function(t,e,n){T(this,t,e,!0,n)},i.prototype.writeInt32BE=function(t,e,n){T(this,t,e,!1,n)},i.prototype.writeFloatLE=function(t,e,n){B(this,t,e,!0,n)},i.prototype.writeFloatBE=function(t,e,n){B(this,t,e,!1,n)},i.prototype.writeDoubleLE=function(t,e,n){C(this,t,e,!0,n)},i.prototype.writeDoubleBE=function(t,e,n){C(this,t,e,!1,n)},i.prototype.fill=function(t,e,n){if(t||(t=0),e||(e=0),n||(n=this.length),"string"==typeof t&&(t=t.charCodeAt(0)),Y("number"==typeof t&&!isNaN(t),"value is not a number"),Y(n>=e,"end < start"),n!==e&&0!==this.length){Y(e>=0&&e<this.length,"start out of bounds"),Y(n>=0&&n<=this.length,"end out of bounds");for(var o=e;n>o;o++)this[o]=t}},i.prototype.inspect=function(){for(var t=[],e=this.length,o=0;e>o;o++)if(t[o]=q(this[o]),o===n.INSPECT_MAX_BYTES){t[o+1]="...";break}return"<Buffer "+t.join(" ")+">"},i.prototype.toArrayBuffer=function(){if("function"==typeof Uint8Array){if(i._useTypedArrays)return new i(this).buffer;for(var t=new Uint8Array(this.length),e=0,n=t.length;n>e;e+=1)t[e]=this[e];return t.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var W=i.prototype}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/index.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,"base64-js":2,buffer:1,ieee754:3}],2:[function(t,e){(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(){"use strict";function n(t){var e=t.charCodeAt(0);return e===r?62:e===a?63:u>e?-1:u+10>e?e-u+26+26:h+26>e?e-h:l+26>e?e-l+26:void 0}function o(t){function e(t){l[c++]=t}var o,i,r,a,u,l;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var h=t.length;u="="===t.charAt(h-2)?2:"="===t.charAt(h-1)?1:0,l=new s(3*t.length/4-u),r=u>0?t.length-4:t.length;var c=0;for(o=0,i=0;r>o;o+=4,i+=3)a=n(t.charAt(o))<<18|n(t.charAt(o+1))<<12|n(t.charAt(o+2))<<6|n(t.charAt(o+3)),e((16711680&a)>>16),e((65280&a)>>8),e(255&a);return 2===u?(a=n(t.charAt(o))<<2|n(t.charAt(o+1))>>4,e(255&a)):1===u&&(a=n(t.charAt(o))<<10|n(t.charAt(o+1))<<4|n(t.charAt(o+2))>>2,e(a>>8&255),e(255&a)),l}function i(e){function n(e){return t.charAt(e)}function o(t){return n(t>>18&63)+n(t>>12&63)+n(t>>6&63)+n(63&t)}var i,s,r,a=e.length%3,u="";for(i=0,r=e.length-a;r>i;i+=3)s=(e[i]<<16)+(e[i+1]<<8)+e[i+2],u+=o(s);switch(a){case 1:s=e[e.length-1],u+=n(s>>2),u+=n(s<<4&63),u+="==";break;case 2:s=(e[e.length-2]<<8)+e[e.length-1],u+=n(s>>10),u+=n(s>>4&63),u+=n(s<<2&63),u+="="}return u}var s="undefined"!=typeof Uint8Array?Uint8Array:Array,r=("0".charCodeAt(0),"+".charCodeAt(0)),a="/".charCodeAt(0),u="0".charCodeAt(0),l="a".charCodeAt(0),h="A".charCodeAt(0);e.exports.toByteArray=o,e.exports.fromByteArray=i}()}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib/b64.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],3:[function(t,e,n){(function(){n.read=function(t,e,n,o,i){var s,r,a=8*i-o-1,u=(1<<a)-1,l=u>>1,h=-7,c=n?i-1:0,d=n?-1:1,f=t[e+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=a;h>0;s=256*s+t[e+c],c+=d,h-=8);for(r=s&(1<<-h)-1,s>>=-h,h+=o;h>0;r=256*r+t[e+c],c+=d,h-=8);if(0===s)s=1-l;else{if(s===u)return r?0/0:1/0*(f?-1:1);r+=Math.pow(2,o),s-=l}return(f?-1:1)*r*Math.pow(2,s-o)},n.write=function(t,e,n,o,i,s){var r,a,u,l=8*s-i-1,h=(1<<l)-1,c=h>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=o?0:s-1,p=o?1:-1,m=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||1/0===e?(a=isNaN(e)?1:0,r=h):(r=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-r))<1&&(r--,u*=2),e+=r+c>=1?d/u:d*Math.pow(2,1-c),e*u>=2&&(r++,u/=2),r+c>=h?(a=0,r=h):r+c>=1?(a=(e*u-1)*Math.pow(2,i),r+=c):(a=e*Math.pow(2,c-1)*Math.pow(2,i),r=0));i>=8;t[n+f]=255&a,f+=p,a/=256,i-=8);for(r=r<<i|a,l+=i;l>0;t[n+f]=255&r,f+=p,r/=256,l-=8);t[n+f-p]|=128*m}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/ieee754")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],4:[function(t,e){(function(t){function n(){}var t=e.exports={};t.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var n=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var o=n.shift();o()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),t.title="browser",t.browser=!0,t.env={},t.argv=[],t.on=n,t.once=n,t.off=n,t.emit=n,t.binding=function(){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(){throw new Error("process.chdir is not supported")}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js","/../node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],5:[function(t,e){(function(){function n(){}var o=t("./Scalar");e.exports=n,n.lineInt=function(t,e,n){n=n||0;var i,s,r,a,u,l,h,c=[0,0];return i=t[1][1]-t[0][1],s=t[0][0]-t[1][0],r=i*t[0][0]+s*t[0][1],a=e[1][1]-e[0][1],u=e[0][0]-e[1][0],l=a*e[0][0]+u*e[0][1],h=i*u-a*s,o.eq(h,0,n)||(c[0]=(u*r-s*l)/h,c[1]=(i*l-a*r)/h),c},n.segmentsIntersect=function(t,e,n,o){var i=e[0]-t[0],s=e[1]-t[1],r=o[0]-n[0],a=o[1]-n[1];if(r*s-a*i==0)return!1;var u=(i*(n[1]-t[1])+s*(t[0]-n[0]))/(r*s-a*i),l=(r*(t[1]-n[1])+a*(n[0]-t[0]))/(a*i-r*s);return u>=0&&1>=u&&l>=0&&1>=l}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Line.js","/../node_modules/poly-decomp/src")},{"./Scalar":8,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],6:[function(t,e){(function(){function t(){}e.exports=t,t.area=function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])},t.left=function(e,n,o){return t.area(e,n,o)>0},t.leftOn=function(e,n,o){return t.area(e,n,o)>=0},t.right=function(e,n,o){return t.area(e,n,o)<0},t.rightOn=function(e,n,o){return t.area(e,n,o)<=0};var n=[],o=[];t.collinear=function(e,i,s,r){if(r){var a=n,u=o;a[0]=i[0]-e[0],a[1]=i[1]-e[1],u[0]=s[0]-i[0],u[1]=s[1]-i[1];var l=a[0]*u[0]+a[1]*u[1],h=Math.sqrt(a[0]*a[0]+a[1]*a[1]),c=Math.sqrt(u[0]*u[0]+u[1]*u[1]),d=Math.acos(l/(h*c));return r>d}return 0==t.area(e,i,s)},t.sqdist=function(t,e){var n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Point.js","/../node_modules/poly-decomp/src")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],7:[function(t,e){(function(){function n(){this.vertices=[]}function o(t,e,n,o,i){i=i||0;var s=e[1]-t[1],a=t[0]-e[0],u=s*t[0]+a*t[1],l=o[1]-n[1],h=n[0]-o[0],c=l*n[0]+h*n[1],d=s*h-l*a;
return r.eq(d,0,i)?[0,0]:[(h*u-a*c)/d,(s*c-l*u)/d]}var i=t("./Line"),s=t("./Point"),r=t("./Scalar");e.exports=n,n.prototype.at=function(t){var e=this.vertices,n=e.length;return e[0>t?t%n+n:t%n]},n.prototype.first=function(){return this.vertices[0]},n.prototype.last=function(){return this.vertices[this.vertices.length-1]},n.prototype.clear=function(){this.vertices.length=0},n.prototype.append=function(t,e,n){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof n)throw new Error("To is not given!");if(e>n-1)throw new Error("lol1");if(n>t.vertices.length)throw new Error("lol2");if(0>e)throw new Error("lol3");for(var o=e;n>o;o++)this.vertices.push(t.vertices[o])},n.prototype.makeCCW=function(){for(var t=0,e=this.vertices,n=1;n<this.vertices.length;++n)(e[n][1]<e[t][1]||e[n][1]==e[t][1]&&e[n][0]>e[t][0])&&(t=n);s.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},n.prototype.reverse=function(){for(var t=[],e=0,n=this.vertices.length;e!==n;e++)t.push(this.vertices.pop());this.vertices=t},n.prototype.isReflex=function(t){return s.right(this.at(t-1),this.at(t),this.at(t+1))};var a=[],u=[];n.prototype.canSee=function(t,e){var n,o,r=a,l=u;if(s.leftOn(this.at(t+1),this.at(t),this.at(e))&&s.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;o=s.sqdist(this.at(t),this.at(e));for(var h=0;h!==this.vertices.length;++h)if((h+1)%this.vertices.length!==t&&h!==t&&s.leftOn(this.at(t),this.at(e),this.at(h+1))&&s.rightOn(this.at(t),this.at(e),this.at(h))&&(r[0]=this.at(t),r[1]=this.at(e),l[0]=this.at(h),l[1]=this.at(h+1),n=i.lineInt(r,l),s.sqdist(this.at(t),n)<o))return!1;return!0},n.prototype.copy=function(t,e,o){var i=o||new n;if(i.clear(),e>t)for(var s=t;e>=s;s++)i.vertices.push(this.vertices[s]);else{for(var s=0;e>=s;s++)i.vertices.push(this.vertices[s]);for(var s=t;s<this.vertices.length;s++)i.vertices.push(this.vertices[s])}return i},n.prototype.getCutEdges=function(){for(var t=[],e=[],o=[],i=new n,s=Number.MAX_VALUE,r=0;r<this.vertices.length;++r)if(this.isReflex(r))for(var a=0;a<this.vertices.length;++a)if(this.canSee(r,a)){e=this.copy(r,a,i).getCutEdges(),o=this.copy(a,r,i).getCutEdges();for(var u=0;u<o.length;u++)e.push(o[u]);e.length<s&&(t=e,s=e.length,t.push([this.at(r),this.at(a)]))}return t},n.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},n.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],n=0;n<t.length;n++)for(var o=t[n],i=0;i<e.length;i++){var s=e[i],r=s.slice(o);if(r){e.splice(i,1),e.push(r[0],r[1]);break}}return e}var o=t,n=this.vertices.indexOf(o[0]),i=this.vertices.indexOf(o[1]);return-1!=n&&-1!=i?[this.copy(n,i),this.copy(i,n)]:!1},n.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var n=0;e-1>n;n++)if(i.segmentsIntersect(t[e],t[e+1],t[n],t[n+1]))return!1;for(var e=1;e<t.length-2;e++)if(i.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},n.prototype.quickDecomp=function(t,e,i,r,a,u){a=a||100,u=u||0,r=r||25,t="undefined"!=typeof t?t:[],e=e||[],i=i||[];var l=[0,0],h=[0,0],c=[0,0],d=0,f=0,p=0,m=0,y=0,g=0,v=0,_=new n,b=new n,w=this,E=this.vertices;if(E.length<3)return t;if(u++,u>a)return console.warn("quickDecomp: max level ("+a+") reached."),t;for(var A=0;A<this.vertices.length;++A)if(w.isReflex(A)){e.push(w.vertices[A]),d=f=Number.MAX_VALUE;for(var S=0;S<this.vertices.length;++S)s.left(w.at(A-1),w.at(A),w.at(S))&&s.rightOn(w.at(A-1),w.at(A),w.at(S-1))&&(c=o(w.at(A-1),w.at(A),w.at(S),w.at(S-1)),s.right(w.at(A+1),w.at(A),c)&&(p=s.sqdist(w.vertices[A],c),f>p&&(f=p,h=c,g=S))),s.left(w.at(A+1),w.at(A),w.at(S+1))&&s.rightOn(w.at(A+1),w.at(A),w.at(S))&&(c=o(w.at(A+1),w.at(A),w.at(S),w.at(S+1)),s.left(w.at(A-1),w.at(A),c)&&(p=s.sqdist(w.vertices[A],c),d>p&&(d=p,l=c,y=S)));if(g==(y+1)%this.vertices.length)c[0]=(h[0]+l[0])/2,c[1]=(h[1]+l[1])/2,i.push(c),y>A?(_.append(w,A,y+1),_.vertices.push(c),b.vertices.push(c),0!=g&&b.append(w,g,w.vertices.length),b.append(w,0,A+1)):(0!=A&&_.append(w,A,w.vertices.length),_.append(w,0,y+1),_.vertices.push(c),b.vertices.push(c),b.append(w,g,A+1));else{if(g>y&&(y+=this.vertices.length),m=Number.MAX_VALUE,g>y)return t;for(var S=g;y>=S;++S)s.leftOn(w.at(A-1),w.at(A),w.at(S))&&s.rightOn(w.at(A+1),w.at(A),w.at(S))&&(p=s.sqdist(w.at(A),w.at(S)),m>p&&(m=p,v=S%this.vertices.length));v>A?(_.append(w,A,v+1),0!=v&&b.append(w,v,E.length),b.append(w,0,A+1)):(0!=A&&_.append(w,A,E.length),_.append(w,0,v+1),b.append(w,v,A+1))}return _.vertices.length<b.vertices.length?(_.quickDecomp(t,e,i,r,a,u),b.quickDecomp(t,e,i,r,a,u)):(b.quickDecomp(t,e,i,r,a,u),_.quickDecomp(t,e,i,r,a,u)),t}return t.push(this),t},n.prototype.removeCollinearPoints=function(t){for(var e=0,n=this.vertices.length-1;this.vertices.length>3&&n>=0;--n)s.collinear(this.at(n-1),this.at(n),this.at(n+1),t)&&(this.vertices.splice(n%this.vertices.length,1),n--,e++);return e}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Polygon.js","/../node_modules/poly-decomp/src")},{"./Line":5,"./Point":6,"./Scalar":8,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],8:[function(t,e){(function(){function t(){}e.exports=t,t.eq=function(t,e,n){return n=n||0,Math.abs(t-e)<n}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/Scalar.js","/../node_modules/poly-decomp/src")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],9:[function(t,e){(function(){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/../node_modules/poly-decomp/src/index.js","/../node_modules/poly-decomp/src")},{"./Point":6,"./Polygon":7,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],10:[function(t,e){e.exports={name:"p2",version:"0.6.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],11:[function(t,e){(function(){function n(t){this.lowerBound=o.create(),t&&t.lowerBound&&o.copy(this.lowerBound,t.lowerBound),this.upperBound=o.create(),t&&t.upperBound&&o.copy(this.upperBound,t.upperBound)}var o=t("../math/vec2");t("../utils/Utils"),e.exports=n;var i=o.create();n.prototype.setFromPoints=function(t,e,n,s){var r=this.lowerBound,a=this.upperBound;"number"!=typeof n&&(n=0),0!==n?o.rotate(r,t[0],n):o.copy(r,t[0]),o.copy(a,r);for(var u=Math.cos(n),l=Math.sin(n),h=1;h<t.length;h++){var c=t[h];if(0!==n){var d=c[0],f=c[1];i[0]=u*d-l*f,i[1]=l*d+u*f,c=i}for(var p=0;2>p;p++)c[p]>a[p]&&(a[p]=c[p]),c[p]<r[p]&&(r[p]=c[p])}e&&(o.add(this.lowerBound,this.lowerBound,e),o.add(this.upperBound,this.upperBound,e)),s&&(this.lowerBound[0]-=s,this.lowerBound[1]-=s,this.upperBound[0]+=s,this.upperBound[1]+=s)},n.prototype.copy=function(t){o.copy(this.lowerBound,t.lowerBound),o.copy(this.upperBound,t.upperBound)},n.prototype.extend=function(t){for(var e=2;e--;){var n=t.lowerBound[e];this.lowerBound[e]>n&&(this.lowerBound[e]=n);var o=t.upperBound[e];this.upperBound[e]<o&&(this.upperBound[e]=o)}},n.prototype.overlaps=function(t){var e=this.lowerBound,n=this.upperBound,o=t.lowerBound,i=t.upperBound;return(o[0]<=n[0]&&n[0]<=i[0]||e[0]<=i[0]&&i[0]<=n[0])&&(o[1]<=n[1]&&n[1]<=i[1]||e[1]<=i[1]&&i[1]<=n[1])}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/AABB.js","/collision")},{"../math/vec2":33,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],12:[function(t,e){(function(){function n(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=n.AABB}var o=t("../math/vec2"),i=t("../objects/Body");e.exports=n,n.AABB=1,n.BOUNDING_CIRCLE=2,n.prototype.setWorld=function(t){this.world=t},n.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!")};var s=o.create();n.boundingRadiusCheck=function(t,e){o.sub(s,t.position,e.position);var n=o.squaredLength(s),i=t.boundingRadius+e.boundingRadius;return i*i>=n},n.aabbCheck=function(t,e){return t.aabbNeedsUpdate&&t.updateAABB(),e.aabbNeedsUpdate&&e.updateAABB(),t.aabb.overlaps(e.aabb)},n.prototype.boundingVolumeCheck=function(t,e){var o;switch(this.boundingVolumeType){case n.BOUNDING_CIRCLE:o=n.boundingRadiusCheck(t,e);break;case n.AABB:o=n.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return o},n.canCollide=function(t,e){return t.type===i.STATIC&&e.type===i.STATIC?!1:t.type===i.KINEMATIC&&e.type===i.STATIC||t.type===i.STATIC&&e.type===i.KINEMATIC?!1:t.type===i.KINEMATIC&&e.type===i.KINEMATIC?!1:t.sleepState===i.SLEEPING&&e.sleepState===i.SLEEPING?!1:t.sleepState===i.SLEEPING&&e.type===i.STATIC||e.sleepState===i.SLEEPING&&t.type===i.STATIC?!1:!0},n.NAIVE=1,n.SAP=2}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/Broadphase.js","/collision")},{"../math/vec2":33,"../objects/Body":34,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],13:[function(t,e){(function(){function n(t){o.apply(this),t=i.defaults(t,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10}),this.xmin=t.xmin,this.ymin=t.ymin,this.xmax=t.xmax,this.ymax=t.ymax,this.nx=t.nx,this.ny=t.ny,this.binsizeX=(this.xmax-this.xmin)/this.nx,this.binsizeY=(this.ymax-this.ymin)/this.ny}var o=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Particle"),t("../collision/Broadphase")),i=(t("../math/vec2"),t("../utils/Utils"));e.exports=n,n.prototype=new o,n.prototype.getCollisionPairs=function(t){for(var e=[],n=t.bodies,i=n.length,s=(this.binsizeX,this.binsizeY,this.nx),r=this.ny,a=this.xmin,u=this.ymin,l=this.xmax,h=this.ymax,c=[],d=s*r,f=0;d>f;f++)c.push([]);for(var p=s/(l-a),m=r/(h-u),f=0;f!==i;f++)for(var y=n[f],g=y.aabb,v=Math.max(g.lowerBound[0],a),_=Math.max(g.lowerBound[1],u),b=Math.min(g.upperBound[0],l),w=Math.min(g.upperBound[1],h),E=Math.floor(p*(v-a)),A=Math.floor(m*(_-u)),S=Math.floor(p*(b-a)),x=Math.floor(m*(w-u)),T=E;S>=T;T++)for(var B=A;x>=B;B++){var C=T,L=B,M=C*(r-1)+L;M>=0&&d>M&&c[M].push(y)}for(var f=0;f!==d;f++)for(var P=c[f],T=0,I=P.length;T!==I;T++)for(var y=P[T],B=0;B!==T;B++){var R=P[B];o.canCollide(y,R)&&this.boundingVolumeCheck(y,R)&&e.push(y,R)}return e}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/GridBroadphase.js","/collision")},{"../collision/Broadphase":12,"../math/vec2":33,"../shapes/Circle":40,"../shapes/Particle":44,"../shapes/Plane":45,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],14:[function(t,e){(function(){function n(){o.call(this,o.NAIVE)}var o=(t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle"),t("../collision/Broadphase"));t("../math/vec2"),e.exports=n,n.prototype=new o,n.prototype.getCollisionPairs=function(t){var e=t.bodies,n=this.result;n.length=0;for(var i=0,s=e.length;i!==s;i++)for(var r=e[i],a=0;i>a;a++){var u=e[a];o.canCollide(r,u)&&this.boundingVolumeCheck(r,u)&&n.push(r,u)}return n}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/NaiveBroadphase.js","/collision")},{"../collision/Broadphase":12,"../math/vec2":33,"../shapes/Circle":40,"../shapes/Particle":44,"../shapes/Plane":45,"../shapes/Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],15:[function(t,e){(function(){function n(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.reuseObjects=!0,this.reusableContactEquations=[],this.reusableFrictionEquations=[],this.restitution=0,this.stiffness=c.DEFAULT_STIFFNESS,this.relaxation=c.DEFAULT_RELAXATION,this.frictionStiffness=c.DEFAULT_STIFFNESS,this.frictionRelaxation=c.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new h,this.contactSkinSize=.01}function o(t,e){s.set(t.vertices[0],.5*-e.length,-e.radius),s.set(t.vertices[1],.5*e.length,-e.radius),s.set(t.vertices[2],.5*e.length,e.radius),s.set(t.vertices[3],.5*-e.length,e.radius)}function i(t,e,n,o){for(var i=G,u=X,l=Y,h=H,c=t,d=e.vertices,f=null,p=0;p!==d.length+1;p++){var m=d[p%d.length],y=d[(p+1)%d.length];s.rotate(i,m,o),s.rotate(u,y,o),a(i,i,n),a(u,u,n),r(l,i,c),r(h,u,c);var g=s.crossLength(l,h);if(null===f&&(f=g),0>=g*f)return!1;f=g}return!0}var s=t("../math/vec2"),r=s.sub,a=s.add,u=s.dot,l=t("../utils/Utils"),h=t("../utils/TupleDictionary"),c=t("../equations/Equation"),d=t("../equations/ContactEquation"),f=t("../equations/FrictionEquation"),p=t("../shapes/Circle"),m=t("../shapes/Convex"),y=t("../shapes/Shape"),g=(t("../objects/Body"),t("../shapes/Rectangle"));e.exports=n;var v=s.fromValues(0,1),_=s.fromValues(0,0),b=s.fromValues(0,0),w=s.fromValues(0,0),E=s.fromValues(0,0),A=s.fromValues(0,0),S=s.fromValues(0,0),x=s.fromValues(0,0),T=s.fromValues(0,0),B=s.fromValues(0,0),C=s.fromValues(0,0),L=s.fromValues(0,0),M=s.fromValues(0,0),P=s.fromValues(0,0),I=s.fromValues(0,0),R=s.fromValues(0,0),O=s.fromValues(0,0),q=s.fromValues(0,0),j=s.fromValues(0,0),U=[];n.prototype.collidedLastStep=function(t,e){var n=0|t.id,o=0|e.id;return!!this.collidingBodiesLastStep.get(n,o)},n.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var n=t[e],o=n.bodyA.id,i=n.bodyB.id;this.collidingBodiesLastStep.set(o,i,!0)}if(this.reuseObjects){var s=this.contactEquations,r=this.frictionEquations,a=this.reusableFrictionEquations,u=this.reusableContactEquations;l.appendArray(u,s),l.appendArray(a,r)}this.contactEquations.length=this.frictionEquations.length=0},n.prototype.createContactEquation=function(t,e,n,o){var i=this.reusableContactEquations.length?this.reusableContactEquations.pop():new d(t,e);return i.bodyA=t,i.bodyB=e,i.shapeA=n,i.shapeB=o,i.restitution=this.restitution,i.firstImpact=!this.collidedLastStep(t,e),i.stiffness=this.stiffness,i.relaxation=this.relaxation,i.needsUpdate=!0,i.enabled=!0,i.offset=this.contactSkinSize,i},n.prototype.createFrictionEquation=function(t,e,n,o){var i=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new f(t,e);return i.bodyA=t,i.bodyB=e,i.shapeA=n,i.shapeB=o,i.setSlipForce(this.slipForce),i.frictionCoefficient=this.frictionCoefficient,i.relativeVelocity=this.surfaceVelocity,i.enabled=!0,i.needsUpdate=!0,i.stiffness=this.frictionStiffness,i.relaxation=this.frictionRelaxation,i.contactEquations.length=0,i},n.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return s.copy(e.contactPointA,t.contactPointA),s.copy(e.contactPointB,t.contactPointB),s.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},n.prototype.createFrictionFromAverage=function(t){if(!t)throw new Error("numContacts == 0!");var e=this.contactEquations[this.contactEquations.length-1],n=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),o=e.bodyA;e.bodyB,s.set(n.contactPointA,0,0),s.set(n.contactPointB,0,0),s.set(n.t,0,0);for(var i=0;i!==t;i++)e=this.contactEquations[this.contactEquations.length-1-i],e.bodyA===o?(s.add(n.t,n.t,e.normalA),s.add(n.contactPointA,n.contactPointA,e.contactPointA),s.add(n.contactPointB,n.contactPointB,e.contactPointB)):(s.sub(n.t,n.t,e.normalA),s.add(n.contactPointA,n.contactPointA,e.contactPointB),s.add(n.contactPointB,n.contactPointB,e.contactPointA)),n.contactEquations.push(e);var r=1/t;return s.scale(n.contactPointA,n.contactPointA,r),s.scale(n.contactPointB,n.contactPointB,r),s.normalize(n.t,n.t),s.rotate90cw(n.t,n.t),n},n.prototype[y.LINE|y.CONVEX]=n.prototype.convexLine=function(t,e,n,o,i,s,r,a,u){return u?!1:0},n.prototype[y.LINE|y.RECTANGLE]=n.prototype.lineRectangle=function(t,e,n,o,i,s,r,a,u){return u?!1:0};var F=new g(1,1),k=s.create();n.prototype[y.CAPSULE|y.CONVEX]=n.prototype[y.CAPSULE|y.RECTANGLE]=n.prototype.convexCapsule=function(t,e,n,i,r,a,u,l,h){var c=k;s.set(c,a.length/2,0),s.rotate(c,c,l),s.add(c,c,u);var d=this.circleConvex(r,a,c,l,t,e,n,i,h,a.radius);s.set(c,-a.length/2,0),s.rotate(c,c,l),s.add(c,c,u);var f=this.circleConvex(r,a,c,l,t,e,n,i,h,a.radius);if(h&&(d||f))return!0;var p=F;o(p,a);var m=this.convexConvex(t,e,n,i,r,p,u,l,h);return m+d+f},n.prototype[y.CAPSULE|y.LINE]=n.prototype.lineCapsule=function(t,e,n,o,i,s,r,a,u){return u?!1:0};var N=s.create(),D=s.create(),V=new g(1,1);n.prototype[y.CAPSULE|y.CAPSULE]=n.prototype.capsuleCapsule=function(t,e,n,i,r,a,u,l,h){for(var c,d=N,f=D,p=0,m=0;2>m;m++){s.set(d,(0===m?-1:1)*e.length/2,0),s.rotate(d,d,i),s.add(d,d,n);for(var y=0;2>y;y++){s.set(f,(0===y?-1:1)*a.length/2,0),s.rotate(f,f,l),s.add(f,f,u),this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1);var g=this.circleCircle(t,e,d,i,r,a,f,l,h,e.radius,a.radius);if(this.enableFrictionReduction&&(this.enableFriction=c),h&&g)return!0;p+=g}}this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1);var v=V;o(v,e);var _=this.convexCapsule(t,v,n,i,r,a,u,l,h);if(this.enableFrictionReduction&&(this.enableFriction=c),h&&_)return!0;if(p+=_,this.enableFrictionReduction){var c=this.enableFriction;this.enableFriction=!1}o(v,a);var b=this.convexCapsule(r,v,u,l,t,e,n,i,h);return this.enableFrictionReduction&&(this.enableFriction=c),h&&b?!0:(p+=b,this.enableFrictionReduction&&p&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(p)),p)},n.prototype[y.LINE|y.LINE]=n.prototype.lineLine=function(t,e,n,o,i,s,r,a,u){return u?!1:0},n.prototype[y.PLANE|y.LINE]=n.prototype.planeLine=function(t,e,n,o,i,l,h,c,d){var f=_,p=b,m=w,y=E,g=A,C=S,L=x,M=T,P=B,I=U,R=0;s.set(f,-l.length/2,0),s.set(p,l.length/2,0),s.rotate(m,f,c),s.rotate(y,p,c),a(m,m,h),a(y,y,h),s.copy(f,m),s.copy(p,y),r(g,p,f),s.normalize(C,g),s.rotate90cw(P,C),s.rotate(M,v,o),I[0]=f,I[1]=p;for(var O=0;O<I.length;O++){var q=I[O];r(L,q,n);var j=u(L,M);if(0>j){if(d)return!0;var F=this.createContactEquation(t,i,e,l);R++,s.copy(F.normalA,M),s.normalize(F.normalA,F.normalA),s.scale(L,M,j),r(F.contactPointA,q,L),r(F.contactPointA,F.contactPointA,t.position),r(F.contactPointB,q,h),a(F.contactPointB,F.contactPointB,h),r(F.contactPointB,F.contactPointB,i.position),this.contactEquations.push(F),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(F))}}return d?!1:(this.enableFrictionReduction||R&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(R)),R)},n.prototype[y.PARTICLE|y.CAPSULE]=n.prototype.particleCapsule=function(t,e,n,o,i,s,r,a,u){return this.circleLine(t,e,n,o,i,s,r,a,u,s.radius,0)},n.prototype[y.CIRCLE|y.LINE]=n.prototype.circleLine=function(t,e,n,o,i,l,h,c,d,f,p){var f=f||0,p="undefined"!=typeof p?p:e.radius,m=_,y=b,g=w,v=E,R=A,O=S,q=x,j=T,F=B,k=C,N=L,D=M,V=P,G=I,X=U;s.set(j,-l.length/2,0),s.set(F,l.length/2,0),s.rotate(k,j,c),s.rotate(N,F,c),a(k,k,h),a(N,N,h),s.copy(j,k),s.copy(F,N),r(O,F,j),s.normalize(q,O),s.rotate90cw(R,q),r(D,n,j);var Y=u(D,R);r(v,j,h),r(V,n,h);var H=p+f;if(Math.abs(Y)<H){s.scale(m,R,Y),r(g,n,m),s.scale(y,R,u(R,V)),s.normalize(y,y),s.scale(y,y,f),a(g,g,y);var z=u(q,g),W=u(q,j),K=u(q,F);if(z>W&&K>z){if(d)return!0;var $=this.createContactEquation(t,i,e,l);return s.scale($.normalA,m,-1),s.normalize($.normalA,$.normalA),s.scale($.contactPointA,$.normalA,p),a($.contactPointA,$.contactPointA,n),r($.contactPointA,$.contactPointA,t.position),r($.contactPointB,g,h),a($.contactPointB,$.contactPointB,h),r($.contactPointB,$.contactPointB,i.position),this.contactEquations.push($),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact($)),1}}X[0]=j,X[1]=F;for(var J=0;J<X.length;J++){var Q=X[J];if(r(D,Q,n),s.squaredLength(D)<Math.pow(H,2)){if(d)return!0;var $=this.createContactEquation(t,i,e,l);return s.copy($.normalA,D),s.normalize($.normalA,$.normalA),s.scale($.contactPointA,$.normalA,p),a($.contactPointA,$.contactPointA,n),r($.contactPointA,$.contactPointA,t.position),r($.contactPointB,Q,h),s.scale(G,$.normalA,-f),a($.contactPointB,$.contactPointB,G),a($.contactPointB,$.contactPointB,h),r($.contactPointB,$.contactPointB,i.position),this.contactEquations.push($),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact($)),1}}return 0},n.prototype[y.CIRCLE|y.CAPSULE]=n.prototype.circleCapsule=function(t,e,n,o,i,s,r,a,u){return this.circleLine(t,e,n,o,i,s,r,a,u,s.radius)},n.prototype[y.CIRCLE|y.CONVEX]=n.prototype[y.CIRCLE|y.RECTANGLE]=n.prototype.circleConvex=function(t,e,n,o,u,l,h,c,d,f){for(var f="number"==typeof f?f:e.radius,p=_,m=b,y=w,g=E,v=A,S=C,x=L,T=P,B=I,M=R,q=O,j=!1,U=Number.MAX_VALUE,F=l.vertices,k=0;k!==F.length+1;k++){var N=F[k%F.length],D=F[(k+1)%F.length];if(s.rotate(p,N,c),s.rotate(m,D,c),a(p,p,h),a(m,m,h),r(y,m,p),s.normalize(g,y),s.rotate90cw(v,g),s.scale(B,v,-e.radius),a(B,B,n),i(B,l,h,c)){s.sub(M,p,B);var V=Math.abs(s.dot(M,v));U>V&&(s.copy(q,B),U=V,s.scale(T,v,V),s.add(T,T,B),j=!0)}}if(j){if(d)return!0;var G=this.createContactEquation(t,u,e,l);return s.sub(G.normalA,q,n),s.normalize(G.normalA,G.normalA),s.scale(G.contactPointA,G.normalA,f),a(G.contactPointA,G.contactPointA,n),r(G.contactPointA,G.contactPointA,t.position),r(G.contactPointB,T,h),a(G.contactPointB,G.contactPointB,h),r(G.contactPointB,G.contactPointB,u.position),this.contactEquations.push(G),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(G)),1}if(f>0)for(var k=0;k<F.length;k++){var X=F[k];if(s.rotate(x,X,c),a(x,x,h),r(S,x,n),s.squaredLength(S)<Math.pow(f,2)){if(d)return!0;var G=this.createContactEquation(t,u,e,l);return s.copy(G.normalA,S),s.normalize(G.normalA,G.normalA),s.scale(G.contactPointA,G.normalA,f),a(G.contactPointA,G.contactPointA,n),r(G.contactPointA,G.contactPointA,t.position),r(G.contactPointB,x,h),a(G.contactPointB,G.contactPointB,h),r(G.contactPointB,G.contactPointB,u.position),this.contactEquations.push(G),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(G)),1}}return 0};var G=s.create(),X=s.create(),Y=s.create(),H=s.create();n.prototype[y.PARTICLE|y.CONVEX]=n.prototype[y.PARTICLE|y.RECTANGLE]=n.prototype.particleConvex=function(t,e,n,o,l,h,c,d,f){var p=_,m=b,y=w,g=E,v=A,T=S,B=x,L=C,M=P,I=q,R=j,O=Number.MAX_VALUE,U=!1,F=h.vertices;if(!i(n,h,c,d))return 0;if(f)return!0;for(var k=0;k!==F.length+1;k++){var N=F[k%F.length],D=F[(k+1)%F.length];s.rotate(p,N,d),s.rotate(m,D,d),a(p,p,c),a(m,m,c),r(y,m,p),s.normalize(g,y),s.rotate90cw(v,g),r(L,n,p),u(L,v),r(T,p,c),r(B,n,c),s.sub(I,p,n);var V=Math.abs(s.dot(I,v));O>V&&(O=V,s.scale(M,v,V),s.add(M,M,n),s.copy(R,v),U=!0)}if(U){var G=this.createContactEquation(t,l,e,h);return s.scale(G.normalA,R,-1),s.normalize(G.normalA,G.normalA),s.set(G.contactPointA,0,0),a(G.contactPointA,G.contactPointA,n),r(G.contactPointA,G.contactPointA,t.position),r(G.contactPointB,M,c),a(G.contactPointB,G.contactPointB,c),r(G.contactPointB,G.contactPointB,l.position),this.contactEquations.push(G),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(G)),1}return 0},n.prototype[y.CIRCLE]=n.prototype.circleCircle=function(t,e,n,o,i,u,l,h,c,d,f){var p=_,d=d||e.radius,f=f||u.radius;r(p,n,l);var m=d+f;if(s.squaredLength(p)>Math.pow(m,2))return 0;if(c)return!0;var y=this.createContactEquation(t,i,e,u);return r(y.normalA,l,n),s.normalize(y.normalA,y.normalA),s.scale(y.contactPointA,y.normalA,d),s.scale(y.contactPointB,y.normalA,-f),a(y.contactPointA,y.contactPointA,n),r(y.contactPointA,y.contactPointA,t.position),a(y.contactPointB,y.contactPointB,l),r(y.contactPointB,y.contactPointB,i.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1},n.prototype[y.PLANE|y.CONVEX]=n.prototype[y.PLANE|y.RECTANGLE]=n.prototype.planeConvex=function(t,e,n,o,i,l,h,c,d){var f=_,p=b,m=w,y=0;s.rotate(p,v,o);for(var g=0;g!==l.vertices.length;g++){var E=l.vertices[g];if(s.rotate(f,E,c),a(f,f,h),r(m,f,n),u(m,p)<=0){if(d)return!0;y++;var A=this.createContactEquation(t,i,e,l);r(m,f,n),s.copy(A.normalA,p);var S=u(m,A.normalA);s.scale(m,A.normalA,S),r(A.contactPointB,f,i.position),r(A.contactPointA,f,m),r(A.contactPointA,A.contactPointA,t.position),this.contactEquations.push(A),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A))}}return this.enableFrictionReduction&&this.enableFriction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},n.prototype[y.PARTICLE|y.PLANE]=n.prototype.particlePlane=function(t,e,n,o,i,a,l,h,c){var d=_,f=b;h=h||0,r(d,n,l),s.rotate(f,v,h);var p=u(d,f);if(p>0)return 0;if(c)return!0;var m=this.createContactEquation(i,t,a,e);return s.copy(m.normalA,f),s.scale(d,m.normalA,p),r(m.contactPointA,n,d),r(m.contactPointA,m.contactPointA,i.position),r(m.contactPointB,n,t.position),this.contactEquations.push(m),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(m)),1},n.prototype[y.CIRCLE|y.PARTICLE]=n.prototype.circleParticle=function(t,e,n,o,i,u,l,h,c){var d=_;if(r(d,l,n),s.squaredLength(d)>Math.pow(e.radius,2))return 0;if(c)return!0;var f=this.createContactEquation(t,i,e,u);return s.copy(f.normalA,d),s.normalize(f.normalA,f.normalA),s.scale(f.contactPointA,f.normalA,e.radius),a(f.contactPointA,f.contactPointA,n),r(f.contactPointA,f.contactPointA,t.position),r(f.contactPointB,l,i.position),this.contactEquations.push(f),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(f)),1};var z=new p(1),W=s.create(),K=s.create();s.create(),n.prototype[y.PLANE|y.CAPSULE]=n.prototype.planeCapsule=function(t,e,n,o,i,r,u,l,h){var c=W,d=K,f=z;s.set(c,-r.length/2,0),s.rotate(c,c,l),a(c,c,u),s.set(d,r.length/2,0),s.rotate(d,d,l),a(d,d,u),f.radius=r.radius;var p;this.enableFrictionReduction&&(p=this.enableFriction,this.enableFriction=!1);var m=this.circlePlane(i,f,c,0,t,e,n,o,h),y=this.circlePlane(i,f,d,0,t,e,n,o,h);if(this.enableFrictionReduction&&(this.enableFriction=p),h)return m||y;var g=m+y;return this.enableFrictionReduction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g},n.prototype[y.CIRCLE|y.PLANE]=n.prototype.circlePlane=function(t,e,n,o,i,l,h,c,d){var f=t,p=e,m=n,y=i,g=h,E=c;E=E||0;var A=_,S=b,x=w;r(A,m,g),s.rotate(S,v,E);var T=u(S,A);if(T>p.radius)return 0;if(d)return!0;var B=this.createContactEquation(y,f,l,e);return s.copy(B.normalA,S),s.scale(B.contactPointB,B.normalA,-p.radius),a(B.contactPointB,B.contactPointB,m),r(B.contactPointB,B.contactPointB,f.position),s.scale(x,B.normalA,T),r(B.contactPointA,A,x),a(B.contactPointA,B.contactPointA,g),r(B.contactPointA,B.contactPointA,y.position),this.contactEquations.push(B),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(B)),1},n.prototype[y.CONVEX]=n.prototype[y.CONVEX|y.RECTANGLE]=n.prototype[y.RECTANGLE]=n.prototype.convexConvex=function(t,e,o,i,l,h,c,d,f,p){var m=_,y=b,g=w,v=E,S=A,C=x,L=T,M=B,P=0,p="number"==typeof p?p:0,I=n.findSeparatingAxis(e,o,i,h,c,d,m);if(!I)return 0;r(L,c,o),u(m,L)>0&&s.scale(m,m,-1);var R=n.getClosestEdge(e,i,m,!0),O=n.getClosestEdge(h,d,m);if(-1===R||-1===O)return 0;for(var q=0;2>q;q++){var j=R,U=O,F=e,k=h,N=o,D=c,V=i,G=d,X=t,Y=l;if(0===q){var H;H=j,j=U,U=H,H=F,F=k,k=H,H=N,N=D,D=H,H=V,V=G,G=H,H=X,X=Y,Y=H}for(var z=U;U+2>z;z++){var W=k.vertices[(z+k.vertices.length)%k.vertices.length];s.rotate(y,W,G),a(y,y,D);for(var K=0,$=j-1;j+2>$;$++){var J=F.vertices[($+F.vertices.length)%F.vertices.length],Q=F.vertices[($+1+F.vertices.length)%F.vertices.length];s.rotate(g,J,V),s.rotate(v,Q,V),a(g,g,N),a(v,v,N),r(S,v,g),s.rotate90cw(M,S),s.normalize(M,M),r(L,y,g);var Z=u(M,L);($===j&&p>=Z||$!==j&&0>=Z)&&K++}if(K>=3){if(f)return!0;var te=this.createContactEquation(X,Y,F,k);P++;var J=F.vertices[j%F.vertices.length],Q=F.vertices[(j+1)%F.vertices.length];s.rotate(g,J,V),s.rotate(v,Q,V),a(g,g,N),a(v,v,N),r(S,v,g),s.rotate90cw(te.normalA,S),s.normalize(te.normalA,te.normalA),r(L,y,g);var Z=u(te.normalA,L);s.scale(C,te.normalA,Z),r(te.contactPointA,y,N),r(te.contactPointA,te.contactPointA,C),a(te.contactPointA,te.contactPointA,N),r(te.contactPointA,te.contactPointA,X.position),r(te.contactPointB,y,D),a(te.contactPointB,te.contactPointB,D),r(te.contactPointB,te.contactPointB,Y.position),this.contactEquations.push(te),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(te))}}}return this.enableFrictionReduction&&this.enableFriction&&P&&this.frictionEquations.push(this.createFrictionFromAverage(P)),P};var $=s.fromValues(0,0);n.projectConvexOntoAxis=function(t,e,n,o,i){var r,a,l=null,h=null,c=$;s.rotate(c,o,-n);for(var d=0;d<t.vertices.length;d++)r=t.vertices[d],a=u(r,c),(null===l||a>l)&&(l=a),(null===h||h>a)&&(h=a);if(h>l){var f=h;h=l,l=f}var p=u(e,o);s.set(i,h+p,l+p)};var J=s.fromValues(0,0),Q=s.fromValues(0,0),Z=s.fromValues(0,0),te=s.fromValues(0,0),ee=s.fromValues(0,0),ne=s.fromValues(0,0);n.findSeparatingAxis=function(t,e,o,i,a,u,l){var h=null,c=!1,d=!1,f=J,p=Q,m=Z,y=te,v=ee,_=ne;if(t instanceof g&&i instanceof g)for(var b=0;2!==b;b++){var w=t,E=o;1===b&&(w=i,E=u);for(var A=0;2!==A;A++){0===A?s.set(y,0,1):1===A&&s.set(y,1,0),0!==E&&s.rotate(y,y,E),n.projectConvexOntoAxis(t,e,o,y,v),n.projectConvexOntoAxis(i,a,u,y,_);
var S=v,x=_,T=!1;v[0]>_[0]&&(x=v,S=_,T=!0);var B=x[0]-S[1];c=0>=B,(null===h||B>h)&&(s.copy(l,y),h=B,d=c)}}else for(var b=0;2!==b;b++){var w=t,E=o;1===b&&(w=i,E=u);for(var A=0;A!==w.vertices.length;A++){s.rotate(p,w.vertices[A],E),s.rotate(m,w.vertices[(A+1)%w.vertices.length],E),r(f,m,p),s.rotate90cw(y,f),s.normalize(y,y),n.projectConvexOntoAxis(t,e,o,y,v),n.projectConvexOntoAxis(i,a,u,y,_);var S=v,x=_,T=!1;v[0]>_[0]&&(x=v,S=_,T=!0);var B=x[0]-S[1];c=0>=B,(null===h||B>h)&&(s.copy(l,y),h=B,d=c)}}return d};var oe=s.fromValues(0,0),ie=s.fromValues(0,0),se=s.fromValues(0,0);n.getClosestEdge=function(t,e,n,o){var i=oe,a=ie,l=se;s.rotate(i,n,-e),o&&s.scale(i,i,-1);for(var h=-1,c=t.vertices.length,d=-1,f=0;f!==c;f++){r(a,t.vertices[(f+1)%c],t.vertices[f%c]),s.rotate90cw(l,a),s.normalize(l,l);var p=u(l,i);(-1===h||p>d)&&(h=f%c,d=p)}return h};var re=s.create(),ae=s.create(),ue=s.create(),le=s.create(),he=s.create(),ce=s.create(),de=s.create();n.prototype[y.CIRCLE|y.HEIGHTFIELD]=n.prototype.circleHeightfield=function(t,e,n,o,i,u,l,h,c,d){var f=u.data,d=d||e.radius,p=u.elementWidth,m=ae,y=re,g=he,v=de,_=ce,b=ue,w=le,E=Math.floor((n[0]-d-l[0])/p),A=Math.ceil((n[0]+d-l[0])/p);0>E&&(E=0),A>=f.length&&(A=f.length-1);for(var S=f[E],x=f[A],T=E;A>T;T++)f[T]<x&&(x=f[T]),f[T]>S&&(S=f[T]);if(n[1]-d>S)return c?!1:0;n[1]+d<x;for(var B=!1,T=E;A>T;T++){s.set(b,T*p,f[T]),s.set(w,(T+1)*p,f[T+1]),s.add(b,b,l),s.add(w,w,l),s.sub(_,w,b),s.rotate(_,_,Math.PI/2),s.normalize(_,_),s.scale(y,_,-d),s.add(y,y,n),s.sub(m,y,b);var C=s.dot(m,_);if(y[0]>=b[0]&&y[0]<w[0]&&0>=C){if(c)return!0;B=!0,s.scale(m,_,-C),s.add(g,y,m),s.copy(v,_);var L=this.createContactEquation(i,t,u,e);s.copy(L.normalA,v),s.scale(L.contactPointB,L.normalA,-d),a(L.contactPointB,L.contactPointB,n),r(L.contactPointB,L.contactPointB,t.position),s.copy(L.contactPointA,g),s.sub(L.contactPointA,L.contactPointA,i.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L))}}if(B=!1,d>0)for(var T=E;A>=T;T++)if(s.set(b,T*p,f[T]),s.add(b,b,l),s.sub(m,n,b),s.squaredLength(m)<Math.pow(d,2)){if(c)return!0;B=!0;var L=this.createContactEquation(i,t,u,e);s.copy(L.normalA,m),s.normalize(L.normalA,L.normalA),s.scale(L.contactPointB,L.normalA,-d),a(L.contactPointB,L.contactPointB,n),r(L.contactPointB,L.contactPointB,t.position),r(L.contactPointA,b,l),a(L.contactPointA,L.contactPointA,l),r(L.contactPointA,L.contactPointA,i.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L))}return B?1:0};var fe=s.create(),pe=s.create(),me=s.create(),ye=new m([s.create(),s.create(),s.create(),s.create()]);n.prototype[y.RECTANGLE|y.HEIGHTFIELD]=n.prototype[y.CONVEX|y.HEIGHTFIELD]=n.prototype.convexHeightfield=function(t,e,n,o,i,r,a,u,l){var h=r.data,c=r.elementWidth,d=fe,f=pe,p=me,m=ye,y=Math.floor((t.aabb.lowerBound[0]-a[0])/c),g=Math.ceil((t.aabb.upperBound[0]-a[0])/c);0>y&&(y=0),g>=h.length&&(g=h.length-1);for(var v=h[y],_=h[g],b=y;g>b;b++)h[b]<_&&(_=h[b]),h[b]>v&&(v=h[b]);if(t.aabb.lowerBound[1]>v)return l?!1:0;for(var w=0,b=y;g>b;b++){s.set(d,b*c,h[b]),s.set(f,(b+1)*c,h[b+1]),s.add(d,d,a),s.add(f,f,a);var E=100;s.set(p,.5*(f[0]+d[0]),.5*(f[1]+d[1]-E)),s.sub(m.vertices[0],f,p),s.sub(m.vertices[1],d,p),s.copy(m.vertices[2],m.vertices[1]),s.copy(m.vertices[3],m.vertices[0]),m.vertices[2][1]-=E,m.vertices[3][1]-=E,w+=this.convexConvex(t,e,n,o,i,m,p,0,l)}return w}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/Narrowphase.js","/collision")},{"../equations/ContactEquation":24,"../equations/Equation":25,"../equations/FrictionEquation":26,"../math/vec2":33,"../objects/Body":34,"../shapes/Circle":40,"../shapes/Convex":41,"../shapes/Rectangle":46,"../shapes/Shape":47,"../utils/TupleDictionary":51,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],16:[function(t,e){(function(){function n(){i.call(this,i.SAP),this.axisList=[],this.world=null,this.axisIndex=0;var t=this.axisList;this._addBodyHandler=function(e){t.push(e.body)},this._removeBodyHandler=function(e){var n=t.indexOf(e.body);-1!==n&&t.splice(n,1)}}var o=t("../utils/Utils"),i=t("../collision/Broadphase");e.exports=n,n.prototype=new i,n.prototype.setWorld=function(t){this.axisList.length=0,o.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},n.sortAxisList=function(t,e){e=0|e;for(var n=1,o=t.length;o>n;n++){for(var i=t[n],s=n-1;s>=0&&!(t[s].aabb.lowerBound[e]<=i.aabb.lowerBound[e]);s--)t[s+1]=t[s];t[s+1]=i}return t},n.prototype.getCollisionPairs=function(){var t=this.axisList,e=this.result,o=this.axisIndex;e.length=0;for(var s=t.length;s--;){var r=t[s];r.aabbNeedsUpdate&&r.updateAABB()}n.sortAxisList(t,o);for(var a=0,u=0|t.length;a!==u;a++)for(var l=t[a],h=a+1;u>h;h++){var c=t[h],d=c.aabb.lowerBound[o]<=l.aabb.upperBound[o];if(!d)break;i.canCollide(l,c)&&this.boundingVolumeCheck(l,c)&&e.push(l,c)}return e}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/collision/SAPBroadphase.js","/collision")},{"../collision/Broadphase":12,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],17:[function(t,e){(function(){function n(t,e,n,i){this.type=n,i=o.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=n;var o=t("../utils/Utils");n.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},n.DISTANCE=1,n.GEAR=2,n.LOCK=3,n.PRISMATIC=4,n.REVOLUTE=5,n.prototype.setStiffness=function(t){for(var e=this.equations,n=0;n!==e.length;n++){var o=e[n];o.stiffness=t,o.needsUpdate=!0}},n.prototype.setRelaxation=function(t){for(var e=this.equations,n=0;n!==e.length;n++){var o=e[n];o.relaxation=t,o.needsUpdate=!0}}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/Constraint.js","/constraints")},{"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],18:[function(t,e){(function(){function n(t,e,n){n=r.defaults(n,{localAnchorA:[0,0],localAnchorB:[0,0]}),o.call(this,t,e,o.DISTANCE,n),this.localAnchorA=s.fromValues(n.localAnchorA[0],n.localAnchorA[1]),this.localAnchorB=s.fromValues(n.localAnchorB[0],n.localAnchorB[1]);var a=this.localAnchorA,u=this.localAnchorB;if(this.distance=0,"number"==typeof n.distance)this.distance=n.distance;else{var l=s.create(),h=s.create(),c=s.create();s.rotate(l,a,t.angle),s.rotate(h,u,e.angle),s.add(c,e.position,h),s.sub(c,c,l),s.sub(c,c,t.position),this.distance=s.length(c)}var d;d="undefined"==typeof n.maxForce?Number.MAX_VALUE:n.maxForce;var f=new i(t,e,-d,d);this.equations=[f],this.maxForce=d;var c=s.create(),p=s.create(),m=s.create(),y=this;f.computeGq=function(){var t=this.bodyA,e=this.bodyB,n=t.position,o=e.position;return s.rotate(p,a,t.angle),s.rotate(m,u,e.angle),s.add(c,o,m),s.sub(c,c,p),s.sub(c,c,n),s.length(c)-y.distance},this.setMaxForce(d),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var o=t("./Constraint"),i=t("../equations/Equation"),s=t("../math/vec2"),r=t("../utils/Utils");e.exports=n,n.prototype=new o;var a=s.create(),u=s.create(),l=s.create();n.prototype.update=function(){var t=this.equations[0],e=this.bodyA,n=this.bodyB,o=(this.distance,e.position),i=n.position,r=this.equations[0],h=t.G;s.rotate(u,this.localAnchorA,e.angle),s.rotate(l,this.localAnchorB,n.angle),s.add(a,i,l),s.sub(a,a,u),s.sub(a,a,o),this.position=s.length(a);var c=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(r.maxForce=0,r.minForce=-this.maxForce,this.distance=this.upperLimit,c=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(r.maxForce=this.maxForce,r.minForce=0,this.distance=this.lowerLimit,c=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!c)return void(r.enabled=!1);r.enabled=!0,s.normalize(a,a);var d=s.crossLength(u,a),f=s.crossLength(l,a);h[0]=-a[0],h[1]=-a[1],h[2]=-d,h[3]=a[0],h[4]=a[1],h[5]=f},n.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},n.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/DistanceConstraint.js","/constraints")},{"../equations/Equation":25,"../math/vec2":33,"../utils/Utils":52,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],19:[function(t,e){(function(){function n(t,e,n){n=n||{},o.call(this,t,e,o.GEAR,n),this.ratio="number"==typeof n.ratio?n.ratio:1,this.angle="number"==typeof n.angle?n.angle:e.angle-this.ratio*t.angle,n.angle=this.angle,n.ratio=this.ratio,this.equations=[new i(t,e,n)],"number"==typeof n.maxTorque&&this.setMaxTorque(n.maxTorque)}var o=t("./Constraint"),i=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2"),e.exports=n,n.prototype=new o,n.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},n.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},n.prototype.getMaxTorque=function(){return this.equations[0].maxForce}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/GearConstraint.js","/constraints")},{"../equations/AngleLockEquation":23,"../equations/Equation":25,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],20:[function(t,e){(function(){function n(t,e,n){n=n||{},o.call(this,t,e,o.LOCK,n);var r="undefined"==typeof n.maxForce?Number.MAX_VALUE:n.maxForce,a=(n.localAngleB||0,new s(t,e,-r,r)),u=new s(t,e,-r,r),l=new s(t,e,-r,r),h=i.create(),c=i.create(),d=this;a.computeGq=function(){return i.rotate(h,d.localOffsetB,t.angle),i.sub(c,e.position,t.position),i.sub(c,c,h),c[0]},u.computeGq=function(){return i.rotate(h,d.localOffsetB,t.angle),i.sub(c,e.position,t.position),i.sub(c,c,h),c[1]};var f=i.create(),p=i.create();l.computeGq=function(){return i.rotate(f,d.localOffsetB,e.angle-d.localAngleB),i.scale(f,f,-1),i.sub(c,t.position,e.position),i.add(c,c,f),i.rotate(p,f,-Math.PI/2),i.normalize(p,p),i.dot(c,p)},this.localOffsetB=i.create(),n.localOffsetB?i.copy(this.localOffsetB,n.localOffsetB):(i.sub(this.localOffsetB,e.position,t.position),i.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,this.localAngleB="number"==typeof n.localAngleB?n.localAngleB:e.angle-t.angle,this.equations.push(a,u,l),this.setMaxForce(r)}var o=t("./Constraint"),i=t("../math/vec2"),s=t("../equations/Equation");e.exports=n,n.prototype=new o,n.prototype.setMaxForce=function(t){for(var e=this.equations,n=0;n<this.equations.length;n++)e[n].maxForce=t,e[n].minForce=-t},n.prototype.getMaxForce=function(){return this.equations[0].maxForce};var r=i.create(),a=i.create(),u=i.create(),l=i.fromValues(1,0),h=i.fromValues(0,1);n.prototype.update=function(){var t=this.equations[0],e=this.equations[1],n=this.equations[2],o=this.bodyA,s=this.bodyB;i.rotate(r,this.localOffsetB,o.angle),i.rotate(a,this.localOffsetB,s.angle-this.localAngleB),i.scale(a,a,-1),i.rotate(u,a,Math.PI/2),i.normalize(u,u),t.G[0]=-1,t.G[1]=0,t.G[2]=-i.crossLength(r,l),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-i.crossLength(r,h),e.G[4]=1,n.G[0]=-u[0],n.G[1]=-u[1],n.G[3]=u[0],n.G[4]=u[1],n.G[5]=i.crossLength(a,u)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/LockConstraint.js","/constraints")},{"../equations/Equation":25,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],21:[function(t,e){(function(){function n(t,e,n){n=n||{},o.call(this,t,e,o.PRISMATIC,n);var u=r.fromValues(0,0),l=r.fromValues(1,0),h=r.fromValues(0,0);n.localAnchorA&&r.copy(u,n.localAnchorA),n.localAxisA&&r.copy(l,n.localAxisA),n.localAnchorB&&r.copy(h,n.localAnchorB),this.localAnchorA=u,this.localAnchorB=h,this.localAxisA=l;var c=this.maxForce="undefined"!=typeof n.maxForce?n.maxForce:Number.MAX_VALUE,d=new s(t,e,-c,c),f=new r.create,p=new r.create,m=new r.create,y=new r.create;if(d.computeGq=function(){return r.dot(m,y)},d.updateJacobian=function(){var n=this.G,o=t.position,i=e.position;r.rotate(f,u,t.angle),r.rotate(p,h,e.angle),r.add(m,i,p),r.sub(m,m,o),r.sub(m,m,f),r.rotate(y,l,t.angle+Math.PI/2),n[0]=-y[0],n[1]=-y[1],n[2]=-r.crossLength(f,y)+r.crossLength(y,m),n[3]=y[0],n[4]=y[1],n[5]=r.crossLength(p,y)},this.equations.push(d),!n.disableRotationalLock){var g=new a(t,e,-c,c);this.equations.push(g)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof n.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof n.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof n.lowerLimit?n.lowerLimit:0,this.upperLimit="undefined"!=typeof n.upperLimit?n.upperLimit:1,this.upperLimitEquation=new i(t,e),this.lowerLimitEquation=new i(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=c,this.motorEquation=new s(t,e),this.motorEnabled=!1,this.motorSpeed=0;var v=this,_=this.motorEquation;_.computeGW,_.computeGq=function(){return 0},_.computeGW=function(){var t=this.G,e=this.bodyA,n=this.bodyB,o=e.velocity,i=n.velocity,s=e.angularVelocity,r=n.angularVelocity;return this.gmult(t,o,s,i,r)+v.motorSpeed}}var o=t("./Constraint"),i=t("../equations/ContactEquation"),s=t("../equations/Equation"),r=t("../math/vec2"),a=t("../equations/RotationalLockEquation");e.exports=n,n.prototype=new o;var u=r.create(),l=r.create(),h=r.create(),c=r.create(),d=r.create(),f=r.create();n.prototype.update=function(){var t=this.equations,e=t[0],n=this.upperLimit,o=this.lowerLimit,i=this.upperLimitEquation,s=this.lowerLimitEquation,a=this.bodyA,p=this.bodyB,m=this.localAxisA,y=this.localAnchorA,g=this.localAnchorB;e.updateJacobian(),r.rotate(u,m,a.angle),r.rotate(c,y,a.angle),r.add(l,c,a.position),r.rotate(d,g,p.angle),r.add(h,d,p.position);var v=this.position=r.dot(h,u)-r.dot(l,u);if(this.motorEnabled){var _=this.motorEquation.G;_[0]=u[0],_[1]=u[1],_[2]=r.crossLength(u,d),_[3]=-u[0],_[4]=-u[1],_[5]=-r.crossLength(u,c)}if(this.upperLimitEnabled&&v>n)r.scale(i.normalA,u,-1),r.sub(i.contactPointA,l,a.position),r.sub(i.contactPointB,h,p.position),r.scale(f,u,n),r.add(i.contactPointA,i.contactPointA,f),-1===t.indexOf(i)&&t.push(i);else{var b=t.indexOf(i);-1!==b&&t.splice(b,1)}if(this.lowerLimitEnabled&&o>v)r.scale(s.normalA,u,1),r.sub(s.contactPointA,l,a.position),r.sub(s.contactPointB,h,p.position),r.scale(f,u,o),r.sub(s.contactPointB,s.contactPointB,f),-1===t.indexOf(s)&&t.push(s);else{var b=t.indexOf(s);-1!==b&&t.splice(b,1)}},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},n.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/PrismaticConstraint.js","/constraints")},{"../equations/ContactEquation":24,"../equations/Equation":25,"../equations/RotationalLockEquation":27,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],22:[function(t,e){(function(){function n(t,e,n){n=n||{},o.call(this,t,e,o.REVOLUTE,n);var f=this.maxForce="undefined"!=typeof n.maxForce?n.maxForce:Number.MAX_VALUE;this.pivotA=a.create(),this.pivotB=a.create(),n.worldPivot?(a.sub(this.pivotA,n.worldPivot,t.position),a.sub(this.pivotB,n.worldPivot,e.position),a.rotate(this.pivotA,this.pivotA,-t.angle),a.rotate(this.pivotB,this.pivotB,-e.angle)):(a.copy(this.pivotA,n.localPivotA),a.copy(this.pivotB,n.localPivotB));var p=this.equations=[new i(t,e,-f,f),new i(t,e,-f,f)],m=p[0],y=p[1],g=this;m.computeGq=function(){return a.rotate(u,g.pivotA,t.angle),a.rotate(l,g.pivotB,e.angle),a.add(d,e.position,l),a.sub(d,d,t.position),a.sub(d,d,u),a.dot(d,h)},y.computeGq=function(){return a.rotate(u,g.pivotA,t.angle),a.rotate(l,g.pivotB,e.angle),a.add(d,e.position,l),a.sub(d,d,t.position),a.sub(d,d,u),a.dot(d,c)},y.minForce=m.minForce=-f,y.maxForce=m.maxForce=f,this.motorEquation=new s(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new r(t,e),this.lowerLimitEquation=new r(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var o=t("./Constraint"),i=t("../equations/Equation"),s=t("../equations/RotationalVelocityEquation"),r=t("../equations/RotationalLockEquation"),a=t("../math/vec2");e.exports=n;var u=a.create(),l=a.create(),h=a.fromValues(1,0),c=a.fromValues(0,1),d=a.create();n.prototype=new o,n.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},n.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.pivotA,o=this.pivotB,i=this.equations,s=(i[0],i[1],i[0]),r=i[1],d=this.upperLimit,f=this.lowerLimit,p=this.upperLimitEquation,m=this.lowerLimitEquation,y=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&y>d)p.angle=d,-1===i.indexOf(p)&&i.push(p);else{var g=i.indexOf(p);-1!==g&&i.splice(g,1)}if(this.lowerLimitEnabled&&f>y)m.angle=f,-1===i.indexOf(m)&&i.push(m);else{var g=i.indexOf(m);-1!==g&&i.splice(g,1)}a.rotate(u,n,t.angle),a.rotate(l,o,e.angle),s.G[0]=-1,s.G[1]=0,s.G[2]=-a.crossLength(u,h),s.G[3]=1,s.G[4]=0,s.G[5]=a.crossLength(l,h),r.G[0]=0,r.G[1]=-1,r.G[2]=-a.crossLength(u,c),r.G[3]=0,r.G[4]=1,r.G[5]=a.crossLength(l,c)},n.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},n.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},n.prototype.motorIsEnabled=function(){return!!this.motorEnabled},n.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},n.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/constraints/RevoluteConstraint.js","/constraints")},{"../equations/Equation":25,"../equations/RotationalLockEquation":27,"../equations/RotationalVelocityEquation":28,"../math/vec2":33,"./Constraint":17,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],23:[function(t,e){(function(){function n(t,e,n){n=n||{},o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0,this.ratio="number"==typeof n.ratio?n.ratio:1,this.setRatio(this.ratio)}var o=t("./Equation");t("../math/vec2"),e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},n.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},n.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/AngleLockEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],24:[function(t,e){(function(){function n(t,e){o.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=i.create(),this.penetrationVec=i.create(),this.contactPointB=i.create(),this.normalA=i.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var o=t("./Equation"),i=t("../math/vec2");e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.computeB=function(t,e,n){var o=this.bodyA,s=this.bodyB,r=this.contactPointA,a=this.contactPointB,u=o.position,l=s.position,h=this.penetrationVec,c=this.normalA,d=this.G,f=i.crossLength(r,c),p=i.crossLength(a,c);d[0]=-c[0],d[1]=-c[1],d[2]=-f,d[3]=c[0],d[4]=c[1],d[5]=p,i.add(h,l,a),i.sub(h,h,u),i.sub(h,h,r);var m,y;this.firstImpact&&0!==this.restitution?(y=0,m=1/e*(1+this.restitution)*this.computeGW()):(y=i.dot(c,h)+this.offset,m=this.computeGW());var g=this.computeGiMf(),v=-y*t-m*e-n*g;return v}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/ContactEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],25:[function(t,e){(function(){function n(t,e,o,s){this.minForce="undefined"==typeof o?-Number.MAX_VALUE:o,this.maxForce="undefined"==typeof s?Number.MAX_VALUE:s,this.bodyA=t,this.bodyB=e,this.stiffness=n.DEFAULT_STIFFNESS,this.relaxation=n.DEFAULT_RELAXATION,this.G=new i.ARRAY_TYPE(6);for(var r=0;6>r;r++)this.G[r]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=n;var o=t("../math/vec2"),i=t("../utils/Utils");t("../objects/Body"),n.prototype.constructor=n,n.DEFAULT_STIFFNESS=1e6,n.DEFAULT_RELAXATION=4,n.prototype.update=function(){var t=this.stiffness,e=this.relaxation,n=this.timeStep;this.a=4/(n*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(n*n*t*(1+4*e)),this.needsUpdate=!1},n.prototype.gmult=function(t,e,n,o,i){return t[0]*e[0]+t[1]*e[1]+t[2]*n+t[3]*o[0]+t[4]*o[1]+t[5]*i},n.prototype.computeB=function(t,e,n){var o=this.computeGW(),i=this.computeGq(),s=this.computeGiMf();return-i*t-o*e-s*n};var s=o.create(),r=o.create();n.prototype.computeGq=function(){var t=this.G,e=this.bodyA,n=this.bodyB,o=(e.position,n.position,e.angle),i=n.angle;return this.gmult(t,s,o,r,i)+this.offset},n.prototype.computeGW=function(){var t=this.G,e=this.bodyA,n=this.bodyB,o=e.velocity,i=n.velocity,s=e.angularVelocity,r=n.angularVelocity;return this.gmult(t,o,s,i,r)+this.relativeVelocity},n.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,n=this.bodyB,o=e.vlambda,i=n.vlambda,s=e.wlambda,r=n.wlambda;return this.gmult(t,o,s,i,r)};var a=o.create(),u=o.create();n.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,n=t.force,i=t.angularForce,s=e.force,r=e.angularForce,l=t.invMassSolve,h=e.invMassSolve,c=t.invInertiaSolve,d=e.invInertiaSolve,f=this.G;return o.scale(a,n,l),o.scale(u,s,h),this.gmult(f,a,i*c,u,r*d)},n.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,n=t.invMassSolve,o=e.invMassSolve,i=t.invInertiaSolve,s=e.invInertiaSolve,r=this.G;return r[0]*r[0]*n+r[1]*r[1]*n+r[2]*r[2]*i+r[3]*r[3]*o+r[4]*r[4]*o+r[5]*r[5]*s};var l=o.create(),h=o.create(),c=o.create();o.create(),o.create(),o.create(),n.prototype.addToWlambda=function(t){var e=this.bodyA,n=this.bodyB,i=l,s=h,r=c,a=e.invMassSolve,u=n.invMassSolve,d=e.invInertiaSolve,f=n.invInertiaSolve,p=this.G;s[0]=p[0],s[1]=p[1],r[0]=p[3],r[1]=p[4],o.scale(i,s,a*t),o.add(e.vlambda,e.vlambda,i),e.wlambda+=d*p[2]*t,o.scale(i,r,u*t),o.add(n.vlambda,n.vlambda,i),n.wlambda+=f*p[5]*t},n.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/Equation.js","/equations")},{"../math/vec2":33,"../objects/Body":34,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],26:[function(t,e){(function(){function n(t,e,n){i.call(this,t,e,-n,n),this.contactPointA=o.create(),this.contactPointB=o.create(),this.t=o.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var o=t("../math/vec2"),i=t("./Equation");t("../utils/Utils"),e.exports=n,n.prototype=new i,n.prototype.constructor=n,n.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},n.prototype.getSlipForce=function(){return this.maxForce},n.prototype.computeB=function(t,e,n){var i=(this.bodyA,this.bodyB,this.contactPointA),s=this.contactPointB,r=this.t,a=this.G;a[0]=-r[0],a[1]=-r[1],a[2]=-o.crossLength(i,r),a[3]=r[0],a[4]=r[1],a[5]=o.crossLength(s,r);var u=this.computeGW(),l=this.computeGiMf(),h=-u*e-n*l;return h}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/FrictionEquation.js","/equations")},{"../math/vec2":33,"../utils/Utils":52,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],27:[function(t,e){(function(){function n(t,e,n){n=n||{},o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0;var i=this.G;i[2]=1,i[5]=-1}var o=t("./Equation"),i=t("../math/vec2");e.exports=n,n.prototype=new o,n.prototype.constructor=n;var s=i.create(),r=i.create(),a=i.fromValues(1,0),u=i.fromValues(0,1);n.prototype.computeGq=function(){return i.rotate(s,a,this.bodyA.angle+this.angle),i.rotate(r,u,this.bodyB.angle),i.dot(s,r)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/RotationalLockEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],28:[function(t,e){(function(){function n(t,e){o.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var o=t("./Equation");t("../math/vec2"),e.exports=n,n.prototype=new o,n.prototype.constructor=n,n.prototype.computeB=function(t,e,n){var o=this.G;o[2]=-1,o[5]=this.ratio;var i=this.computeGiMf(),s=this.computeGW(),r=-s*e-n*i;return r}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/equations/RotationalVelocityEquation.js","/equations")},{"../math/vec2":33,"./Equation":25,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],29:[function(t,e){(function(){var t=function(){};e.exports=t,t.prototype={constructor:t,on:function(t,e,n){e.context=n||this,void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[t]&&(o[t]=[]),-1===o[t].indexOf(e)&&o[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;if(e){if(void 0!==n[t]&&-1!==n[t].indexOf(e))return!0}else if(void 0!==n[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var n=this._listeners,o=n[t].indexOf(e);return-1!==o&&n[t].splice(o,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,n=e[t.type];if(void 0!==n){t.target=this;for(var o=0,i=n.length;i>o;o++){var s=n[o];s.call(s.context,t)}}return this}}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/events/EventEmitter.js","/events")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],30:[function(t,e){(function(){function n(t,e,s){if(s=s||{},!(t instanceof o&&e instanceof o))throw new Error("First two arguments must be Material instances.");
this.id=n.idCounter++,this.materialA=t,this.materialB=e,this.friction="undefined"!=typeof s.friction?Number(s.friction):.3,this.restitution="undefined"!=typeof s.restitution?Number(s.restitution):0,this.stiffness="undefined"!=typeof s.stiffness?Number(s.stiffness):i.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof s.relaxation?Number(s.relaxation):i.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof s.frictionStiffness?Number(s.frictionStiffness):i.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof s.frictionRelaxation?Number(s.frictionRelaxation):i.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof s.surfaceVelocity?Number(s.surfaceVelocity):0,this.contactSkinSize=.005}var o=t("./Material"),i=t("../equations/Equation");e.exports=n,n.idCounter=0}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/material/ContactMaterial.js","/material")},{"../equations/Equation":25,"./Material":31,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],31:[function(t,e){(function(){function t(e){this.id=e||t.idCounter++}e.exports=t,t.idCounter=0}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/material/Material.js","/material")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],32:[function(t,e){(function(){var t={};t.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,n=0,o=0;e>o;o+=2)n+=(t[o+2]-t[o])*(t[o+1]+t[o+3]);return n+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-n},t.Triangulate=function(e){var n=e.length>>1;if(3>n)return[];for(var o=[],i=[],s=0;n>s;s++)i.push(s);for(var s=0,r=n;r>3;){var a=i[(s+0)%r],u=i[(s+1)%r],l=i[(s+2)%r],h=e[2*a],c=e[2*a+1],d=e[2*u],f=e[2*u+1],p=e[2*l],m=e[2*l+1],y=!1;if(t._convex(h,c,d,f,p,m)){y=!0;for(var g=0;r>g;g++){var v=i[g];if(v!=a&&v!=u&&v!=l&&t._PointInTriangle(e[2*v],e[2*v+1],h,c,d,f,p,m)){y=!1;break}}}if(y)o.push(a,u,l),i.splice((s+1)%r,1),r--,s=0;else if(s++>3*r)break}return o.push(i[0],i[1],i[2]),o},t._PointInTriangle=function(t,e,n,o,i,s,r,a){var u=r-n,l=a-o,h=i-n,c=s-o,d=t-n,f=e-o,p=u*u+l*l,m=u*h+l*c,y=u*d+l*f,g=h*h+c*c,v=h*d+c*f,_=1/(p*g-m*m),b=(g*y-m*v)*_,w=(p*v-m*y)*_;return b>=0&&w>=0&&1>b+w},t._convex=function(t,e,n,o,i,s){return(e-o)*(i-n)+(n-t)*(s-o)>=0},e.exports=t}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/math/polyk.js","/math")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],33:[function(t,e){(function(){var n=e.exports={},o=t("../utils/Utils");n.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},n.crossVZ=function(t,e,o){return n.rotate(t,e,-Math.PI/2),n.scale(t,t,o),t},n.crossZV=function(t,e,o){return n.rotate(t,o,Math.PI/2),n.scale(t,t,e),t},n.rotate=function(t,e,n){if(0!==n){var o=Math.cos(n),i=Math.sin(n),s=e[0],r=e[1];t[0]=o*s-i*r,t[1]=i*s+o*r}else t[0]=e[0],t[1]=e[1]},n.rotate90cw=function(t,e){var n=e[0],o=e[1];t[0]=o,t[1]=-n},n.toLocalFrame=function(t,e,o,i){n.copy(t,e),n.sub(t,t,o),n.rotate(t,t,-i)},n.toGlobalFrame=function(t,e,o,i){n.copy(t,e),n.rotate(t,t,i),n.add(t,t,o)},n.centroid=function(t,e,o,i){return n.add(t,e,o),n.add(t,t,i),n.scale(t,t,1/3),t},n.create=function(){var t=new o.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},n.clone=function(t){var e=new o.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},n.fromValues=function(t,e){var n=new o.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},n.set=function(t,e,n){return t[0]=e,t[1]=n,t},n.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},n.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},n.sub=n.subtract,n.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},n.mul=n.multiply,n.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},n.div=n.divide,n.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},n.distance=function(t,e){var n=e[0]-t[0],o=e[1]-t[1];return Math.sqrt(n*n+o*o)},n.dist=n.distance,n.squaredDistance=function(t,e){var n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},n.len=n.length,n.squaredLength=function(t){var e=t[0],n=t[1];return e*e+n*n},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},n.normalize=function(t,e){var n=e[0],o=e[1],i=n*n+o*o;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},n.str=function(t){return"vec2("+t[0]+", "+t[1]+")"}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/math/vec2.js","/math")},{"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],34:[function(t,e){(function(){function n(t){t=t||{},a.call(this),this.id=++n._idCounter,this.world=null,this.shapes=[],this.shapeOffsets=[],this.shapeAngles=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation||!1,this.position=o.fromValues(0,0),t.position&&o.copy(this.position,t.position),this.interpolatedPosition=o.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=o.fromValues(0,0),this.previousAngle=0,this.velocity=o.fromValues(0,0),t.velocity&&o.copy(this.velocity,t.velocity),this.vlambda=o.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=o.create(),t.force&&o.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=n.STATIC,this.type="undefined"!=typeof t.type?t.type:t.mass?n.DYNAMIC:n.STATIC,this.boundingRadius=0,this.aabb=new r,this.aabbNeedsUpdate=!0,this.allowSleep=!0,this.wantsToSleep=!1,this.sleepState=n.AWAKE,this.sleepSpeedLimit=.2,this.sleepTimeLimit=1,this.gravityScale=1,this.timeLastSleepy=0,this.concavePath=null,this.lastDampingScale=1,this.lastAngularDampingScale=1,this.lastDampingTimeStep=-1,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var o=t("../math/vec2"),i=t("poly-decomp"),s=t("../shapes/Convex"),r=t("../collision/AABB"),a=t("../events/EventEmitter");e.exports=n,n.prototype=new a,n._idCounter=0,n.prototype.updateSolveMassProperties=function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},n.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},n.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},n.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var u=new r,l=o.create();n.prototype.updateAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,n=this.shapeAngles,i=t.length,s=l,r=this.angle,a=0;a!==i;a++){var h=t[a],c=n[a]+r;o.rotate(s,e[a],r),o.add(s,s,this.position),h.computeAABB(u,s,c),0===a?this.aabb.copy(u):this.aabb.extend(u)}this.aabbNeedsUpdate=!1},n.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,n=t.length,i=0,s=0;s!==n;s++){var r=t[s],a=o.length(e[s]),u=r.boundingRadius;a+u>i&&(i=a+u)}this.boundingRadius=i},n.prototype.addShape=function(t,e,n){n=n||0,e=e?o.fromValues(e[0],e[1]):o.fromValues(0,0),this.shapes.push(t),this.shapeOffsets.push(e),this.shapeAngles.push(n),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},n.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e?(this.shapes.splice(e,1),this.shapeOffsets.splice(e,1),this.shapeAngles.splice(e,1),this.aabbNeedsUpdate=!0,!0):!1},n.prototype.updateMassProperties=function(){if(this.type===n.STATIC||this.type===n.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,s=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var r=0;e>r;r++){var a=t[r],u=o.squaredLength(this.shapeOffsets[r]),l=a.computeMomentOfInertia(i);s+=l+i*u}this.inertia=s,this.invInertia=s>0?1/s:0}this.invMass=1/this.mass}};var h=o.create();n.prototype.applyForce=function(t,e){var n=h;o.sub(n,e,this.position),o.add(this.force,this.force,t);var i=o.crossLength(n,t);this.angularForce+=i},n.prototype.toLocalFrame=function(t,e){o.toLocalFrame(t,e,this.position,this.angle)},n.prototype.toWorldFrame=function(t,e){o.toGlobalFrame(t,e,this.position,this.angle)},n.prototype.fromPolygon=function(t,e){e=e||{};for(var n=this.shapes.length;n>=0;--n)this.removeShape(this.shapes[n]);var r=new i.Polygon;if(r.vertices=t,r.makeCCW(),"number"==typeof e.removeCollinearPoints&&r.removeCollinearPoints(e.removeCollinearPoints),"undefined"==typeof e.skipSimpleCheck&&!r.isSimple())return!1;this.concavePath=r.vertices.slice(0);for(var n=0;n<this.concavePath.length;n++){var a=[0,0];o.copy(a,this.concavePath[n]),this.concavePath[n]=a}var u;u=e.optimalDecomp?r.decomp():r.quickDecomp();for(var l=o.create(),n=0;n!==u.length;n++){for(var h=new s(u[n].vertices),c=0;c!==h.vertices.length;c++){var a=h.vertices[c];o.sub(a,a,h.centerOfMass)}o.scale(l,h.centerOfMass,1),h.updateTriangles(),h.updateCenterOfMass(),h.updateBoundingRadius(),this.addShape(h,l)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var c=(o.fromValues(0,0),o.fromValues(0,0)),d=o.fromValues(0,0),f=o.fromValues(0,0);n.prototype.adjustCenterOfMass=function(){var t=c,e=d,n=f,i=0;o.set(e,0,0);for(var s=0;s!==this.shapes.length;s++){var r=this.shapes[s],a=this.shapeOffsets[s];o.scale(t,a,r.area),o.add(e,e,t),i+=r.area}o.scale(n,e,1/i);for(var s=0;s!==this.shapes.length;s++){var r=this.shapes[s],a=this.shapeOffsets[s];a||(a=this.shapeOffsets[s]=o.create()),o.sub(a,a,n)}o.add(this.position,this.position,n);for(var s=0;this.concavePath&&s<this.concavePath.length;s++)o.sub(this.concavePath[s],this.concavePath[s],n);this.updateMassProperties(),this.updateBoundingRadius()},n.prototype.setZeroForce=function(){o.set(this.force,0,0),this.angularForce=0},n.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;o.set(e,0,0),t.wlambda=0},n.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;o.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},n.prototype.applyDamping=function(t){if(this.type===n.DYNAMIC){t!==this.lastDampingTimeStep&&(this.lastDampingScale=Math.pow(1-this.damping,t),this.lastAngularDampingScale=Math.pow(1-this.angularDamping,t),this.lastDampingTimeStep=t);var e=this.velocity;o.scale(e,e,this.lastDampingScale),this.angularVelocity*=this.lastAngularDampingScale}},n.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=n.AWAKE,this.idleTime=0,t!==n.AWAKE&&this.emit(n.wakeUpEvent)},n.prototype.sleep=function(){this.sleepState=n.SLEEPING,this.angularVelocity=0,this.angularForce=0,o.set(this.velocity,0,0),o.set(this.force,0,0),this.emit(n.sleepEvent)},n.prototype.sleepTick=function(t,e,i){if(this.allowSleep&&this.type!==n.SLEEPING){this.wantsToSleep=!1;var s=(this.sleepState,o.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),r=Math.pow(this.sleepSpeedLimit,2);s>=r?(this.idleTime=0,this.sleepState=n.AWAKE):(this.idleTime+=i,this.sleepState=n.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},n.prototype.getVelocityFromPosition=function(t,e){return t=t||o.create(),o.sub(t,this.position,this.previousPosition),o.scale(t,t,1/e),t},n.prototype.getAngularVelocityFromPosition=function(t){return(this.angle-this.previousAngle)/t},n.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)},n.sleepyEvent={type:"sleepy"},n.sleepEvent={type:"sleep"},n.wakeUpEvent={type:"wakeup"},n.DYNAMIC=1,n.STATIC=2,n.KINEMATIC=4,n.AWAKE=0,n.SLEEPY=1,n.SLEEPING=2}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/Body.js","/objects")},{"../collision/AABB":11,"../events/EventEmitter":29,"../math/vec2":33,"../shapes/Convex":41,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1,"poly-decomp":9}],35:[function(t,e){(function(){function n(t,e,n){n=n||{},i.call(this,t,e,n),this.localAnchorA=o.fromValues(0,0),this.localAnchorB=o.fromValues(0,0),n.localAnchorA&&o.copy(this.localAnchorA,n.localAnchorA),n.localAnchorB&&o.copy(this.localAnchorB,n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB);var s=o.create(),r=o.create();this.getWorldAnchorA(s),this.getWorldAnchorB(r);var a=o.distance(s,r);this.restLength="number"==typeof n.restLength?n.restLength:a}var o=t("../math/vec2"),i=t("./Spring");t("../utils/Utils"),e.exports=n,n.prototype=new i,n.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},n.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},n.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},n.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var s=o.create(),r=o.create(),a=o.create(),u=o.create(),l=o.create(),h=o.create(),c=o.create(),d=o.create(),f=o.create();n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,n=this.restLength,i=this.bodyA,p=this.bodyB,m=s,y=r,g=a,v=u,_=f,b=l,w=h,E=c,A=d;this.getWorldAnchorA(b),this.getWorldAnchorB(w),o.sub(E,b,i.position),o.sub(A,w,p.position),o.sub(m,w,b);var S=o.len(m);o.normalize(y,m),o.sub(g,p.velocity,i.velocity),o.crossZV(_,p.angularVelocity,A),o.add(g,g,_),o.crossZV(_,i.angularVelocity,E),o.sub(g,g,_),o.scale(v,y,-t*(S-n)-e*o.dot(g,y)),o.sub(i.force,i.force,v),o.add(p.force,p.force,v);var x=o.crossLength(E,v),T=o.crossLength(A,v);i.angularForce-=x,p.angularForce+=T}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/LinearSpring.js","/objects")},{"../math/vec2":33,"../utils/Utils":52,"./Spring":37,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],36:[function(t,e){(function(){function n(t,e,n){n=n||{},o.call(this,t,e,n),this.restAngle="number"==typeof n.restAngle?n.restAngle:e.angle-t.angle}var o=(t("../math/vec2"),t("./Spring"));e.exports=n,n.prototype=new o,n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,n=this.restAngle,o=this.bodyA,i=this.bodyB,s=i.angle-o.angle,r=i.angularVelocity-o.angularVelocity,a=-t*(s-n)-e*r*0;o.angularForce-=a,i.angularForce+=a}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/RotationalSpring.js","/objects")},{"../math/vec2":33,"./Spring":37,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],37:[function(t,e){(function(){function n(t,e,n){n=o.defaults(n,{stiffness:100,damping:1}),this.stiffness=n.stiffness,this.damping=n.damping,this.bodyA=t,this.bodyB=e}var o=(t("../math/vec2"),t("../utils/Utils"));e.exports=n,n.prototype.applyForce=function(){}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/objects/Spring.js","/objects")},{"../math/vec2":33,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],38:[function(t,e){(function(){e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),GearConstraint:t("./constraints/GearConstraint"),GridBroadphase:t("./collision/GridBroadphase"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Rectangle:t("./shapes/Rectangle"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/p2.js","/")},{"../package.json":10,"./collision/AABB":11,"./collision/Broadphase":12,"./collision/GridBroadphase":13,"./collision/NaiveBroadphase":14,"./collision/Narrowphase":15,"./collision/SAPBroadphase":16,"./constraints/Constraint":17,"./constraints/DistanceConstraint":18,"./constraints/GearConstraint":19,"./constraints/LockConstraint":20,"./constraints/PrismaticConstraint":21,"./constraints/RevoluteConstraint":22,"./equations/AngleLockEquation":23,"./equations/ContactEquation":24,"./equations/Equation":25,"./equations/FrictionEquation":26,"./equations/RotationalVelocityEquation":28,"./events/EventEmitter":29,"./material/ContactMaterial":30,"./material/Material":31,"./math/vec2":33,"./objects/Body":34,"./objects/LinearSpring":35,"./objects/RotationalSpring":36,"./objects/Spring":37,"./shapes/Capsule":39,"./shapes/Circle":40,"./shapes/Convex":41,"./shapes/Heightfield":42,"./shapes/Line":43,"./shapes/Particle":44,"./shapes/Plane":45,"./shapes/Rectangle":46,"./shapes/Shape":47,"./solver/GSSolver":48,"./solver/Solver":49,"./utils/Utils":52,"./world/World":56,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],39:[function(t,e){(function(){function n(t,e){this.length=t||1,this.radius=e||1,o.call(this,o.CAPSULE)}var o=t("./Shape"),i=t("../math/vec2");e.exports=n,n.prototype=new o,n.prototype.computeMomentOfInertia=function(t){var e=this.radius,n=this.length+e,o=2*e;return t*(o*o+n*n)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var s=i.create();n.prototype.computeAABB=function(t,e,n){var o=this.radius;i.set(s,this.length/2,0),0!==n&&i.rotate(s,s,n),i.set(t.upperBound,Math.max(s[0]+o,-s[0]+o),Math.max(s[1]+o,-s[1]+o)),i.set(t.lowerBound,Math.min(s[0]-o,-s[0]-o),Math.min(s[1]-o,-s[1]-o)),i.add(t.lowerBound,t.lowerBound,e),i.add(t.upperBound,t.upperBound,e)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Capsule.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],40:[function(t,e){(function(){function n(t){this.radius=t||1,o.call(this,o.CIRCLE)}var o=t("./Shape"),i=t("../math/vec2");e.exports=n,n.prototype=new o,n.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},n.prototype.computeAABB=function(t,e){var n=this.radius;i.set(t.upperBound,n,n),i.set(t.lowerBound,-n,-n),e&&(i.add(t.lowerBound,t.lowerBound,e),i.add(t.upperBound,t.upperBound,e))}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Circle.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],41:[function(t,e){(function(){function n(t,e){this.vertices=[],this.axes=[];for(var n=0;n<t.length;n++){var s=i.create();i.copy(s,t[n]),this.vertices.push(s)}if(e)for(var n=0;n<e.length;n++){var r=i.create();i.copy(r,e[n]),this.axes.push(r)}else for(var n=0;n<t.length;n++){var a=t[n],u=t[(n+1)%t.length],l=i.create();i.sub(l,u,a),i.rotate90cw(l,l),i.normalize(l,l),this.axes.push(l)}if(this.centerOfMass=i.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,o.call(this,o.CONVEX),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var o=t("./Shape"),i=t("../math/vec2"),s=t("../math/polyk");t("poly-decomp"),e.exports=n,n.prototype=new o;var r=i.create(),a=i.create();n.prototype.projectOntoLocalAxis=function(t,e){for(var n,o,s=null,a=null,t=r,u=0;u<this.vertices.length;u++)n=this.vertices[u],o=i.dot(n,t),(null===s||o>s)&&(s=o),(null===a||a>o)&&(a=o);if(a>s){var l=a;a=s,s=l}i.set(e,a,s)},n.prototype.projectOntoWorldAxis=function(t,e,n,o){var s=a;this.projectOntoLocalAxis(t,o),0!==n?i.rotate(s,t,n):s=t;var r=i.dot(e,s);i.set(o,o[0]+r,o[1]+r)},n.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var n=this.vertices[e];t.push(n[0],n[1])}for(var o=s.Triangulate(t),e=0;e<o.length;e+=3){var i=o[e],r=o[e+1],a=o[e+2];this.triangles.push([i,r,a])}};var u=i.create(),l=i.create(),h=i.create(),c=i.create(),d=i.create();i.create(),i.create(),i.create(),i.create(),n.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,o=this.centerOfMass,s=u,r=h,a=c,f=d,p=l;i.set(o,0,0);for(var m=0,y=0;y!==t.length;y++){var g=t[y],r=e[g[0]],a=e[g[1]],f=e[g[2]];i.centroid(s,r,a,f);var v=n.triangleArea(r,a,f);m+=v,i.scale(p,s,v),i.add(o,o,p)}i.scale(o,o,1/m)},n.prototype.computeMomentOfInertia=function(t){for(var e=0,n=0,o=this.vertices.length,s=o-1,r=0;o>r;s=r,r++){var a=this.vertices[s],u=this.vertices[r],l=Math.abs(i.crossLength(a,u)),h=i.dot(u,u)+i.dot(u,a)+i.dot(a,a);e+=l*h,n+=l}return t/6*(e/n)},n.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,n=0;n!==t.length;n++){var o=i.squaredLength(t[n]);o>e&&(e=o)}this.boundingRadius=Math.sqrt(e)},n.triangleArea=function(t,e,n){return.5*((e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1]))},n.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,o=0;o!==t.length;o++){var i=t[o],s=e[i[0]],r=e[i[1]],a=e[i[2]],u=n.triangleArea(s,r,a);this.area+=u}},n.prototype.computeAABB=function(t,e,n){t.setFromPoints(this.vertices,e,n,0)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Convex.js","/shapes")},{"../math/polyk":32,"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1,"poly-decomp":9}],42:[function(t,e){(function(){function n(t,e){if(e=i.defaults(e,{maxValue:null,minValue:null,elementWidth:.1}),null===e.minValue||null===e.maxValue){e.maxValue=t[0],e.minValue=t[0];for(var n=0;n!==t.length;n++){var s=t[n];s>e.maxValue&&(e.maxValue=s),s<e.minValue&&(e.minValue=s)}}this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementWidth=e.elementWidth,o.call(this,o.HEIGHTFIELD)}var o=t("./Shape"),i=(t("../math/vec2"),t("../utils/Utils"));e.exports=n,n.prototype=new o,n.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.updateArea=function(){for(var t=this.data,e=0,n=0;n<t.length-1;n++)e+=(t[n]+t[n+1])/2*this.elementWidth;this.area=e},n.prototype.computeAABB=function(t,e){t.upperBound[0]=this.elementWidth*this.data.length+e[0],t.upperBound[1]=this.maxValue+e[1],t.lowerBound[0]=e[0],t.lowerBound[1]=-Number.MAX_VALUE}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Heightfield.js","/shapes")},{"../math/vec2":33,"../utils/Utils":52,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],43:[function(t,e){(function(){function n(t){this.length=t||1,o.call(this,o.LINE)}var o=t("./Shape"),i=t("../math/vec2");e.exports=n,n.prototype=new o,n.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var s=[i.create(),i.create()];n.prototype.computeAABB=function(t,e,n){var o=this.length/2;i.set(s[0],-o,0),i.set(s[1],o,0),t.setFromPoints(s,e,n,0)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Line.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],44:[function(t,e){(function(){function n(){o.call(this,o.PARTICLE)}var o=t("./Shape"),i=t("../math/vec2");e.exports=n,n.prototype=new o,n.prototype.computeMomentOfInertia=function(){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=0},n.prototype.computeAABB=function(t,e){i.copy(t.lowerBound,e),i.copy(t.upperBound,e)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Particle.js","/shapes")},{"../math/vec2":33,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],45:[function(t,e){(function(){function n(){o.call(this,o.PLANE)}var o=t("./Shape"),i=t("../math/vec2");t("../utils/Utils"),e.exports=n,n.prototype=new o,n.prototype.computeMomentOfInertia=function(){return 0},n.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},n.prototype.computeAABB=function(t,e,n){var o=0,s=i.set;"number"==typeof n&&(o=n%(2*Math.PI)),0===o?(s(t.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),s(t.upperBound,Number.MAX_VALUE,0)):o===Math.PI/2?(s(t.lowerBound,0,-Number.MAX_VALUE),s(t.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):o===Math.PI?(s(t.lowerBound,-Number.MAX_VALUE,0),s(t.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):o===3*Math.PI/2?(s(t.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),s(t.upperBound,0,Number.MAX_VALUE)):(s(t.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),s(t.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)),i.add(t.lowerBound,t.lowerBound,e),i.add(t.upperBound,t.upperBound,e)},n.prototype.updateArea=function(){this.area=Number.MAX_VALUE}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Plane.js","/shapes")},{"../math/vec2":33,"../utils/Utils":52,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],46:[function(t,e){(function(){function n(t,e){this.width=t||1,this.height=e||1;var n=[o.fromValues(-t/2,-e/2),o.fromValues(t/2,-e/2),o.fromValues(t/2,e/2),o.fromValues(-t/2,e/2)],r=[o.fromValues(1,0),o.fromValues(0,1)];s.call(this,n,r),this.type=i.RECTANGLE}var o=t("../math/vec2"),i=t("./Shape"),s=t("./Convex");e.exports=n,n.prototype=new s([]),n.prototype.computeMomentOfInertia=function(t){var e=this.width,n=this.height;return t*(n*n+e*e)/12},n.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},o.create(),o.create(),o.create(),o.create(),n.prototype.computeAABB=function(t,e,n){t.setFromPoints(this.vertices,e,n,0)
},n.prototype.updateArea=function(){this.area=this.width*this.height}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Rectangle.js","/shapes")},{"../math/vec2":33,"./Convex":41,"./Shape":47,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],47:[function(t,e){(function(){function t(e){this.type=e,this.id=t.idCounter++,this.boundingRadius=0,this.collisionGroup=1,this.collisionMask=1,e&&this.updateBoundingRadius(),this.material=null,this.area=0,this.sensor=!1,this.updateArea()}e.exports=t,t.idCounter=0,t.CIRCLE=1,t.PARTICLE=2,t.PLANE=4,t.CONVEX=8,t.LINE=16,t.RECTANGLE=32,t.CAPSULE=64,t.HEIGHTFIELD=128,t.prototype.computeMomentOfInertia=function(){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...")},t.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...")},t.prototype.updateArea=function(){},t.prototype.computeAABB=function(){}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/shapes/Shape.js","/shapes")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],48:[function(t,e){(function(){function n(t){s.call(this,t,s.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-10,this.arrayStep=30,this.lambda=new r.ARRAY_TYPE(this.arrayStep),this.Bs=new r.ARRAY_TYPE(this.arrayStep),this.invCs=new r.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}function o(t){for(var e=t.length;e--;)t[e]=0}var i=t("../math/vec2"),s=t("./Solver"),r=t("../utils/Utils"),a=t("../equations/FrictionEquation");e.exports=n,n.prototype=new s,n.prototype.solve=function(t,e){this.sortEquations();var s=0,u=this.iterations,l=this.frictionIterations,h=this.equations,c=h.length,d=Math.pow(this.tolerance*c,2),f=e.bodies,p=e.bodies.length,m=(i.add,i.set,this.useZeroRHS),y=this.lambda;if(this.usedIterations=0,c)for(var g=0;g!==p;g++){var v=f[g];v.updateSolveMassProperties()}y.length<c&&(y=this.lambda=new r.ARRAY_TYPE(c+this.arrayStep),this.Bs=new r.ARRAY_TYPE(c+this.arrayStep),this.invCs=new r.ARRAY_TYPE(c+this.arrayStep)),o(y);for(var _=this.invCs,b=this.Bs,y=this.lambda,g=0;g!==h.length;g++){var w=h[g];(w.timeStep!==t||w.needsUpdate)&&(w.timeStep=t,w.update()),b[g]=w.computeB(w.a,w.b,t),_[g]=w.computeInvC(w.epsilon)}var w,E,g,A;if(0!==c){for(g=0;g!==p;g++){var v=f[g];v.resetConstraintVelocity()}if(l){for(s=0;s!==l;s++){for(E=0,A=0;A!==c;A++){w=h[A];var S=n.iterateEquation(A,w,w.epsilon,b,_,y,m,t,s);E+=Math.abs(S)}if(this.usedIterations++,d>=E*E)break}for(n.updateMultipliers(h,y,1/t),A=0;A!==c;A++){var x=h[A];if(x instanceof a){for(var T=0,B=0;B!==x.contactEquations.length;B++)T+=x.contactEquations[B].multiplier;T*=x.frictionCoefficient/x.contactEquations.length,x.maxForce=T,x.minForce=-T}}}for(s=0;s!==u;s++){for(E=0,A=0;A!==c;A++){w=h[A];var S=n.iterateEquation(A,w,w.epsilon,b,_,y,m,t,s);E+=Math.abs(S)}if(this.usedIterations++,d>=E*E)break}for(g=0;g!==p;g++)f[g].addConstraintVelocity();n.updateMultipliers(h,y,1/t)}},n.updateMultipliers=function(t,e,n){for(var o=t.length;o--;)t[o].multiplier=e[o]*n},n.iterateEquation=function(t,e,n,o,i,s,r,a){var u=o[t],l=i[t],h=s[t],c=e.computeGWlambda(),d=e.maxForce,f=e.minForce;r&&(u=0);var p=l*(u-c-n*h),m=h+p;return f*a>m?p=f*a-h:m>d*a&&(p=d*a-h),s[t]+=p,e.addToWlambda(p),p}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/solver/GSSolver.js","/solver")},{"../equations/FrictionEquation":26,"../math/vec2":33,"../utils/Utils":52,"./Solver":49,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],49:[function(t,e){(function(){function n(t,e){t=t||{},o.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var o=(t("../utils/Utils"),t("../events/EventEmitter"));e.exports=n,n.prototype=new o,n.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var i={bodies:[]};n.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),i.bodies.length=0,e.getBodies(i.bodies),i.bodies.length&&this.solve(t,i))},n.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},n.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},n.prototype.addEquations=function(t){for(var e=0,n=t.length;e!==n;e++){var o=t[e];o.enabled&&this.equations.push(o)}},n.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},n.prototype.removeAllEquations=function(){this.equations.length=0},n.GS=1,n.ISLAND=2}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/solver/Solver.js","/solver")},{"../events/EventEmitter":29,"../utils/Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],50:[function(t,e){(function(){function n(){this.overlappingShapesLastState=new i,this.overlappingShapesCurrentState=new i,this.recordPool=[],this.tmpDict=new i,this.tmpArray1=[]}function o(t,e,n,o){this.shapeA=e,this.shapeB=o,this.bodyA=t,this.bodyB=n}var i=t("./TupleDictionary");t("./Utils"),e.exports=n,n.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,n=t.keys.length;n--;){var o=t.keys[n],i=t.getByKey(o),s=e.getByKey(o);i&&!s&&this.recordPool.push(i)}t.reset(),t.copy(e),e.reset()},n.prototype.setOverlapping=function(t,e,n,i){var s=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!s.get(e.id,i.id)){var r;this.recordPool.length?(r=this.recordPool.pop(),r.set(t,e,n,i)):r=new o(t,e,n,i),s.set(e.id,i.id,r)}},n.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},n.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},n.prototype.bodiesAreOverlapping=function(t,e){for(var n=this.overlappingShapesCurrentState,o=n.keys.length;o--;){var i=n.keys[o],s=n.data[i];if(s.bodyA===t&&s.bodyB===e||s.bodyA===e&&s.bodyB===t)return!0}return!1},n.prototype.getDiff=function(t,e,n){var n=n||[],o=t,i=e;n.length=0;for(var s=i.keys.length;s--;){var r=i.keys[s],a=i.data[r];if(!a)throw new Error("Key "+r+" had no data!");var u=o.data[r];u||n.push(a)}return n},n.prototype.isNewOverlap=function(t,e){var n=0|t.id,o=0|e.id,i=this.overlappingShapesLastState,s=this.overlappingShapesCurrentState;return!i.get(n,o)&&!!s.get(n,o)},n.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},n.prototype.getBodyDiff=function(t,e){e=e||[];for(var n=this.tmpDict,o=t.length;o--;){var i=t[o];n.set(0|i.bodyA.id,0|i.bodyB.id,i)}for(o=n.keys.length;o--;){var i=n.getByKey(n.keys[o]);i&&e.push(i.bodyA,i.bodyB)}return n.reset(),e},o.prototype.set=function(t,e,n,i){o.call(this,t,e,n,i)}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/utils/OverlapKeeper.js","/utils")},{"./TupleDictionary":51,"./Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],51:[function(t,e){(function(){function n(){this.data={},this.keys=[]}var o=t("./Utils");e.exports=n,n.prototype.getKey=function(t,e){return t=0|t,e=0|e,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},n.prototype.getByKey=function(t){return t=0|t,this.data[t]},n.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},n.prototype.set=function(t,e,n){if(!n)throw new Error("No data!");var o=this.getKey(t,e);return this.data[o]||this.keys.push(o),this.data[o]=n,o},n.prototype.reset=function(){for(var t=this.data,e=this.keys,n=e.length;n--;)delete t[e[n]];e.length=0},n.prototype.copy=function(t){this.reset(),o.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var n=t.keys[e];this.data[n]=t.data[n]}}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/utils/TupleDictionary.js","/utils")},{"./Utils":52,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],52:[function(t,e){(function(){function t(){}e.exports=t,t.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var n=0,o=e.length;n!==o;++n)t.push(e[n])},t.splice=function(t,e,n){n=n||1;for(var o=e,i=t.length-n;i>o;o++)t[o]=t[o+n];t.length=i},t.ARRAY_TYPE="undefined"!=typeof P2_ARRAY_TYPE?P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?Float32Array:Array,t.extend=function(t,e){for(var n in e)t[n]=e[n]},t.defaults=function(t,e){t=t||{};for(var n in e)n in t||(t[n]=e[n]);return t}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/utils/Utils.js","/utils")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],53:[function(t,e){(function(){function n(){this.equations=[],this.bodies=[]}var o=t("../objects/Body");e.exports=n,n.prototype.reset=function(){this.equations.length=this.bodies.length=0};var i=[];n.prototype.getBodies=function(t){var e=t||[],n=this.equations;i.length=0;for(var o=0;o!==n.length;o++){var s=n[o];-1===i.indexOf(s.bodyA.id)&&(e.push(s.bodyA),i.push(s.bodyA.id)),-1===i.indexOf(s.bodyB.id)&&(e.push(s.bodyB),i.push(s.bodyB.id))}return e},n.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===o.DYNAMIC&&!e.wantsToSleep)return!1}return!0},n.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return!0}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/Island.js","/world")},{"../objects/Body":34,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],54:[function(t,e){(function(){function n(){this._nodePool=[],this._islandPool=[],this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var o=(t("../math/vec2"),t("./Island")),i=t("./IslandNode"),s=t("../objects/Body");e.exports=n,n.getUnvisitedNode=function(t){for(var e=t.length,n=0;n!==e;n++){var o=t[n];if(!o.visited&&o.body.type===s.DYNAMIC)return o}return!1},n.prototype.visit=function(t,e,n){e.push(t.body);for(var o=t.equations.length,i=0;i!==o;i++){var s=t.equations[i];-1===n.indexOf(s)&&n.push(s)}},n.prototype.bfs=function(t,e,o){var i=this.queue;for(i.length=0,i.push(t),t.visited=!0,this.visit(t,e,o);i.length;)for(var r,a=i.pop();r=n.getUnvisitedNode(a.neighbors);)r.visited=!0,this.visit(r,e,o),r.body.type===s.DYNAMIC&&i.push(r)},n.prototype.split=function(t){for(var e=t.bodies,s=this.nodes,r=this.equations;s.length;)this._nodePool.push(s.pop());for(var a=0;a!==e.length;a++)if(this._nodePool.length){var u=this._nodePool.pop();u.reset(),u.body=e[a],s.push(u)}else s.push(new i(e[a]));for(var l=0;l!==r.length;l++){var h=r[l],a=e.indexOf(h.bodyA),c=e.indexOf(h.bodyB),d=s[a],f=s[c];d.neighbors.push(f),f.neighbors.push(d),d.equations.push(h),f.equations.push(h)}for(var p=this.islands;p.length;){var m=p.pop();m.reset(),this._islandPool.push(m)}for(var y;y=n.getUnvisitedNode(s);){var m=this._islandPool.length?this._islandPool.pop():new o;this.bfs(y,m.bodies,m.equations),p.push(m)}return p}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/IslandManager.js","/world")},{"../math/vec2":33,"../objects/Body":34,"./Island":53,"./IslandNode":55,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],55:[function(t,e){(function(){function t(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=t,t.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/IslandNode.js","/world")},{"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}],56:[function(t,e){(function(){function n(t){c.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new o,this.narrowphase=new m(this),this.islandManager=new v,this.gravity=s.fromValues(0,-9.78),t.gravity&&s.copy(this.gravity,t.gravity),this.frictionGravity=s.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.doProfiling=t.doProfiling||!1,this.lastStepTime=0,this.broadphase=t.broadphase||new i,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new f,this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.fixedStepTime=0,this.islandSplit="undefined"!=typeof t.islandSplit?!!t.islandSplit:!1,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=n.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new g}var o=t("../solver/GSSolver"),i=(t("../solver/Solver"),t("../collision/NaiveBroadphase")),s=t("../math/vec2"),r=t("../shapes/Circle"),a=(t("../shapes/Rectangle"),t("../shapes/Convex")),u=(t("../shapes/Line"),t("../shapes/Plane")),l=t("../shapes/Capsule"),h=t("../shapes/Particle"),c=t("../events/EventEmitter"),d=t("../objects/Body"),f=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),p=t("../material/ContactMaterial"),m=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/SAPBroadphase"),t("../collision/Narrowphase")),y=t("../utils/Utils"),g=t("../utils/OverlapKeeper"),v=t("./IslandManager");if(t("../objects/RotationalSpring"),e.exports=n,"undefined"==typeof performance&&(performance={}),!performance.now){var _=Date.now();performance.timing&&performance.timing.navigationStart&&(_=performance.timing.navigationStart),performance.now=function(){return Date.now()-_}}n.prototype=new Object(c.prototype),n.NO_SLEEPING=1,n.BODY_SLEEPING=2,n.ISLAND_SLEEPING=4,n.prototype.addConstraint=function(t){this.constraints.push(t)},n.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},n.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&y.splice(this.contactMaterials,e,1)},n.prototype.getContactMaterial=function(t,e){for(var n=this.contactMaterials,o=0,i=n.length;o!==i;o++){var s=n[o];if(s.materialA.id===t.id&&s.materialB.id===e.id||s.materialA.id===e.id&&s.materialB.id===t.id)return s}return!1},n.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&y.splice(this.constraints,e,1)};var b=(s.create(),s.create(),s.create(),s.create(),s.create(),s.create(),s.create()),w=s.fromValues(0,0),E=s.fromValues(0,0),A=(s.fromValues(0,0),s.fromValues(0,0));n.prototype.step=function(t,e,n){if(n=n||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{var o=Math.floor((this.time+e)/t)-Math.floor(this.time/t);o=Math.min(o,n);for(var i=performance.now(),r=0;r!==o&&(this.internalStep(t),!(performance.now()-i>1e3*t));r++);this.time+=e;for(var a=this.time%t,u=a/t,l=0;l!==this.bodies.length;l++){var h=this.bodies[l];h.type!==d.STATIC&&h.sleepState!==d.SLEEPING?(s.sub(A,h.position,h.previousPosition),s.scale(A,A,u),s.add(h.interpolatedPosition,h.position,A),h.interpolatedAngle=h.angle+(h.angle-h.previousAngle)*u):(s.copy(h.interpolatedPosition,h.position),h.interpolatedAngle=h.angle)}}};var S=[];n.prototype.internalStep=function(t){this.stepping=!0;var e,o,i=this,r=this.doProfiling,a=this.springs.length,u=this.springs,l=this.bodies,h=this.gravity,c=this.solver,f=this.bodies.length,p=this.broadphase,m=this.narrowphase,g=this.constraints,v=b,_=(s.scale,s.add),w=(s.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,r&&(e=performance.now()),this.useWorldGravityAsFrictionGravity){var E=s.length(this.gravity);0===E&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=E)}if(this.applyGravity)for(var A=0;A!==f;A++){var x=l[A],T=x.force;x.type===d.DYNAMIC&&x.sleepState!==d.SLEEPING&&(s.scale(v,h,x.mass*x.gravityScale),_(T,T,v))}if(this.applySpringForces)for(var A=0;A!==a;A++){var B=u[A];B.applyForce()}if(this.applyDamping)for(var A=0;A!==f;A++){var x=l[A];x.type===d.DYNAMIC&&x.applyDamping(t)}for(var C=p.getCollisionPairs(this),L=this.disabledBodyCollisionPairs,A=L.length-2;A>=0;A-=2)for(var M=C.length-2;M>=0;M-=2)(L[A]===C[M]&&L[A+1]===C[M+1]||L[A+1]===C[M]&&L[A]===C[M+1])&&C.splice(M,2);var P=g.length;for(A=0;A!==P;A++){var I=g[A];if(!I.collideConnected)for(var M=C.length-2;M>=0;M-=2)(I.bodyA===C[M]&&I.bodyB===C[M+1]||I.bodyB===C[M]&&I.bodyA===C[M+1])&&C.splice(M,2)}this.postBroadphaseEvent.pairs=C,this.emit(this.postBroadphaseEvent),m.reset(this);for(var A=0,R=C.length;A!==R;A+=2)for(var O=C[A],q=C[A+1],j=0,U=O.shapes.length;j!==U;j++)for(var F=O.shapes[j],k=O.shapeOffsets[j],N=O.shapeAngles[j],D=0,V=q.shapes.length;D!==V;D++){var G=q.shapes[D],X=q.shapeOffsets[D],Y=q.shapeAngles[D],H=this.defaultContactMaterial;if(F.material&&G.material){var z=this.getContactMaterial(F.material,G.material);z&&(H=z)}this.runNarrowphase(m,O,F,k,N,q,G,X,Y,H,this.frictionGravity)}for(var A=0;A!==f;A++){var W=l[A];W._wakeUpAfterNarrowphase&&(W.wakeUp(),W._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(S);for(var K=this.endContactEvent,D=S.length;D--;){var $=S[D];K.shapeA=$.shapeA,K.shapeB=$.shapeB,K.bodyA=$.bodyA,K.bodyB=$.bodyA,this.emit(K)}}var J=this.preSolveEvent;J.contactEquations=m.contactEquations,J.frictionEquations=m.frictionEquations,this.emit(J);var P=g.length;for(A=0;A!==P;A++)g[A].update();if(m.contactEquations.length||m.frictionEquations.length||g.length)if(this.islandSplit){for(w.equations.length=0,y.appendArray(w.equations,m.contactEquations),y.appendArray(w.equations,m.frictionEquations),A=0;A!==P;A++)y.appendArray(w.equations,g[A].equations);w.split(this);for(var A=0;A!==w.islands.length;A++){var Q=w.islands[A];Q.equations.length&&c.solveIsland(t,Q)}}else{for(c.addEquations(m.contactEquations),c.addEquations(m.frictionEquations),A=0;A!==P;A++)c.addEquations(g[A].equations);this.solveConstraints&&c.solve(t,this),c.removeAllEquations()}for(var A=0;A!==f;A++){var W=l[A];W.sleepState!==d.SLEEPING&&W.type!==d.STATIC&&n.integrateBody(W,t)}for(var A=0;A!==f;A++)l[A].setZeroForce();if(r&&(o=performance.now(),i.lastStepTime=o-e),this.emitImpactEvent&&this.has("impact"))for(var Z=this.impactEvent,A=0;A!==m.contactEquations.length;A++){var te=m.contactEquations[A];te.firstImpact&&(Z.bodyA=te.bodyA,Z.bodyB=te.bodyB,Z.shapeA=te.shapeA,Z.shapeB=te.shapeB,Z.contactEquation=te,this.emit(Z))}if(this.sleepMode===n.BODY_SLEEPING)for(A=0;A!==f;A++)l[A].sleepTick(this.time,!1,t);else if(this.sleepMode===n.ISLAND_SLEEPING&&this.islandSplit){for(A=0;A!==f;A++)l[A].sleepTick(this.time,!0,t);for(var A=0;A<this.islandManager.islands.length;A++){var Q=this.islandManager.islands[A];Q.wantsToSleep()&&Q.sleep()}}if(this.stepping=!1,this.bodiesToBeRemoved.length){for(var A=0;A!==this.bodiesToBeRemoved.length;A++)this.removeBody(this.bodiesToBeRemoved[A]);this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};var x=s.create(),T=s.create();n.integrateBody=function(t,e){var n=t.invMass,o=t.force,i=t.position,r=t.velocity;s.copy(t.previousPosition,t.position),t.previousAngle=t.angle,t.fixedRotation||(t.angularVelocity+=t.angularForce*t.invInertia*e,t.angle+=t.angularVelocity*e),s.scale(x,o,e*n),s.add(r,x,r),s.scale(T,r,e),s.add(i,i,T),t.aabbNeedsUpdate=!0},n.prototype.runNarrowphase=function(t,e,n,o,i,r,a,u,l,h,c){if(0!==(n.collisionGroup&a.collisionMask)&&0!==(a.collisionGroup&n.collisionMask)){s.rotate(w,o,e.angle),s.rotate(E,u,r.angle),s.add(w,w,e.position),s.add(E,E,r.position);var f=i+e.angle,p=l+r.angle;t.enableFriction=h.friction>0,t.frictionCoefficient=h.friction;var m;m=e.type===d.STATIC||e.type===d.KINEMATIC?r.mass:r.type===d.STATIC||r.type===d.KINEMATIC?e.mass:e.mass*r.mass/(e.mass+r.mass),t.slipForce=h.friction*c*m,t.restitution=h.restitution,t.surfaceVelocity=h.surfaceVelocity,t.frictionStiffness=h.frictionStiffness,t.frictionRelaxation=h.frictionRelaxation,t.stiffness=h.stiffness,t.relaxation=h.relaxation,t.contactSkinSize=h.contactSkinSize;var y=t[n.type|a.type],g=0;if(y){var v=n.sensor||a.sensor,_=t.frictionEquations.length;g=n.type<a.type?y.call(t,e,n,w,f,r,a,E,p,v):y.call(t,r,a,E,p,e,n,w,f,v);var b=t.frictionEquations.length-_;if(g){if(e.allowSleep&&e.type===d.DYNAMIC&&e.sleepState===d.SLEEPING&&r.sleepState===d.AWAKE&&r.type!==d.STATIC){var A=s.squaredLength(r.velocity)+Math.pow(r.angularVelocity,2),S=Math.pow(r.sleepSpeedLimit,2);A>=2*S&&(e._wakeUpAfterNarrowphase=!0)}if(r.allowSleep&&r.type===d.DYNAMIC&&r.sleepState===d.SLEEPING&&e.sleepState===d.AWAKE&&e.type!==d.STATIC){var x=s.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2),T=Math.pow(e.sleepSpeedLimit,2);x>=2*T&&(r._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,n,r,a),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(n,a)){var B=this.beginContactEvent;if(B.shapeA=n,B.shapeB=a,B.bodyA=e,B.bodyB=r,B.contactEquations.length=0,"number"==typeof g)for(var C=t.contactEquations.length-g;C<t.contactEquations.length;C++)B.contactEquations.push(t.contactEquations[C]);this.emit(B)}if("number"==typeof g&&b>1)for(var C=t.frictionEquations.length-b;C<t.frictionEquations.length;C++){var L=t.frictionEquations[C];L.setSlipForce(L.getSlipForce()/b)}}}}},n.prototype.addSpring=function(t){this.springs.push(t),this.addSpringEvent.spring=t,this.emit(this.addSpringEvent)},n.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&y.splice(this.springs,e,1)},n.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(this.bodies.push(t),t.world=this,this.addBodyEvent.body=t,this.emit(this.addBodyEvent))},n.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(y.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent))}},n.prototype.getBodyById=function(t){for(var e=this.bodies,n=0;n<e.length;n++){var o=e[n];if(o.id===t)return o}return!1},n.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},n.prototype.enableBodyCollision=function(t,e){for(var n=this.disabledBodyCollisionPairs,o=0;o<n.length;o+=2)if(n[o]===t&&n[o+1]===e||n[o+1]===t&&n[o]===e)return void n.splice(o,2)},n.prototype.clear=function(){this.time=0,this.fixedStepTime=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);for(var o=this.bodies,e=o.length-1;e>=0;e--)this.removeBody(o[e]);for(var i=this.springs,e=i.length-1;e>=0;e--)this.removeSpring(i[e]);for(var s=this.contactMaterials,e=s.length-1;e>=0;e--)this.removeContactMaterial(s[e]);n.apply(this)},n.prototype.clone=function(){var t=new n;return t.fromJSON(this.toJSON()),t};var B=s.create(),C=s.fromValues(0,0),L=s.fromValues(0,0);n.prototype.hitTest=function(t,e,n){n=n||0;var o=new d({position:t}),i=new h,c=t,f=0,p=B,m=C,y=L;o.addShape(i);for(var g=this.narrowphase,v=[],_=0,b=e.length;_!==b;_++)for(var w=e[_],E=0,A=w.shapes.length;E!==A;E++){var S=w.shapes[E],x=w.shapeOffsets[E]||m,T=w.shapeAngles[E]||0;s.rotate(p,x,w.angle),s.add(p,p,w.position);var M=T+w.angle;(S instanceof r&&g.circleParticle(w,S,p,M,o,i,c,f,!0)||S instanceof a&&g.particleConvex(o,i,c,f,w,S,p,M,!0)||S instanceof u&&g.particlePlane(o,i,c,f,w,S,p,M,!0)||S instanceof l&&g.particleCapsule(o,i,c,f,w,S,p,M,!0)||S instanceof h&&s.squaredLength(s.sub(y,p,t))<n*n)&&v.push(w)}return v},n.prototype.setGlobalEquationParameters=function(t){t=t||{};for(var e=0;e!==this.constraints.length;e++)for(var n=this.constraints[e],o=0;o!==n.equations.length;o++){var i=n.equations[o];"undefined"!=typeof t.stiffness&&(i.stiffness=t.stiffness),"undefined"!=typeof t.relaxation&&(i.relaxation=t.relaxation),i.needsUpdate=!0}for(var e=0;e!==this.contactMaterials.length;e++){var n=this.contactMaterials[e];"undefined"!=typeof t.stiffness&&(n.stiffness=t.stiffness,n.frictionStiffness=t.stiffness),"undefined"!=typeof t.relaxation&&(n.relaxation=t.relaxation,n.frictionRelaxation=t.relaxation)}var n=this.defaultContactMaterial;"undefined"!=typeof t.stiffness&&(n.stiffness=t.stiffness,n.frictionStiffness=t.stiffness),"undefined"!=typeof t.relaxation&&(n.relaxation=t.relaxation,n.frictionRelaxation=t.relaxation)},n.prototype.setGlobalStiffness=function(t){this.setGlobalEquationParameters({stiffness:t})},n.prototype.setGlobalRelaxation=function(t){this.setGlobalEquationParameters({relaxation:t})}}).call(this,t("/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/world/World.js","/world")},{"../../package.json":10,"../collision/Broadphase":12,"../collision/NaiveBroadphase":14,"../collision/Narrowphase":15,"../collision/SAPBroadphase":16,"../constraints/Constraint":17,"../constraints/DistanceConstraint":18,"../constraints/GearConstraint":19,"../constraints/LockConstraint":20,"../constraints/PrismaticConstraint":21,"../constraints/RevoluteConstraint":22,"../events/EventEmitter":29,"../material/ContactMaterial":30,"../material/Material":31,"../math/vec2":33,"../objects/Body":34,"../objects/LinearSpring":35,"../objects/RotationalSpring":36,"../shapes/Capsule":39,"../shapes/Circle":40,"../shapes/Convex":41,"../shapes/Line":43,"../shapes/Particle":44,"../shapes/Plane":45,"../shapes/Rectangle":46,"../shapes/Shape":47,"../solver/GSSolver":48,"../solver/Solver":49,"../utils/OverlapKeeper":50,"../utils/Utils":52,"./IslandManager":54,"/Users/schteppe/git/p2.js/node_modules/grunt-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":4,buffer:1}]},{},[38])(38)}),soya2d.Physics=function(t){function e(){i=[],s=[]}function n(t,e){if(t){t.sort(function(t,e){return t.order-e.order});for(var n=o.scene,a=t.length;a--;){var u=t[a].context,l=null,h=null;if(("contactstart"==e||"contactend"==e)&&(l="contactstart"==e?i:s),u instanceof soya2d.DisplayObject&&u!=n&&("contactstart"==e||"contactend"==e)){for(var c=!1,d=l.length;d--;){var f=l[d];if(f.a==u||f.b==u){c=!0,h=f.a==u?f.b:f.a;break}}if(!c)continue}r.collisionPairs=l,r.otherCollider=h,t[a].fn.call(u,r)}}}t=t||{},t.gravity=t.gravity||[0,9.8],t.gravity[0]=t.gravity[0]||0,t.gravity[1]=t.gravity[1]||9.8,t.friction=t.friction||1,t.bounce=t.bounce||.5,t.stiffness=t.stiffness||1e5,t.relaxation=t.relaxation||20,t.tolerance=t.tolerance||.01,this.world=new p2.World(t),this.world.defaultContactMaterial.friction=1,this.world.defaultContactMaterial.restitution=t.bounce,this.world.defaultContactMaterial.stiffness=t.stiffness,this.world.defaultContactMaterial.relaxation=t.relaxation,this.world.solver.tolerance=t.tolerance;var o,i=[],s=[];this.startListen=function(t){return o=t,this.world.on("beginContact",function(t){i.push({a:t.bodyA.ro,b:t.bodyB.ro})},this),this.world.on("endContact",function(t){s.push({a:t.bodyA.ro,b:t.bodyB.ro})},this),this},this.stopListen=function(){return this},this.scan=function(){if(i.length>0){var t=this.__eventMap.contactstart;n(t,"contactstart")}if(s.length>0){var t=this.__eventMap.contactend;n(t,"contactend")}e()};var r={collisionPairs:null,otherCollider:null};this.bind=function(t,e){e=e||{};var n,o=0,i=0;if(o=t.w/2,i=t.h/2,t.bounds instanceof soya2d.Rectangle)n=new p2.Rectangle(t.w,t.h);else if(t.bounds instanceof soya2d.Circle)n=new p2.Circle(t.bounds.r);else if(t.bounds instanceof soya2d.Polygon){for(var s=t.bounds.vtx,r=[],a=0;a<s.length;a+=2)r.push([s[a]-o,s[a+1]-i]);n=new p2.Convex(r)}switch(e.mass=0===e.mass?0:e.mass||1,e.sensor=e.sensor||!1,e.position=[t.x+o,t.y+i],e.angularVelocity=e.angularVelocity||0,e.fixedRotation=e.fixedRotation||!1,e.angle=t.rotation,e.type){case soya2d.PHY_STATIC:e.type=p2.Body.STATIC;
break;case soya2d.PHY_DYNAMIC:default:e.type=p2.Body.DYNAMIC,0==e.mass&&(e.type=p2.Body.KINEMATIC)}var u=new p2.Body(e);n.sensor=e.sensor,u.addShape(n),this.world.addBody(u),t.body=u,u.ro=t},this.unbind=function(t){this.world.removeBody(t.body),t.body=null,delete t.body},this.update=function(t){this.world.step(t);for(var e=this.world.bodies.length;e--;){var n=this.world.bodies[e],o=n.ro;if(o&&!isNaN(n.position[0])){var i=0,s=0;i=o.w/2,s=o.h/2,o.x=n.position[0]-i,o.y=n.position[1]-s,o.rotation=n.angle*soya2d.Math.ONEANG}}},soya2d.EventHandler.call(this)},soya2d.inherits(soya2d.Physics,soya2d.EventHandler),Object.defineProperties(p2.Body.prototype,{x:{set:function(t){this.position[0]=t+this.ro.w/2},get:function(){return this.position[0]-this.ro.w/2},enumerable:!0},y:{set:function(t){this.position[1]=t+this.ro.h/2},get:function(){return this.position[1]-this.ro.h/2},enumerable:!0},rotation:{set:function(t){this.angle=t},get:function(){return this.angle*soya2d.Math.ONEANG},enumerable:!0}}),soya2d.PHY_STATIC=1,soya2d.PHY_DYNAMIC=2,soya2d.EVENT_CONTACTSTART="contactstart",soya2d.EVENT_CONTACTEND="contactend",soya2d.module.install("physics",{onInit:function(t){t.startPhysics=function(e){if(!t.physics){t.physics=new soya2d.Physics(e);var n=["contactstart","contactend"];return t.events.register(n,t.physics),t.physics.startListen(t),t.physics}},t.stopPhysics=function(){t.physics=null}},onUpdate:function(t){t.physics&&t.physics.update(1/60)}}),!function(){"use strict";function t(){var t=1,e=[],n={};this.scheduleTask=function(t,o){o._taskKey&&console.error("a trigger can only bind one task simultaneously"),n[t.key]=t,o._taskKey=t.key,e.push(o)},this.unscheduleTask=function(t){delete n[t];for(var o=0;o<e.length&&e[o]._taskKey!=t;o++);e.length<1||(e[o]._reset(),e.splice(o,1))},this.clear=function(){n={};for(var t=0;t<e.length;t++)e[t]._reset();e=[]},this.triggerTask=function(t){n[t].cbk&&n[t].cbk()},this.isRunning=function(){return 1===t?!0:!1},this.pause=function(){t=2},this.resume=function(){t=1};var o=1e3;this._scanTasks=function(i){if(2!==t){for(var s=[],r=e.length;r--;){var a=e[r],u=n[a._taskKey],l=!1;if(a.milliseconds+=i,a.type===soya2d.TRIGGER_TYPE_FRAME)a._frameCount++,a.canTrigger()&&(l=!0,1===a._frameInfo.canTriggerTimes&&s.push(u.key));else if(a.type===soya2d.TRIGGER_TYPE_TIME){var h=a.milliseconds-a._lastTriggerMilliseconds;a.canTrigger()&&h>=o&&(l=!0,a._lastTriggerMilliseconds=a.milliseconds),a._canUnload()&&s.push(u.key)}l&&u.cbk&&(a.times++,u.cbk(a.key,a.milliseconds,a.times,a._frameCount||a._t))}for(var r=s.length;r--;)this.unscheduleTask(s[r])}}}var e=new t;soya2d.getScheduler=function(){return e}}(),soya2d.TRIGGER_TYPE_FRAME=1,soya2d.TRIGGER_TYPE_TIME=2,soya2d.Task=function(t,e){this.key=t,this.cbk=e},!function(){function t(t){var e,n,o,i,s;if("*"==t)e=-1,n=0,o=-1;else if((n=parseInt(t))==t)o=1,e=0;else if(2===(s=t.split("/")).length){e=parseInt(s[1]);var r;if(2===(r=s[0].split("-")).length){i=[];for(var a=r[0]>>0,u=r[1]>>0;u>=a;a++)i.push(a);i.sort(function(t,e){return t-e}),o=i.length}else(n=parseInt(s[0]))||(n=0),o=-1}else if((s=t.split(",")).length>1){i=[];for(var e=s.length;e--;)i.push(s[e]>>0);i.sort(function(t,e){return t-e}),o=s.length}else if(2===(s=t.split("-")).length){i=[];for(var a=s[0]>>0,u=s[1]>>0;u>=a;a++)i.push(a);i.sort(function(t,e){return t-e}),o=i.length}return[e,n,o,i]}function e(t,e){if(-1===t.canTriggerTimes){if(-1===t.interval)return!0;var n=e-t.startOff;if(0===n)return!1;if(!(n%t.interval))return!0}else if(1===t.canTriggerTimes&&e===t.startOff)return!0;return!1}function n(t){var e=t.milliseconds/1e3,n=t._t[0]=e%60>>0,i=t._t[1]=e/60%60>>0,s=t._t[2]=e/60/60>>0;return o(t._timeInfo.hour,s)?o(t._timeInfo.min,i)?o(t._timeInfo.sec,n)?!0:!1:!1:!1}function o(t,e){if(1===t[2]){if(t[0]!==e)return!1}else if(-1===t[2]&&-1===t[0]);else if(t[3]&&!t[0]){if(t[3].indexOf(e)<0)return!1}else if(-1===t[2]&&t[0]>0||t[0]>0&&t[3]){if(t[3]&&t[3].indexOf(e)<0)return!1;var n=e-t[1];if(0>=n&&0!=t[1])return!1;if(n%t[0])return!1}return!0}soya2d.Trigger=function(o,i,s){switch(this.type=s||soya2d.TRIGGER_TYPE_FRAME,this.exp=i,this.key=o,this.times=0,this.priority=0,this.milliseconds=0,this._taskKey,this._frameCount=0,this._lastTriggerMilliseconds=-1e3,this._t=[],this._reset=function(){this.times=0,this._taskKey=null,this._frameCount=0,this.milliseconds=0,this._lastTriggerMilliseconds=-1e3,this._t=[],delete this._frameInfo,delete this._timeInfo},this._canUnload=function(){var t=this._timeInfo.hour;if(1===t[2]){if(this._t[2]>t[0])return!0}else if(t[2]>1&&this._t[2]>t[3][t[3].length-1])return!0},this.canTrigger=function(){switch(this.type){case soya2d.TRIGGER_TYPE_FRAME:return e(this._frameInfo,this._frameCount);case soya2d.TRIGGER_TYPE_TIME:return n(this)}},this.type){case soya2d.TRIGGER_TYPE_FRAME:/^(\*|(?:(?:[0-9]+|\*)\/[0-9]+)|[0-9]+)$/.test(i)||console.error("invalid trigger expression -- "+i);var r=t(RegExp.$1);this._frameInfo={canTriggerTimes:r[2],startOff:r[1],interval:r[0]};break;case soya2d.TRIGGER_TYPE_TIME:/^(\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+)) (\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+)) (\*|(?:[0-9]+(?:,[0-9]+)*)|(?:[0-9]+-[0-9]+)|(?:(?:(?:[0-9]+(?:-[0-9]+)?)|\*)\/[0-9]+))$/.test(i)||console.error("invalid trigger expression -- "+i);var a=t(RegExp.$1),u=t(RegExp.$2),l=t(RegExp.$3);this._timeInfo={sec:a,min:u,hour:l}}}}(),soya2d.module.install("task",{onInit:function(t){t.addTask=function(t,e,n){var o="soya_task_"+Date.now()+999*Math.random(),i=soya2d.getScheduler(),s=this,r=new soya2d.Task(o,function(n,o,i,r){t&&t.call&&t(s,e||"*",o,i,r)}),a=new soya2d.Trigger(o+"_trigger",e||"*",n);return i.scheduleTask(r,a),o},t.removeTask=function(t){var e=soya2d.getScheduler();e.unscheduleTask(t)}},onUpdate:function(t,e,n){var o=soya2d.getScheduler();o._scanTasks(0>n?-n:n)}});